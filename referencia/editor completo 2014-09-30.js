(function(){this.JST||(this.JST={}),this.JST["templates/archive-panel"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<h1>"),null!=this.addresses?(null!=this.addresses.from&&(i.push("  <strong>"+t(e(this.t("archive_panel.from")+":"))+"</strong>"),i.push("  "+t(e(this.h.formatAddress(this.addresses.from))))),null!=this.addresses.to&&(i.push("  <strong>"+t(e(" | "+this.t("archive_panel.to")+":"))+"</strong>"),i.push("  "+t(e(this.h.formatAddress(this.addresses.to)))))):i.push("  "+t(e(this.t("archive_panel.loading")))),i.push("</h1>\n<section class='clearfix panel-contents'>\n  <form class='clearfix'>\n    <fieldset>\n      <p class='legend'>"+t(e(this.t("archive_panel.actions.title")+":"))+"</p>\n      <button class='btn create-road' disabled>"+t(e(this.t("archive_panel.actions.create_road")))+"</button>\n    </fieldset>\n  </form>\n</section>\n<div class='form-container'>\n  <form class='clearfix panel-action' id='archive-actions'></form>\n  <nav class='problem-panel-navigation'>\n    <button class='btn close-button'>\n      <span>"+t(e(this.t("archive_panel.actions.close")))+"</span>\n    </button>\n  </nav>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}).call(this),function(){this.JST||(this.JST={}),this.JST["templates/archive-sessions"]=function(e){return function(){var e,t,i,n,s,r,o;if(t=window.HAML.escape,e=window.HAML.cleanValue,i=[],this.sessions.isEmpty())i.push("<p class='message'>\n  <strong>"),i.push("    "+t(e(this.t("user.drives.no_drives")))),i.push("  </strong>\n</p>\n<p class='message'>"),i.push("  "+t(e(this.t("user.drives.no_drives_explanation")))),i.push("</p>");else{for(i.push("<p class='message'>"),i.push("  "+t(e(this.t("user.drives.subtitle")+":"))),i.push("</p>\n<ul class='result-list'>"),o=this.sessions,s=0,r=o.length;r>s;s++)n=o[s],i.push("  <li class='"+["result","session",""+t(e(n.hasFullSession?"session-available":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' data-id='"+t(e(n.id))+"'>\n    <p class='title'>"+t(e(this.h.dateString(n.startTime)))+"</p>\n    <p class='additional-info clearfix'>\n      <span>"+t(e(this.h.distanceString(n.totalRoadMeters)))+"</span>\n      <span>"+t(e(this.h.durationString(n.startTime,n.endTime)))+"</span>\n    </p>\n  </li>");i.push("</ul>")}return i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/camera-edit"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<div class='selection-text'>"+t(e(this.t("edit.camera.title")))+"</div>\n<div class='tab-content'>\n  <div class='active tab-pane' id='camera-edit-general'>\n    <p class='message'>"+t(e(this.typeName))+"</p>\n  </div>\n  <form class='attributes-form'>\n    <div class='form-group'>\n      <label class='control-label'>"+t(e(this.t("edit.camera.fields.speed")))),i.push("        "+t(e("("+(this.model.isImperial?"mp/h":"km/h")+")"))),i.push("      </label>\n      <div class='controls'>\n        <input class='form-control' type='number' name='speed' maxlength='4' value='"+t(e(this.h.getDisplayUnitValue("speed","km",!0,this)))+"' data-units='"+t(e(this.UNITS.speed))+"' data-display-units='"+t(e(this.h.getDisplayUnit(this.UNITS.speed,this)))+"' data-round='true'>\n        <label class='checkbox'>\n          <input type='checkbox' name='validated' checked='"+t(e(this.attributes.validated))+"' disabled='"+t(e(!this.isValidationStateEditable))+"'>"),i.push("          "+t(e(this.t("edit.camera.fields.approved")))),i.push("        </label>\n      </div>\n    </div>\n  </form>\n  <ul class='additional-attributes list-unstyled'>"),null!=this.attributes.updatedBy&&i.push("    <li>"+t(e(this.t("edit.updated",{time:this.h.dateOnlyString(this.attributes.updatedOn),user:this.h.formatUserName(this.attributes.updatedBy)})))+"</li>"),null!=this.attributes.createdBy&&i.push("    <li>"+t(e(this.t("edit.created",{time:this.h.dateOnlyString(this.attributes.createdOn),user:this.h.formatUserName(this.attributes.createdBy)})))+"</li>"),i.push("    <li>"+t(e(this.t("edit.id",{num:this.getID()})))+"</li>\n  </ul>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/chat"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<div id='chat-toggle'>\n  <button class='toggle'></button>\n</div>"),i.push(""+e(this.h.hidableMessage("chat_intro_tip"))),i.push("<div id='chat'>\n  <div class='header'>\n    <span class='room-name single-room-label'></span>\n    <div class='dropdown room-selector'>\n      <a class='dropdown-toggle' data-toggle='dropdown' href='#' role='menu'>\n        <span class='room-name'></span>\n        <i class='icon-angle-down'></i>\n      </a>\n      <ul class='dropdown-menu rooms'></ul>\n    </div>\n    <div class='dropdown visibilty-menu'>\n      <a class='dropdown-toggle' data-toggle='dropdown' href='#' role='menu'>\n        <span class='status'>"+t(e(this.status))+"</span>\n        <i class='icon-angle-down'></i>\n      </a>\n      <ul class='dropdown-menu visibility'>\n        <li class='visibility-visible'>\n          <a href='#'>"+t(e(this.t("chat.visible")))+"</a>\n        </li>\n        <li class='visibility-invisible'>\n          <a href='#'>"+t(e(this.t("chat.invisible")))+"</a>\n        </li>\n      </ul>\n    </div>\n    <button class='minimize' aria-hidden='true' type='button'>_</button>\n  </div>\n  <div class='not-connected-message'>Not Connected</div>\n  <div class='chat-body'>\n    <div class='messages'>\n      <div class='message-list'></div>\n      <a class='unread-messages-notification' href='#'></a>\n      <div class='new-message'>\n        <input class='message-input' placeholder='"+t(e(this.t("chat.placeholder")))+"' data-auto-rtl>\n      </div>\n    </div>\n    <div class='users'>\n      <ul class='list-unstyled user-list'></ul>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/chat_intro_tip"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<div class='chat-intro-tip hidable-message popover top'>\n  <div class='arrow'></div>\n  <div class='popover-content'>\n    <button class='close' aria-hidden='true' type='button'>&times;</button>\n    <h3>"+t(e(this.t("chat.tooltip.title")))+"</h3>\n    <p>"+t(e(this.t("chat.tooltip.message")))+"</p>\n    <a class='btn btn-primary go-visible' href='#' data-hide-message='chat_intro_tip'>"+t(e(this.t("chat.tooltip.great")))+"</a>\n    <a class='go-invisible' href='#' data-hide-message='chat_intro_tip'>"+t(e(this.t("chat.tooltip.go_invisible")))+"</a>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/chat_message"]=function(e){return function(){var e,t,i,n,s,r,o;for(t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<div class='from'>"+t(e(this.message.from.name))+"</div>\n<div class='body'>"),o=this.message.body.split("\n"),s=0,r=o.length;r>s;s++)n=o[s],i.push("  <div>"+t(e(n))+"</div>");return i.push("</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/chat_user"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<a class='"+["user",""+t(e(this.className))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' href='#' data-id='"+t(e(this.user.id))+"'>\n  <div class='rank'>"),i.push(this.user.rank<6?"    "+t(e(this.user.rank+1)):"    &nbsp;"),i.push("  </div>\n  <i class='crosshair icon-screenshot'></i>\n  <div class='username'>"+t(e(this.user.name))+"</div>\n</a>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/closures/panel"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<h1>"+t(e("Road Closure"+(this.isDeleted()?"(deleted)":"")))+"</h1>\n<section class='clearfix panel-contents'>\n  <form>\n    <fieldset>\n      <label>\n        Reason:\n        <input type='text' value='"+t(e(this.reason))+"' disabled='"+t(e(this.isDeleted()))+"' name='reason'>\n      </label>\n      <label>\n        End date:\n        <div class='date date-picker input-append'>\n          <input name='endDate' data-format='dd/MM/yyyy' type='text' disabled='"+t(e(this.isDeleted()))+"' data-type='date'>\n          <span class='add-on'>\n            <i class='icon-calendar'></i>\n          </span>\n        </div>\n      </label>\n      <div class='input-append timepicker'>\n        <input type='text' name='endTime' value='"+t(e(this.getEndTime()))+"' disabled='"+t(e(this.isDeleted()))+"'>\n        <span class='add-on'>\n          <i class='icon-time'></i>\n        </span>\n      </div>\n    </fieldset>\n  </form>\n  <div class='field'>\n    <div class='name'>Direction:</div>\n    <div class='value'>"+t(e(this.isFwdDirection()?"A \u2192 B":"B \u2192 A"))+"</div>\n  </div>\n</section>\n<nav class='panel-navigation'>"),this.isDeleted()||i.push("  <button class='btn btn-danger delete'>Delete Closure</button>"),i.push("  <button class='btn close-button'>\n    <span>"+t(e(this.t("save_error.confirm")))+"</span>\n  </button>\n</nav>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/editable-areas"]=function(e){return function(){var e,t,i,n,s,r,o;if(t=window.HAML.escape,e=window.HAML.cleanValue,i=[],this.areas.isEmpty())i.push("<p class='message'>"+t(e(this.t("user.areas.no_areas")))+"</p>");else{for(i.push("<p class='message'>"+t(e(this.t("user.areas.subtitle")+":"))+"</p>\n<ul class='result-list'>"),o=this.areas,s=0,r=o.length;r>s;s++)n=o[s],i.push("  <li class='area result' data-id='"+t(e(n.geomIndex))+"'>\n    <p class='title'>"+t(e(this.t("user.areas.area",{num:n.geomIndex+1})))+"</p>\n    <p class='additional-info clearfix'>\n      <span>"+t(e(this.h.areaString(n.area)))+"</span>\n    </p>\n  </li>");i.push("</ul>")}return i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/house-number"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<div class='"+["content",""+t(e("valid-"+this.valid+" forced-"+this.forced))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n  <div class='uneditable-number'>"+t(e(this.number))+"</div>\n  <div class='drag-handle'></div>\n  <div class='"+["input-wrapper",""+t(e("side-"+(this.isLeft?"left":"right")))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n    <div class='number-preview'>"+t(e(this.number))+"</div>\n    <input class='number' value='"+t(e(this.number))+"' type='text' placeholder='"+t(e(this.t("edit.segment.house_numbers.no_number")))+"'>\n    <div class='delete-button'>x</div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/house-numbers-lightbox"]=function(e){return function(){var e,t,i,n;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<div class='header'>\n  <div class='title'>"),null!=this.address&&i.push("    "+t(e(this.address.streetName+", "+this.address.cityName+", "+(this.address.hasState?this.address.stateName:this.address.countryName)))),i.push("  </div>\n  <div class='loading-animation not-shown'></div>\n  <div class='toolbar'>\n    <button class='cancel toolbar-btn'>"+t(e(this.t("edit.house_numbers.toolbar.close")))+"</button>\n    <button class='redo toolbar-btn' disabled='"+t(e(!this.model.actionManager.canRedo()||this.disabled))+"'>"+t(e(this.t("edit.house_numbers.toolbar.redo")))+"</button>\n    <button class='toolbar-btn undo' disabled='"+t(e(!this.model.actionManager.canUndo()||this.disabled))+"'>"+t(e(this.t("edit.house_numbers.toolbar.undo")))+"</button>\n    <button class='save toolbar-btn' disabled='"+t(e(!this.model.actionManager.canSave()||this.disabled))+"'>"+t(e(this.t("edit.house_numbers.toolbar.save")))+"</button>\n    <button class='add toolbar-btn' disabled='"+t(e(this.disabled||!this.pm.editingAllowedInZoom()||this.pm.failedLoading))+"'>"+t(e(this.t("edit.house_numbers.toolbar.add")))+"</button>\n  </div>\n</div>\n<div class='success-message' style='display: none;'>"+t(e(this.t("edit.house_numbers.save.success")))+"</div>\n<div class='error-message' style='display: none;'>Error loading house numbers</div>"),this.pm.editingAllowedInZoom()||i.push("<div class='zoom-message'>"+t(e(this.t("edit.house_numbers.zoom_to_edit")))+"</div>"),i.push("<div class='last-edited'>\n  Last edited by\n  <span class='username'>"+t(e(this.h.formatUserName(null!=(n=this.pm.selectedNumber)?n.model.updatedBy:void 0)))+"</span>\n</div>\n<div class='force-message' style='display: none;'>"),i.push("  "+t(e(this.t("edit.house_numbers.save.invalid")))),i.push("  <br>"),this.pm.canForcedInvalid()&&(i.push("  "+t(e(this.t("edit.house_numbers.force.title")))),i.push("  <br>\n  <button class='btn btn-default btn-sm force-invalid'>"+t(e(this.t("edit.house_numbers.force.action")))+"</button>")),i.push("  <button class='btn btn-default btn-sm continue-editing'>"+t(e(this.t("edit.house_numbers.force.continue")))+"</button>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/keyboard_shortcuts/list"]=function(e){return function(){var e,t,i,n,s,r,o,a,l,h,u={}.hasOwnProperty;t=window.HAML.escape,e=window.HAML.cleanValue,i=[],l=this.groups;for(s in l)if(u.call(l,s)){for(n=l[s],i.push("<section class='shortcut-action-group'>"),null!=n.members&&i.push("  <h2>"+t(e(this.t("keyboard_shortcuts.groups."+s+".description")))+"</h2>"),h=n.members,o=0,a=h.length;a>o;o++)r=h[o],r.changeable&&(i.push("  <p class='shortcut-action' data-action='"+t(e(r.id))+"'>"),null==r.shortcut||r.shortcut.isEmpty()?i.push("    <kbd class='no-shotcut'>None</kbd>"):(i.push("    "+e(this.h.shortcutMaskToKeys(r.shortcut))),i.push("    <kbd>"+t(e(this.h.getShortcutKey(r.shortcut)))+"</kbd>")),i.push(r.layerToggle?"    "+t(e(this.t("keyboard_shortcuts.groups.layers.toggle_layer",{name:this.t("layers.name."+r.layerKey)}))):"    "+t(e(this.t("keyboard_shortcuts.groups."+s+".members."+r.name)))),i.push("  </p>"));i.push("</section>")}return i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/keyboard_shortcuts/modal"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<div id='shortcuts-dialog'>\n  <div class='modal-dialog'>\n    <div class='modal-content'>\n      <div class='modal-header'>\n        <button class='close' data-dismiss='modal' type='button'>\xd7</button>\n        <h3 class='modal-title'>"+t(e(this.t("keyboard_shortcuts.title")))+"</h3>\n      </div>\n      <div class='modal-body'>"),i.push("        "+e(JST["templates/keyboard_shortcuts/list"]({groups:this.groups}))),i.push("      </div>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/layer-switcher"]=function(e){return function(){var e,t,i,n,s,r,o,a;for(t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<div class='dropdown' id='layer-switcher-menu'>\n  <a class='dropdown-toggle' data-toggle='dropdown' role='button'>\n    <span></span>\n  </a>\n  <ul class='controls-container dropdown-menu' role='menu'>\n    <form class='layer-togglers'>\n      <div class='icon-repeat reload-button'></div>"),a=this.layers,n=r=0,o=a.length;o>r;n=++r)s=a[n],s.displayInLayerSwitcher&&(i.push("      <li class='"+["toggler",""+t(e(s.draggable?"draggable":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' data-position='"+t(e(n))+"'>"),s.draggable&&i.push("        <span class='handle'>\n          &#xf142;&#xf142;\n        </span>"),i.push("        <input class='toggle' id='layer-switcher-"+s.id+"' type='checkbox' data-id='"+t(e(s.id))+"' checked='"+t(e(s.visibility))+"'>\n        <label for='layer-switcher-"+t(e(s.id))+"'>\n          <span class='label-text'>"+t(e(s.name))+"</span>"),s.closedFilter&&(i.push("          <a class='closed-filter'>\x92"),i.push(s.showHidden?"                "+t(e(this.t("layer_switcher.hide_closed"))):"                "+t(e(this.t("layer_switcher.show_closed")))),i.push("          \x91</a>")),i.push("        </label>\n      </li>"));return i.push("    </form>\n  </ul>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"").replace(/[\s\n]*\u0091/gm,"").replace(/\u0092[\s\n]*/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/location-info"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<span>"+t(e(this.city+", "+(this.showState()?this.state:this.country)))+"</span>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/location-message"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<div class='footer-message location-message'>\n  Data for this location is on a different server environment,\n  <a data-env='"+t(e(this.view.otherEnv))+"' href='#'>switch now</a>\n  <button class='close'>\xd7</button>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/location-switcher"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<a class='dropdown-toggle' data-toggle='dropdown' href='#'>"),i.push("  "+t(e(this.t("envs")[W.location.code]))),i.push("  <i class='icon-angle-down'></i>\n</a>\n<ul class='dropdown-menu' role='menu'>\n  <li>  \n    <a class='env-link' href='/"+t(e("en"!==I18n.locale?I18n.locale+"/":void 0))+"editor' data-env='row'>"+t(e(this.t("envs.row")))+"</a>\n  </li>\n  <li>\n    <a class='env-link' href='/"+t(e("en"!==I18n.locale?I18n.locale+"/":void 0))+"editor' data-env='usa'>"+t(e(this.t("envs.usa")))+"</a>\n  </li>\n  <li>\n    <a class='env-link' href='/"+t(e("en"!==I18n.locale?I18n.locale+"/":void 0))+"editor' data-env='il'>"+t(e(this.t("envs.il")))+"</a>\n  </li>\n</ul>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/login/login-form"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<div class='form-title'>"),W.loginManager.expired?(i.push("  <div class='text-warning'>"+t(e(this.t("session.expired.title")))+"</div>"),i.push("  "+t(e(this.t("session.expired.description"))))):i.push("  "+t(e(this.t("login.subtitle")))),i.push("</div>\n<form action='#' method='post'>\n  <input class='form-control username' name='username' required='"+t(e(!0))+"' type='text' placeholder='"+t(e(this.t("login.form.username")))+"'>\n  <input class='form-control password' name='password' required='"+t(e(!0))+"' type='password' placeholder='"+t(e(this.t("login.form.password")))+"'>\n  <div class='error-message text-danger'></div>\n  <div class='form-action'>\n    <button class='btn btn-primary submit' type='submit'>\n      <span class='loading not-shown'>\n        <i class='icon-spin icon-spinner'></i>\n      </span>"),i.push("      "+t(e(this.t("login.form.action")))),i.push("    </button>\n  </div>\n  <a class='forgot-password' href='/forgot_password'>"+t(e(this.t("login.forgot_password")))+"</a>\n</form>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/login/login-status"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],this.isLoggedIn&&(i.push(""+t(e(this.t("header.website.greeting",{username:this.user.userName})))),i.push("<a class='dashboard-link' href='/dashboard/'>\n  <i class='icon-cog'></i>\n</a>\n<a class='logout-link' href='#'>"+t(e(this.t("header.website.logout")))+"</a>")),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/login/sandbox-message"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<div class='footer-message sandbox-message'>\n  <strong>"+t(e(this.t("play_mode.title")))+"</strong>"),i.push("  "+t(e(this.t("play_mode.description")))),i.push("  <span class='dropdown'>"),i.push("    "+e(this.safe_t("play_mode.login_msg",{login_link:this.h.link(this.t("play_mode.login_link"),"#",{"data-toggle":"dropdown"})}))),i.push("    <ul class='dropdown-menu login-dropdown' role='menu'>\n      <li class='login-form'></li>\n    </ul>\n  </span>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/login/user-info"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<h2>"),i.push(this.sandbox?"  "+e(this.safe_t("login.greeting",{stranger:this.h.contentTag("strong",this.t("login.stranger"))})):"  "+e(this.safe_t("user.info.greeting",{username:this.h.contentTag("strong",this.user.userName)}))),i.push("</h2>"),this.sandbox?(i.push("<div class='sandbox'>"),i.push("  "+t(e(this.t("play_mode.sidebar.subtitle")))),i.push("  <br>"),i.push("  "+t(e(this.t("play_mode.sidebar.description")))),i.push("  <br>"),i.push("  "+t(e(this.t("play_mode.sidebar.login")))),i.push("  <br>\n  <a href='/forgot_password' target='_blank'>"+t(e(this.t("play_mode.sidebar.help")))+"</a>\n  <div class='links'>\n    <a class='btn btn-default tutorial' data-toggle='modal' href='#tutorial-dialog'>\n      <div class='title'>"+t(e(this.t("welcome.tutorial.title")))+"</div>\n      <div class='description'>"+t(e(this.t("welcome.tutorial.description")))+"</div>\n    </a>\n    <a class='btn btn-default wiki' href='http://www.waze.com/wiki/index.php/Map_Editing_-_select_map_editor' target='_blank'>\n      <div class='title'>"+t(e(this.t("welcome.wiki.title")))+"</div>\n      <div class='description'>"+t(e(this.t("welcome.wiki.description")))+"</div>\n    </a>\n    <a class='btn btn-default forum' href='"+t(e(this.t("internal.editing_forum_link")))+"' target='_blank'>\n      <div class='title'>"+t(e(this.t("welcome.forum.title")))+"</div>\n      <div class='description'>"+t(e(this.t("welcome.forum.description")))+"</div>\n    </a>\n  </div>\n</div>")):(i.push("<ul class='nav nav-tabs'>\n  <li class='active'>\n    <a data-toggle='tab' href='#sidepanel-me'>"+t(e(this.t("user.info.title")))+"</a>\n  </li>\n  <li>\n    <a data-toggle='tab' href='#sidepanel-drives'>"+t(e(this.t("user.drives.title")))+"</a>\n  </li>\n  <li>\n    <a data-toggle='tab' href='#sidepanel-areas'>"+t(e(this.t("user.areas.title")))+"</a>\n  </li>\n</ul>\n<div class='tab-content'>\n  <div class='active tab-pane' id='sidepanel-me'>\n    <section id='user-details'>      "),i.push("      "+e(JST["templates/user-details"](this.user))),i.push("    </section>\n  </div>\n  <div class='tab-pane' id='sidepanel-drives'>\n    <div class='loading-animation'></div>\n    <div class='error hide'>"),i.push("      "+t(e(this.t("user.drives.error")))),i.push("    </div>\n    <div class='result-list-container'></div>\n    <div class='pagination'></div>\n  </div>\n  <div class='tab-pane' id='sidepanel-areas'>\n    <div class='result-list-container'></div>\n    <div class='pagination'></div>\n  </div>\n</div>")),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/login/welcome-popup"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<div class='map-modal' id='welcome-popup'>\n  <div class='clearfix map-modal-body'>\n    <div class='login'>\n      <div class='welcome-message'>\n        <h2>"+t(e(this.t("welcome.title")))+"</h2>\n        <p>"),i.push("          "+t(e(this.t("welcome.content")))),i.push("        </p>\n      </div>\n      <div class='login-form'></div>\n    </div>\n    <div class='links'>\n      <a class='btn btn-default tutorial' data-toggle='modal' href='#tutorial-dialog'>\n        <div class='title'>"+t(e(this.t("welcome.tutorial.title")))+"</div>\n        <div class='description'>"+t(e(this.t("welcome.tutorial.description")))+"</div>\n      </a>\n      <a class='btn btn-default wiki' href='"+t(e(this.t("internal.wiki_link")))+"' target='_blank'>\n        <div class='title'>"+t(e(this.t("welcome.wiki.title")))+"</div>\n        <div class='description'>"+t(e(this.t("welcome.wiki.description")))+"</div>\n      </a>\n      <a class='btn btn-default forum' href='"+t(e(this.t("internal.editing_forum_link")))+"' target='_blank'>\n        <div class='title'>"+t(e(this.t("welcome.forum.title")))+"</div>\n        <div class='description'>"+t(e(this.t("welcome.forum.description")))+"</div>\n      </a>\n      <a class='btn btn-default playmode' href='#'>\n        <div class='title'>"+t(e(this.t("welcome.play_mode.title")))+"</div>\n        <div class='description'>"+t(e(this.t("welcome.play_mode.description")))+"</div>\n      </a>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/map-problem-panel"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<nav class='clearfix problems'>\n  <h1>"),i.push(this.showExtendedInfo?"    "+t(e(""+this.message.title+" ("+this.t("problems.auto_detected")+" - "+this.problem.getID()+")")):"    "+t(e(""+this.message.title+" ("+this.t("problems.auto_detected")+")"))),i.push("  </h1>\n</nav>\n<section class='clearfix problem-details'>\n  <figure class='"+t(e(this.problemState))+"'>\n    <div class='image'></div>\n    <figcaption></figcaption>\n  </figure>\n  <section class='problem-description'>\n    <article class='description'>\n      <h2>"+t(e(this.t("problems.panel.description")+":"))+"</h2>\n      <p>"+t(e(this.message.description))+"</p>\n    </article>\n    <article class='solution'>\n      <h2>"+t(e(this.t("problems.panel.solution")+":"))+"</h2>\n      <p>"+t(e(this.message.solution))+"</p>\n    </article>"),null!=this.problem.attributes.resolvedBy&&i.push("    <article class='closedOn'>\n      <h2>"+t(e(this.t("problems.panel.resolved_title")+":"))+"</h2>\n      <p>"+t(e(this.t("problems.panel.resolved",{time:this.h.dateOnlyString(this.problem.attributes.resolvedOn),user:this.h.formatUserName(this.problem.attributes.resolvedBy)})))+"</p>\n    </article>"),i.push("  </section>"),this.isTurnProblem||i.push("  <section class='controls-container problem-display-options'>\n    <h2>"+t(e(this.t("problems.panel.gps.title")+":"))+"</h2>\n    <input id='map-problem-panel-average' type='checkbox' value='average' name='sessionDisplay' checked='"+t(e(this.pm.displayedSessionTypes.average))+"'>\n    <label for='map-problem-panel-average' title='"+t(e(this.t("problems.panel.gps.average_tooltip")))+"'>"+t(e(this.t("problems.panel.gps.average")))+"</label>\n    <input id='map-problem-panel-all' type='checkbox' value='all' name='sessionDisplay' checked='"+t(e(this.pm.displayedSessionTypes.all))+"'>\n    <label for='map-problem-panel-all' title='"+t(e(this.t("problems.panel.gps.recent_tooltip")))+"'>"+t(e(this.t("problems.panel.gps.recent")))+"</label>\n    <div>\n      <a class='zoom-to-problem-button' href='#'>\n        <i class='icon-screenshot'></i>\n        <span>"+t(e(this.t("problems.panel.zoom_to_problem")))+"</span>\n      </a>\n    </div>\n  </section>"),i.push("</section>\n<h1 class='collapsed-title'>"+t(e(""+this.message.title+" ("+this.t("problems.auto_detected")+")"))+"</h1>\n<div class='form-container'>\n  <form class='clearfix controls-container panel-action' id='edit-problem'>\n    <fieldset>\n      <legend>"+t(e(this.t("problems.panel.report_as")+":"))+"</legend>"),i.push("      "+e(this.h.radio(this.t("problems.panel.states.open"),"state","open",this.problemState,this.problem.editable))),i.push("      "+e(this.h.radio(this.t("problems.panel.states.solved"),"state","solved",this.problemState,this.problem.editable))),i.push("      "+e(this.h.radio(this.t("problems.panel.states.rejected"),"state","rejected",this.problemState,this.problem.editable))),i.push("    </fieldset>\n  </form>\n</div>\n<nav class='problem-panel-navigation'>\n  <button class='btn btn-default collapse-panel-button'>\n    <span>"+t(e(this.t("problems.panel.collapse")))+"</span>\n    <i class='icon-angle-up'></i>\n  </button>\n  <button class='btn btn-default expand-panel-button'>\n    <span>"+t(e(this.t("problems.panel.expand")))+"</span>\n    <i class='icon-angle-down'></i>\n  </button>\n  <button class='btn btn-default close-button'>\n    <span>"+t(e(this.t("problems.panel.close")))+"</span>\n  </button>\n</nav>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/map"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<div id='map'>\n  <div id='input-overlay'></div>\n  <div id='map-overlay'></div>\n  <div id='popup-overlay'></div>\n  <div class='not-shown' id='map-lightbox'>\n    <div class='overlay'>\n      <div class='top'></div>\n      <div class='bottom'></div>\n      <div class='left'></div>\n      <div class='right'></div>\n    </div>\n    <div class='content'></div>\n  </div>\n  <div id='map-modal-container'></div>\n  <div>\n    <div id='toolbar'>\n      <div id='layer-switcher'></div>\n      <div class='toolbar-separator'></div>\n      <div id='edit-buttons'></div>\n      <div id='display-options'></div>\n      <form class='form-search' id='map-search'>\n        <div class='input-wrapper'>\n          <button class='btn input-addon input-addon-left'>\n            <i class='icon-search'></i>\n          </button>\n          <input class='form-control search-query' autocomplete='off' name='q' spellcheck='off' type='text' placeholder='"+t(e(this.t("toolbar.search")))+"'>\n          <i class='icon-spin icon-spinner input-addon input-addon-right spinner'></i>\n        </div>\n      </form>\n    </div>\n    <div id='panel-container'></div>\n    <div id='panels-container'>\n      <section id='location-information'></section>\n      <section class='panel-hidden top-panel' id='problem-edit-panel' style='display: none;'></section>\n      <section class='panel-hidden top-panel' id='update-request-panel' style='display: none;'></section>\n      <section class='panel-shown top-panel' id='archive-panel' style='display: none;'></section>\n      <section class='panel-hidden top-panel' id='closures-panel' style='display: none;'></section>\n      <section class='panel-hidden top-panel' id='save-problem-panel' style='display: none;'>\n        <h1>"+t(e(this.t("save_error.title")))+"</h1>\n        <section class='clearfix panel-contents'>\n          <h2 id='save-problem-panel-error'></h2>\n          <p id='save-problem-panel-error-description'>"+t(e(this.t("save_error.action")))+"</p>\n          <p id='save-problem-panel-error-details'></p>\n        </section>\n        <nav class='panel-navigation'>\n          <button class='btn btn-default close-button'>\n            <span>"+t(e(this.t("save_error.confirm")))+"</span>\n          </button>\n        </nav>\n      </section>\n    </div>\n    <div id='street-view-container'>\n      <div class='panorama view-area'></div>\n      <a class='close-button'>\n        <i class='icon-remove'></i>\n      </a>\n    </div>\n    <div class='view-area' id='WazeMap' tabindex='1'></div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")
}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/node-edit"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<div class='selection-text'>"+t(e(this.t("edit.node.title")))+"</div>\n<div class='tab-content'>\n  <div class='active tab-pane' id='node-edit-general'>"),this.connectionsExist()&&(i.push("    <p class='connectionStatus'>"),this.areAllConnectionsEnabled()&&i.push("      "+t(e(this.t("edit.node.turns.all_allowed")))),this.areAllConnectionsDisabled()&&i.push("      "+t(e(this.t("edit.node.turns.all_disallowed")))),i.push("    </p>"),this.areAllConnectionsEnabled()||i.push("    <button class='allow-connections btn btn-default' disabled='"+t(e(!this.areConnectionsEditable()))+"'>"+t(e(this.t("edit.node.turns.allow_all")))+"</button>"),this.areAllConnectionsDisabled()||i.push("    <button class='btn btn-default disallow-connections' disabled='"+t(e(!this.areConnectionsEditable()))+"'>"+t(e(this.t("edit.node.turns.disallow_all")))+"</button>")),i.push("  </div>\n  <ul class='additional-attributes list-unstyled'>\n    <li>"+t(e(this.t("edit.id",{num:this.getID()})))+"</li>\n  </ul>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/opening_hours/add"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<div class='modal-content'>\n  <div class='modal-header'>\n    <h3 class='modal-title'>"+t(e(this.t("edit.landmark.opening_hours.add_title")))+"</h3>\n  </div>\n  <div class='modal-body'>\n    <div class='content'>\n      <form class='add-opening-hour' action='#' method='post'>\n        <div class='days section'>"),i.push("          "+e(JST["templates/util/day-checkboxes"]({cb:this.dayCallback}))),i.push("          "+e(JST["templates/restriction/toggle-checkboxes"]())),i.push("        </div>\n        <div class='clearfix hours section'>\n          <div class='row'>\n            <div class='labels'>\n              <div class='col-xs-2'>\n                <label class='radio'>\n                  <input type='radio' name='allDay' value='on' checked='"+t(e(!1))+"'>"),i.push("                  "+t(e(this.t("time_span.all_day")))),i.push("                </label>\n              </div>\n              <div class='col-xs-2'>\n                <label class='radio'>\n                  <input type='radio' name='allDay' value='off' checked='"+t(e(!0))+"'>"),i.push("                    "+t(e(this.t("time_span.from")+":"))),i.push("                </label>\n              </div>\n            </div>\n            <div class='inputs'>\n              <div class='col-xs-4'>\n                <div class='bootstrap-timepicker input-append input-group' dir='ltr'>\n                  <input class='form-control from-time time-selector' type='text' name='fromTime' value='"+t(e(this.defaultFromTime))+"'>\n                  <span class='add-on input-group-addon'>\n                    <i class='icon-time'></i>\n                  </span>\n                </div>\n              </div>\n              <div class='col-xs-4'>\n                <div class='pull-left to-label'>"),i.push("                  "+t(e(this.t("time_span.to")+":"))),i.push("                </div>\n                <div class='bootstrap-timepicker input-append input-group' dir='ltr'>\n                  <input class='form-control time-selector to-time' type='text' name='toTime' value='"+t(e(this.defaultToTime))+"'>\n                  <span class='add-on input-group-addon'>\n                    <i class='icon-time'></i>\n                  </span>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class='validation-errors'></div>\n        <button class='btn btn-primary'>"+t(e(this.t("edit.add")))+"</button>\n        <button class='btn btn-default cancel-button'>"+t(e(this.t("edit.cancel")))+"</button>\n      </form>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/opening_hours/item"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push(""+t(e(this.h.formatOpeningHour(this.model)))),this.isEditable&&i.push("<a class='delete' href='#'>\n  <i class='icon-remove'></i>\n</a>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/opening_hours/layout"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<div class='sub-section-header'>"+t(e(this.t("edit.landmark.opening_hours.title")))+"</div>\n<ul class='list'></ul>"),this.isEditable&&i.push("<a class='add' href='#'>"+t(e(this.t("edit.landmark.opening_hours.add")))+"</a>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/permalink"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<a class='icon-link' data-toggle='tooltip' data-html='true' title='"+t(e(this.t("footer.copy_to_clipboard",{button:this.copyShortcut})))+"'></a>\n<div id='clipboard-container'>\n  <div id='clipboard'></div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/place_updates/actions"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<div class='"+["actions","approve-intent-"+t(e(this.getApproveActionIntent()))+" "+t(e(this.model.get("updateType")))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>"),this.model.get("isEditable")?(i.push("  <form class='controls-container'>"),i.push("    "+e(this.h.radio(this.t("venues.update_requests.panel.action.open"),"approved",null,this.model.get("approved")))),i.push("    "+e(this.h.radio(this.getRejectActionName(),"approved",!1,this.model.get("approved")))),i.push("    "+e(this.h.radio(this.getApproveActionName(),"approved",!0,this.model.get("approved")))),i.push("  </form>")):i.push("  <div class='alert alert-danger'>"+t(e(this.getMinEditLevelMessage()))+"</div>"),i.push("</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/place_updates/add_details"]=function(e){return function(){var e,t;return e=window.HAML.cleanValue,t=[],t.push("<div class='add-details'>\n  <div class='date small'>"+e(this.safe_t("venues.update_requests.panel.added_on",{added_on_title:this.h.contentTag("strong",this.t("venues.update_requests.panel."+this.type)),date:I18n.l("date.formats.long",this.dateAdded)}))+"</div>"),!this.hideUserDetails&&this.createdBy&&t.push("  <div class='small user'>"+e(this.safe_t("venues.update_requests.panel.added_by",{added_by_title:this.h.contentTag("strong",this.t("venues.update_requests.panel.added_by_title")),username:this.h.formatUserName(this.createdBy)}))+"</div>"),t.push("</div>"),t.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/place_updates/add_image"]=function(e){return function(){var e,t,i;return e=window.HAML.cleanValue,t=[],i=this.model.getAddedImage(),t.push(""+e(JST["templates/place_updates/image"]({image:i}))),t.push(""+e(JST["templates/place_updates/add_details"]({type:"added_on_title",hideUserDetails:!1,dateAdded:i.get("date"),createdBy:i.get("creatorUserId")}))),t.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/place_updates/add_venue"]=function(e){return function(){var e,t,i,n,s,r,o;for(t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<h2 class='name'>"+t(e(this.h.formatVenueName(this.venue.attributes.name)))+"</h2>\n<div class='address'>"+t(e(this.h.formatPlaceAddress(this.venue)))+"</div>\n<div class='categories small'>"+t(e(this.h.formatVenueCategories(this.venue.attributes.categories)))+"</div>\n<div class='images'>"),o=this.getNewPlaceImages().slice(0,1),s=0,r=o.length;r>s;s++)n=o[s],i.push("  "+e(JST["templates/place_updates/image"]({image:n})));return i.push("</div>"),i.push(""+e(JST["templates/place_updates/add_details"]({type:"added_on_title",dateAdded:this.model.get("dateAdded"),createdBy:this.model.get("createdBy")}))),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/place_updates/changed_field"]=function(e){return function(){var e,t,i,n,s,r,o,a;if(t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<div class='"+["change","field-"+t(e(this.fieldName))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n  <div class='field-name'>"+t(e(this.t("edit.landmark.fields."+this.fieldName)))+"</div>\n  <div class='values'>"),this.isGeometry)i.push("    "+t(e(this.t("venues.update_requests.panel.change.hover")))),i.push("    <div class='current location-button'>"),i.push("      "+t(e(this.t("venues.update_requests.panel.change.current")))),i.push("      <i class='icon-screenshot'></i>\n    </div>\n    <div class='location-button suggested'>"),i.push("      "+t(e(this.t("venues.update_requests.panel.change.suggested")))),i.push("      <i class='icon-screenshot'></i>\n    </div>");else if("images"===this.fieldName){for(n=require("Waze/Model/Object/Image").SIZE,i.push("    <div class='removed-title'>"+t(e(this.t("venues.update_requests.panel.change.removed")))+"</div>\n    <div class='remove-images'>"),a=this.getRemovedImages(),r=0,o=a.length;o>r;r++)s=a[r],i.push("      <img class='image-preview' src='"+t(e(s.getUrl(n.WEB)))+"' data-image-id='"+t(e(s.id))+"'>");i.push("    </div>")}else this.currentValue&&i.push("    <div class='current-title'>"+t(e(this.t("venues.update_requests.panel.change.current")))+"</div>\n    <div class='current'>"+t(e(this.currentValue))+"</div>"),i.push("    <div class='suggested-title'>"+t(e(this.t("venues.update_requests.panel.change.suggested")))+"</div>\n    <div class='suggested'>"+t(e(this.suggestedValue))+"</div>");return i.push("  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/place_updates/delete_venue"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<h3>"+t(e(I18n.t("venues.update_requests.panel.place_deleted")))+"</h3>"),i.push(""+e(JST["templates/place_updates/add_details"]({type:"suggested_on_title",dateAdded:this.model.get("dateAdded"),createdBy:this.model.get("createdBy")}))),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/place_updates/flag"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push(""+e(JST["templates/place_updates/panel_header"](this))),i.push("<div class='body'>\n  <div class='request-details'>"),i.push("    "+e(JST["templates/place_updates/place_details"](this))),this.showImage?(i.push("    "+e(JST["templates/place_updates/image"]({image:this.image}))),this.image&&i.push("    "+e(JST["templates/place_updates/add_details"]({type:"picture_added_on_title",hideUserDetails:!this.showAddingUser,dateAdded:this.image.get("date"),createdBy:this.image.get("creatorUserId")})))):i.push("    "+e(JST["templates/place_updates/add_details"]({type:"added_on_title",hideUserDetails:!this.showAddingUser,dateAdded:this.venue.attributes.createdOn}))),i.push("  </div>\n  <div class='changes'>\n    <div class='small'>"+t(e(I18n.t("venues.update_requests.panel.flag_reason")))+"</div>\n    <h3>"+t(e(this.t("venues.update_requests.flags."+this.model.get("type"))))+"</h3>"),this.showComment&&i.push("    <div class='wrong-details-comment'>"+t(e(this.model.get("comment")))+"</div>"),i.push("  </div>"),this.showDuplicateVenue&&(i.push("  <div class='duplicate request-details'>"),i.push("    "+e(JST["templates/place_updates/place_details"]({venue:this.model.getDuplicateVenue()}))),i.push("    "+e(JST["templates/place_updates/add_details"]({type:"added_on_title",hideUserDetails:!0,dateAdded:this.model.getDuplicateVenue().attributes.createdOn}))),i.push("  </div>")),i.push("  "+e(JST["templates/place_updates/actions"](this))),i.push("</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/place_updates/image"]=function(e){return function(){var e,t,i,n;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],n=require("Waze/Model/Object/Image").SIZE,i.push(this.image?"<a>\n  <img class='image-preview' src='"+t(e(this.image.getUrl(n.MOBILE)))+"' data-image-id='"+t(e(this.image.id))+"'>\n</a>":"<div class='missing-image'></div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/place_updates/image_dialog"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<div class='modal-dialog place-update-image-dialog'>\n  <div class='modal-content'>\n    <div class='modal-body'>\n      <img src='"+t(e(this.imageUrl))+"'>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/place_updates/item"]=function(e){return function(){var e,t;return e=window.HAML.cleanValue,t=[],t.push(""+e(JST["templates/place_updates/panel_header"](this))),t.push("<div class='body'>"),this.hidePlaceDetails||(t.push("  <div class='request-details'>"),t.push("    "+e(JST["templates/place_updates/place_details"](this))),t.push("  </div>")),t.push("  <div class='changes'>"),t.push("    "+e(JST[this.getChangesTemplate()](this))),t.push("  </div>"),t.push("  "+e(JST["templates/place_updates/actions"](this))),t.push("</div>"),t.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/place_updates/layout"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<div class='place-update'></div>\n<div class='navigation'>"),this.showNextButton?(i.push("  <button class='btn btn-default navigation-button'>"),i.push("    "+t(e(this.t("venues.update_requests.panel.next")))),i.push("  </button>")):(i.push("  <button class='btn btn-primary navigation-button'>"),i.push("    "+t(e(this.t("venues.update_requests.panel.done")))),i.push("  </button>")),i.push("</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/place_updates/panel_header"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<div class='header'>"),i.push("  "+t(e(this.getTitle()))),i.push("  <a class='close-panel'>\xd7</a>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/place_updates/place_details"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<div class='place-details'>\n  <h3 class='name'>"+t(e(this.h.formatVenueName(this.venue.attributes.name)))+"</h3>\n  <div class='address'>"+t(e(this.h.formatPlaceAddress(this.venue)))+"</div>\n  <div class='categories small'>"+t(e(this.h.formatVenueCategories(this.venue.attributes.categories)))+"</div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/place_updates/update_venue"]=function(e){return function(){var e,t;return e=window.HAML.cleanValue,t=[],t.push("<ul class='changed-fields list-unstyled'></ul>"),t.push(""+e(JST["templates/place_updates/add_details"]({type:"suggested_on_title",dateAdded:this.model.get("dateAdded"),createdBy:this.model.get("createdBy")}))),t.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/restriction/edit"]=function(e){return function(){var e,t,i,n,s,r,o,a={}.hasOwnProperty;t=window.HAML.escape,e=window.HAML.cleanValue,n=window.HAML.preserve,i=[],i.push("<h4>"),i.push(this.model.isNew?"  "+t(e(this.t("restrictions.creating"))):"  "+t(e(this.t("restrictions.editing")))),i.push("</h4>\n<form class='edit-restriction' action='#' method='post'>\n  <div class='days section'>"),i.push("    "+e(JST["templates/util/day-checkboxes"]({cb:function(e){return function(t){return e.model.includesDay(t)}}(this)}))),i.push("    <div class='not-shown text-danger validation-error'>\n      <i class='icon-exclamation-sign'></i>"),i.push("      "+t(e(this.t("restrictions.errors.days")))),i.push("    </div>"),i.push("    "+e(JST["templates/restriction/toggle-checkboxes"]())),i.push("  </div>\n  <div class='clearfix hours section'>\n    <div class='row'>\n      <div class='col-xs-4 labels'>\n        <label class='radio'>\n          <input type='radio' name='allDay' value='on' checked='"+t(e(this.model.isAllDay()))+"'>"),i.push("          "+t(e(this.t("time_span.all_day")))),i.push("        </label>\n        <label class='radio'>\n          <input type='radio' name='allDay' value='off' checked='"+t(e(!this.model.isAllDay()))+"'>"),i.push("            "+t(e(this.t("time_span.from")+":"))),i.push("        </label>\n      </div>\n      <div class='col-xs-8 inputs'>\n        <div class='bootstrap-timepicker input-append input-group' dir='ltr'>\n          <input class='form-control from-time time-selector' type='text' name='fromTime' value='"+t(e(this.model.fromTime||this.view.getDefaultFromTime()))+"' disabled='"+t(e(this.model.isAllDay()))+"'>\n          <span class='add-on input-group-addon'>\n            <i class='icon-time'></i>\n          </span>\n        </div>\n        <div class='to-label'>"),i.push("          "+t(e(this.t("time_span.to")+":"))),i.push("        </div>\n        <div class='bootstrap-timepicker input-append input-group' dir='ltr'>\n          <input class='form-control time-selector to-time' type='text' name='toTime' value='"+t(e(this.model.toTime||this.view.getDefaultToTime()))+"' disabled='"+t(e(this.model.isAllDay()))+"'>\n          <span class='add-on input-group-addon'>\n            <i class='icon-time'></i>\n          </span>\n        </div>\n        <div class='"+["wraparound",""+t(e(this.model.isTwoDay()?void 0:"hidden"))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n          <i class='icon-info-sign'></i>"),i.push("          "+t(e(this.t("restrictions.wraparound")))),i.push("        </div>\n      </div>\n    </div>\n    <div class='not-shown text-danger validation-error'>\n      <i class='icon-exclamation-sign'></i>"),i.push("      "+t(e(this.t("restrictions.errors.hours")))),i.push("    </div>\n  </div>\n  <div class='clearfix dates row section'>\n    <div class='col-xs-4 labels'>\n      <label class='radio'>\n        <input type='radio' name='permanent' value='on' checked='"+t(e(this.model.isPermanent()))+"'>"),i.push("        "+t(e(this.t("restrictions.permanent")))),i.push("      </label>\n      <label class='radio'>\n        <input type='radio' name='permanent' value='off' checked='"+t(e(!this.model.isPermanent()))+"'>"),i.push("        "+t(e(this.t("restrictions.date_range")+":"))),i.push("      </label>\n    </div>\n    <div class='col-xs-8 inputs'>\n      <div class='selector-container'>\n        <button class='btn btn-default daterange-selector' disabled='"+t(e(this.model.isPermanent()))+"'>"),i.push("          "+t(e(this.view.getDateRangeText(this.model.getFromDate()||this.view.getDefaultFromDate(),this.model.getToDate()||this.view.getDefaultToDate())))),i.push("        </button>\n      </div>\n    </div>\n  </div>\n  <div class='"+["section","vehicle-types",""+t(e(this.model.allVehiclesIncluded()?"all-included":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n    <div class='title'>"),i.push("      "+t(e(this.t("restrictions.all_vehicles_title")))),i.push("      <a class='toggle-vehicles' href='#'>"+t(e("("+this.t("edit.edit")+")"))+"</a>\n    </div>\n    <div class='types'>\n      <div class='checkboxes'>"),o=this.t("restrictions.vehicle_types");for(s in o)a.call(o,s)&&(r=o[s],i.push("        <label>\n          <input class='vehicle_type' type='checkbox' checked='"+t(e(this.model.includesVehicleType(s)))+"' value='"+t(e(s))+"'>"),i.push("          "+t(e(r))),i.push("        </label>"));return i.push("      </div>\n      <div class='not-shown text-danger validation-error'>\n        <i class='icon-exclamation-sign'></i>"),i.push("        "+t(e(this.t("restrictions.errors.vehicle_types")))),i.push("      </div>"),i.push("      "+e(JST["templates/restriction/toggle-checkboxes"]())),i.push("    </div>\n  </div>\n  <div class='description section'>\n    <textarea class='description form-control' placeholder='Enter description...' maxlength='"+t(e(this.descriptionMaxLength))+"'>"+n(t(e(this.model.description)))+"</textarea>\n  </div>\n  <div class='controls well'>\n    <button class='btn btn-primary' type='submit'>"+t(e(this.t(this.model.isNew?"edit.add":"edit.update")))+"</button>\n    <button class='btn btn-default cancel' type='submit'>"+t(e(this.t("edit.cancel")))+"</button>\n    <span class='not-shown text-danger validation-error'>"+t(e(this.t("restrictions.errors.general")))+"</span>\n  </div>\n</form>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/restriction/item"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],(this.mixed&&this.showMixed||!this.mixed&&!this.showMixed)&&(i.push("<tr class='"+t(e(this.r.isNew?"new":void 0))+"' data-index='"+t(e(this.index))+"'>\n  <td>"+t(e(this.h.formatDays(this.r.getDays())))+"</td>\n  <td>"+t(e(this.r.isAllDay()?this.t("time_span.all_day"):""+this.r.fromTime+" - "+this.r.toTime))+"</td>\n  <td class='"+t(e(this.r.isInThePast()?"past":void 0))+"'>"),i.push(this.r.isPermanent()?"    "+t(e(this.t("restrictions.permanent"))):"    <span>"+t(e(""+this.r.getFromDate().toString(this.view.dateFormat)+" - "+this.r.getToDate().toString(this.view.dateFormat)))+"</span>"),i.push("  </td>\n  <td>"+t(e(this.t(this.r.allVehiclesIncluded()?"restrictions.all_vehicles":"restrictions.some_vehicles")))+"</td>"),this.view.editable&&(i.push("  <td>\n    <div class='btn btn-default edit'>\n      <i class='icon-edit'></i>\n    </div>\n    <div class='btn btn-default remove'>\n      <i class='icon-remove-sign'></i>\n    </div>"),this.mixed&&i.push("    <a class='add-to-all' href='#'>"+t(e(this.t("restrictions.apply_to_all")))+"</a>"),i.push("  </td>")),i.push("</tr>")),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/restriction/layout"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<div class='modal' id='schedule-modal' tabindex='-1'>\n  <div class='modal-dialog'>\n    <div class='modal-content'>\n      <div class='modal-header'>\n        <h3 class='modal-title'>\n          <i class='icon-time'></i>"),i.push("          "+t(e(this.t("restrictions.title")))),i.push("        </h3>\n      </div>\n      <div class='modal-body'>\n        <div class='content'></div>\n      </div>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/restriction/list"]=function(e){return function(){var e,t,i,n,s,r,o,a,l,h,u,c,d,p,m,g,f,y={}.hasOwnProperty;if(t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<div class='items'>"),this.view.shouldShowTabs){i.push("  <ul class='nav nav-tabs'>"),c=this.model;for(s in c)y.call(c,s)&&(n=c[s],i.push("    <li class='"+t(e(s===this.selectedGroup?"active":""))+"'>\n      <a data-toggle='tab' href='#restriction-edit-"+t(e(n.name))+"' data-group='"+t(e(s))+"'>"),i.push("        "+t(e(this.t("restrictions.groups."+s)))),i.push("        <span class='badge count'>"+t(e(n.restrictions.length))+"</span>\n      </a>\n    </li>"));i.push("  </ul>")}i.push("  <div class='tab-content'>"),d=this.model;for(s in d)if(y.call(d,s)){for(n=d[s],i.push("    <div class='"+["tab-pane",""+t(e(s!==this.selectedGroup&&this.view.shouldShowTabs?"":"active"))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' id='restriction-edit-"+s+"' data-group='"+t(e(s))+"'>\n      <div class='"+["group-title",""+t(e(this.view.shouldShowTabs?void 0:"no-tabs"))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>"),i.push(this.view.multipleFeatures?"        "+t(e(this.t("restrictions.group_title.multiple")+":")):"        "+t(e(n.title+":"))),i.push("      </div>\n      <table class='table table-striped'>\n        <tr>\n          <th>"+t(e(this.t("restrictions.headers.days")))+"</th>\n          <th>"+t(e(this.t("restrictions.headers.time")))+"</th>\n          <th>"+t(e(this.t("restrictions.headers.range")))+"</th>\n          <th>"+t(e(this.t("restrictions.headers.vehicles")))+"</th>"),this.view.editable&&i.push("          <th>"+t(e(this.t("restrictions.headers.actions")))+"</th>"),i.push("        </tr>"),p=n.restrictions,r=a=0,h=p.length;h>a;r=++a)o=p[r],i.push("        "+e(JST["templates/restriction/item"]({r:o,index:r,view:this.view,features:this.features,showMixed:!1,mixed:(null!=(m=o.models)?m.length:void 0)<this.features.length})));if(this.view.mixedGroups[s])for(i.push("        <tr>\n          <th class='mixed' colspan='"+t(e(5))+"'>"+t(e(this.t("restrictions.mixed")+":"))+"</th>\n        </tr>"),g=n.restrictions,r=l=0,u=g.length;u>l;r=++l)o=g[r],i.push("        "+e(JST["templates/restriction/item"]({r:o,index:r,view:this.view,features:this.features,showMixed:!0,mixed:(null!=(f=o.models)?f.length:void 0)<this.features.length})));!n.restrictions.isEmpty()&&this.view.numGroups>1&&!this.view.multipleFeatures&&this.view.editable&&i.push("        <tr>\n          <th class='copy-container' colspan='"+t(e(5))+"'>\n            <a class='copy' href='#'>"+t(e(this.t("restrictions.copy_all")))+"</a>\n          </th>\n        </tr>"),i.push("      </table>"),n.restrictions.isEmpty()&&i.push("      <div class='no-restrictions'>"+t(e(this.t("restrictions.none")))+"</div>"),i.push("      <div class='actions well'>"),this.view.editable&&(i.push("        <div class='add-restriction btn btn-default'>\n          <i class='icon-plus'></i>"),i.push("          "+t(e(this.t("restrictions.add")))),i.push("        </div>\n        <div class='btn btn-primary done'>"+t(e(this.t("edit.apply")))+"</div>")),i.push("        <div class='btn btn-default cancel-edit'>"+t(e(this.t("edit.cancel")))+"</div>\n      </div>\n    </div>")}return i.push("  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/restriction/toggle-checkboxes"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<div class='toggle'>\n  <a class='select-all' href='#'>"+t(e(this.t("edit.select.all")))+"</a>\n  /\n  <a class='select-none' href='#'>"+t(e(this.t("edit.select.none")))+"</a>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/save/pending_venue_changes"]=function(e){return function(){var e,t;return e=window.HAML.cleanValue,t=[],t.push(this.names.length>0?""+e(this.safe_t("toolbar.save.pending_venues_names",{names:this.h.contentTag("strong",this.names.join(", "))})):""+e(this.safe_t("toolbar.save.pending_venues"))),t.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/segment-address-edit"]=function(e){return function(){var e,t,i,n,s,r,o,a,l,h,u,c,d,p,m,g,f,y,v,b,L,w,S,C,O={}.hasOwnProperty;if(t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<div class='clearfix preview'>"),null!=this.addressDetails){if(i.push("  <h3 class='primary-street'>"+t(e(this.addressDetails.streetName+", "+this.addressDetails.cityName+(this.addressDetails.hasState?", "+this.addressDetails.stateName:", "+this.addressDetails.countryName)))+"</h3>"),null!=this.address.altStreets){for(i.push("  <ul class='alt-street-list list-unstyled'>"),u=this.address.altStreets,l=0,h=u.length;h>l;l++)n=u[l],i.push("    <li class='alt-street'>"),i.push("      "+t(e(""+n.street.name+", "+(n.city.isEmpty?"No city":n.city.name)))),i.push("    </li>");i.push("  </ul>")}}else i.push("  <h3 class='primary-street'>"+t(e(this.t("segment.address.none")))+"</h3>");i.push("  <a class='address-edit-btn'>\n    <i class='icon-edit'></i>"),i.push("    "+t(e(this.t("edit.edit")))),i.push("  </a>\n</div>\n<form class='address-form'>\n  <div class='primary-street'>\n    <div class='form-group'>\n      <label class='control-label'>"+t(e(this.t("edit.address.country")))+"</label>\n      <div class='controls'>\n        <select class='form-control' name='countryID' required>"),this.segment.mixed.country&&i.push("          <option value=''></option>"),c=this.dataModel.countries.objects;for(r in c)O.call(c,r)&&(s=c[r],i.push("          "+e(this.h.option(s.name,r,null!=(f=this.address.country)?f.id:void 0))));if(i.push("        </select>\n      </div>\n    </div>"),this.hasStates){i.push("    <div class='form-group'>\n      <label class='control-label'>"+t(e(this.t("edit.address.state")))+"</label>\n      <div class='controls'>\n        <select class='form-control' name='stateID' required>"),this.segment.mixed.state&&i.push("          <option value=''></option>"),y=this.dataModel.states.objects;for(a in y)O.call(y,a)&&(o=y[a],i.push("          "+e(this.h.option(o.name,a,null!=(v=this.address.state)?v.id:void 0))));i.push("        </select>\n      </div>\n    </div>")}else i.push("    <input class='form-control' name='stateID' type='hidden' value='"+t(e(null!=(b=this.address.state)?b.id:void 0))+"'>");return i.push("    <div class='form-group text-with-checkbox'>\n      <label class='control-label'>"+t(e(this.t("edit.address.city")))+"</label>\n      <div class='controls toggle-empty'>\n        <div class='controls-container'>\n          <input id='emptyCity' type='checkbox' name='emptyCity' checked='"+t(e(!!(null!=(L=this.address.city)?L.isEmpty:void 0)))+"'>\n          <label for='emptyCity'>"+t(e(this.t("edit.address.none")))+"</label>\n        </div>\n        <div class='input-container'>\n          <input class='form-control' autocomplete='off' maxlength='100' name='cityName' title='City name' type='text' value='"+t(e(null!=(w=this.address.city)?w.name:void 0))+"' required='"+t(e(!(null!=(S=this.address.city)?S.isEmpty:void 0)))+"' disabled='"+t(e(!!(null!=(C=this.address.city)?C.isEmpty:void 0)))+"'>\n        </div>\n      </div>\n    </div>\n    <div class='form-group text-with-checkbox'>\n      <label class='control-label'>"+t(e(this.t("edit.address.street")))+"</label>\n      <div class='toggle-empty'>\n        <div class='controls-container'>\n          <input id='emptyStreet' type='checkbox' name='emptyStreet' checked='"+t(e(!!(null!=(d=this.address.street)?d.isEmpty:void 0)))+"'>\n          <label for='emptyStreet'>"+t(e(this.t("edit.address.none")))+"</label>\n        </div>\n        <div class='input-container'>\n          <input class='form-control streetName' autocomplete='off' type='text' name='streetName' title='Street name' maxlength='100' value='"+t(e(null!=(p=this.address.street)?p.name:void 0))+"' required='"+t(e(!(null!=(m=this.address.street)?m.isEmpty:void 0)))+"' disabled='"+t(e(!!(null!=(g=this.address.street)?g.isEmpty:void 0)))+"'>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class='alt-street-controls'></div>\n  <div class='address-form-actions'>\n    <a class='address-edit-cancel btn btn-default' href='#'>"+t(e(this.t("edit.cancel")))+"</a>\n    <button class='btn btn-primary' type='submit'>"+t(e(this.t("edit.apply")))+"</button>\n  </div>\n</form>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")
}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/segment-alt-streets-edit"]=function(e){return function(){var e,t,i,n,s,r,o;if(t=window.HAML.escape,e=window.HAML.cleanValue,i=[],this.address.anyStreet){for(i.push("<p class='sub-section-header'>"+t(e(this.t("edit.segment.fields.alt_streets")+":"))+"</p>\n<table class='add-alt-street-form'>\n  <tr>\n    <th class='city'>"+t(e(this.t("edit.address.city")))+"</th>\n    <th>"+t(e(this.t("edit.address.street")))+"</th>\n    <th class='delete-buttons'></th>\n  </tr>"),o=this.address.altStreets,s=0,r=o.length;r>s;s++)n=o[s],i.push("  <tr class='alt-street' data-id='"+t(e(n.street.id))+"'>\n    <td>"+t(e(n.city.isEmpty?this.t("edit.address.none"):n.city.name))+"</td>\n    <td>"+t(e(n.street.name))+"</td>\n    <td>\n      <a class='alt-street-delete' href='#'>\n        <i class='icon-remove-sign'></i>\n      </a>\n    </td>\n  </tr>");i.push("  <tr class='alt-street-form-template new-alt-street'>\n    <td>"),this.isHighway?(i.push("      <div class='toggle-empty'>\n        <label>\n          <input class='form-control' autocomplete='off' disabled maxlength='100' name='cityName' title='City name' type='text'>\n        </label>\n        <div class='controls-container'>\n          <input id='alt-city' checked name='emptyCity' type='checkbox'>\n          <label class='checkbox' for='alt-city'>"),i.push("            "+t(e(this.t("edit.address.none")))),i.push("          </label>\n        </div>\n      </div>")):(i.push("      <div class='toggle-empty'>\n        <label>\n          <input class='form-control' type='text' autocomplete='off' name='cityName' title='City name' maxlength='100' required='"+t(e(!this.address.city.isEmpty))+"' disabled='"+t(e(this.address.city.isEmpty))+"' value='"+t(e(this.address.city.name))+"'>\n        </label>\n        <div class='controls-container'>\n          <input id='alt-city' type='checkbox' name='emptyCity' checked='"+t(e(this.address.city.isEmpty))+"'>\n          <label for='alt-city'>"),i.push("            "+t(e(this.t("edit.address.none")))),i.push("          </label>\n        </div>\n      </div>")),i.push("    </td>\n    <td>\n      <label>\n        <input class='form-control' autocomplete='off' maxlength='100' name='streetName' required='' title='Street name' type='text'>\n      </label>\n    </td>\n    <td>\n      <a class='alt-street-delete' href='#'>\n        <i class='icon-remove-sign'></i>\n      </a>\n    </td>\n  </tr>\n  <div class='alt-streets-actions'>\n    <a class='add-alt-street-btn' href='#'>"+t(e(this.t("edit.segment.actions.add_alt_street")))+"</a>\n  </div>\n</table>")}return i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/segment-edit"]=function(e){return function(){var e,t,i,n,s,r,o,a,l,h,u,c,d,p,m,g,f;for(t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<div class='segment'>\n  <div class='selection-text'>"),i.push("    "+t(e(this.t("edit.segment.title",{count:this.numSegments})))),i.push("  </div>"),this.view.consistentDirection||(i.push("  <div class='direction-message'>\n    <i class='icon-info-sign'></i>"),i.push("    "+t(e(this.t("edit.segment.op_direction")))),i.push("  </div>")),i.push("  <div class='tab-content'>\n    <div class='active tab-pane' id='segment-edit-general'>\n      <div class='segment-details'>\n        <div class='address-edit clearfix'></div>"),this.editable||(this.editingMultiple?(i.push("        <p class='message'>\n          <span class='error'>"+t(e(this.t("edit.segment.permissions.multiple.title")))+"</span>"),i.push("          "+t(e(this.t("edit.segment.permissions.multiple.description")))),i.push("        </p>")):(i.push("        <p class='message'>"),this.isLockedForUser?(i.push("          <span class='error'>"+t(e(this.t("edit.segment.permissions.locked.title")))+"</span>"),i.push("          "+t(e(this.t("edit.segment.permissions.locked.description",{lockLevel:this.h.formatRank(this.segment.getLockRank())}))))):(i.push("          <span class='error'>"+t(e(this.t("edit.segment.permissions.area.title")))+"</span>"),i.push("          "+t(e(this.t("edit.segment.permissions.area.description"))))),i.push("        </p>"))),i.push("      </div>\n      <form class='attributes-form'>\n        <div class='form-group'>\n          <label class='control-label'>"+t(e(this.t("edit.segment.fields.road_type")))+"</label>\n          <div class='controls'>\n            <select class='form-control' data-type='numeric' name='roadType'>\n              <option value='' selected='"+t(e(this.segment.mixed.roadType))+"'>"+t(e(this.segment.mixed.roadType?this.t("edit.multiple_values"):void 0))+"</option>\n              <optgroup label='"+t(e(this.t("segment.categories.highways")))+"'>"),i.push("                "+e(this.h.roadTypeOption(this.segment,3))),i.push("                "+e(this.h.roadTypeOption(this.segment,6))),i.push("                "+e(this.h.roadTypeOption(this.segment,7))),i.push("                "+e(this.h.roadTypeOption(this.segment,4))),i.push("              </optgroup>\n              <optgroup label='"+t(e(this.t("segment.categories.streets")))+"'>"),i.push("                "+e(this.h.roadTypeOption(this.segment,2))),i.push("                "+e(this.h.roadTypeOption(this.segment,1))),i.push("                "+e(this.h.roadTypeOption(this.segment,21))),i.push("              </optgroup>\n              <optgroup label='"+t(e(this.t("segment.categories.other_drivable")))+"'>"),i.push("                "+e(this.h.roadTypeOption(this.segment,8))),i.push("                "+e(this.h.roadTypeOption(this.segment,20))),i.push("                "+e(this.h.roadTypeOption(this.segment,17))),i.push("              </optgroup>\n              <optgroup label='"+t(e(this.t("segment.categories.non_drivable")))+"'>"),i.push("                "+e(this.h.roadTypeOption(this.segment,5))),i.push("                "+e(this.h.roadTypeOption(this.segment,10))),i.push("                "+e(this.h.roadTypeOption(this.segment,16))),i.push("                "+e(this.h.roadTypeOption(this.segment,18))),i.push("                "+e(this.h.roadTypeOption(this.segment,19))),i.push("                "+e(this.h.roadTypeOption(this.segment,14))),i.push("              </optgroup>\n            </select>"),this.view.shouldShowRoutingRoadTypeMessage()&&i.push("            <div class='hint'>"+e(this.view.getRoutingRoadTypeMessage())+"</div>"),i.push("            <div class='controls-container'>\n              <input id='tollRoadCheck' type='checkbox' name='tollRoad' checked='"+t(e(!!this.segment.attributes.toll))+"'>\n              <label for='tollRoadCheck'>"+t(e(this.t("edit.segment.fields.toll")))+"</label>\n            </div>\n          </div>\n        </div>"),this.view.shouldShowRoutingSelect()&&i.push("        "+e(JST["templates/segment-routing"](this))),i.push("        <div class='form-group'>\n          <label class='control-label'>"+t(e(this.t("edit.segment.fields.direction")))+"</label>\n          <div class='controls'>\n            <select class='form-control' data-type='numeric' name='direction'>"),this.segment.mixed.direction&&i.push("              <option value='-1'>"+t(e(this.t("edit.multiple_values")))+"</option>"),i.push("              "+e(this.h.directionOption(this.segment,3))),i.push("              "+e(this.h.directionOption(this.segment,1))),i.push("              "+e(this.h.directionOption(this.segment,2))),!this.segment.mixed.allowNoDirection&&this.segment.attributes.allowNoDirection&&i.push("              "+e(this.h.directionOption(this.segment,0))),i.push("            </select>\n          </div>\n        </div>\n        <div class='form-group'>\n          <label class='control-label'>"+t(e(this.t("edit.segment.fields.level")))+"</label>\n          <div class='controls'>\n            <select class='form-control' data-type='numeric' name='level'>\n              <option value=''>"+t(e(this.segment.mixed.level?this.t("edit.multiple_values"):void 0))+"</option>"),n=o=d=this.segment.MaxLevel,p=this.segment.MinLevel;p>=d?p>=o:o>=p;n=p>=d?++o:--o)i.push("              "+e(this.h.option(this.t("edit.segment.levels")[n]||n,n,this.segment.attributes.level)));if(i.push("            </select>\n          </div>\n        </div>\n        <div class='form-group'>\n          <label class='control-label'>"+t(e(this.t("edit.segment.fields.lock")))+"</label>\n          <div class='controls'>\n            <select class='form-control' data-type='numeric' data-nullable='"+t(e(!0))+"' name='lockRank'>"),this.segment.mixed.lockRank&&i.push("              <option value='' data-mixed-indicator='"+t(e(!0))+"'>"+t(e(this.t("edit.multiple_values")))+"</option>"),this.editable){for(i.push("              "+e(this.h.segmentRankOption(this.segment,null,this.allowDefaultRank))),s=a=0,m=this.userRank;m>=0?m>=a:a>=m;s=m>=0?++a:--a)i.push("              "+e(this.h.segmentRankOption(this.segment,s)));this.isStaffLocked&&i.push("              "+e(this.h.segmentRankOption(this.segment,this.segment.attributes.lockRank)))}else i.push("              "+e(this.h.segmentRankOption(this.segment,this.segment.attributes.lockRank)));if(i.push("            </select>\n          </div>\n        </div>\n        <div class='form-group'>\n          <div class='controls street-actions'>"),this.segment.mixed.street||!this.address.street||this.address.street.isEmpty||(i.push("            <button class='btn btn-default select-entire-street'>"+t(e(this.t("edit.segment.actions.select_entire_street")))+"</button>"),this.allowEditingHouseNumbers&&(i.push("            <button class='btn btn-default edit-house-numbers' disabled='"+t(e(this.dataModel.actionManager.canSave()))+"'>"),i.push(this.segment.canEditHouseNumbers()?"              "+t(e(this.t("edit.segment.actions.edit_house_numbers"))):"              "+t(e(this.t("edit.segment.actions.view_house_numbers")))),i.push("            </button>"),this.dataModel.actionManager.canSave()&&i.push("            <p>Save your changes to edit house numbers</p>"))),this.view.shouldAllowRestrictionEditing()&&(i.push("            <button class='btn btn-default edit-restrictions'>"),this.segment.arePropertiesEditable()?this.editingMultiple||this.segment.getRestrictionCount()>0?(i.push("              "+t(e(this.t("edit.segment.actions.restrictions.edit")))),i.push("              "+t(e(this.editingMultiple?"":"("+this.segment.getRestrictionCount()+")")))):i.push("              "+t(e(this.t("edit.segment.actions.restrictions.add")))):i.push("              "+t(e(this.t("edit.segment.actions.restrictions.view")))),i.push("            </button>")),i.push("          </div>\n        </div>\n      </form>\n      <ul class='additional-attributes list-unstyled'>"),null!=this.segment.attributes.length&&i.push("        <li>\n          <span class='name'>"+t(e(this.t("edit.segment.fields.length")+":"))+"</span>\n          <span class='value'>"+t(e(this.t("edit.segment.fields.length_value",{length:this.segment.attributes.length})))+"</span>\n        </li>"),null!=this.segment.attributes.updatedOn)if(this.editingMultiple)if(null!=this.segment.mixed.updatedBy){for(i.push("        <li>"),i.push("          "+t(e(this.t("edit.segment.fields.updated_by")+":"))),i.push("          <ul class='list-unstyled updated-by-list'>"),g=this.segment.attributes.updatedBy,l=0,u=g.length;u>l;l++)r=g[l],i.push("            <li>"+t(e(this.h.formatUserName(r)))+"\n              &lrm;\n            </li>");i.push("          </ul>\n        </li>")}else i.push("        <li>\n          <span class='name'>"+t(e(this.t("edit.segment.fields.updated_by")+":"))+"</span>\n          <span class='value'>"+t(e(this.h.formatUserName(this.segment.attributes.updatedBy)))+"</span>\n        </li>");else i.push("        <li>"+t(e(this.t("edit.updated",{time:this.h.dateOnlyString(this.segment.attributes.updatedOn),user:this.h.formatUserName(this.segment.attributes.updatedBy)})))+"\n          &lrm;\n        </li>");if(this.editingMultiple)if(this.segment.mixed.createdBy){for(i.push("        <li>"),i.push("          "+t(e(this.t("edit.segment.fields.created_by")+":"))),i.push("          <ul class='created-by-list list-unstyled'>"),f=this.segment.attributes.createdBy,h=0,c=f.length;c>h;h++)r=f[h],i.push("            <li>"+t(e(this.h.formatUserName(r)))+"\n              &lrm;\n            </li>");i.push("          </ul>\n        </li>")}else i.push("        <li>\n          <span>"+t(e(this.t("edit.segment.fields.created_by")+":"))+"</span>\n          <span class='value'>"+t(e(this.h.formatUserName(this.segment.attributes.createdBy)))+"</span>\n        </li>");else null!=this.segment.attributes.createdBy&&i.push("        <li>"+t(e(this.t("edit.created",{time:this.h.dateOnlyString(this.segment.attributes.createdOn),user:this.h.formatUserName(this.segment.attributes.createdBy)})))+"\n          &lrm;\n        </li>");return i.push("        <li>"+t(e(this.t("edit.id",{num:this.segmentId})))+"</li>\n      </ul>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/segment-routing"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<div class='form-group'>\n  <label class='col-xs-4 control-label'>"+t(e(this.t("edit.segment.fields.routing")))+"</label>\n  <div class='col-xs-8 controls'>\n    <select class='form-control' data-type='numeric' name='routingRoadType' data-nullable>"),i.push("      "+e(this.h.option(this.t("edit.segment.routing.road_type.prev"),this.routingRoadTypes.prev,this.segment.attributes.routingRoadType,!1,this.prevRouteRankDisabled))),i.push("      "+e(this.h.option(this.t("edit.segment.routing.road_type.current"),null,this.segment.attributes.routingRoadType))),i.push("      "+e(this.h.option(this.t("edit.segment.routing.road_type.next"),this.routingRoadTypes.next,this.segment.attributes.routingRoadType,!1,this.nextRouteRankDisabled))),i.push("    </select>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/session-expired"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<div id='session-expired-lightbox'>\n  <div class='map-modal-header'>"+t(e(this.t("session.expired.title")))+"</div>\n  <div class='map-modal-body'>\n    <p>"+t(e(this.t("session.expired.description")))+"</p>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/tips/watch-tutorial"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<div class='clearfix hidable-message' id='show-tutorial-lightbox'>\n  <div class='hide-message icon-remove-sign' data-hide-message='tips/watch-tutorial'></div>\n  <a data-toggle='modal' href='#tutorial-dialog'>\n    <img src='"+t(e(W.imagePath))+"video-notext.png'>"),i.push("    "+t(e(this.t("tutorial.title")))),i.push("  </a>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/tutorial-lightbox"]=function(e){return function(){var e,t,i,n,s,r,o;for(t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<div class='modal-dialog'>\n  <div class='modal-content'>\n    <div class='clearfix modal-body'>\n      <ul class='video-menu' style='display: none;'>"),o=this.videos,s=0,r=o.length;r>s;s++)n=o[s],i.push("        <li class='video-link' data-video-key='"+t(e(n))+"'>"+t(e(this.t("tutorial.videos."+n+".title")))+"</li>");return i.push("      </ul>\n      <div id='tutorial-player'></div>\n      <a class='dialog-close-button' href='#'></a>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/update_request/comment"]=function(e){return function(){var e,t,i,n,s,r,o;for(t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<li class='"+["comment",""+t(e(-1===this.comment.userID?"reporter":""))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n  <strong class='title'>"),i.push(-1===this.comment.userID?"    Reporter":"    "+t(e(this.h.formatUserName(this.comment.userID)))),i.push("    "+t(e("on "+I18n.l("date.formats.long",this.comment.createdOn)))),i.push("  </strong>\n  <div class='comment-text'>"),o=this.comment.text.split("\n"),s=0,r=o.length;r>s;s++)n=o[s],i.push("    "+t(e(n))),i.push("    <br>");return i.push("  </div>\n</li>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/update_request/comment_list"]=function(e){return function(){var e,t,i,n,s,r,o;for(t=window.HAML.escape,e=window.HAML.cleanValue,i=[],this.model.comments.isEmpty()&&(i.push("<div class='no-comments'>"),i.push("  "+t(e(this.t("conversation.no_comments")))),i.push("  <br>"),i.push("  "+t(e(this.t("conversation.ask")))),i.push("</div>")),i.push("<ul class='comment-list list-unstyled'>"),o=this.model.comments,s=0,r=o.length;r>s;s++)n=o[s],i.push("  "+e(JST["templates/update_request/comment"]({comment:n})));return i.push("</ul>"),this.view.pm.shouldAllowCommenting()&&(i.push("<form class='clearfix new-comment-form'>\n  <textarea class='form-control new-comment-text' placeholder='"+t(e(this.t("conversation.enter")))+"' required></textarea>\n  <button class='btn btn-default' type='submit'>"+t(e(this.t("conversation.send")))+"</button>\n  <button class='"+["btn","btn-default","toggle-follow",""+t(e(this.model.isFollowing?"following":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n    <span class='unfollow'>\n      <i class='icon-eye-close icon-large'></i>"),i.push("      "+t(e(this.t("conversation.unfollow")))),i.push("    </span>\n    <span class='follow'>\n      <i class='icon-eye-open icon-large'></i>"),i.push("      "+t(e(this.t("conversation.follow")))),i.push("    </span>\n  </button>\n</form>")),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/update_request/panel"]=function(e){return function(){var e,t,i,n;return t=window.HAML.escape,e=window.HAML.cleanValue,n=window.HAML.preserve,i=[],i.push("<h1>"+t(e(""+this.t("update_requests.types."+this.currentRequest.attributes.type)+" ("+this.t("problems.user_reported")+(this.shouldShowRequestID()?" - "+this.currentRequest.getID():"")+")"))+"</h1>\n<section class='clearfix panel-contents problem-details'>\n  <figure class='"+t(e(this.currentRequest.attributes.type))+"'>\n    <div class='image'></div>\n    <figcaption></figcaption>\n  </figure>\n  <section class='problem-description'>"),this.currentRequest.attributes.description&&i.push("    <article class='solution'>\n      <h2>"+t(e(this.t("problems.panel.description")+":"))+"</h2>\n      <p>"+t(e(this.currentRequest.attributes.description))+"</p>\n    </article>"),i.push("    <article class='solution'>\n      <h2>"+t(e(this.t("update_requests.panel.reported")+":"))+"</h2>\n      <p>"+t(e(this.h.dateOnlyString(this.currentRequest.attributes.driveDate)))+"</p>\n    </article>"),this.shouldShowCloseDetails()&&null!=this.currentRequest.attributes.updatedOn&&(i.push("    <article class='closedOn'>\n      <h2>"+t(e(this.t("problems.panel.resolved_title")+":"))+"</h2>"),i.push(null!=this.currentRequest.attributes.updatedBy?"      <p>"+t(e(this.t("problems.panel.resolved",{time:this.h.dateOnlyString(this.currentRequest.attributes.updatedOn),user:this.h.formatUserName(this.currentRequest.attributes.updatedBy)})))+"</p>":"      <p>"+t(e(this.t("problems.panel.resolved_no_user",{time:this.h.dateOnlyString(this.currentRequest.attributes.updatedOn)})))+"</p>"),i.push("    </article>")),i.push("  </section>\n  <section class='controls-container problem-display-options'>"),(this.shouldShowSessionCheckbox()||this.shouldShowRouteCheckbox())&&(i.push("    <h2>\n      <span>"+t(e(this.t("update_requests.panel.gps.title")))+"</span>\n      <a class='zoom-to-ur-button' href='#'>\n        \x91<span>(</span>\x92\n        <i class='icon-screenshot'></i>\n        <span>"+n(t(e(this.t("problems.panel.zoom_to_ur"))))+"\x92\x91</span>\n        \x91<span>)</span>\x92\n      </a>\n    </h2>"),this.shouldShowSessionCheckbox()&&i.push("    <input id='update-request-panel-drive' type='checkbox' value='drive' name='sessionDisplay' checked='"+t(e(this.displayedSessionTypes.drive))+"'>\n    <label for='update-request-panel-drive'>"+t(e(this.t("update_requests.panel.gps.user_drive")))+"</label>"),this.shouldShowRouteCheckbox()&&i.push("    <input id='update-request-panel-route' type='checkbox' value='route' name='sessionDisplay' checked='"+t(e(this.displayedSessionTypes.route))+"'>\n    <label for='update-request-panel-route'>"+t(e(this.t("update_requests.panel.gps.route")))+"</label>")),i.push("  </section>\n</section>\n<h1 class='collapsed-title'>"+t(e(""+this.t("update_requests.types."+this.currentRequest.attributes.type)+" ("+this.t("problems.user_reported")+(this.shouldShowRequestID()?" - "+this.currentRequest.getID():"")+")"))+"</h1>\n<div class='form-container'>\n  <form class='clearfix controls-container panel-action' id='edit-request'>"),W.Config.update_requests.conversation.enabled&&this.isSessionAvailable()&&(i.push("    <btn class='"+["btn","btn-default","toggle-comment-view",""+t(e(this.showCommentView?"comment-view-shown":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n      <i class='hide-icon icon-caret-up'></i>\n      <i class='icon-caret-down show-icon'></i>"),i.push("      "+t(e(this.t("conversation.title")))),i.push("      <span class='badge num-comments'>"+t(e(this.requestSession.comments.length))+"</span>\n    </btn>")),i.push("    <fieldset>\n      <legend>"+t(e(this.t("problems.panel.report_as")+":"))+"</legend>"),i.push("      "+e(this.h.radio(this.t("problems.panel.states.open"),"state",this.currentRequest.ResolutionType.NO_RESOLUTION,this.currentRequest.attributes.resolution,this.currentRequest.editable))),i.push("      "+e(this.h.radio(this.t("problems.panel.states.solved"),"state",this.currentRequest.ResolutionType.FIXED,this.currentRequest.attributes.resolution,this.currentRequest.editable))),i.push("      "+e(this.h.radio(this.t("problems.panel.states.rejected"),"state",this.currentRequest.ResolutionType.NOT_A_PROBLEM,this.currentRequest.attributes.resolution,this.currentRequest.editable))),i.push("    </fieldset>\n  </form>\n</div>\n<nav class='problem-panel-navigation'>\n  <button class='btn btn-default collapse-panel-button'>\n    <span>"+t(e(this.t("problems.panel.collapse")))+"</span>\n    <i class='icon-angle-up'></i>\n  </button>\n  <button class='btn btn-default expand-panel-button'>\n    <span>"+t(e(this.t("problems.panel.expand")))+"</span>\n    <i class='icon-angle-down'></i>\n  </button>\n  <button class='btn btn-default close-button'>\n    <span>"+t(e(this.t("problems.panel.close")))+"</span>\n  </button>\n</nav>\n<div class='"+["conversation-container",""+t(e(this.showCommentView?void 0:"not-shown"))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'></div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"").replace(/[\s\n]*\u0091/gm,"").replace(/\u0092[\s\n]*/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/user-details"]=function(e){return function(){var e,t,i,n,s;for(t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<p class='clearfix rank'>"),n=s=1;6>=s;n=++s)i.push("  <span class='"+t(e(this.normalizedLevel===n?"taken"+n:void 0))+"'>"+t(e(n))+"</span>");return i.push("</p>\n<p class='message'>"),i.push(this.isStaff?"  "+e(this.safe_t("user.info.level_header",{level_name:this.h.contentTag("strong",this.t("user.info.staff_level_name"))})+","):"  "+e(this.safe_t("user.info.level_header",{level_name:this.h.contentTag("strong",this.t("user.info.level_name",{level:this.normalizedLevel}))})+",")),W.Config.user_editing_enabled?(i.push("  "+t(e(this.t("user.info.area",{distance:this.t("user.info.mile",{count:this.editableMiles})})))),this.isCountryManager()?i.push("  "+t(e(this.t("user.info.country_manager")))):this.isAreaManager&&i.push("  "+t(e(this.t("user.info.area_manager"))))):(i.push("  <br>"),i.push("  "+e(this.safe_t("user.info.editing_restricted",{forum_link:this.h.link(this.t("user.info.forum"),this.t("internal.ur_forum_link"))})))),i.push("</p>\n<p class='message points'>"),i.push("  "+e(this.safe_t("user.info.points",{points:this.h.contentTag("strong",this.totalPoints)})+".")),i.push("</p>\n<div class='tips'>"),i.push("  "+e(this.h.hidableMessage("tips/watch-tutorial"))),i.push("</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/user-greeting"]=function(e){return function(){var e,t;return e=window.HAML.cleanValue,t=[],t.push("<h2>"+e(this.safe_t("user.info.greeting",{username:this.h.contentTag("strong",this.userName)}))+"</h2>"),t.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/util/day-checkboxes"]=function(e){return function(){var e,t,i,n,s;for(t=window.HAML.escape,e=window.HAML.cleanValue,i=[],n=s=0;6>=s;n=++s)i.push("<label class='checkbox-inline'>\n  <input type='checkbox' name='days' value='"+t(e(n))+"' checked='"+t(e(this.cb(n)))+"'>"),i.push("  "+t(e(this.t("date.abbr_day_names")[n]))),i.push("</label>");return i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/venue/alias"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<input class='alias-name form-control' type='text' value='"+t(e(this.name))+"'>\n<a class='delete'>\n  <i class='icon-remove-sign'></i>\n</a>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/venue/aliases-layout"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<ul class='list list-unstyled'></ul>\n<a class='"+["add",""+t(e(this.hideAddButton?"hidden":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' href='#'>"),i.push("  "+t(e(this.t("edit.landmark.aliases.add")))),i.push("</a>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/venue/category-tag"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<div class='category' data-category='"+t(e(this.category))+"'>"),i.push("  "+t(e(this.t("venues.categories."+this.category)))),this.hideClose||i.push("  <a class='remove-choice select2-search-choice-close' href='#'>\n    <i class='icon-remove'></i>\n  </a>"),i.push("</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/venue/suggested-categories"]=function(e){return function(){var e,t,i,n,s,r;for(e=window.HAML.cleanValue,t=[],t.push("<ul class='list-unstyled'>"),r=this.view.getSuggestedCategories(),n=0,s=r.length;s>n;n++)i=r[n],this.categoryMap[i]||(t.push("  <li class='select2-search-choice suggested-category'>"),t.push("    "+e(JST["templates/venue/category-tag"]({category:i,hideClose:!0}))),t.push("  </li>"));return t.push("</ul>"),t.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/venue/venue-categories"]=function(e){return function(){var e,t,i;return t=window.HAML.escape,e=window.HAML.cleanValue,i=[],i.push("<input name='categories' data-placeholder='"+t(e(this.t("edit.landmark.select_categories")))+"' type='hidden'>\n<div class='suggested-categories'>"),i.push("  "+e(JST["templates/venue/suggested-categories"](this))),i.push("</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),function(){this.JST||(this.JST={}),this.JST["templates/venue/venue-edit"]=function(e){return function(){var e,t,i,n,s,r,o,a,l,h,u,c,d,p,m,g,f,y,v,b,L,w,S,C,O,E,A,x,M,_,T,k,D,N,P,I,z,R;if(t=window.HAML.escape,e=window.HAML.cleanValue,n=window.HAML.preserve,i=[],i.push("<div class='landmark'>\n  <div class='selection-text'>"+t(e(this.t("edit.landmark.title")))+"</div>"),this.showUnapprovedAlert?(i.push("  <div class='alert alert-danger pending-changes-alert'>"),i.push("    "+t(e(this.t("edit.landmark.update_requests.unapproved")))),i.push("  </div>")):this.showPendingChangesAlert&&(i.push("  <div class='alert alert-danger pending-changes-alert'>"),i.push("    "+t(e(this.t("edit.landmark.update_requests.pending")))),i.push("  </div>")),i.push("  <ul class='nav nav-tabs'>\n    <li class='active'>\n      <a data-toggle='tab' href='#landmark-edit-general'>"+t(e(this.t("edit.landmark.tabs.general")))+"</a>\n    </li>"),this.landmark.attributes.residential||i.push("    <li>\n      <a data-toggle='tab' href='#landmark-edit-more-info'>"+t(e(this.t("edit.landmark.tabs.more_info")))+"</a>\n    </li>"),i.push("    <li>\n      <a data-toggle='tab' href='#landmark-edit-photos'>"),i.push("        "+t(e(""+this.t("edit.landmark.tabs.photos")+" ("+this.imageCount+")"))),i.push("      </a>\n    </li>\n  </ul>\n  <div class='tab-content'>\n    <div class='active tab-pane' id='landmark-edit-general'>\n      <form class='attributes-form'>"),!this.landmark.attributes.residential){for(i.push("        <div class='form-group'>\n          <label class='control-label'>"+t(e(this.t("edit.landmark.fields.categories")))+"</label>\n          <div class='categories controls'></div>\n        </div>\n        <div class='form-group'>\n          <label class='control-label'>"+t(e(this.t("edit.landmark.fields.name")))+"</label>\n          <div class='controls'>\n            <input class='form-control' autocomplete='off' maxlength='100' name='name' type='text' value='"+t(e(this.landmark.attributes.name))+"'>\n            <div class='aliases-view'></div>\n          </div>\n        </div>\n        <div class='"+["form-group","brand",""+t(e(this.landmark.isGasStation()?void 0:"not-shown"))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n          <label class='control-label'>"+t(e(this.t("edit.landmark.fields.brand")))+"</label>\n          <div class='controls'>\n            <select class='form-control' name='brand'>"),w=this.dataModel.venues.venueBrands,p=0,y=w.length;y>p;p++)r=w[p],i.push("              "+e(this.h.option(r,r,this.landmark.attributes.brand,!0)));if(i.push("            </select>\n          </div>\n        </div>\n        <div class='form-group'>\n          <label class='control-label'>"+t(e(this.t("edit.landmark.fields.description")))+"</label>\n          <div class='controls'>\n            <textarea class='form-control' name='description'>"+n(t(e(this.landmark.attributes.description)))+"</textarea>\n          </div>\n        </div>\n        <div class='form-group'>\n          <label class='control-label'>"+t(e(this.t("edit.landmark.fields.lock")))+"</label>\n          <div class='controls'>\n            <select class='form-control' data-type='numeric' name='lockRank'>"),this.landmark.arePropertiesEditable()){for(S=this.lockRankRange,m=0,v=S.length;v>m;m++)h=S[m],i.push("              "+e(this.h.option(this.h.formatRank(h),h,this.landmark.attributes.lockRank)));
this.showStaffLockOption&&i.push("              "+e(this.h.option(this.h.formatRank(this.landmark.attributes.lockRank),this.landmark.attributes.lockRank,this.landmark.attributes.lockRank)))}else i.push("              <option>"+t(e(this.h.formatRank(this.landmark.attributes.lockRank)))+"</option>");i.push("            </select>\n          </div>\n        </div>\n        <div class='form-group'>\n          <label class='control-label'>"+t(e(this.t("edit.landmark.fields.type")))+"</label>\n          <div class='controls'>\n            <div class='btn-group' data-toggle='buttons'>\n              <label class='"+["btn","btn-default",""+t(e(this.landmark.isPoint()?"active":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' disabled='"+t(e(!this.landmark.arePropertiesEditable()))+"'>\n                <input type='radio' name='isPoint' checked='"+t(e(this.landmark.isPoint()))+"' value='true'>"),i.push("                  "+t(e(this.t("edit.landmark.type.point")))),i.push("              </label>\n              <label class='"+["btn","btn-default",""+t(e(this.landmark.isPoint()?void 0:"active"))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' disabled='"+t(e(!this.landmark.arePropertiesEditable()))+"'>\n                <input type='radio' name='isPoint' checked='"+t(e(!this.landmark.isPoint()))+"' value='false'>"),i.push("                  "+t(e(this.t("edit.landmark.type.area")))),i.push("              </label>\n            </div>\n          </div>\n        </div>")}i.push("        <div class='form-group'>\n          <label class='control-label'>"+t(e(this.t("edit.landmark.fields.residential")))+"</label>\n          <div class='controls'>\n            <div class='btn-group' data-toggle='buttons'>\n              <label class='"+["btn","btn-default",""+t(e(this.landmark.attributes.residential?"active":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' disabled='"+t(e(!this.landmark.arePropertiesEditable()))+"'>\n                <input type='radio' name='residential' checked='"+t(e(this.landmark.attributes.residential))+"' value='true' data-refresh='"+t(e(!0))+"' data-type='boolean'>"),i.push("                  "+t(e(this.t("edit.landmark.residential.private")))),i.push("              </label>\n              <label class='"+["btn","btn-default",""+t(e(this.landmark.attributes.residential?void 0:"active"))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' disabled='"+t(e(!this.landmark.arePropertiesEditable()))+"'>\n                <input type='radio' name='residential' checked='"+t(e(!this.landmark.attributes.residential))+"' value='false' data-refresh='"+t(e(!0))+"' data-type='boolean'>"),i.push("                  "+t(e(this.t("edit.landmark.residential.public")))),i.push("              </label>\n            </div>\n          </div>\n        </div>\n      </form>\n      <div class='landmark-address-edit'>\n        <div class='sub-section-header'>"+t(e(this.t("edit.landmark.fields.address")))+"</div>\n        <div class='clearfix preview'>\n          <div class='venue-address'>"),i.push(this.showAddress?"            "+t(e(this.h.formatPlaceAddress(this.landmark))):"            "+t(e(this.t("edit.landmark.no_address")))),i.push("          </div>"),this.landmark.arePropertiesEditable()&&(i.push("          <a class='address-edit-btn'>\n            <i class='icon-edit'></i>"),i.push("            "+t(e(this.t("edit.edit")))),i.push("          </a>")),i.push("        </div>\n        <form class='clearfix landmark-address-form'>\n          <div class='form-group'>\n            <label class='control-label'>"+t(e(this.t("edit.address.country")))+"</label>\n            <div class='controls'>\n              <select class='form-control' name='countryID' required>"),T=this.dataModel.countries.objects;for(a in T)o=T[a],i.push("                "+e(this.h.option(o.name,a,null!=(k=this.address.country)?k.id:void 0)));if(i.push("              </select>\n            </div>\n          </div>"),this.showStatesSelection){i.push("          <div class='form-group'>\n            <label class='control-label'>"+t(e(this.t("edit.address.state")))+"</label>\n            <div class='controls'>\n              <select class='form-control' name='stateID' required>"),D=this.dataModel.states.objects;for(d in D)c=D[d],i.push("                "+e(this.h.option(c.name,d,null!=(N=this.address.state)?N.id:void 0)));i.push("              </select>\n            </div>\n          </div>")}else i.push("          <input class='form-control' name='stateID' type='hidden' value='"+t(e(null!=(P=this.address.state)?P.id:void 0))+"'>");if(i.push("          <div class='form-group text-with-checkbox'>\n            <label class='control-label'>"+t(e(this.t("edit.address.city")))+"</label>\n            <div class='controls toggle-empty'>\n              <div class='controls-container'>\n                <input class='toggleEmptyAddress' id='emptyCity' type='checkbox' name='emptyCity' checked='"+t(e(!!(null!=(I=this.address.city)?I.isEmpty:void 0)))+"'>\n                <label for='emptyCity'>"+t(e(this.t("edit.address.none")))+"</label>\n              </div>\n              <div class='input-container'>\n                <input class='form-control' type='text' autocomplete='off' name='cityName' title='City name' maxlength='100' value='"+t(e(null!=(z=this.address.city)?z.name:void 0))+"' required='"+t(e(!(null!=(R=this.address.city)?R.isEmpty:void 0)))+"' disabled='"+t(e(!!(null!=(C=this.address.city)?C.isEmpty:void 0)))+"'>\n              </div>\n            </div>\n          </div>\n          <div class='form-group text-with-checkbox'>\n            <label class='control-label'>"+t(e(this.t("edit.address.street")))+"</label>\n            <div class='controls toggle-empty'>\n              <div class='controls-container'>\n                <input class='toggleEmptyAddress' id='emptyStreet' type='checkbox' name='emptyStreet' checked='"+t(e(!!(null!=(O=this.address.street)?O.isEmpty:void 0)))+"'>\n                <label for='emptyStreet'>"+t(e(this.t("edit.address.none")))+"</label>\n              </div>\n              <div class='input-container'>\n                <input class='form-control streetName' autocomplete='off' type='text' name='streetName' title='Street name' maxlength='100' value='"+t(e(null!=(E=this.address.street)?E.name:void 0))+"' required='"+t(e(!(null!=(A=this.address.street)?A.isEmpty:void 0)))+"' disabled='"+t(e(!!(null!=(x=this.address.street)?x.isEmpty:void 0)))+"'>\n              </div>\n            </div>\n          </div>\n          <div class='form-group'>\n            <label class='control-label'>"+t(e(this.t("edit.landmark.fields.houseNumber")))+"</label>\n            <div class='controls'>\n              <input class='form-control' autocomplete='off' maxlength='100' name='houseNumber' type='text' value='"+t(e(this.landmark.attributes.houseNumber))+"'>\n            </div>\n          </div>\n          <div class='address-form-actions'>\n            <a class='address-edit-cancel btn btn-default' href='#'>"+t(e(this.t("edit.cancel")))+"</a>\n            <button class='btn btn-primary' type='submit'>"+t(e(this.t("edit.apply")))+"</button>\n          </div>\n        </form>\n      </div>\n      <div class='opening-hours'></div>\n      <ul class='additional-attributes list-unstyled'>"),null!=this.landmark.attributes.updatedBy&&i.push("        <li>"+t(e(this.t("edit.updated",{time:this.h.dateOnlyString(this.landmark.attributes.updatedOn),user:this.h.formatUserName(this.landmark.attributes.updatedBy)})))+"</li>"),null!=this.landmark.attributes.createdBy&&i.push("        <li>"+t(e(this.t("edit.created",{time:this.h.dateOnlyString(this.landmark.attributes.createdOn),user:this.h.formatUserName(this.landmark.attributes.createdBy)})))+"</li>"),i.push("        <li>"+t(e(this.t("edit.id",{num:this.landmark.getID()})))+"</li>\n      </ul>\n    </div>"),!this.landmark.attributes.residential){for(i.push("    <div class='tab-pane' id='landmark-edit-more-info'>\n      <form class='attributes-form'>\n        <div class='sub-section-header'>"+t(e(this.t("edit.landmark.fields.contact")))+"</div>\n        <div class='form-group'>\n          <label class='control-label'>"+t(e(this.t("edit.landmark.fields.url")))+"</label>\n          <div class='controls'>\n            <input class='form-control' autocomplete='off' maxlength='100' name='url' type='text' value='"+t(e(this.landmark.attributes.url))+"'>\n          </div>\n        </div>\n        <div class='form-group'>\n          <label class='control-label'>"+t(e(this.t("edit.landmark.fields.phone")))+"</label>\n          <div class='controls'>\n            <input class='form-control' autocomplete='off' maxlength='100' name='phone' type='tel' value='"+t(e(this.landmark.attributes.phone))+"'>\n          </div>\n        </div>\n        <div class='sub-section-header'>"+t(e(this.t("edit.landmark.fields.services")))+"</div>\n        <div class='controls-container form-group'>\n          <div class='col-xs-11 col-xs-offset-1'>"),M=this.serviceTypes,g=0,b=M.length;b>g;g++)u=M[g],i.push("            <div class='service-checkbox'>\n              <input id='service-checkbox-"+u+"' type='checkbox' name='services' data-multiple='"+t(e(!0))+"' value='"+t(e(u))+"' checked='"+t(e(null!=this.serviceSet[u]))+"'>\n              <label for='service-checkbox-"+t(e(u))+"'>"+t(e(this.t("venues.services."+u)))+"</label>\n            </div>");i.push("          </div>\n        </div>\n      </form>\n    </div>")}for(i.push("    <div class='tab-pane' id='landmark-edit-photos'>\n      <div class='image-view'>"),this.hasImages||i.push("        <em>"+t(e(this.t("edit.landmark.no_photos")))+"</em>"),s=require("Waze/Model/Object/Image").SIZE,_=this.images,f=0,L=_.length;L>f;f++)l=_[f],i.push("        <div class='image-preview-container' data-id='"+t(e(l.id))+"'>\n          <img class='image-preview' src='"+t(e(l.getUrl(s.WEB)))+"'>\n          <button class='btn icon-remove image-delete-button'></button>\n          <button class='btn icon-search image-enlarge-button'></button>\n        </div>");return i.push("      </div>\n    </div>\n  </div>\n</div>"),i.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(e))}}.call(this),this.require.define({"Waze/Action":function(e,t,i){var n,s=t("Waze/Util");n=OpenLayers.Class({model:null,GEOMETRY_FIELDS:["geometry"],initialize:function(e){OpenLayers.Util.extend(this,e)},destroy:function(){this.model=null},isLeaf:function(){return!0},accept:function(e){e.visit(this)},setModel:function(e){this.model=e},undoSupported:function(){return s.isDefined(this.undoAction)},doAction:function(){},redoAction:function(){},undoAction:function(){},getBounds:function(){return null},eachGeometryField:function(e,t){this.GEOMETRY_FIELDS.forEach(function(i){t.call(this,i,e[i],e)},this)},CLASS_NAME:"Waze.Action"}),n.TYPE={ADD:"ADD",DELETE:"DELETE",UPDATE:"UPDATE",REPLACE:"REPLACE"},i.exports=n}}),this.require.define({"Waze/Action/AddAlternateStreet":function(e,t,i){var n,s=t("Waze/Action/CompositeAction"),r=t("Waze/Action/UpdateObject"),o=t("Waze/Action/AddOrGetCity"),a=t("Waze/Action/AddOrGetStreet");n=OpenLayers.Class(s,{segment:null,attributes:null,initialize:function(e,t,i){s.prototype.initialize.apply(this,[i]),this.segment=e,this.attributes=t},destroy:function(){this.segment=null,s.prototype.destroy.apply(this)},doAction:function(){var e,t,i,n,s=this.segment.getAddress();return!s.street||s.street.isEmpty?!1:(i=new o(s.state,s.country,this.attributes.cityName,this.attributes.emptyCity),this.doSubAction(i),e=i.city,n=new a(this.attributes.streetName,e,this.attributes.emptyStreet),this.doSubAction(n),t=n.street,this.segment.attributes.streetIDs.contains(t.getID())?!1:void this.doSubAction(new r(this.segment,{streetIDs:this.segment.attributes.streetIDs.concat(t.getID())})))},CLASS_NAME:"Waze.Model.AddAlternateStreet"}),i.exports=n}}),this.require.define({"Waze/Action/AddJunction":function(e,t,i){var n,s=t("Waze/Action/CompositeAction"),r=t("Waze/Action/SplitSegments"),o=t("Waze/Feature/Vector/Segment");n=OpenLayers.Class(s,{segments:null,sourceSplits:null,targetSplits:null,initialize:function(e,t,i){s.prototype.initialize.apply(this,[i]),this.segments=e,this.sourceSplits=t.first().map(function(e){var t=new o({geometry:e});return t.copyAttributes(this.segments.first()),t},this),this.targetSplits=t.last().map(function(e){var t=new o({geometry:e});return t.copyAttributes(this.segments.last()),t},this),this.options=i},destroy:function(){this.segments=null,this.sourceSplits=null,this.targetSplits=null,s.prototype.destroy.apply(this)},doAction:function(){var e=new r(this.segments.last(),{splits:this.targetSplits});this.doSubAction(e),this.doSubAction(new r(this.segments.first(),{splits:this.sourceSplits,splitNode:e.splitNode}))},CLASS_NAME:"Waze.Action.AddJunction"}),i.exports=n}}),this.require.define({"Waze/Action/AddLandmark":function(e,t,i){var n,s=t("Waze/Action/CompositeAction"),r=t("Waze/Action"),o=t("Waze/Action/AddOrGetCity"),a=t("Waze/Action/AddOrGetStreet"),l=(t("Waze/Feature/Vector/Landmark"),t("Waze/Model/ObjectType"));n=OpenLayers.Class(s,{landmark:null,attributes:null,initialGeometry:null,initialize:function(e,t){s.prototype.initialize.apply(this,[t]),this.landmark=e},destroy:function(){this.landmark=null,s.prototype.destroy.apply(this)},doAction:function(){var e,t,i,n=null,s=this.landmark.attributes.geometry;return this.landmark.isPoint()||this.landmark.is2D()?(this.initialGeometry=this.landmark.geometry.clone(),this.landmark.attributes.geometry=null,this.attributes={},$.extend(!0,this.attributes,this.landmark.attributes),this.landmark.attributes.geometry=s,this.landmark.getID()||this.landmark.setID(this.model.venues.generateUniqueID()),this.landmark.state=OpenLayers.State.INSERT,this.model.venues.put(this.landmark),this.model.segments.topCityID&&(n=this.model.cities.get(this.model.segments.topCityID)),null===n&&null!==this.model.countries.top&&(t=new o(this.model.states.top,this.model.countries.top,"",!0),this.doSubAction(t),n=t.city),null!==n&&(e=new a("",n,!0),this.doSubAction(e),i=e.street,this.attributes.streetID=i.getID(),this.landmark.attributes.streetID=i.getID()),!0):!1},undoAction:function(){s.prototype.undoAction.apply(this),this.model.venues.remove(this.landmark)},redoAction:function(){this.model.venues.put(this.landmark),s.prototype.redoAction.apply(this)},serialize:function(){var e=this.attributes;e.id=this.landmark.getID(),e.geometry=this.initialGeometry;var t={_objectType:l.VENUE,action:r.TYPE.ADD,attributes:e};return t},getBounds:function(){return this.initialGeometry.getBounds().clone()},CLASS_NAME:"Waze.Action.AddLandmark"}),i.exports=n}}),this.require.define({"Waze/Action/AddNode":function(e,t,i){var n,s=t("Waze/Action"),r=t("Waze/Action/ConnectSegment"),o=t("Waze/Action/CompositeAction"),a=t("Waze/Model/ObjectType"),l=t("Waze/Feature/Vector/Node");n=OpenLayers.Class(o,{point:null,segments:null,options:null,node:null,nodeAttributes:null,initialize:function(e,t,i){o.prototype.initialize.apply(this,[i]),this.point=e.clone(),delete this.point.parent,this.segments=t,this.options=i,this.nodeAttributes={}},destroy:function(){this.model.nodes.get(this.node.getID())||this.node.destroy(),this.options=null,this.segment=null,this.point=null,this.node=null,this.newID=null,this.segments=null,this.nodeAttributes=null,o.prototype.destroy.apply(this)},createNode:function(e){var t=new l({geometry:e});return t.attributes||(t.attributes={}),OpenLayers.Util.applyDefaults(t.attributes,this.DEFAULT_NODE_ATTRIBUTES),t.attributes.segIDs=[],t.state=OpenLayers.State.INSERT,t.setID(this.model.nodes.generateUniqueID()),$.extend(!0,this.nodeAttributes,t.attributes),t},doAction:function(){if(this.node=this.createNode(this.point.clone()),this.model.nodes.put(this.node),null!==this.segments)for(var e=0,t=this.segments.length;t>e;e++)this.doSubAction(new r(this.node,this.segments[e],this.options))},undoAction:function(){o.prototype.undoAction.apply(this),this.model.nodes.remove(this.node)},redoAction:function(){this.model.nodes.put(this.node),o.prototype.redoAction.apply(this)},serialize:function(){var e,t=this.nodeAttributes;return t.id=this.node.getID(),t.geometry=this.point,e={_objectType:a.NODE,action:s.TYPE.ADD,attributes:t}},DEFAULT_NODE_ATTRIBUTES:{permissions:2147483647},CLASS_NAME:"Waze.Action.AddNode"}),i.exports=n}}),this.require.define({"Waze/Action/AddOrGetCity":function(e,t,i){var n,s=t("Waze/Action/CompositeAction"),r=t("Waze/Action/CreateObject"),o=t("Waze/Model/ObjectType");n=OpenLayers.Class(s,{city:null,initialize:function(e,t,i,n,r){s.prototype.initialize.apply(this,[r]),this.state=e,this.country=t,this.name=i,this.isEmpty=n},doAction:function(){var e,t=null,i=!1;return this.state||(this.state=this.model.states.getByAttributes({isDefault:!0}).first()),t=this.isEmpty?this.model.cities.getByAttributes({countryID:this.country.getID(),stateID:this.state.getID(),isEmpty:!0}).first():this.model.cities.getByAttributes({name:this.name,countryID:this.country.getID(),stateID:this.state.getID()}).first(),t||(e=new r(o.CITY,{countryID:this.country.getID(),stateID:this.state.getID(),isEmpty:this.isEmpty,name:this.isEmpty?"":this.name}),this.doSubAction(e),t=e.newObject,i=!0),this.city=t,i},CLASS_NAME:"Waze.Action.AddOrGetCity"}),i.exports=n}}),this.require.define({"Waze/Action/AddOrGetStreet":function(e,t,i){var n,s=t("Waze/Action/CompositeAction"),r=t("Waze/Action/CreateObject"),o=t("Waze/Model/ObjectType");n=OpenLayers.Class(s,{street:null,initialize:function(e,t,i){s.prototype.initialize.apply(this,arguments),this.city=t,this.name=e,this.isEmpty=i},doAction:function(){var e,t=null,i=!1;return t=this.isEmpty?this.model.streets.getByAttributes({isEmpty:!0,cityID:this.city.getID()}).first():this.model.streets.getByAttributes({name:this.name,cityID:this.city.getID()}).first(),t||(e=new r(o.STREET,{name:this.isEmpty?"":this.name,isEmpty:this.isEmpty,cityID:this.city.getID()}),this.doSubAction(e),t=e.newObject,i=!0),this.street=t,i},CLASS_NAME:"Waze.Action.AddOrGetStreet"}),i.exports=n}}),this.require.define({"Waze/Action/AddSegment":function(e,t,i){var n,s=t("Waze/Action"),r=t("Waze/Action/SegmentAction"),o=t("Waze/Action/CompositeAction"),a=t("Waze/Model/ObjectType");n=OpenLayers.Class(r,{segment:null,segmentAttributes:null,initialSegmentGeometry:null,createNodes:!1,initialize:function(e,t){r.prototype.initialize.apply(this,[e,t]),this.segment=e,this.segmentAttributes={}},destroy:function(){this.segment=null,this.segmentAttributes=null,this.newID=null,this.options=null,null!==this.initialSegmentGeometry&&(this.initialSegmentGeometry.destroy(),this.initialSegmentGeometry=null),r.prototype.destroy.apply(this)},doAction:function(){if(this.segment.isSingular())return!1;this.segment.geometry.bounds||this.segment.geometry.calculateBounds(),this.segment.bounds||(this.segment.bounds=this.segment.geometry.bounds),this.segment.state=OpenLayers.State.INSERT,this.segment.getID()||this.segment.setID(this.model.segments.generateUniqueID()),this.segment.attributes.streetIDs||(this.segment.attributes.streetIDs=[]),this.initialSegmentGeometry=this.segment.geometry.clone(),this.model.segments.put(this.segment);var e=(this.segment.geometry.getVertices(!0),this.segment.attributes.geometry);this.segment.attributes.geometry=null,$.extend(!0,this.segmentAttributes,this.segment.attributes),this.segment.attributes.geometry=e,this.updateEndPoint(null,this.touching.fromVertex,!0),this.updateEndPoint(null,this.touching.toVertex,!1)},undoAction:function(){r.prototype.undoAction.apply(this),this.model.segments.remove(this.segment)},redoAction:function(){this.model.segments.put(this.segment),r.prototype.redoAction.apply(this)},serialize:function(){var e=this.segmentAttributes;e.id=this.segment.getID(),e.geometry=this.initialSegmentGeometry;var t={_objectType:a.SEGMENT,action:s.TYPE.ADD,attributes:e};return t},getBounds:function(){var e=o.prototype.getBounds.apply(this,arguments)||new OpenLayers.Bounds;return e.extend(this.initialSegmentGeometry.getBounds()),e},CLASS_NAME:"Waze.Action.AddSegment"}),i.exports=n}}),this.require.define({"Waze/Action/CompositeAction":function(e,t,i){var n,s=t("Waze/Action"),r=t("Waze/Utils/Visitor");n=OpenLayers.Class(s,{subActions:null,initialize:function(e){s.prototype.initialize.apply(this,[e]),this.subActions=[]},destroy:function(){for(var e=0,t=this.subActions.length;t>e;e++)this.subActions[e].destroy();this.subActions=null,s.prototype.destroy.apply(this)},isLeaf:function(){return!1},doSubAction:function(e){e.setModel(this.model);var t=e.doAction();return t!==!1?this.subActions.push(e):e.destroy(),t},doAction:function(){for(var e,t=!1,i=0,n=this.subActions.length;n>i;i++)e=this.subActions[i].doAction()!==!1,t=t||e},undoAction:function(){for(var e=this.subActions.length-1;e>=0;e--)this.subActions[e].undoAction()},redoAction:function(){for(var e=0,t=this.subActions.length;t>e;e++)this.subActions[e].redoAction()},accept:function(e){var t=e.getTraversalOrder(this),i=e.beforeEnter(this),n=!1;t!==r.Order.POST&&(e.visit(this),n=!0),i!==!1&&this.subActions.forEach(function(t){t.accept(e)}),n||e.visit(this),e.afterLeave(this)},getBounds:function(){var e,t,i,n;if(this.subActions.isEmpty())return null;for(n=this.subActions.first().getBounds(),e=n?n.clone():new OpenLayers.Bounds,t=1;t<this.subActions.length;t++)i=this.subActions[t],n=i.getBounds(),n&&n.getWidth()>0&&n.getHeight()>0&&e.extend(n);return e},serialize:function(){return null},CLASS_NAME:"Waze.Action.CompositeAction"}),i.exports=n}}),this.require.define({"Waze/Action/ConnectSegment":function(e,t,i){(function(){var e,n,s;e=t("Waze/Action/CompositeAction"),s=t("Waze/Action/UpdateObject"),n=OL.Class(e,{segment:null,node:null,initialize:function(t,i,n){this.node=t,this.segment=i,e.prototype.initialize.apply(this,[n])},doAction:function(){var e,t;return(e=this.findSegmentEdge())?(t={},t[""+e+"NodeID"]=this.node.getID(),this.doSubAction(new s(this.segment,t)),this.updateNodeSegmentList(),!0):!1},findSegmentEdge:function(){var e;return e=this.segment.geometry.getVertices(!0),e[0].equals(this.node.geometry)?"from":e[1].equals(this.node.geometry)?"to":null},updateNodeSegmentList:function(){var e;return e=this.node.attributes.segIDs.clone(),e.contains(this.segment.getID())||e.push(this.segment.getID()),this.doSubAction(new s(this.node,{segIDs:e},{dontSerialize:!0}))},CLASS_NAME:"W.Action.ConnectSegment"}),i.exports=n}).call(this)}}),this.require.define({"Waze/Action/CreateObject":function(e,t,i){var n,s=t("Waze/Action"),r=t("Waze/Model/Object");n=OpenLayers.Class(s,{objectType:null,attributes:null,newObject:null,repository:null,initialize:function(e,t,i,n){s.prototype.initialize.apply(this,[i]),this.objectType=e,this.attributes=t,this.newObject=n},destroy:function(){null!==this.newObject&&null===this.repository.get(this.newObject.getID())&&this.newObject.destroy(),this.objectType=null,this.attributes=null,this.newObject=null,this.repository=null,s.prototype.destroy.apply(this)},createNewObject:function(e,t){var i=t;return i||(i=new r,i.id=e.generateUniqueID(),i.version=1),OpenLayers.Util.extend(i,this.attributes),i.state=OpenLayers.State.INSERT,i},doAction:function(){return this.repository=this.model.getRepository(this.objectType),null===this.repository?!1:(this.newObject=this.createNewObject(this.repository,this.newObject),this.repository.put(this.newObject),!0)},undoAction:function(){this.repository.remove(this.newObject)},redoAction:function(){this.repository.put(this.newObject)},serialize:function(){var e,t=this.attributes;return t.id=this.newObject.getID(),e={_objectType:this.objectType,action:s.TYPE.ADD,attributes:t}},CLASS_NAME:"Waze.Action.CreateObject"}),i.exports=n}}),this.require.define({"Waze/Action/CreateRoundabout":function(e,t,i){var n,s=(t("Waze/Action"),t("Waze/Action/CompositeAction")),r=t("Waze/Action/UpdateSegmentGeometry"),o=t("Waze/Action/SplitSegments"),a=t("Waze/Action/AddNode"),l=t("Waze/Action/AddSegment"),h=t("Waze/Action/ModifyConnection"),u=t("Waze/Action/ConnectSegment"),c=t("Waze/Action/DeleteSegment"),d=t("Waze/Action/CreateObject"),p=t("Waze/Action/UpdateObject"),m=t("Waze/Model/ObjectType"),g=t("Waze/Feature/Vector/Segment");n=OpenLayers.Class(s,{ELLIPSE_PRECISION:.17453292519943295,ellipse:null,containedSegments:null,roundaboutSegments:null,initialize:function(e,t){s.prototype.initialize.apply(this,[t]),this.ellipse=e},destroy:function(){this.ellipse=null,s.prototype.destroy.apply(this)},doAction:function(){var e=this.getIntersections();return e.isEmpty()?!1:(this.deleteContainedSegments(),this.modifyIntersectingSegments(e),this.addRoundaboutSegments(e),void this.addRoundabout())},isLeftHand:function(){return this.model.isLeftHand},addRoundabout:function(){var e,t=_(this.roundaboutSegments).invoke("getID"),i={segIDs:t,type:"RA"};e=new d(m.JUNCTION,i),this.doSubAction(e),this.roundaboutSegments.forEach(function(t){this.doSubAction(new p(t,{junctionID:e.newObject.getID()}))},this)},deleteContainedSegments:function(){this.containedSegments.forEach(function(e){this.doSubAction(new c(e))},this)},addRoundaboutSegments:function(e){var t,i,n,s,r,o,a,h;for(this.roundaboutSegments=[],e=e.reduce(function(e,t){return e.concat(t)}),e.sort(function(e,t){return e.angle-t.angle}),e.push({angle:e.first().angle,point:e.first().point,segments:[]}),t=0;t<e.length-1;t++){for(n=e[t].point,s=e[t+1].point,a=new OpenLayers.Geometry.LineString,h=new g({geometry:a}),r=e[t].angle,o=e[t+1].angle,t===e.length-2&&(o+=2*Math.PI),a.addPoint(n.clone()),i=r+this.ELLIPSE_PRECISION;o>i;i+=this.ELLIPSE_PRECISION)a.addPoint(new OpenLayers.Geometry.Point(this.ellipse.center.x+this.ellipse.rx*Math.cos(i),this.ellipse.center.y+this.ellipse.ry*Math.sin(i)));i>o&&a.addPoint(s.clone()),this.isLeftHand()&&(h.attributes.fwdDirection=!1,h.attributes.revDirection=!0),this.doSubAction(new l(h)),this.roundaboutSegments.push(h)}e.pop(),this.addNodes(e,this.roundaboutSegments)},addNodes:function(e,t){var i,n;e.forEach(function(e,s){i=e.segments.clone(),i.push(t[s]),i.push(t[(t.length+s-1)%t.length]),e.node?i.forEach(function(t){t.isConnectedToNode(e.node)||this.doSubAction(new u(e.node,t))},this):(n=new a(e.point,i),this.doSubAction(n),e.node=n.node),this.isLeftHand()?(this.openConnection(i.first(),e.node,i.last()),this.openConnection(i[1],e.node,i.first()),this.openConnection(i[1],e.node,i.last())):(this.openConnection(i.first(),e.node,i[1]),this.openConnection(i.last(),e.node,i.first()),this.openConnection(i.last(),e.node,i[1]))},this)},openConnection:function(e,t,i){t.isTurnAllowedBySegDirections(e,i)&&this.doSubAction(new h(e.getID(),t,i.getID(),!0))},modifyIntersectingSegments:function(e){e.forEach(function(e){1===e.length?this.shortenSegment(e.first()):this.splitSegment(e)},this)},splitSegment:function(e){var t=e.first().segments.first(),i=new o(t,{splitAtPoint:e.first().point,splittingPointIndex:e.first().index});this.doSubAction(i),e.first().node=i.splitNode,e.last().segments=[i.splits.last()],e.last().index=e.last().index-e.first().index,e.first().segments=[i.splits.first()],this.shortenSegment(e.last())},shortenSegment:function(e){var t=e.segments.first(),i=t.geometry.clone();e.goingOut?(t.geometry.components.splice(0,e.index+1),t.geometry.addComponent(e.point.clone(),0)):(t.geometry.components.splice(e.index+1),t.geometry.addComponent(e.point.clone())),this.doSubAction(new r(t,i,t.geometry))},getIntersections:function(){var e,t,i=this;return this.containedSegments=[],e=this.model.segments.getObjectArray(function(e){return e.state!==OpenLayers.State.DELETE&&e.geometry.bounds.intersectsBounds(i.ellipse.bounds)}),e.reduce(function(e,n){return t=n.intersectionWithEllipse(i.ellipse.center,i.ellipse.rx,i.ellipse.ry),t instanceof Array?1!==t.length&&t.first().goingOut||(t.forEach(function(e){e.segments=[n]}),e.push(t)):t&&i.containedSegments.push(n),e},[])},CLASS_NAME:"Waze.Action.CreateRoundabout"}),i.exports=n}}),this.require.define({"Waze/Action/DeleteNode":function(e,t,i){var n,s,r=t("Waze/Action/CompositeAction"),o=t("Waze/Action"),a=t("Waze/Model/ObjectType");_.defer(function(){n=t("Waze/Action/DisconnectSegment")}),s=OpenLayers.Class(r,{node:null,prevNodeState:null,changedSegAttributes:null,changedSegStates:null,dontSerialize:!0,hidNode:!1,initialize:function(e,t){r.prototype.initialize.apply(this,[t]),this.node=e,this.changedSegAttributes={},this.changedSegStates=[]},destroy:function(){this.model.nodes.get(this.node.getID())||this.node.destroy(),this.node=null,this.changedSegAttributes=null,this.prevNodeState=null,this.changedSegStates=null,r.prototype.destroy.apply(this)},doAction:function(){return this.node.state===OpenLayers.State.DELETE?!1:(this.node.attributes.segIDs.forEach(function(e){var t=this.model.segments.get(e);this.doSubAction(new n(t,this.node))},this),this.node.hidden||(this.hidNode=!0),this.node.hidden=!0,this.prevNodeState=this.node.state,void(this.node.state===OpenLayers.State.INSERT?this.model.nodes.remove(this.node):(this.node.state=OpenLayers.State.DELETE,this.model.nodes.changed(this.node))))},undoAction:function(){this.hidNode&&delete this.node.hidden,this.node.state===OpenLayers.State.INSERT?this.model.nodes.put(this.node):(this.node.state=this.prevNodeState,this.model.nodes.changed(this.node)),r.prototype.undoAction.apply(this)},redoAction:function(){this.node.getID();this.hidNode&&(this.node.hidden=!0),this.node.state===OpenLayers.State.INSERT?this.model.nodes.remove(this.node):(this.node.state=OpenLayers.State.DELETE,this.model.nodes.changed(this.node)),r.prototype.redoAction.apply(this)},serialize:function(){var e={_objectType:a.NODE,action:o.TYPE.DELETE,attributes:{id:this.node.getID()}};return e},CLASS_NAME:"Waze.Action.DeleteNode"}),i.exports=s}}),this.require.define({"Waze/Action/DeleteObject":function(e,t,i){var n,s=t("Waze/Action");n=OpenLayers.Class(s,{object:null,repo:null,origState:null,initialize:function(e,t){s.prototype.initialize.apply(this,[t]),this.object=e},destroy:function(){null!==this.repo&&null!==this.object&&null===this.repo.get(this.object.getID())&&this.object.destroy(),this.object=null,s.prototype.destroy.apply(this)},doAction:function(){return this.repo=this.model.getRepository(this.object.type),null===this.repo?!1:(this.origState=this.object.state,this.removeObjct(),!0)},removeObjct:function(){this.object.state===OpenLayers.State.INSERT?this.repo.remove(this.object):(this.object.state=OpenLayers.State.DELETE,this.repo.changed(this.object))},undoAction:function(){this.object.state=this.origState,this.object.state===OpenLayers.State.INSERT?this.repo.put(this.object):this.repo.changed(this.object)},redoAction:function(){this.removeObjct()},serialize:function(){var e={_objectType:this.object.type,action:s.TYPE.DELETE,attributes:{id:this.object.getID()}};return e},CLASS_NAME:"Waze.Action.DeleteObject"}),i.exports=n}}),this.require.define({"Waze/Action/DeleteSegment":function(e,t,i){var n,s=t("Waze/Action"),r=t("Waze/Action/CompositeAction"),o=t("Waze/Action/DisconnectSegment"),a=t("Waze/Model/ObjectType");n=OpenLayers.Class(r,{segment:null,origState:null,hideSegment:!1,hidSegment:!1,initialize:function(e,t){r.prototype.initialize.apply(this,[t]),this.segment=e,this.hideSegment=t&&!!t.hide},destroy:function(){this.model.segments.get(this.segment.getID())||this.segment.destroy(),this.segment=null,r.prototype.destroy.apply(this)},doAction:function(){var e;this.origState=this.segment.state,["fromNodeID","toNodeID"].forEach(function(t){this.segment.attributes[t]&&(e=this.model.nodes.get(this.segment.attributes[t]),e&&e.isConnectedToSegment(this.segment)&&this.doSubAction(new o(this.segment,e,{deleteNode:this.deleteNode,dontSerialize:!0})))},this),this.hideSegment&&(this.segment.hidden||(this.hidSegment=!0),this.segment.hidden=!0),this.segment.state===OpenLayers.State.INSERT?this.model.segments.remove(this.segment):(this.segment.state=OpenLayers.State.DELETE,this.model.segments.changed(this.segment))},undoAction:function(){this.segment.state=this.origState,this.hidSegment&&delete this.segment.hidden,this.segment.state===OpenLayers.State.INSERT?this.model.segments.put(this.segment):this.model.segments.changed(this.segment),r.prototype.undoAction.apply(this)},redoAction:function(){r.prototype.redoAction.apply(this),this.hidSegment&&(this.segment.hidden=!0),this.segment.state===OpenLayers.State.INSERT?this.model.segments.remove(this.segment):(this.segment.state=OpenLayers.State.DELETE,this.model.segments.changed(this.segment))},serialize:function(){var e={_objectType:a.SEGMENT,action:s.TYPE.DELETE,attributes:{id:this.segment.getID()}};return e},CLASS_NAME:"Waze.Action.DeleteSegment"}),i.exports=n}}),this.require.define({"Waze/Action/DisconnectSegment":function(e,t,i){(function(){var e,n,s,r;
e=t("Waze/Action/CompositeAction"),r=t("Waze/Action/UpdateObject"),n=t("Waze/Action/DeleteNode"),s=OL.Class(e,{segment:null,node:null,deleteNode:!0,initialize:function(t,i,n){this.segment=t,this.node=i,e.prototype.initialize.apply(this,[n])},doAction:function(){var e,t,i,s,o,a;return o=this.segment.getID(),s=this.node.getID(),e=this.segment.getTurnsLockAttribute(this.node),(i=this.segment.getNodeAttribute(this.node))?(t={},t[e]=!1,t[""+i+"NodeID"]=null,t[""+i+"Connections"]={},a=this.node.attributes.segIDs.clone(),OL.Util.removeItem(a,o),this.doSubAction(new r(this.segment,t)),this.doSubAction(new r(this.node,{segIDs:a})),this.node.isDisconnected()&&this.deleteNode&&this.doSubAction(new n(this.node)),!0):!1},CLASS_NAME:"Waze.Action.DisconnectSegment"}),i.exports=s}).call(this)}}),this.require.define({"Waze/Action/HouseNumber":function(e,t,i){(function(){var e,n,s,r,o,a,l;e=t("Waze/Action"),s=t("Waze/Action/CompositeAction"),l=t("Waze/Action/UpdateHouseNumber"),n=OL.Class(e,{GEOMETRY_FIELDS:["geometry","fractionPoint"],houseNumberSet:null,houseNumber:null,initialize:function(t,i,n){e.prototype.initialize.call(this,n),this.houseNumberSet=t,this.houseNumber=i},destroy:function(){return this.houseNumberSet=null,this.houseNumber=null,e.prototype.destroy.apply(this,arguments)},doAction:function(){return this.houseNumber.id=this.model.houseNumbers.generateUniqueID(),this.houseNumberSet.numbers.push(this.houseNumber),this.model.houseNumbers.changed(this.houseNumberSet),!0},undoAction:function(){return this.houseNumberSet.numbers=this.houseNumberSet.numbers.remove(this.houseNumber),this.model.houseNumbers.changed(this.houseNumberSet)},redoAction:function(){return this.houseNumberSet.numbers.push(this.houseNumber),this.model.houseNumbers.changed(this.houseNumberSet)},serialize:function(){var t,i;return t={number:this.houseNumber.number,id:this.houseNumber.id,segID:this.houseNumberSet.id,geometry:this.houseNumber.geometry,fractionPoint:this.houseNumber.fractionPoint,forced:this.houseNumber.forced},i={_objectType:this.houseNumberSet.type,action:e.TYPE.ADD,attributes:t}},CLASS_NAME:"Waze.Action.AddHouseNumber"}),r=OL.Class(e,{houseNumberSet:null,houseNumber:null,initialize:function(t,i,n){e.prototype.initialize.call(this,n),this.houseNumberSet=t,this.houseNumber=i},destroy:function(){return this.houseNumberSet=null,this.houseNumber=null,e.prototype.destroy.apply(this,arguments)},doAction:function(){return this.houseNumberSet.numbers=this.houseNumberSet.numbers.remove(this.houseNumber),this.model.houseNumbers.changed(this.houseNumberSet),!0},undoAction:function(){return this.houseNumberSet.numbers.push(this.houseNumber),this.model.houseNumbers.changed(this.houseNumberSet)},redoAction:function(){return this.houseNumberSet.numbers=this.houseNumberSet.numbers.remove(this.houseNumber),this.model.houseNumbers.changed(this.houseNumberSet)},serialize:function(){var t,i;return t={id:this.houseNumber.id,segID:this.houseNumberSet.id},i={_objectType:this.houseNumberSet.type,action:e.TYPE.DELETE,attributes:t}},CLASS_NAME:"Waze.Action.DeleteHouseNumber"}),o=OL.Class(s,{newSet:null,houseNumber:null,newHouseNumber:null,oldParent:null,initialize:function(e,t,i){s.prototype.initialize.call(this,i),this.houseNumber=e,this.newSet=t},destroy:function(){return this.houseNumber=null,this.newSet=null,this.oldParent=null,s.prototype.destroy.apply(this,arguments)},doAction:function(){return this.newHouseNumber=this.houseNumber.clone(),this.oldParent=this.newHouseNumber.parent,this.newHouseNumber.parent=this.newSet,this.doSubAction(new r(this.houseNumber.parent,this.houseNumber)),this.doSubAction(new n(this.newSet,this.newHouseNumber)),!0},undoAction:function(){return s.prototype.undoAction.apply(this,arguments),this.houseNumber.parent=this.oldParent},redoAction:function(){return s.prototype.redoAction.apply(this,arguments),this.newHouseNumber.parent=this.newSet},CLASS_NAME:"Waze.Action.ReplaceHouseNumberSegment"}),a=OL.Class(s,{houseNumberSet:null,houseNumber:null,newHouseNumber:null,initialize:function(e,t,i,n){s.prototype.initialize.call(this,n),this.houseNumber=e,this.houseNumberSet=t,this.fractionPoint=i},destroy:function(){return this.fractionPoint=null,this.houseNumber=null,this.houseNumberSet=null,this.newHouseNumber=null,s.prototype.destroy.apply(this,arguments)},doAction:function(){var e,t;return this.newHouseNumber=this.houseNumber,e=new OL.Geometry.Point(this.fractionPoint.lonlat.lon,this.fractionPoint.lonlat.lat),this.fractionPoint.closestSegment.getID()!==this.houseNumber.parent.id?(t=new o(this.houseNumber,this.houseNumberSet,null),this.doSubAction(t),this.doSubAction(new l(t.newSet,t.newHouseNumber,{fractionPoint:e})),this.newHouseNumber=t.newHouseNumber):this.doSubAction(new l(this.houseNumber.parent,this.houseNumber,{fractionPoint:e})),!0},CLASS_NAME:"Waze.Action.UpdateFractionPoint"}),i.exports={AddHouseNumber:n,DeleteHouseNumber:r,ReplaceHouseNumberSegment:o,UpdateFractionPoint:a}}).call(this)}}),this.require.define({"Waze/Action/MergeNode":function(e,t,i){var n,s=t("Waze/Action/CompositeAction"),r=t("Waze/Action/DeleteNode"),o=t("Waze/Action/DeleteSegment"),a=t("Waze/Action/DisconnectSegment"),l=t("Waze/Action/ConnectSegment"),h=t("Waze/Action/UpdateObject"),u=t("Waze/Model/ObjectType"),c=t("Waze/Action");n=OpenLayers.Class(s,{node:null,mergeNode:null,initialize:function(e,t,i){s.prototype.initialize.apply(this,[i]),this.node=e,this.mergeNode=t},destroy:function(){this.model.nodes.get(this.node.getID())||this.node.destroy(),this.node=null,this.mergeNode=null,s.prototype.destroy.apply(this)},considerMerging:function(){return this.mergeNode&&this.mergeNode.geometry.equals(this.node.geometry)?this.node.attributes.segIDs.every(function(e){var t=this.model.segments.get(e);return!this.mergeNode.isConnectedToSegment(t)||t.isSingular()},this):!1},moveSegments:function(){this.node.attributes.segIDs.clone().forEach(function(e){var t=this.model.segments.get(e);if(t.isSingular())this.doSubAction(new o(t));else{var i=t.getNodeAttribute(this.node),n=i+"Connections",s=_.clone(t.attributes[n]),r={};this.doSubAction(new a(t,this.node,{deleteNode:!1,dontSerialize:!0})),this.doSubAction(new l(this.mergeNode,t,{dontSerialize:!0})),r[n]=s,this.doSubAction(new h(t,r))}},this)},doAction:function(){return this.considerMerging()?(this.moveSegments(),void this.doSubAction(new r(this.node))):!1},undoAction:function(){s.prototype.undoAction.apply(this)},serialize:function(){var e={sourceNodeID:this.node.getID(),sourceNodeVersion:this.node.attributes.version,destNodeID:this.mergeNode.getID(),destNodeVersion:this.node.attributes.version},t={_objectType:u.MERGED_NODE,action:c.TYPE.ADD,attributes:e};return t},CLASS_NAME:"Waze.Action.MergeNode"}),i.exports=n}}),this.require.define({"Waze/Action/MergeSegments":function(e,t,i){var n,s=(t("Waze/Action"),t("Waze/Action/CompositeAction")),r=t("Waze/Action/ConnectSegment"),o=t("Waze/Action/DeleteSegment"),a=t("Waze/Action/AddSegment"),l=t("Waze/Util"),h=t("Waze/Action/ReplaceNCSegmentID"),u=t("Waze/Feature/Vector/Segment");n=OpenLayers.Class(s,{segments:null,node:null,fromNode:null,toNode:null,mergedSegment:null,firstSegReversed:!1,secondSegReversed:!1,keepLevel:!1,initialize:function(e,t,i){s.prototype.initialize.apply(this,[i]),this.segments=e,this.node=t,this.previousNodeStates={}},destroy:function(){this.previousNodeStates=null,this.fromNode=null,this.toNode=null,s.prototype.destroy.apply(this)},areSegmentsBridgable:function(e,t){return e&&2===e.length&&t&&t.attributes.segIDs.contains(e[0].getID())&&t.attributes.segIDs.contains(e[1].getID())&&(t.isTurnAllowedBySegDirections(e[0],e[1])||t.isTurnAllowedBySegDirections(e[1],e[0]))?e[0].attributes.primaryStreetID!==e[1].attributes.primaryStreetID?!1:!0:!1},createMergedSegment:function(e,t){var i,n,s=e[0].geometry.clone().getVertices(),r=e[1].geometry.clone().getVertices();return this.fromNode=e[0].attributes.fromNodeID,e[0].attributes.fromNodeID===t.getID()&&(s.reverse(),this.fromNode=e[0].attributes.toNodeID,this.firstSegReversed=!0),this.toNode=e[1].attributes.toNodeID,e[1].attributes.toNodeID===t.getID()&&(r.reverse(),this.toNode=e[1].attributes.fromNodeID,this.secondSegReversed=!0),s.pop(),s=s.concat(r),i=new OpenLayers.Geometry.LineString(s),n=new u,n.copyAttributes(this.segments.first()),n.geometry=i,n.setID(null),n},doAction:function(){if(l.defined(this.segments)||(this.keepLevel=!0,this.segments=this.node.attributes.segIDs.map(function(e){return this.model.segments.get(e)},this)),!this.areSegmentsBridgable(this.segments,this.node))return!1;this.mergedSegment=this.createMergedSegment(this.segments,this.node);var e=this.mergedSegment.attributes;e.fwdDirection=this.segments[0].attributes.fwdDirection,e.revDirection=this.segments[0].attributes.revDirection,e.fwdToll=this.segments[0].attributes.fwdToll,e.revToll=this.segments[0].attributes.revToll;var t=this.segments[0],i=this.segments[1];this.firstSegReversed?(e.fromConnections=_.clone(t.attributes.toConnections),e.fromRestrictions=t.cloneRestrictions(t.attributes.toRestrictions)):(e.fromConnections=_.clone(t.attributes.fromConnections),e.fromRestrictions=t.cloneRestrictions(t.attributes.fromRestrictions)),this.secondSegReversed?(e.toConnections=_.clone(i.attributes.fromConnections),e.toRestrictions=i.cloneRestrictions(i.attributes.fromRestrictions)):(e.toConnections=_.clone(i.attributes.toConnections),e.toRestrictions=i.cloneRestrictions(i.attributes.toRestrictions)),(this.firstSegReversed||this.secondSegReversed)&&this.mergedSegment.reverseDirection();var s=this.level;if(void 0===this.level&&(s=this.node.attributes.segIDs.map(function(e){var t=this.model.segments.get(e);return t.attributes.level},this).max(),void 0===s&&(s=0),this.keepLevel||s++),e.level=s,e.streetIDs=(this.segments[0].attributes.streetIDs||[]).union(this.segments[1].attributes.streetIDs||[]),e.origIDs=[this.segments[0].getID(),this.segments[1].getID()],this.mergedSegment.attributes.toNodeID=this.toNode,this.mergedSegment.attributes.fromNodeID=this.fromNode,this.setLockLevel(this.mergedSegment),this.doSubAction(new a(this.mergedSegment)),this.mergedSegment.attributes.permissions=this.segments[0].attributes.permissions&this.segments[1].attributes.permissions,this.fromNode=this.model.nodes.get(this.fromNode),this.toNode=this.model.nodes.get(this.toNode),this.doSubAction(new h(this.fromNode,t,this.mergedSegment,{dontSerialize:!0})),this.doSubAction(new h(this.toNode,i,this.mergedSegment,{dontSerialize:!0})),this.fromNode&&this.doSubAction(new r(this.fromNode,this.mergedSegment)),this.toNode&&this.doSubAction(new r(this.toNode,this.mergedSegment)),this.doSubAction(new o(this.segments[0],{hide:!0})),this.doSubAction(new o(this.segments[1],{hide:!0})),2===this.node.attributes.segIDs.length){var u=this.node.attributes.segIDs.map(function(e){return this.model.segments.get(e)},this);this.doSubAction(new n(u,this.node,{level:s-1}))}},setLockLevel:function(e){var t=[this.segments[0].attributes.lockRank,this.segments[1].attributes.lockRank],i=[this.segments[0].attributes.rank,this.segments[1].attributes.rank];e.attributes.lockRank=null===t[0]&&null===t[1]?null:Math.max.apply(null,t),e.attributes.rank=Math.max.apply(null,i)},CLASS_NAME:"Waze.Action.MergeSegments"}),i.exports=n}}),this.require.define({"Waze/Action/ModifyAllConnections":function(e,t,i){(function(){var e,n,s;e=t("Waze/Action/CompositeAction"),s=t("Waze/Action/ModifyConnection"),n=OL.Class(e,{initialize:function(t,i,n){return this.node=t,this.navigable=i,e.prototype.initialize.apply(this,[n])},doAction:function(){var e,t,i,n,r,o,a;for(e=this.node.allConnectionKeys(!0),i=this.navigable?e.legal:e.all,a=[],r=0,o=i.length;o>r;r++)t=i[r],n=t.from===t.to,t.from.areTurnsLocked(this.node)||this.doSubAction(t.from.lockTurns(this.node,!0)),a.push(this.navigable&&n?void 0:this.doSubAction(new s(t.from.getID(),this.node,t.to.getID(),this.navigable)));return a}}),i.exports=n}).call(this)}}),this.require.define({"Waze/Action/ModifyConnection":function(e,t,i){(function(){var e,n,s,r,o;n=t("Waze/Action/CompositeAction"),o=t("Waze/Action/UpdateObject"),r=t("Waze/Model/ObjectType"),e=t("Waze/Action"),s=OL.Class(n,{initialize:function(e,t,i,s,r){return this.fromSegID=e,this.node=t,this.toSegID=i,this.navigable=s,n.prototype.initialize.apply(this,[r])},doAction:function(){var e,t,i;return this.fromSegment=this.model.segments.get(this.fromSegID),this.toSegment=this.model.segments.get(this.toSegID),this.fromSegFwd=this.fromSegment.attributes.toNodeID===this.node.getID(),this.toSegFwd=this.toSegment.attributes.fromNodeID===this.node.getID(),e=this.fromSegFwd?"toConnections":"fromConnections",t=OL.Util.extend({},this.fromSegment.attributes[e]),t[this.toSegID]=this.navigable,i={},i[e]=t,void this.doSubAction(new o(this.fromSegment,i,{dontSerialize:!0}))},serialize:function(){var t,i,n;return i={fromSegID:this.fromSegID,toSegID:this.toSegID,fromSegFwd:this.fromSegFwd,toSegFwd:this.toSegFwd},t=this.navigable?e.TYPE.ADD:e.TYPE.DELETE,t!==e.TYPE.DELETE&&(i.nodeID=this.node.getID()),n={_objectType:r.NC,action:t,attributes:i}},CLASS_NAME:"Waze.Action.ModifyConnection"}),i.exports=s}).call(this)}}),this.require.define({"Waze/Action/ModifyConnectionRestriction":function(e,t,i){(function(){var e,n,s,r,o,a={}.hasOwnProperty;n=t("Waze/Action/CompositeAction"),o=t("Waze/Action/UpdateObject"),r=t("Waze/Model/ObjectType"),e=t("Waze/Action"),s=OL.Class(n,{initialize:function(e,t,i,s,r){return this.fromSeg=e,this.node=t,this.toSeg=i,this.restrictions=s,n.prototype.initialize.apply(this,[r])},doAction:function(){var e,t,i,n,s,r;this.fromSegFwd=this.fromSeg.attributes.toNodeID===this.node.getID(),this.toSegFwd=this.toSeg.attributes.fromNodeID===this.node.getID(),t=this.fromSegFwd?"toRestrictions":"fromRestrictions",e={},r=this.fromSeg.getRestrictionsAtNode(this.node);for(n in r)a.call(r,n)&&(i=r[n],e[n]=i.map(function(e){return e.clone()}));return e[this.toSeg.getID()]=this.restrictions,s={},s[t]=e,this.doSubAction(new o(this.fromSeg,s,{dontSerialize:!0}))},serialize:function(){var t,i;return t={connection:{fromSegID:this.fromSeg.getID(),toSegID:this.toSeg.getID(),fromSegFwd:this.fromSegFwd,toSegFwd:this.toSegFwd},restrictions:this.restrictions},i={_objectType:r.RESTRICTION,action:e.TYPE.UPDATE,attributes:t}},CLASS_NAME:"W.Action.ModifyConnectionRestriction"}),i.exports=s}).call(this)}}),this.require.define({"Waze/Action/MoveNode":function(e,t,i){var n,s=t("Waze/Action/CompositeAction"),r=t("Waze/Action"),o=t("Waze/Model/ObjectType"),a=t("Waze/Action/DeleteSegment"),l=t("Waze/Action/ConnectSegment"),h=t("Waze/Action/MergeNode"),u=t("Waze/Action/SplitSegments");n=OpenLayers.Class(s,{node:null,oldGeometry:null,newGeometry:null,origSegGeometries:null,changedNodeState:!1,changedSegStates:null,changedSegments:null,initialize:function(e,t,i,n,r){s.prototype.initialize.apply(this,[r]),this.node=e,this.oldGeometry=e.geometry===t?t.clone():t,this.newGeometry=e.geometry===i?i.clone():i,this.origSegGeometries=n,this.changedSegStates=[],this.changedSegments=[],this.changedNodeState=!1},destroy:function(){this.oldGeometry.destroy(),this.oldGeometry=null,this.newGeometry.destroy(),this.newGeometry=null,this.node=null,this.changedSegStates=null,this.changedSegments=null,Object.values(this.origSegGeometries).forEach(function(e){e.destroy()}),s.prototype.destroy.apply(this)},moveConnectedSegments:function(){this.node.attributes.segIDs.forEach(function(e){var t=this.model.segments.get(e);if(t){var i=!1;if(t.attributes.fromNodeID===this.node.getID()&&(i=!0,t.geometry.components[0].x=this.newGeometry.x,t.geometry.components[0].y=this.newGeometry.y,t.geometry.components[0].clearBounds()),t.attributes.toNodeID===this.node.getID()){i=!0;var n=t.geometry.components.length-1;t.geometry.components[n].x=this.newGeometry.x,t.geometry.components[n].y=this.newGeometry.y,t.geometry.components[n].clearBounds()}t.geometry.calculateBounds(),i&&(t.state||(t.state=OpenLayers.State.UPDATE,this.changedSegStates.push(e)),this.changedSegments.push(t))}},this),this.changedSegments.length>0&&this.model.segments.changed(this.changedSegments),this.changedSegments.forEach(function(e){e.isSingular()&&this.doSubAction(new a(e,{deleteNode:!1}))},this)},moveNode:function(){this.node.geometry.x=this.newGeometry.x,this.node.geometry.y=this.newGeometry.y,this.node.geometry.calculateBounds(),this.node.bounds=this.node.geometry.bounds,this.node.state||(this.node.state=OpenLayers.State.UPDATE,this.changedNodeState=!0),this.model.nodes.changed(this.node)},handleTouchingFeatures:function(){var e;return this.snappedFeatures?(e=this.snappedFeatures,void(e.feature.type===o.SEGMENT?"edge"===e.type||"vertex"===e.type?this.doSubAction(new u(e.feature,{splitNode:this.node,splitAtPoint:e.point,splittingPointDistance:e.distance})):"node"===e.type&&this.doSubAction(new l(this.node,e.feature)):e.feature.type===o.NODE&&this.doSubAction(new h(this.node,e.feature)))):!1},doAction:function(){this.moveNode(),this.moveConnectedSegments();var e=this;this.doSubAction(new r({serialize:function(){var t={};t.id=e.node.getID(),t.geometry=e.newGeometry;var i={_objectType:o.NODE,action:r.TYPE.UPDATE,attributes:t};return i}})),this.handleTouchingFeatures()},undoAction:function(){s.prototype.undoAction.apply(this);for(var e=0,t=this.changedSegments.length;t>e;e++){var i=this.changedSegments[e],n=i.getID();if(i.attributes.toNodeID===this.node.getID()){var r=i.geometry.components.length-1;i.geometry.components[r].x=this.origSegGeometries[n].components[r].x,i.geometry.components[r].y=this.origSegGeometries[n].components[r].y,i.geometry.components[r].clearBounds()}i.attributes.fromNodeID===this.node.getID()&&(i.geometry.components[0].x=this.origSegGeometries[n].components[0].x,i.geometry.components[0].y=this.origSegGeometries[n].components[0].y,i.geometry.components[0].clearBounds()),i.geometry.calculateBounds(),OpenLayers.Util.indexOf(this.changedSegStates,n)>=0&&(i.state=null)}this.changedSegments.length>0&&this.model.segments.changed(this.changedSegments),this.node.geometry.x=this.oldGeometry.x,this.node.geometry.y=this.oldGeometry.y,this.node.geometry.calculateBounds(),this.node.bounds=this.node.geometry.bounds,this.changedNodeState&&(this.node.state=null),this.model.nodes.changed(this.node)},redoAction:function(){this.node.geometry.x=this.newGeometry.x,this.node.geometry.y=this.newGeometry.y,this.node.geometry.calculateBounds(),this.node.bounds=this.node.geometry.bounds,this.changedNodeState&&(this.node.state=OpenLayers.State.UPDATE),this.model.nodes.changed(this.node);for(var e=0,t=this.changedSegments.length;t>e;e++){var i=this.changedSegments[e];if(i.attributes.fromNodeID===this.node.getID()&&(i.geometry.components[0].x=this.newGeometry.x,i.geometry.components[0].y=this.newGeometry.y,i.geometry.components[0].clearBounds()),i.attributes.toNodeID===this.node.getID()){var n=i.geometry.components.length-1;i.geometry.components[n].x=this.newGeometry.x,i.geometry.components[n].y=this.newGeometry.y,i.geometry.components[n].clearBounds()}i.geometry.calculateBounds(),OpenLayers.Util.indexOf(this.changedSegStates,i.getID())>=0&&(i.state=OpenLayers.State.UPDATE)}this.changedSegments.length>0&&this.model.segments.changed(this.changedSegments),s.prototype.redoAction.apply(this)},getBounds:function(){var e=s.prototype.getBounds.apply(this,arguments)||new OpenLayers.Bounds,t=Object.values(this.origSegGeometries);return t.forEach(function(t){e.extend(t.getBounds())}),e},CLASS_NAME:"Waze.Action.MoveNode"}),i.exports=n}}),this.require.define({"Waze/Action/MultiAction":function(e,t,i){var n,s=t("Waze/Action/CompositeAction");n=OpenLayers.Class(s,{initialize:function(e,t){s.prototype.initialize.apply(this,[t]),this.subActions=e?e:[]},undoSupported:function(){for(var e=0,t=this.subActions.length;t>e;e++)if(!this.subActions[e].undoSupported())return!1;return!0},setModel:function(e){s.prototype.setModel.apply(this,[e]);for(var t=0,i=this.subActions.length;i>t;t++)this.subActions[t].setModel(e)},CLASS_NAME:"Waze.Action.MultiAction"}),i.exports=n}}),this.require.define({"Waze/Action/ReplaceNCSegmentID":function(e,t,i){(function(){var e,n,s;e=t("Waze/Action/CompositeAction"),s=t("Waze/Action/UpdateObject"),n=OL.Class(e,{initialize:function(t,i,n,s){this.node=t,this.originalSegment=i,this.newSegment=n,e.prototype.initialize.apply(this,[s])},doAction:function(){var e,t,i,n,s,r;if(!this.node)return!1;for(i=function(){var t,i,n,s;for(n=this.node.attributes.segIDs,s=[],t=0,i=n.length;i>t;t++)e=n[t],s.push(this.model.segments.get(e));return s}.call(this),r=[],n=0,s=i.length;s>n;n++)t=i[n],this.replaceConnections(t,"fromConnections"),this.replaceConnections(t,"toConnections"),this.replaceRestrictions(t,"fromRestrictions"),r.push(this.replaceRestrictions(t,"toRestrictions"));return r},replaceConnections:function(e,t){var i,n,r;return n=e.attributes[t],n[this.originalSegment.getID()]?(r=_.clone(n),r[this.newSegment.getID()]=n[this.originalSegment.getID()],i={},i[t]=r,this.doSubAction(new s(e,i))):void 0},replaceRestrictions:function(e,t){var i,n,r;return r=e.attributes[t],(null!=r?r[this.originalSegment.getID()]:void 0)?(n=e.cloneRestrictions(r),n[this.newSegment.getID()]=r[this.originalSegment.getID()],i={},i[t]=n,this.doSubAction(new s(e,i))):void 0},CLASS_NAME:"Waze.Action.ReplaceNCSegmentID"}),i.exports=n}).call(this)}}),this.require.define({"Waze/Action/SegmentAction":function(e,t,i){var n,s=(t("Waze/Action"),t("Waze/Action/SplitSegments")),r=t("Waze/Action/AddNode"),o=t("Waze/Action/ConnectSegment"),a=t("Waze/Action/DisconnectSegment"),l=t("Waze/Action/CompositeAction"),h=t("Waze/Model/ObjectType");n=OpenLayers.Class(l,{segment:null,initialize:function(e,t){l.prototype.initialize.apply(this,[t]),this.segment=e,this.analyzeSnappedFeatures()},destroy:function(){l.prototype.destroy.apply(this)},analyzeSnappedFeatures:function(){if(this.touching={},this.snappedFeatures){this.snappedFeatures instanceof Array||(this.snappedFeatures=[this.snappedFeatures]),this.snappedFeatures=this.snappedFeatures.filter(function(e){return e});var e,t=this.segment.geometry.getVertices(!0),i=t.first(),n=t.last();this.snappedFeatures.forEach(function(t){e=null,t.point.equals(i)?(this.touching.fromVertex={},e=this.touching.fromVertex):t.point.equals(n)&&(this.touching.toVertex={},e=this.touching.toVertex),e&&(e.feature=t.feature,e.point=t.point,e.distance=t.distance,t.feature.type===h.SEGMENT?"edge"===t.type||"vertex"===t.type?e.segmentEdge=!0:"node"===t.type&&(e.segmentNode=!0):t.feature.type===h.NODE&&(e.node=!0))},this)}},connectToExistingNode:function(e,t){t!==e.getID()&&(t&&this.doSubAction(new a(this.segment,this.model.nodes.get(t))),this.doSubAction(new o(e,this.segment)))},updateEndPoint:function(e,t,i){if(t)t.node?this.connectToExistingNode(t.feature,e):t.segmentNode?(e&&this.doSubAction(new a(this.segment,this.model.nodes.get(e))),this.doSubAction(new r(t.point,[this.segment,t.feature]))):t.segmentEdge&&(e&&this.doSubAction(new a(this.segment,this.model.nodes.get(e))),this.doSubAction(new s(t.feature,{splitAtPoint:t.point,splitWithSegment:this.segment,splittingPointDistance:t.distance})));else if(e&&this.doSubAction(new a(this.segment,this.model.nodes.get(e))),this.createNodes){var n;n=i?this.segment.geometry.components[0]:this.segment.geometry.components[this.segment.geometry.components.length-1],this.doSubAction(new r(n,[this.segment]))}return!0},CLASS_NAME:"Waze.Action.SegmentAction"}),i.exports=n}}),this.require.define({"Waze/Action/SplitSegments":function(e,t,i){var n,s,r=(t("Waze/Action"),t("Waze/Action/ConnectSegment")),o=t("Waze/Action/DeleteSegment"),a=t("Waze/Action/ModifyConnection"),l=t("Waze/Action/CompositeAction"),h=t("Waze/Action/AddNode"),u=t("Waze/Action/ReplaceNCSegmentID"),c=t("Waze/Utils/Geo"),d=t("Waze/Util");_.defer(function(){n=t("Waze/Action/AddSegment")}),s=OpenLayers.Class(l,{segment:null,splits:null,initialize:function(e,t){l.prototype.initialize.apply(this,[t]),this.segment=e},destroy:function(){this.model.segments.get(this.segment.getID())||this.segment.destroy(),this.splits&&this.splits.forEach(function(e){this.model.segments.get(this.segment.getID())||e.destroy()},this),this.segment=null,this.splits=null,l.prototype.destroy.apply(this)},splitSegment:function(){var e=this.model.nodes.get(this.segment.attributes.fromNodeID),t=this.model.nodes.get(this.segment.attributes.toNodeID);this.addSplitNode(),this.createSegments(),this.connectSegmentsToSplitNode(),this.connectSplitToNode(this.splits.first(),e),this.connectSplitToNode(this.splits.last(),t),this.splitNode.isTurnAllowedBySegDirections(this.splits.first(),this.splits.last())&&this.doSubAction(new a(this.splits.first().getID(),this.splitNode,this.splits.last().getID(),!0)),this.splitNode.isTurnAllowedBySegDirections(this.splits.last(),this.splits.first())&&this.doSubAction(new a(this.splits.last().getID(),this.splitNode,this.splits.first().getID(),!0)),this.doSubAction(new u(e,this.segment,this.splits.first(),{dontSerialize:!0})),this.doSubAction(new u(t,this.segment,this.splits.last(),{dontSerialize:!0})),this.doSubAction(new o(this.segment,{hide:!0}))},createSegments:function(){var e=this.segment.attributes.origID||this.segment.getID()||null,t=this.segment.attributes,i=this.splits[0],s=this.splits[1];i.attributes.fromConnections=_.clone(t.fromConnections),i.attributes.toConnections={},i.attributes.fromRestrictions=this.segment.cloneRestrictions(t.fromRestrictions),i.attributes.toRestrictions={},i.attributes.toNodeID=this.splitNode.getID(),i.attributes.fromNodeID=t.fromNodeID,s.attributes.toConnections=_.clone(t.toConnections),s.attributes.fromConnections={},s.attributes.toRestrictions=this.segment.cloneRestrictions(t.toRestrictions),s.attributes.fromRestrictions={},s.attributes.toNodeID=t.toNodeID,s.attributes.fromNodeID=this.splitNode.getID(),this.splits.forEach(function(i){i.attributes.fwdDirection=t.fwdDirection,i.attributes.revDirection=t.revDirection,i.attributes.fwdToll=t.fwdToll,i.attributes.revToll=t.revToll,i.attributes.origIDs=[e],i.setID(null),this.doSubAction(new n(i))},this)},addSplitNode:function(){var e,t;this.splitNode||(e=this.splits.first().geometry.components.last(),e=new OpenLayers.Geometry.Point(e.x,e.y),t=new h(e,[]),this.doSubAction(t),this.splitNode=t.node)},connectSegmentsToSplitNode:function(){this.splitWithSegment&&this.doSubAction(new r(this.splitNode,this.splitWithSegment)),this.splits.forEach(function(e){this.doSubAction(new r(this.splitNode,e,{dontSerialize:!0}))},this)},connectSplitToNode:function(e,t){t&&this.doSubAction(new r(t,e,{dontSerialize:!0}))},doAction:function(){return this.splitAtPoint&&!this.createSplitsFromPoint(this.splitAtPoint)?!1:this.splits?this.hasSingularParts()?!1:void this.splitSegment():!1},hasSingularParts:function(){var e=this.model.distanceCache.getValue(this.segment.geometry.getVertices(!0).first());return this.splits.some(function(t){return t.geometry.getLength()<e},this)},createSplitsFromPoint:function(e){var t,i,n,s;if(s=this.segment.geometry.getVertices().map(function(e){return new OpenLayers.Geometry.Point(e.x,e.y)}),d.defined(this.splittingPointIndex))n=this.splittingPointIndex;else if(n=this.getSplitEdge(e,s),-1===n)return!1;return t=new OpenLayers.Geometry.LineString(s.slice(0,n+1)),t.components.last().equals(e)||t.components.push(e.clone()),i=new OpenLayers.Geometry.LineString(s.slice(n+1)),i.components.first().equals(e)||i.components.unshift(e.clone()),this.splits=[t,i].map(function(e){return this.createSplitSegmentPart(this.segment,e)},this),!0},getSplitEdge:function(e,t){return c.getPointEdge(t,e,this.splittingPointDistance)},createSplitSegmentPart:function(e,t){var i=e.clone();return delete i.geometry,i.geometry=t,i},CLASS_NAME:"Waze.Action.SplitSegments"}),i.exports=s}}),

this.require.define({"Waze/Action/UpdateFeatureGeometry":function(e,t,i){var n,s=t("Waze/Action");n=OpenLayers.Class(s,{feature:null,repo:null,newGeometry:null,oldGeometry:null,changedState:!1,initialize:function(e,t,i,n){this.feature=e,this.repo=t,this.newGeometry=n,this.oldGeometry=i},destroy:function(){this.feature=null,this.repo=null,this.newGeometry=null,this.oldGeometry=null},doAction:function(){this.replaceGeometry(this.newGeometry.clone()),this.feature.state||(this.changedState=!0,this.feature.state=OpenLayers.State.UPDATE),this.repo.changed(this.feature)},replaceGeometry:function(e){e!==this.feature.geometry&&(e.id=this.feature.geometry.id,this.feature.geometry=e,this.feature.bounds=this.feature.geometry.bounds)},undoAction:function(){this.changedState&&(this.feature.state=null),this.replaceGeometry(this.oldGeometry.clone()),this.repo.changed(this.feature)},redoAction:function(){this.replaceGeometry(this.newGeometry.clone()),this.changedState&&(this.feature.state=OpenLayers.State.UPDATE),this.repo.changed(this.feature)},serialize:function(){var e={};e.id=this.feature.getID(),e.geometry=this.newGeometry;var t={_objectType:this.feature.type,action:s.TYPE.UPDATE,attributes:e};return t},getBounds:function(){return this.newGeometry.getBounds().clone()},CLASS_NAME:"Waze.Action.UpdateFeatureGeometry"}



),i.exports=n}}),this.require.define({"Waze/Action/UpdateHouseNumber":function(e,t,i){(function(){var e,n,s,r={}.hasOwnProperty;e=t("Waze/Action"),s=t("Waze/Util"),n=OL.Class(e,{GEOMETRY_FIELDS:["geometry","fractionPoint"],houseNumberSet:null,houseNumber:null,attributes:null,oldAttributes:null,stateChanged:!1,changed:!1,initialize:function(t,i,n,s){e.prototype.initialize.call(this,s),this.houseNumberSet=t,this.houseNumber=i,this.attributes=n,this.oldAttributes={}},destroy:function(){return this.houseNumberSet=null,this.houseNumber=null,this.attributes=null,this.oldAttributes=null,e.prototype.destroy.apply(this,arguments)},doAction:function(){var e,t,i;i=this.attributes;for(e in i)r.call(i,e)&&(t=i[e],null!=this.houseNumber[e]&&this.houseNumber[e]!==t&&(this.changed=!0,this.oldAttributes[e]=this.houseNumber[e]));return this.changed&&OL.Util.extend(this.houseNumber,this.attributes),this.houseNumberSet.state||(this.houseNumberSet.state=OL.State.UPDATE,this.stateChanged=!0),this.model.houseNumbers.changed(this.houseNumberSet),this.changed},undoAction:function(){var e;for(e in this.oldAttributes)s.isUndefined(this.oldAttributes[e])?delete this.attributes[e]:this.houseNumber[e]=this.oldAttributes[e];return this.stateChanged&&(this.houseNumberSet.state=null),this.model.houseNumbers.changed(this.houseNumberSet)},redoAction:function(){return this.houseNumberSet.state=OL.State.UPDATE,OL.Util.extend(this.houseNumber,this.attributes),this.model.houseNumbers.changed(this.houseNumberSet)},serialize:function(){var t,i;return t={},OL.Util.extend(t,this.attributes),t.id=this.houseNumber.id,t.segID=this.houseNumberSet.id,i={_objectType:this.houseNumberSet.type,action:e.TYPE.UPDATE,attributes:t}},CLASS_NAME:"Waze.Action.UpdateHouseNumber"}),i.exports=n}).call(this)}}),this.require.define({"Waze/Action/UpdateHouseNumberGeometry":function(e,t,i){(function(){var e,n;e=t("Waze/Action"),n=OL.Class(e,{GEOMETRY_FIELDS:["geometry","fractionPoint"],houseNumberSet:null,houseNumber:null,newGeometry:null,oldGeometry:null,newFraction:null,oldFraction:null,changedState:!1,initialize:function(t,i,n,s){e.prototype.initialize.call(this,s),this.houseNumber=t,this.houseNumberSet=this.houseNumber.parent,this.newGeometry=n.clone(),this.oldGeometry=i,this.oldFraction=t.fractionPoint.clone()},destroy:function(){return this.houseNumberSet=null,this.houseNumber=null,this.newGeometry=null,this.oldGeometry=null},doAction:function(){return this.newFraction=this.houseNumber.getFractionFromProjection(),this.houseNumber.geometry=this.newGeometry.clone(),this.houseNumber.fractionPoint=this.newFraction,this.houseNumberSet.state||(this.changedState=!0,this.houseNumberSet.state=OL.State.UPDATE),this.model.houseNumbers.changed(this.houseNumberSet)},undoAction:function(){return this.houseNumber.geometry=this.oldGeometry,this.houseNumber.fractionPoint=this.oldFraction,this.changedState&&(this.houseNumberSet.state=null),this.model.houseNumbers.changed(this.houseNumberSet)},redoAction:function(){return this.houseNumber.geometry=this.newGeometry.clone(),this.houseNumber.fractionPoint=this.newFraction,this.changedState&&(this.houseNumberSet.state=OL.State.UPDATE),this.model.houseNumbers.changed(this.houseNumberSet)},serialize:function(){var t,i;return t={segID:this.houseNumberSet.id,id:this.houseNumber.id,geometry:this.newGeometry,fractionPoint:this.newFraction},i={_objectType:this.houseNumberSet.type,action:e.TYPE.UPDATE,attributes:t}},CLASS_NAME:"Waze.Action.UpdateHouseNumberGeometry"}),i.exports=n}).call(this)}}),this.require.define({"Waze/Action/UpdateLandmarkAddress":function(e,t,i){var n,s=t("Waze/Action/CompositeAction"),r=t("Waze/Action/UpdateObject"),o=t("Waze/Action/AddOrGetCity"),a=t("Waze/Action/AddOrGetStreet");
n=OpenLayers.Class(s,{landmark:null,attributes:null,initialize:function(e,t){s.prototype.initialize.apply(this,[t]),this.landmark=e,this.attributes=t},destroy:function(){this.landmark=null,s.prototype.destroy.apply(this)},doAction:function(){var e,t,i,n,s=this.model.countries.get(this.attributes.countryID),l=this.model.states.get(this.attributes.stateID);return i=new o(l,s,this.attributes.cityName,this.attributes.emptyCity),this.doSubAction(i),e=i.city,n=new a(this.attributes.streetName,e,this.attributes.emptyStreet),this.doSubAction(n),t=n.street,this.doSubAction(new r(this.landmark,{streetID:t.getID()}))},CLASS_NAME:"Waze.Action.UpdateLandmarkAddress"}),i.exports=n}}),this.require.define({"Waze/Action/UpdateObject":function(e,t,i){(function(){var e,n,s={}.hasOwnProperty;e=t("Waze/Action"),n=OL.Class(e,{initialize:function(t,i,n){this.object=t,this.newAttributes=i,e.prototype.initialize.apply(this,[n]),this.oldAttributes={},this.newAttributes=_.clone(this.newAttributes),this.changed=!1,this.stateChanged=!1,this.attributes=this.object.attributes?this.object.attributes:this.object},doAction:function(){var e,t,i;this.repository=this.model.getRepository(this.object.type),i=this.newAttributes;for(e in i)s.call(i,e)&&(t=i[e],this.attributes[e]!==t&&(this.oldAttributes[e]=this.attributes[e],this.attributes[e]=t,this.changed=!0));return this.changed?(this.object.state||(this.object.state=OL.State.UPDATE,this.stateChanged=!0),this.repository.changed(this.object),!0):!1},undoAction:function(){var e,t,i;i=this.oldAttributes;for(e in i)s.call(i,e)&&(t=i[e],this.attributes[e]=t);return this.stateChanged&&(this.object.state=null),this.repository.changed(this.object)},redoAction:function(){var e,t,i;this.stateChanged&&(this.object.state=OL.State.UPDATE),i=this.newAttributes;for(e in i)s.call(i,e)&&(t=i[e],this.attributes[e]=t);return this.repository.changed(this.object)},serialize:function(){var t,i;return t=this.newAttributes,t.id=this.object.getID(),i={_objectType:this.object.type,action:e.TYPE.UPDATE,attributes:t}},CLASS_NAME:"Waze.Action.UpdateObject"}),i.exports=n}).call(this)}}),this.require.define({"Waze/Action/UpdatePlaceUpdate":function(e,t,i){(function(){var e,n;e=t("Waze/Action"),n=OL.Class(e,{prevApproved:null,request:null,initialize:function(t,i,n,s){this.venue=t,this.request=i,this.approved=n,e.prototype.initialize.call(this,s)},doAction:function(){return this.prevApproved=this.request.get("approved"),this.request.set({approved:this.approved})},undoAction:function(){return this.request.set({approved:this.prevApproved})},redoAction:function(){return this.request.set({approved:this.approved})},serialize:function(){var e;return e={_objectType:"venueUpdateRequest",action:"UPDATE",attributes:{venueID:this.venue.getID(),id:this.request.id,approve:this.approved}}}}),i.exports=n}).call(this)}}),this.require.define({"Waze/Action/UpdateProblem":function(e,t,i){var n,s=t("Waze/Action");n=OpenLayers.Class(s,{problem:null,newState:null,newResolution:null,newOpenState:null,previousAttributes:null,changedState:!1,initialize:function(e,t,i){s.prototype.initialize.apply(this,[i]),this.problem=e,this.newState=t,this.previousAttributes={}},destroy:function(){s.prototype.destroy.apply(this)},doAction:function(){return OpenLayers.Util.extend(this.previousAttributes,this.problem.attributes),this.problem.setState(this.newState),this.newResolution=this.problem.attributes.resolution,this.newOpenState=this.problem.attributes.open,this.problem.state||(this.problem.state=OpenLayers.State.UPDATE,this.changedState=!0),this.model.problems.changed(this.problem),!0},undoAction:function(){this.problem.attributes={},OpenLayers.Util.extend(this.problem.attributes,this.previousAttributes),this.changedState&&(this.problem.state=null),this.model.problems.changed(this.problem)},redoAction:function(){this.problem.setState(this.newState),this.changedState&&(this.problem.state=OpenLayers.State.UPDATE),this.model.problems.changed(this.problem)},serialize:function(){var e={id:this.problem.getID(),open:this.newOpenState,resolution:this.newResolution},t={_objectType:this.problem.type,action:s.TYPE.UPDATE,attributes:e};return t},CLASS_NAME:"Waze.Action.UpdateProblem"}),i.exports=n}}),



this.require.define(
{"Waze/Feature/Vector/UpdateRequest":function(e,t,i){var n,s=t("Waze/Feature/Vector");n=OpenLayers.Class(s,{nested:{geometry:OL.Geometry,bounds:OL.Geometry},ONE_DAY:864e5,ONE_WEEK_IN_MILLIS:6048e5,SeverityThreshold:{low:4,medium:14},editable:!0,initialize:function(){s.prototype.initialize.apply(this,arguments),this.editable=this.attributes.open,this.attributes.open&&(this.attributes.resolution=this.ResolutionType.NO_RESOLUTION),this.attributes.typeText=this.getTypeText(),this.setSeverity()},merge:function(){s.prototype.merge.apply(this,arguments),this.editable=this.attributes.open},getRequestBounds:function(){return this.requestBounds||(this.requestBounds=this.attributes.bounds),this.requestBounds},getState:function(){return this.attributes.open?"open":this.attributes.resolution===this.ResolutionType.FIXED?"solved":"rejected"},ResolutionType:{NO_RESOLUTION:-1,FIXED:0,NOT_A_PROBLEM:1},Type:{INCORRECT_TURN:6,INCORRECT_ADDRESS:7,INCORRECT_ROUTE:8,INCORRECT_MISSING_ROUNDABOUT:9,INCORRECT_GENERAL_ERROR:10,TURN_NOT_ALLOWED:11,INCORRECT_JUNCTION:12,MISSING_BRIDGE_OVERPASS:13,WRONG_DRIVING_DIRECTIONS:14,MISSING_EXIT:15,MISSING_ROAD:16},getTypeText:function(){return this.TypeText[this.attributes.type]},setState:function(e){e!==this.ResolutionType.NO_RESOLUTION?(this.attributes.open=!1,this.attributes.resolution=e):(this.attributes.open=!0,this.attributes.resolution=this.ResolutionType.NO_RESOLUTION)},setSeverity:function(){var e=(+new Date-this.attributes.driveDate)/this.ONE_DAY,t="high";e<=this.SeverityThreshold.low?t="low":e<=this.SeverityThreshold.medium&&(t="medium"),this.attributes.severity=t},isRecentlyClosed:function(){return!this.attributes.open&&Date.now()-this.attributes.resolvedOn<=this.ONE_WEEK_IN_MILLIS},CLASS_NAME:"Waze.Feature.Vector.UpdateRequest"}),function(){var e=n.prototype.Type,t={};t[e.INCORRECT_TURN]="Incorrect turn",t[e.INCORRECT_ADDRESS]="Incorrect address",t[e.INCORRECT_ROUTE]="Incorrect route",t[e.INCORRECT_MISSING_ROUNDABOUT]="Missing roundabout",t[e.INCORRECT_GENERAL_ERROR]="General error",t[e.TURN_NOT_ALLOWED]="Turn not allowed",t[e.INCORRECT_JUNCTION]="Incorrect junction",t[e.MISSING_BRIDGE_OVERPASS]="Missing bridge overpass",t[e.MISSING_EXIT]="Missing exit",t[e.WRONG_DRIVING_DIRECTIONS]="Wrong driving direction",t[e.MISSING_ROAD]="Missing road",n.prototype.TypeText=t}(),i.exports=n}}
),

this.require.define(
{"Waze/Action/UpdateRequest":function(e,t,i)
{var n,s=t("Waze/Action"),r=t("Waze/Model/ObjectType");
n=OpenLayers.Class(s,
	{request:null,newState:null,newResolution:null,newOpenState:null,previousAttributes:null,changedState:!1,
		initialize:function(e,t,i){s.prototype.initialize.apply(this,[i]),this.request=e,this.newState=t,this.previousAttributes={}},destroy:function(){s.prototype.destroy.apply(this)},doAction:function(){return OpenLayers.Util.extend(this.previousAttributes,this.request.attributes),this.request.setState(this.newState),this.newResolution=this.request.attributes.resolution,this.newResolution===this.request.ResolutionType.NO_RESOLUTION&&(this.newResolution=null),this.newOpenState=this.request.attributes.open,this.request.state||(this.request.state=OpenLayers.State.UPDATE,this.changedState=!0),this.model.mapUpdateRequests.changed(this.request),!0},undoAction:function(){this.request.attributes={},OpenLayers.Util.extend(this.request.attributes,this.previousAttributes),this.changedState&&(this.request.state=null),this.model.mapUpdateRequests.changed(this.request)},redoAction:function(){this.request.setState(this.newState),this.changedState&&(this.request.state=OpenLayers.State.UPDATE),this.model.mapUpdateRequests.changed(this.request)},serialize:function(){var e={id:this.request.getID(),open:this.newOpenState,resolution:this.newResolution},t={_objectType:r.UPDATE_REQUEST,action:s.TYPE.UPDATE,attributes:e};return t},CLASS_NAME:"Waze.Action.UpdateRequest"}),i.exports=n}}
)


,this.require.define({"Waze/Action/UpdateSegmentAddress":function(e,t,i){var n,s=t("Waze/Action/CompositeAction"),r=t("Waze/Action/UpdateObject"),o=t("Waze/Action/AddOrGetCity"),a=t("Waze/Action/AddOrGetStreet");n=OpenLayers.Class(s,{segment:null,attributes:null,initialize:function(e,t){s.prototype.initialize.apply(this,[t]),this.segment=e,this.attributes=t},destroy:function(){this.segment=null,s.prototype.destroy.apply(this)},doAction:function(){var e,t,i,n,s=this.model.countries.get(this.attributes.countryID),l=this.model.states.get(this.attributes.stateID);return i=new o(l,s,this.attributes.cityName,this.attributes.emptyCity),this.doSubAction(i),e=i.city,n=new a(this.attributes.streetName,e,this.attributes.emptyStreet),this.doSubAction(n),t=n.street,this.doSubAction(new r(this.segment,{primaryStreetID:t.getID()}))},CLASS_NAME:"Waze.Action.UpdateSegmentAddress"}),i.exports=n}}),this.require.define({"Waze/Action/UpdateSegmentGeometry":function(e,t,i){var n,s=t("Waze/Action"),r=t("Waze/Action/DeleteSegment"),o=t("Waze/Action/SegmentAction"),a=t("Waze/Model/ObjectType");n=OpenLayers.Class(o,{segment:null,oldGeometry:null,newGeometry:null,changedState:!1,createNodes:!1,initialize:function(e,t,i,n){o.prototype.initialize.apply(this,[e,n]),this.segment=e,this.changedState=!1,this.oldGeometry=t===e.geometry?t.clone():t,this.newGeometry=i===e.geometry?i.clone():i},destroy:function(){this.segment=null,this.oldGeometry.destroy(),this.newGeometry.destroy(),this.oldGeometry=null,this.newGeometry=null,o.prototype.destroy.apply(this)},doAction:function(){var e,t=this.oldGeometry.getVertices(!0);return this.replaceGeometry(),this.segment.isSingular()?void this.doSubAction(new r(this.segment)):(e=this.segment.geometry.getVertices(!0),t[0].equals(e[0])||this.updateEndPoint(this.segment.attributes.fromNodeID,this.touching.fromVertex,!0),t[1].equals(e[1])||this.updateEndPoint(this.segment.attributes.toNodeID,this.touching.toVertex,!1),this.segment.state||(this.changedState=!0,this.segment.state=OpenLayers.State.UPDATE),void this.model.segments.changed(this.segment))},replaceGeometry:function(){this.segment.geometry.components.length=0,this.newGeometry.components.forEach(function(e){this.segment.geometry.addComponent(e.clone())},this),this.segment.geometry.calculateBounds(),this.segment.bounds=this.segment.geometry.bounds},undoAction:function(){this.changedState&&(this.segment.state=null),this.segment.geometry.components.length=0,this.oldGeometry.components.forEach(function(e){this.segment.geometry.addComponent(e.clone())},this),this.segment.geometry.calculateBounds(),this.segment.bounds=this.segment.geometry.bounds,this.model.segments.changed(this.segment),o.prototype.undoAction.apply(this)},redoAction:function(){this.segment.geometry.components.length=0,this.newGeometry.components.forEach(function(e){this.segment.geometry.addComponent(e.clone())},this),this.segment.geometry.calculateBounds(),this.segment.bounds=this.segment.geometry.bounds,this.changedState&&(this.segment.state=OpenLayers.State.UPDATE),this.model.segments.changed(this.segment),o.prototype.redoAction.apply(this)},serialize:function(){var e={};e.id=this.segment.getID(),e.geometry=this.newGeometry;var t={_objectType:a.SEGMENT,action:s.TYPE.UPDATE,attributes:e};return t},getBounds:function(){return this.newGeometry.getBounds().clone()},CLASS_NAME:"Waze.Action.UpdateSegmentGeometry"}),i.exports=n}}),this.require.define({"Waze/Action/Visitor/Serializor":function(e,t,i){var n,s=t("Waze/Utils/Visitor"),r=t("Waze/Util");n=OpenLayers.Class(s,{result:null,problemUpdates:null,processedProblems:!1,traversalOrder:{_default:s.Order.PRE,"Waze.Action.DeleteNode":s.Order.POST,"Waze.Action.DeleteSegment":s.Order.POST},initialize:function(){this.result=[],this.problemUpdates={}},_default:function(e){this.addAction(e)},beforeEnter:function(e){return!e.dontSerialize},afterLeave:function(){},getTraversalOrder:function(e){var t=this.traversalOrder[e.CLASS_NAME];return r.defined(t)||(t=this.traversalOrder._default),t},UpdateProblem:function(e){this.problemUpdates[e.problem.getID()]=e},addAction:function(e){var t;e.dontSerialize||(t=e.serialize(),null!==t&&(t instanceof Array?this.result=this.result.concat(t):this.result.push(t)))},getResult:function(){return this.processedProblems||(Object.values(this.problemUpdates).forEach(function(e){"open"!==e.problem.attributes.state&&this.addAction(e)},this),this.processedProblems=!0),this.result},CLASS_NAME:"Waze.Action.Visitor.Serializor"}),i.exports=n}}),this.require.define({"Waze/Action/Visitor/TreeSerializor":function(e,t,i){var n,s=t("Waze/Utils/Visitor"),r=t("Waze/Util");n=OpenLayers.Class(s,{root:null,currentContainer:null,previousContainer:null,problemUpdates:null,processedProblems:!1,traversalOrder:{_default:s.Order.PRE,"Waze.Action.DeleteNode":s.Order.POST,"Waze.Action.DeleteSegment":s.Order.POST,"Waze.Action.ModifyConnection":s.Order.POST,"Waze.Action.AddLandmark":s.Order.POST},initialize:function(){this.currentContainer={},this.currentContainer._subActions=[],this.problemUpdates={},this.root=this.currentContainer,this.previousContainers=[]},_default:function(e){this.addAction(e)},beforeEnter:function(e){if(!e.dontSerialize){var t={};this.previousContainers.push(this.currentContainer),this.currentContainer._subActions.push(t),this.currentContainer=t,t.name=e.CLASS_NAME.split(".").last(),t._subActions=[]}return!e.dontSerialize},afterLeave:function(e){e.dontSerialize||(this.currentContainer=this.previousContainers.pop())},getTraversalOrder:function(e){var t=this.traversalOrder[e.CLASS_NAME];return r.defined(t)||(t=this.traversalOrder._default),t},addAction:function(e){var t;e.dontSerialize||(t=e.serialize(),null!==t&&(t instanceof Array?(t.forEach(function(t){this.serializeGeometries(e,t)},this),this.currentContainer._subActions=this.currentContainer._subActions.concat(t)):(this.serializeGeometries(e,t),this.currentContainer._subActions.push(t))))},serializeGeometries:function(e,t){e.eachGeometryField(t.attributes,function(e,t,i){if(t){var n=t.clone();n.transform(W.map.getProjectionObject(),W.map.displayProjection),i[e]=OpenLayers.Format.GeoJSON.prototype.extract.geometry.apply(OpenLayers.Format.GeoJSON.prototype,[n])}})},getResult:function(){return this.root._subActions[0]},CLASS_NAME:"Waze.Action.Visitor.TreeSerializor"}),i.exports=n}}),this.require.define({"Waze/ActionManager":function(e,t,i){var n,s=t("Waze/Util"),r=t("Waze/Action/Visitor/TreeSerializor"),o=t("Waze/Action/CompositeAction");n=OpenLayers.Class({actions:null,index:-1,model:null,events:null,initialize:function(e,t){OpenLayers.Util.extend(this,t),this.model=e,this.actions=[],this.events=new OpenLayers.Events(this)},add:function(e){if((e.undoSupported()||this.events.triggerEvent("beforeclearactions")!==!1)&&this.events.triggerEvent("beforeaction",{action:e})!==!1){var t,i,n=this.unsavedActionsNum();if(e.undoSupported()){for(this.index++,t=this.index,i=this.actions.legnth;i>t;t++)this.actions[t].destroy();this.actions.splice(this.index,this.actions.length-this.index,e)}else{for(t=0,i=this.actions.legnth;i>t;t++)this.actions[t].destroy();this.actions=[],this.index=-1,this.events.triggerEvent("afterclearactions",{action:e})}e.setModel(this.model),e.doAction()===!1&&(this.actions.pop(),this.index>-1&&this.index--),0===n&&this.events.triggerEvent("hasActions"),this.events.triggerEvent("afteraction",{action:e})}},canUndo:function(){return this.index>=0},canSave:function(){return this.canUndo()&&this.isAllowedToSave()},canRedo:function(){return this.index<this.actions.length-1},unsavedActionsNum:function(){return this.index+1},undo:function(){return this.canUndo()?this.events.triggerEvent("beforeundoaction",{action:this.actions[this.index]})===!1?!1:(s.protect("undoing "+this.actions[this.index].CLASS_NAME,function(){this.actions[this.index].undoAction()},this),this.index--,this.events.triggerEvent("afterundoaction",{action:this.actions[this.index]}),0===this.unsavedActionsNum()&&this.events.triggerEvent("noActions"),W.track("undo_action"),!0):!1},redo:function(){return this.canRedo()?this.events.triggerEvent("beforeaction",{action:this.actions[this.index+1]})===!1?!1:(0===this.unsavedActionsNum()&&this.events.triggerEvent("hasActions"),this.index++,s.protect("redoing "+this.actions[this.index].CLASS_NAME,function(){this.actions[this.index].redoAction()},this),this.events.triggerEvent("afteraction",{action:this.actions[this.index]}),W.track("redo_action"),!0):!1},clear:function(){for(var e=0,t=this.actions.legnth;t>e;e++)this.actions[e].destroy();this.actions=[],this.index=-1,this.events.triggerEvent("afterclearactions"),this.events.triggerEvent("noActions")},getChangesBounds:function(){var e=new o;return e.subActions=this.actions.slice(0,this.index+1),e.getBounds()},serialize:function(){var e=new r,t=new o;return t.subActions=this.actions.slice(0,this.index+1),t.accept(e),e.getResult()},isAllowedToSave:function(){return this.model.loginManager.isLoggedIn()},CLASS_NAME:"Waze.ActionManager"}),i.exports=n}}),this.require.define({"Waze/App":function(e,t,i){(function(){var e,n,s,r,o,a;a=t("Waze/Model/Model"),o=t("Waze/LoginManager"),n=t("Waze/DataModel"),r=t("Waze/Model/Location"),s=t("Waze/Control/KeyboardShortcuts"),e=OL.Class(a,{initialize:function(){a.prototype.initialize.apply(this),W.vent=new a,this.set({loading:!0,loggedIn:null,sandbox:!1,sessionExpired:!1,editing:!1,user:null})},start:function(){return $.when(r.getCurrent()).done(function(e){return function(t){return W.location=t,t.newCookie?window.location.reload(!0):e._init()}}(this))},_init:function(){W.Config.init(),W.model=new n,W.model.loginManager=W.loginManager=this.loginManager=new o,W.accelerators=new s,this.loginManager.events.on({login:this._onLoginChanged,sessionExpired:this._onSessionExpired,logout:this._onLogout,scope:this}),this._getLoggedInUser()},_getLoggedInUser:function(){return this.loginManager.getLoggedInUser().done(function(e){return function(){return e.set("loading",!1),W.controller.activate()}}(this)).always(function(e){return function(){return e.set("loading",!1),e.set("user",e.loginManager.user),e.set("loggedIn",e.loginManager.isLoggedIn()),e._setEditing()}}(this))},_onLoginChanged:function(){return this.get("sessionExpired")?void this._processRelogin():(this.set("sandbox",!1),this.set("user",this.loginManager.user),this.set("loggedIn",!0),this._setEditing(),W.controller.activate())},_onSessionExpired:function(){return this.set("sessionExpired",!0),this._setEditing()},_setEditing:function(){var e;return e=this.get("sandbox")||this.loginManager.isLoggedIn(),this.set("editing",e)},_processRelogin:function(){return this.loginManager.returningUser?(this.set("sessionExpired",!1),this._setEditing()):void this._onLogout()},activateSandboxMode:function(){return this.set("sandbox",!0),W.controller.activate(),this._setEditing()},_onLogout:function(){return W.model.actionManager.clear(),window.location.reload()}}),i.exports=e}).call(this)}}),this.require.define({"Waze/AppPresenter":function(e,t,i){(function(){var e,n,s,r,o,a;r=t("Waze/Presenter"),n=t("Waze/Presenter/Login"),o=t("Waze/Service/Services"),e=t("Waze/Region/Dialog"),a=t("Waze/Presenter/Sidebar"),s=t("Waze/Map"),i.exports=OL.Class(r,{template:"app",$el:$(".app"),ui:{editArea:".edit-area",sidebar:"#sidebar"},initialize:function(){r.prototype.initialize.apply(this,arguments),this._findUiElements(),this.dialogRegion=new e,this.model.on("change:loading",this._onLoadingChange,this),this.model.on("change:editing",this._onEditingChange,this),$(window).on("beforeunload",function(e){var t;return W.model.actionManager.canUndo()&&!W.controller.isSandBoxMode()?(t=e||window.event,t&&(t.returnValue=I18n.t("edit.unsaved_changes")),I18n.t("edit.unsaved_changes")):void 0})},_onLoadingChange:function(){return $(".app-loading").hide(),this.ui.editArea.show(),W.map=new s,this.loginPresenter=new n({model:this.model}),this.sidebar=new a,this.services=new o(W.model),this.services.activate()},_onEditingChange:function(){return this._toggleSidebar(this.model.get("editing"))},_toggleSidebar:function(e){return this.$el.toggleClass("show-sidebar",e),this.ui.sidebar.toggle(e),W.map.resize()}})}).call(this)}}),this.require.define({"Waze/Control":function(e,t,i){var n=OpenLayers.Class({visible:!0,enabled:!0,initialize:function(e){OpenLayers.Util.applyDefaults(this,e)},show:function(){this.setVisible(!0)},hide:function(){this.setVisible(!1)},setVisible:function(e){e!==this.visible&&(this.visible=e,this.div&&(e?OpenLayers.Element.show(this.div):OpenLayers.Element.hide(this.div)),this.events&&this.events.triggerEvent("visibilitychanged"))},enable:function(e){this.setEnabled(!0,e)},disable:function(e){this.setEnabled(!1,e)},isEnabled:function(){return this.enabled},setEnabled:function(e,t){this.enabled!==e&&(this.enabled=e,this.events&&!t&&this.events.triggerEvent("enablechanged"))},CLASS_NAME:"Waze.Control"});i.exports=n}}),this.require.define({"Waze/Control/Archive":function(e,t,i){var n,s=t("Waze/Control"),r=t("Waze/Action/AddSegment"),o=t("Waze/Feature/Vector/Segment"),a=t("Waze/View/ArchivePanel"),l=t("Waze/View/Archive"),h=t("Waze/View/EditableAreas");n=OpenLayers.Class(OpenLayers.Control,s,{panelView:null,sidePanelView:null,editableAreasListView:null,layerView:null,editableAreasLayer:null,model:null,selectionManager:null,loading:!1,selectedDrivePart:null,segmentToRoadPartes:null,selectControl:null,currentSessionList:null,currentSessionData:null,currentSession:null,currentUser:null,initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments),this.panelView=new a($("#archive-panel"),W.map),this.sidePanelView=new l($("#sidepanel-drives")),this.editableAreasListView=new h($("#sidepanel-areas")),this.layerView=W.map.archiveLayer,this.editableAreasLayer=W.map.userLayer,this.panelView.pm=this,this.layerView.pm=this,this.segmentToRoadPartes={},this.model=W.model,this.selectionManager=W.selectionManager,this.selectControl=new OpenLayers.Control.SelectFeature(this.layerView,{onSelect:this.onDriveSelected,onUnselect:this.onDriveUnselected,onBeforeSelect:this.beforeDriveSelected,scope:this})},setMap:function(){OpenLayers.Control.prototype.setMap.apply(this,arguments),this.selectControl.setMap(this.map)},destroy:function(){this.unregisterListeners()},unregisterListeners:function(){},registerListeners:function(){this.sidePanelView.events.on({shown:this.onSessionsListShown,sessionClicked:this.onSessionClicked,paginationLinkClicked:this.onPaginationLinkClicked,searchSubmitted:this.onSearchSubmitted,scope:this}),this.editableAreasListView.events.on({areaClicked:this.onAreaClicked,areasPaginationLinkClicked:this.onAreasPaginationLinkClicked,scope:this}),this.panelView.events.on({createRoadClicked:this.onCreateRoadClicked,panelClosed:this.onPanelClosed,scope:this})},reset:function(){this.currentSessionList=null,this.currentSessionData=null,this.currentSession=null,this.loadSessions(-1),this.sidePanelView.reset(),this.loadEditableAreas(),this.layerView.clearDrive()},activate:function(){OpenLayers.Control.prototype.activate.apply(this,arguments),this.registerListeners(),this.selectControl.activate()},beforeDriveSelected:function(){return!0},onDriveSelected:function(e){this.selectedDrivePart=e,this.panelView.update()},onDriveUnselected:function(){this.selectedDrivePart=null,this.panelView.update()},onCreateRoadClicked:function(){if(this.selectedDrivePart){var e=new o({geometry:this.selectedDrivePart.geometry.clone()}),t=new r(e);this.model.actionManager.add(t),





this.selectionManager.select([e])}this.selectControl.unselectAll(),this.onDriveUnselected()},onSessionsListShown:function(){null===this.currentSessionList&&(this.loadSessions(0),W.track("show_session_list"))},onPaginationLinkClicked:function(e){this.loadSessions(e.index)},onAreasPaginationLinkClicked:function(e){var t=this.editableAreasListView.ResultsPerPage,i=this.model.loginManager.user,n=[],s=e.index;i&&(n=i.editableAreasMeters||[]),this.editableAreasListView.setEditableAreasPage(n.slice(s*t,(s+1)*t))},loadEditableAreas:function(){var e=this.model.loginManager.user,t=[];e&&(t=e.editableAreasMeters||[]),this.editableAreasListView.setEditableAreas(t.length),this.onAreasPaginationLinkClicked({index:0})},loadSessions:function(e){var t=this;if(!this.model.loginManager.user||-1===e)return void this.sidePanelView.setSessions(0);this.sidePanelView.setLoading(!0);var i={minDistance:1e3,offset:e*this.sidePanelView.ResultsPerPage,count:this.sidePanelView.ResultsPerPage};null!==this.currentUser&&(i.userNames=this.currentUser),this.model.archives.get(null,i).done(function(e){var i=t.model.archives.additionalInfo.totalSessions;null===t.currentSessionList&&t.sidePanelView.setSessions(i),t.sidePanelView.setSessionsPage(e,t.currentUser,t.model.loginManager.user.isStaff),t.currentSessionList=e}).always(function(){t.sidePanelView.setLoading(!1)}).fail(function(){t.sidePanelView.showError()})},onAreaClicked:function(e){this.editableAreasLayer.setVisibility(!0),this.ZoomToEditableArea(e.id)},ZoomToEditableArea:function(e){var t,i;i=this.model.loginManager.user.editableAreas.components[e].getBounds(),t=this.map.getZoomForExtent(i),this.map.setCenter(i.getCenterLonLat(),t)},onSessionClicked:function(e){var t=this;$.when(this.model.archives.get(e.id),this.model.archiveSessions.get(e.id)).then(function(i,n){t.currentSession=i,t.panelView.setSession(t.currentSession),t.sidePanelView.setSelectedSession(e.id),t.panelView.show(),$.isArray(n)&&(n=n.first()),t.currentSessionData=n,t.panelView.setExtendedSessionInfo(t.currentSession,t.currentSessionData),t.layerView.drawDrive(),t.layerView.zoomToDrive()})},onSearchSubmitted:function(e){this.currentUser=e.username?e.username:null,this.currentSessionList=null,this.currentSessionData=null,this.currentSession=null,this.loadSessions(0),this.sidePanelView.reset(),this.loadEditableAreas(),this.layerView.clearDrive()},onPanelClosed:function(){this.sidePanelView.setSelectedSession(null),this.currentSessionData=null,this.currentSession=null,this.layerView.clearDrive()},disable:function(){s.prototype.disable.apply(this,arguments),this.onPanelClosed()},CLASS_NAME:"Waze.Control.Archive"}),i.exports=n}}),this.require.define({"Waze/Control/BridgeCreator":function(e,t,i){var n,s=t("Waze/Control"),r=t("Waze/Action/MergeSegments"),o=t("Waze/DivIcon"),a=t("Waze/Permissions"),l=t("Waze/Model/EventType"),h=t("Waze/Util");n=OpenLayers.Class(OpenLayers.Control,s,{model:null,layer:null,handler:null,segments:null,node:null,bridgeFeature:null,maxScaleForDisplay:1e4,initialize:function(e){OpenLayers.Control.prototype.initialize.apply(this,[e]),s.prototype.initialize.apply(this,[e]),this.model=W.model,this.layer=new OL.Layer.Markers("Bridge",{displayInLayerSwitcher:!1}),this.segments=[]},destroy:function(){this.layer.clearMarkers(),this.unregisterModelEvents(),this.segments=null,this.node=null},onAddClicked:function(){this.model.actionManager.add(new r(this.segments,this.node))},activate:function(){OL.Control.prototype.activate.apply(this),W.selectionManager.events.register("selectionchanged",this,this.onSelectionChanged),$(this.layer.div).on("click",".add-bridge",$.proxy(this.onAddClicked,this))},deactivate:function(){W.selectionManager.events.unregister("selectionchanged",this,this.onSelectionChanged),this.unselect(),$(this.layer.div).off("click",".add-bridge",$.proxy(this.onAddClicked,this)),OpenLayers.Control.prototype.deactivate.apply(this)},onSelectionChanged:function(e){var t=e.selected||[];t||(t=[]);var i=_(this.segments).invoke("getID");t=_(t).pluck("model");var n=_(t).invoke("getID"),s=!i.equals(n);s&&(this.selectionValid(t)||this.segments.isEmpty()?this.selectionValid(t)&&this.segments.isEmpty()&&this.registerModelEvents():this.unregisterModelEvents(),this.segments=t,this.resetConnections())},selectionValid:function(e){return!e.isEmpty()&&2===e.length},unselect:function(){this.select({selected:[]})},registerModelEvents:function(){this.model.segments.events.register(l.CHANGED,this,this.onSegmentsChanged),this.model.segments.events.register(l.REMOVED,this,this.onSegmentsRemoved),this.model.nodes.events.register(l.CHANGED,this,this.onNodesChanged)},unregisterModelEvents:function(){this.model.segments.events.unregister(l.CHANGED,this,this.onSegmentsChanged),this.model.segments.events.unregister(l.REMOVED,this,this.onSegmentsRemoved),this.model.nodes.events.unregister(l.CHANGED,this,this.onNodesChanged)},onSegmentsChanged:function(e){null!==this.segment&&OpenLayers.Util.indexOf(e,this.segment)>=0&&this.resetConnections()},onSegmentsRemoved:function(e){null!==this.segment&&OpenLayers.Util.indexOf(e,this.segment)>=0&&this.unselect()},onNodesChanged:function(e){if(this.segment){var t=this.model.nodes.get(this.segment.attributes.fromNodeID),i=this.model.nodes.get(this.segment.attributes.toNodeID);(t&&OpenLayers.Util.indexOf(e,t)>=0||i&&OpenLayers.Util.indexOf(e,i)>=0)&&this.resetConnections()}},destroyConnections:function(){this.layer.clearMarkers(),this.bridgeFeature=null},resetConnections:function(){if(this.destroyConnections(),!(this.segments.isEmpty()||2!==this.segments.length||this.layer.map.getScale()>this.maxScaleForDisplay)){var e=[this.segments[0].attributes.fromNodeID,this.segments[0].attributes.toNodeID].intersect([this.segments[1].attributes.fromNodeID,this.segments[1].attributes.toNodeID]).filter(h.defined).first();if(this.node=this.model.nodes.get(e),r.prototype.areSegmentsBridgable(this.segments,this.node)){var t=this.segments.every(function(e){return e.isAllowed(a.Segments.EDIT_GEOMETRY)});if(t){var i=this.node.geometry.clone();this.bridgeFeature=new OL.Marker(new OL.LonLat(i.x,i.y),new o("add-bridge")),this.layer.addMarker(this.bridgeFeature)}}}},setMap:function(){OL.Control.prototype.setMap.apply(this,arguments),this.map.addLayer(this.layer)},CLASS_NAME:"Waze.Control.BridgeCreator"}),i.exports=n}}),this.require.define({"Waze/Control/DeleteFeature":function(e,t,i){var n,s=t("Waze/Control"),r=t("Waze/Permissions"),o=t("Waze/Handler/KeyboardShortcut"),a=t("Waze/Model/ObjectType");n=new OpenLayers.Class(OpenLayers.Control.Button,s,{keyboardCodes:null,keyboardHandler:null,initialize:function(e,t){s.prototype.initialize.apply(this,[t]),OpenLayers.Control.prototype.initialize.apply(this,[t]),this.model=e,this.keyboardCodes=[OpenLayers.Event.KEY_DELETE],this.keyboardHandler=new o(this,{keydown:this.handleKeypress}),this.setEnabled(!1)},trigger:function(){if(this.enabled){var e=this.features;if(!e.isEmpty()){if(e.first().type===a.NODE)this.model.deleteNodes(e);else if(e.first().type===a.SEGMENT){var t=!0,i=e.some(function(e){return e.attributes.hasHNs});e.length>1?t=window.confirm(i?I18n.t("edit.segment.delete_confirm.multiple_hn"):I18n.t("edit.segment.delete_confirm.multiple")):i&&(t=window.confirm(I18n.t("edit.segment.delete_confirm.hn"))),t&&this.model.deleteSegments(e)}else this.model.deleteObjects(e);this.onFeatureDelete(e)}}},setEnabledByFeatures:function(e){if(!e||e.isEmpty())return void this.setEnabled(!1);var t,i=1===e.length&&e.first().type===a.NODE,n=!e.isEmpty()&&e.every(function(e){return e.type===a.SEGMENT}),s=!1;i?(t=e.first(),s=t.isDeleteable(this.model)):s=n?e.every(function(e){return e.isAllowed(r.Segments.DELETE)}):e.first().isDeletable(),this.features=e,this.setEnabled(s)},handleKeypress:function(e){this.keyboardCodes.contains(e.keyCode)&&1===this.features.length&&this.trigger()},setEnabled:function(e){s.prototype.setEnabled.apply(this,arguments),e?this.keyboardHandler.activate():this.keyboardHandler.deactivate()},onFeatureDelete:function(){},CLASS_NAME:"Waze.Control.DeleteFeature"}),i.exports=n}}),this.require.define({"Waze/Control/DrawFeature":function(e,t,i){var n,s=t("Waze/Control"),r=t("Waze/Feature/Vector/Segment");n=OpenLayers.Class(OpenLayers.Control.DrawFeature,s,{keyHandler:null,snapControl:null,snappedFrom:null,editingMediator:null,targetLayer:null,type:OL.Control.TYPE_TOGGLE,drawingAccuracy:2,keyUp:function(e){this.active&&0===e.charCode&&e.keyCode===OpenLayers.Event.KEY_ESC&&this.handler.cancel()},handleShortcut:function(){this.isEnabled()&&this.activate()},isEnabled:function(){return!this.editingMediator.get("drawing")&&this.editingMediator.get("editingEnabled")},featureCancelled:function(){},onDrawCancel:function(e){this.deactivate(),this.featureCancelled(e)},createFeature:function(e){return new r({geometry:e})},drawFeature:function(e){var t=this.createFeature(e),i=this.layer.events.triggerEvent("sketchcomplete",{feature:t});i!==!1&&("OpenLayers.Geometry.LineString"===t.geometry.CLASS_NAME&&(t.geometry=t.geometry.simplify(this.drawingAccuracy*this.map.getResolution())),t.state=OpenLayers.State.INSERT,this.snapControl?(this.snappedFrom&&(this.snappedFrom.feature=this.snappedFrom.feature.model,this.snappedFrom.feature&&this.snappedFrom.feature.setSnapped(!1)),this.snapControl.snappedFeature&&(this.snapControl.snappedFeature.feature=this.snapControl.snappedFeature.feature.model),this.snapControl.snappedFeature&&this.snapControl.snappedFeature.feature.outOfScope&&(this.snapControl.snappedFeature=null),this.snappedFrom&&this.snappedFrom.feature.outOfScope&&(this.snappedFrom=null),this.snapControl.snappedFeature&&this.snappedFrom&&this.snapControl.snappedFeature.feature===this.snappedFrom.feature&&(this.snappedFrom=null),this.featureAdded(t,this.snappedFrom,this.snapControl.snappedFeature)):this.featureAdded(t)),this.deactivate()
},initialize:function(e,t,i,n,r){s.prototype.initialize.apply(this,[r]),this.callbacks=OpenLayers.Util.extend({cancel:this.onDrawCancel},this.callbacks),this.editingMediator=W.editingMediator,this.targetLayer=t,OpenLayers.Control.DrawFeature.prototype.initialize.apply(this,[e,i,r]),this.keyHandler=new OpenLayers.Handler.Keyboard(this,{keyup:this.keyUp}),this.accelerator&&W.accelerators.events.register(this.accelerator,this,this.handleShortcut),this.snapControl=n,this.snapControl&&this.snapControl.events.on({snap:function(){var e=this.handler.getGeometry();e&&1===e.components.length&&(this.snapControl.snappedFeature.feature.model&&this.snapControl.snappedFeature.feature.model.setSnapped(!0),this.snappedFrom=this.snapControl.snappedFeature)},scope:this})},setEnabled:function(e){s.prototype.setEnabled.apply(this,arguments),e?this.keyHandler.activate():this.keyHandler.deactivate()},activate:function(){this.active||(OpenLayers.Control.DrawFeature.prototype.activate.apply(this,arguments),this.keyHandler.activate(),this.targetLayer.getVisibility()||this.targetLayer.setVisibility(!0),this.editingMediator.setDrawingInProgress())},deactivate:function(){if(this.snappedFrom){var e=this.snappedFrom.feature;e.setSnapped||(e=e.model),e.setSnapped(!1)}this.snappedFrom=null,this.active&&(this.editingMediator.setDrawingDone(),this.keyHandler.deactivate(),OpenLayers.Control.DrawFeature.prototype.deactivate.apply(this,arguments))},CLASS_NAME:"Waze.Control.DrawFeature"}),i.exports=n}}),this.require.define({"Waze/Control/DrawRoundabout":function(e,t,i){var n,s=t("Waze/Control"),r=t("Waze/Handler/Ellipse");n=OpenLayers.Class(OpenLayers.Control,s,{keyHandler:null,handler:null,editingMediator:null,keyUp:function(e){this.active&&0===e.charCode&&e.keyCode===OpenLayers.Event.KEY_ESC&&(this.handler.cancel(),this.deactivate())},handleShortcut:function(){this.isEnabled()&&this.activate()},onDrawCancel:function(e){this.deactivate(),this.featureCancelled(e)},initialize:function(e){OpenLayers.Control.prototype.initialize.apply(this,[e]),s.prototype.initialize.apply(this,[e]),this.callbacks=OpenLayers.Util.extend({cancel:this.onDrawCancel},this.callbacks),this.keyHandler=new OpenLayers.Handler.Keyboard(this,{keyup:this.keyUp}),W.accelerators.events.register("drawRoundabout",this,this.handleShortcut),this.handler=new r(this,{done:this.onEllipseDrawn,cancel:this.onCancel}),this.editingMediator=W.editingMediator},onDrawStart:function(){OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass+"Over")},onDrawEnd:function(){OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over")},isEnabled:function(){return!this.editingMediator.get("drawing")&&this.editingMediator.get("editingEnabled")},onEllipseDrawn:function(e){this.onDrawEnd();var t,i=new OpenLayers.LonLat(e.x,e.y),n=e.rx*this.map.getResolution(),s=e.ry*this.map.getResolution();i.x=i.lon,i.y=i.lat,t=new OpenLayers.Bounds(e.x-n,e.y-s,e.x+n,e.y+s),this.deactivate(),this.onRoundaboutAdded({center:i,rx:n,ry:s,bounds:t})},onCancel:function(){this.onDrawEnd(),this.deactivate()},onRoundaboutAdded:function(){},setEnabled:function(e){s.prototype.setEnabled.apply(this,arguments),e?this.keyHandler.activate():this.keyHandler.deactivate()},activate:function(){this.active||(OpenLayers.Control.prototype.activate.apply(this,arguments),this.editingMediator.setDrawingInProgress(),this.keyHandler.activate())},deactivate:function(){this.active&&(this.keyHandler.deactivate(),this.editingMediator.setDrawingDone(),OpenLayers.Control.prototype.deactivate.apply(this,arguments))},CLASS_NAME:"Waze.Control.DrawRoundabout"}),i.exports=n}}),this.require.define({"Waze/Control/EditNodeConnections":function(e,t,i){var n,s=t("Waze/Control"),r=t("Waze/Action/ModifyConnection"),o=t("Waze/Action/ModifyConnectionRestriction"),a=t("Waze/DivIcon"),l=t("Waze/Presenter/Restriction/Modal"),h=t("Waze/Model/EventType"),u=t("Waze/Permissions");n=OpenLayers.Class(OpenLayers.Control,s,{showArrows:!0,showAllArrows:!1,offsetArrows:!1,model:null,conLayer:null,selectionManager:null,segment:null,arrowHeight:40,minimalArrowAngle:25,arrowDistanceFromNodeInPixels:35,uturnArrowOffsetInPixels:18,maxScaleForDisplay:1e4,uturnMaxScale:3385.5001277302295,uturnMinSegmentLength:75,restrictionsView:null,eventsRegistered:!1,initialize:function(e){OpenLayers.Control.prototype.initialize.apply(this,[e]),s.prototype.initialize.apply(this,[e]),this.model=W.model,this.conLayer=new OL.Layer.Markers("Node Connections",{displayInLayerSwitcher:!1}),this.selectionManager=W.selectionManager,W.accelerators.events.on({spreadArrows:this.toggleArrowOffset,hideArrows:this.toggleArrows,showAllArrows:this.toggleShowAllArrows,scope:this})},setMap:function(){OpenLayers.Control.prototype.setMap.apply(this,arguments),this.map.addLayer(this.conLayer)},toggleShowAllArrows:function(){this.enabled&&(this.showAllArrows=!this.showAllArrows,this.resetConnections(),this.toggleEvents())},isActive:function(){return null!==this.segment||this.showAllArrows},toggleEvents:function(){this.isActive()?this.registerEvents():this.unregisterEvents()},toggleArrowOffset:function(){this.offsetArrows=!this.offsetArrows,this.resetConnections()},toggleArrows:function(){this.showArrows=!this.showArrows,this.conLayer.markers.forEach(function(e){e.icon.$div.toggleClass("disabled",!this.showArrows)},this)},destroy:function(){this.destroyConnections(),W.accelerators.events.un({spreadArrows:this.toggleArrowOffset,hideArrows:this.toggleArrows})},onArrowClicked:function(e){var t=$(e.target),i=t.hasClass("arrow")?t:t.parents(".arrow"),n=i.data("model"),s=n.fromSeg.isTurnAllowed(n.toSeg,n.node);return n.modifiable&&(n.locked?this.model.actionManager.add(new r(n.fromSeg.getID(),n.node,n.toSeg.getID(),!s)):n.fromSeg.lockTurns(n.node)),!1},onRestrictionsClicked:function(e){e.stopPropagation();var t=$(e.target).parents(".arrow").data("model"),i={},n=t.fromSeg.getRestrictionsAtNode(t.node)||{};n=n[t.toSeg.getID()]||[],n=n.map(function(e){return e.clone()}),this.restrictionsView&&(this.restrictionsView.hide(),this.restrictionsView.destroy()),this.restrictionsView=new l,this.restrictionsView.on("done",this.onRestrictionsEdited,this),this.restrictionsView.on("cancel",this.onRestrictionsEditCancel,this),i.default={name:"default",fromSeg:t.fromSeg,toSeg:t.toSeg,restrictions:n},this.restrictionsView.setModel(i,[t.node],t.modifiable),this.restrictionsView.setSelectedGroup("default"),this.restrictionsView.show()},onRestrictionsEdited:function(){var e=this.restrictionsView.model.default,t=this.restrictionsView.features.first();e.restrictions.forEach(function(e){delete e.models}),this.model.actionManager.add(new o(e.fromSeg,t,e.toSeg,e.restrictions)),this.restrictionsView.hide(),this.restrictionsView.destroy(),this.restrictionsView=null},onRestrictionsEditCancel:function(){this.restrictionsView.hide(),this.restrictionsView.destroy(),this.restrictionsView=null},activate:function(){OpenLayers.Control.prototype.activate.apply(this),this.selectionManager.events.register("selectionchanged",this,this.onSelectionChanged),$(this.conLayer.div).on("click",".arrow",$.proxy(this.onArrowClicked,this)),$(this.conLayer.div).on("click",".restrictions",$.proxy(this.onRestrictionsClicked,this))},deactivate:function(){this.unselect(),this.selectionManager.events.unregister("selectionchanged",this,this.onSelectionChanged),$(this.conLayer.div).off("click",".arrow",$.proxy(this.onArrowClicked,this)),OpenLayers.Control.prototype.deactivate.apply(this)},onSelectionChanged:function(e){var t=e.selected||[];this.select(1===t.length?t[0].model:null)},select:function(e){e!==this.segment&&(this.segment=e,this.resetConnections(),this.toggleEvents())},unselect:function(){this.select(null)},registerEvents:function(){this.eventsRegistered||(this.model.segments.events.register(h.CHANGED,this,this.onSegmentsChanged),this.model.segments.events.register(h.REMOVED,this,this.onSegmentsRemoved),this.model.nodes.events.register(h.CHANGED,this,this.onNodesChanged),this.map.events.register("zoomend",this,this.zoomChanged),this.eventsRegistered=!0)},unregisterEvents:function(){this.eventsRegistered&&(this.model.segments.events.unregister(h.CHANGED,this,this.onSegmentsChanged),this.model.segments.events.unregister(h.REMOVED,this,this.onSegmentsRemoved),this.model.nodes.events.unregister(h.CHANGED,this,this.onNodesChanged),this.map.events.unregister("zoomend",this,this.zoomChanged),this.eventsRegistered=!1)},onSegmentsChanged:function(e){(null!==this.segment&&OpenLayers.Util.indexOf(e,this.segment)>=0||this.showAllArrows)&&this.resetConnections()},onSegmentsRemoved:function(e){null!==this.segment&&OpenLayers.Util.indexOf(e,this.segment)>=0&&this.unselect()},onNodesChanged:function(){this.resetConnections()},destroyConnections:function(){this.conLayer.clearMarkers()},resetConnections:function(){var e,t=[],i=this;this.destroyConnections(),this.conLayer.map.getScale()>this.maxScaleForDisplay||(this.showAllArrows?t=this.model.segments.getObjectArray(function(e){return e.state!==OpenLayers.State.DELETE&&e.geometry.bounds.intersectsBounds(i.map.getExtent())}):null!==this.segment&&(t=[this.segment]),t.isEmpty()||t.forEach(function(t){["fromNodeID","toNodeID"].forEach(function(i){t.attributes[i]&&(e=this.model.nodes.get(t.attributes[i]))&&e.attributes.segIDs.length>1&&this.createNodeConnections(e,t)},this)},this))},createNodeConnections:function(e,t){var i,n,s,r,o,l,h,u=this,c=t.areTurnsLocked(e),d=null,p=null,m=e.getAngleToSegment(t),g=t.geometry.getLength()/this.map.getResolution(),f=e.attributes.segIDs.reduce(function(i,n){if(s=u.model.segments.get(n),s&&e.isTurnAllowedBySegDirections(t,s)){if(h=s.getID()===t.getID(),o=e.getAngleToSegment(s),!h){var r=Math.abs(m-o);r>180&&360>=r&&(r=360-r),90>r&&(e.getDirectionBetweenSegments(t,s)?(null===d||d>r)&&(d=r):(null===p||p>r)&&(p=r))}i.push([s,o])}return i},[]);if(!f.isEmpty()){for(f.sort(function(e,t){return e.last()-t.last()}),r=0,l=1===f.length?Number.MAX_VALUE:f.last().last(),i=0;i<f.length;i++)n=f[i],o=Math.abs(n.last()-l),o>180&&360>=o&&(o=360-o),o<this.minimalArrowAngle&&(i!==f.length-1||2!==f.length)?r++:(r=0,l=n.last()),this.createConnectionFeature(e,t,n.first(),n.last(),r,c,d,p,g),l=n.last();if(!c&&!this.showAllArrows){var y=e.geometry,v=new OpenLayers.Marker(new OL.LonLat(y.x,y.y),new a("unlocked-badge"));this.conLayer.addMarker(v)}}},createConnectionFeature:function(e,t,i,n,s,r,o,l,h){var c,d=t.isTurnAllowed(i,e),p=t.getID()===i.getID(),m=(t.getRestrictionsAtNode(e)||{})[i.getID()],g=m&&m.length;if(!(this.showAllArrows&&(d&&!g||p)||p&&(this.conLayer.map.getScale()>this.uturnMaxScale||h<=this.uturnMinSegmentLength))){c=e.isAllowed(d?u.Nodes.EDIT_CLOSE_TURNS:u.Nodes.EDIT_OPEN_TURNS),(!this.offsetArrows||p)&&(s=0),p&&(this.model.isLeftHand&&null!==l&&(s=(90-l)/90),this.model.isLeftHand||null===o||(s=(90-o)/90));var f,y=this.conLayer.map.getResolution(),v=(this.arrowDistanceFromNodeInPixels+this.arrowHeight*s)*y,b=(450-n)%360,L=n.toRad(),w=new OpenLayers.LonLat(e.geometry.x+Math.cos(L)*v,e.geometry.y+Math.sin(L)*v),S=new OpenLayers.Marker(w,new a("connection-arrow")),C=$("<div />").appendTo(S.icon.$div);if(p){var O=L-Math.PI/2,E=this.uturnArrowOffsetInPixels*y;this.model.isLeftHand&&(O+=Math.PI,C.addClass("lefthand")),w.lon+=Math.cos(O)*E,w.lat+=Math.sin(O)*E}W.Config.restrictions.allowEditing&&r&&d&&(f=$("<div />").addClass("restrictions").css("transform","rotate("+-b+"deg)").appendTo(C)),C.addClass("arrow").css("transform","rotate("+b+"deg)"),g&&d?(C.addClass("restricted"),$("<div />").addClass("restriction-badge").appendTo(C).css("transform","rotate("+-b+"deg)")):C.addClass(d?"open":"closed"),C.toggleClass("uturn",p),d||C.append($("<div />").addClass("closed-badge").css("transform","rotate("+-b+"deg)")),this.showArrows||S.icon.$div.addClass("disabled"),C.data("model",{node:e,fromSeg:t,toSeg:i,locked:r,value:d,modifiable:c}),this.conLayer.addMarker(S)}},zoomChanged:function(){this.resetConnections()},CLASS_NAME:"Waze.Control.EditNodeConnections"}),i.exports=n}}),this.require.define({"Waze/Control/GeometryEditing":function(e,t,i){var n,s=t("Waze/Control/SelectHighlightFeature"),r=t("Waze/Control/ModifyModelFeature"),o=t("Waze/Control/Toolbar"),a=t("Waze/Control/EditNodeConnections"),l=t("Waze/Control/BridgeCreator"),h=t("Waze/Control/NodeCreator"),u=t("Waze/VectorStyles/All"),c=t("Waze/Control/GeometryEditing/Camera"),d=t("Waze/Control/GeometryEditing/Landmark");n=OpenLayers.Class({selectionManager:null,modifyControl:null,selectControl:null,editors:null,activeEditor:null,initialize:function(e){this.selectionManager=e,this.selectionManager.events.register("selectionchanged",this,this.onSelectionChanged),this.initControls(),this.initEditors(),this.initDrawingToolbar(),W.editingMediator.on("change:editingEnabled",this._onEditingEnabledChanged,this),W.editingMediator.on("change:advancedTools",this._onAdvancedToolsChanged,this)},_onAdvancedToolsChanged:function(){var e=W.editingMediator.get("advancedTools");e?this.modifyControl.enableAdvancedTools():this.modifyControl.disableAdvancedTools()},_onEditingEnabledChanged:function(){var e=W.editingMediator.get("editingEnabled");e?(this.selectControl.activate(),this.toolbar.enable()):(this.selectControl.unselectAll(),this.selectControl.deactivate(),this.toolbar.disable())},initControls:function(){var e=W.map;this.selectControl=new s([e.sketchLayer,e.segmentLayer,e.nodeLayer,e.landmarkLayer,e.camerasLayer,e.archiveLayer],{clickout:!0,toggle:!0,deselectKey:OpenLayers.Event.KEY_ESC,multiple:!1,multipleKeys:["metaKey","ctrlKey"],boxMask:OpenLayers.Handler.MOD_CTRL|OpenLayers.Handler.MOD_SHIFT,box:!0,boxSelectionLayers:[e.segmentLayer]}),W.map.addControl(this.selectControl),this.modifyControl=new r(W.model,e.sketchLayer,e.segmentLayer,e.nodeLayer,[e.landmarkLayer,e.camerasLayer,e.archiveLayer],{mode:OpenLayers.Control.ModifyFeature.RESHAPE,virtualStyle:u.virtualVertices,standalone:!0,selectControl:this.selectControl}),this.selectionManager.setSelectControl(this.selectControl),W.map.addControl(this.selectControl),W.map.addControl(this.modifyControl),this.modifyControl.activate(),this.editNodeConsControl=new a,this.bridgeControl=new l,this.newNodeControl=new h,W.map.addControls([this.editNodeConsControl,this.bridgeControl,this.newNodeControl]),this.editNodeConsControl.activate(),this.bridgeControl.activate(),this.newNodeControl.activate()},initEditors:function(){this.editors={},this.editors.venue=new d(W.map.landmarkLayer,{virtualStyle:u.virtualVertices,repo:W.model.venues,model:W.model}),W.map.addControl(this.editors.venue),this.editors.venue.activate(),this.editors.camera=new c(W.map.camerasLayer,{repo:W.model.cameras,model:W.model}),W.map.addControl(this.editors.camera),this.editors.camera.activate(),this.editors.segment=this.modifyControl,this.editors.node=this.modifyControl},initDrawingToolbar:function(){this.toolbar=new o($("#edit-buttons"),this.modifyControl.snapControl),W.map.addControl(this.toolbar),this.toolbar.activate(),this.toolbar.disable()},onSelectionChanged:function(e){var t=e.selected,i=Object.keys(this.selectionManager.selectionCountByType),n=null;this.activeEditor&&(this.activeEditor.unselectFeature(),this.activeEditor=null),i.isEmpty()||(n=this.editors[i.first()]),n&&(this.activeEditor=n,1===t.length&&(t=t.first()),n.selectFeature(t,e.reversedSegments))},CLASS_NAME:"W.Control.GeometryEditing"}),i.exports=n}}),

this.require.define({"Waze/Control/GeometryEditing/Camera":function(e,t,i){(function(){var e,n,s,r;n=t("Waze/Control/GeometryEditing/Feature"),r=t("Waze/Action/UpdateObject"),s=t("Waze/Action/UpdateFeatureGeometry"),e=OL.Class(n,{standalone:!0,mode:OL.Control.ModifyFeature.DRAG|OL.Control.ModifyFeature.ROTATE,RadiusHandleDistance:50,dragBoundary:null,MaxDragDistance:150,initialize:function(){n.prototype.initialize.apply(this,arguments),this.dragControl.handlers.feature.geometryTypeMatches=function(e){return e._sketch}},resetVertices:function(){return this.dragControl.feature&&this.dragControl.outFeature(this.dragControl.feature),this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),this.dragHandle=null),this.removeDragBoundary(),this.removeRadiusHandle(),this.feature?(this.cameraDraggable()&&this.collectDragHandle(),this.feature.model.isGeometryEditable()&&this.collectRadiusHandle(),this._originalGeometry=this.feature.geometry.clone()):void 0},removeDragBoundary:function(){return this.dragBoundary?(this.layer.destroyFeatures([this.dragBoundary],{silent:!0}),this.dragBoundary=null):void 0},removeRadiusHandle:function(){return this.radiusHandle?(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null):void 0},cameraDraggable:function(){return this.feature.model.isGeometryEditable()&&this.map.getZoom()>=W.Config.cameras.minDragZoom},collectDragHandle:function(){var e,t,i,n,s,r,o;return t=this.feature.geometry,o=this.map.getResolution(),s=new OL.Geometry.Point(t.x,t.y),n=new OL.Feature.Vector(s),this.feature.model.attributes.originalPosition||(this.feature.model.attributes.originalPosition=new OL.Geometry.Point(t.x,t.y)),r=this.feature.model.attributes.originalPosition,this.dragBoundary=new OL.Feature.Vector(r.clone(),{},{pointRadius:this.MaxDragDistance/o,fillOpacity:.2,pointerEvents:"none"}),i=this.layer,e=this.MaxDragDistance,s.move=function(i,n){var s,o;return o={x:this.x+i,y:this.y+n},s=Math.sqrt(Math.pow(o.y-r.y,2)+Math.pow(o.x-r.x,2)),OL.Geometry.Point.prototype.move.apply(this,arguments),e>s?(t.x=o.x,t.y=o.y,t.clearBounds()):void 0},this.dragHandle=n,n._sketch=!0,n._cameraAnchor=!0,this.layer.addFeatures([this.dragHandle,this.dragBoundary],{silent:!0})},collectRadiusHandle:function(){var e,t,i,n,s,r;return t=this.feature,i=t.geometry,e=(t.model.attributes.azymuth-90).toRad(),n=new OL.Geometry.Point(i.x,i.y),r=new OL.Geometry.Point(i.x+this.RadiusHandleDistance*this.map.getResolution()*Math.cos(e),i.y-this.RadiusHandleDistance*this.map.getResolution()*Math.sin(e)),s=new OL.Feature.Vector(r),this.originalAngle=t.model.attributes.azymuth,r.move=function(i,s){var r,o;return OL.Geometry.Point.prototype.move.call(this,i,s),r=this.x-n.x,o=this.y-n.y,e=Math.atan2(o,r),t.model.attributes.azymuth=450-e.toDeg()},s._sketch=!0,s._cameraRotator=!0,this.radiusHandle=s,this.layer.addFeatures([this.radiusHandle],{silent:!0})},dragVertex:function(e){var t;return t=e===this.dragHandle,t&&this.removeRadiusHandle(),this.layer.drawFeature(this.feature)},dragComplete:function(e){var t;return e===this.radiusHandle?(t=this.feature.model.attributes.azymuth,this.feature.model.attributes.azymuth=this.originalAngle,this.layer.events.triggerEvent("featuremodified",{feature:this.feature,rotated:!0,newAngle:t})):this.layer.events.triggerEvent("featuremodified",{feature:this.feature,newAngle:t}),this.resetVertices()},onModified:function(e){this.model.actionManager.add(e.rotated?new r(e.feature.model,{azymuth:e.newAngle}):new s(e.feature.model,this.repo,this._originalGeometry.clone(),e.feature.geometry.clone()))},unselectFeature:function(){return this.removeDragBoundary(),n.prototype.unselectFeature.apply(this,arguments)},CLASS_NAME:"Waze.Control.GeometryEditing.Camera"}),i.exports=e}).call(this)}}),this.require.define({"Waze/Control/GeometryEditing/Feature":function(e,t,i){var n=OL.Class(OL.Control.ModifyFeature,{initialize:function(){OpenLayers.Control.ModifyFeature.prototype.initialize.apply(this,arguments),this.repo.events.on({objectschanged:this.onChanged,objectsremoved:this.onRemoved,scope:this}),this.layer.events.on({featuremodified:this.onModified,scope:this})},selectFeature:function(e){var t=this.feature,i=t!==e;i&&this.onActivate(),OL.Control.ModifyFeature.prototype.selectFeature.apply(this,arguments),i&&this.map.events.register("zoomend",this,this.onMapZoom)},unselectFeature:function(){this.isActive()&&(this.onDeactivate(),this.map.events.unregister("zoomend",this,this.onMapZoom)),OL.Control.ModifyFeature.prototype.unselectFeature.apply(this,arguments)},onMapZoom:function(){this.isActive()&&this.resetVertices()},setFeatureState:function(){var e=this.feature;e.modified=OpenLayers.Util.extend(e.modified,{geometry:this._originalGeometry}),delete this._originalGeometry},isActive:function(){return null!==this.feature},onActivate:function(){},onDeactivate:function(){},onChanged:function(){this.isActive()&&(this.feature&&(this._originalGeometry=this.feature.geometry.clone()),this.resetVertices())},onRemoved:function(e){this.isActive()&&e.contains(this.feature)&&this.unselectFeature(this.feature)},onModified:function(){},CLASS_NAME:"Waze.Control.GeometryEditing.Feature"});i.exports=n}}),this.require.define({"Waze/Control/GeometryEditing/Landmark":function(e,t,i){(function(){var e,n,s,r,o;e=t("Waze/Control/GeometryEditing/Feature"),o=t("Waze/Action/UpdateObject"),r=t("Waze/Action/UpdateFeatureGeometry"),s=t("Waze/Control/GeometryEditing/NavigationPoint"),n=OL.Class(e,{standalone:!0,MIN_COMPONENTS:4,initialize:function(){e.prototype.initialize.apply(this,arguments),this.mode=OL.Control.ModifyFeature.RESHAPE|OL.Control.ModifyFeature.DRAG,this.dragControl.handlers.feature.geometryTypeMatches=function(e){var t;return e._sketch||(null!=(t=e.model)?t.isSelected():void 0)}},onModified:function(e){var t;return t=e.feature,this.model.actionManager.add(new r(t.model,this.repo,t.modified.geometry,t.geometry)),delete t.modified,this.selectFeature(e.feature)},handleKeypress:function(t){var i,n,s;return this.feature&&this.deleteCodes.contains(t.keyCode)?(i=this.dragControl.feature,(null!=i&&null!=(n=i.geometry)&&null!=(s=n.parent)?s.components.length:void 0)>this.MIN_COMPONENTS?e.prototype.handleKeypress.apply(this,arguments):void 0):e.prototype.handleKeypress.apply(this,arguments)},onActivate:function(){return null==this.markerLayer&&(this.markerLayer=new OL.Layer.Markers("navigationPointMarkers",{displayInLayerSwitcher:!1})),this.map.addLayer(this.markerLayer)},onDeactivate:function(){return this.removeNavigationPoint(),this.removeDragBoundry(),null!=this.markerLayer?this.map.removeLayer(this.markerLayer):void 0},shouldShowNavigationPoint:function(){return this.map.getZoom()>=W.Config.venues.navigationPoint.minDisplayZoom},resetVertices:function(){var t;return e.prototype.resetVertices.apply(this,arguments),this.feature.model.isPoint()||!this.shouldShowNavigationPoint()?void this.removeNavigationPoint():(t=this.feature.model.getNavigationPoint().point.toLonLat(),this.navigationPoint||(this.navigationPoint=new s(t,this.feature.geometry,this.map),this.navigationPoint.layer=this.markerLayer,this.navigationPoint.events.register("dragEnd",this,this.onNavigationPointChange),this.navigationPoint.events.register("drag",this,this.onNavigationPointDrag),this.markerLayer.addMarker(this.navigationPoint)),this.navigationPoint.setLandmarkGeometry(this.feature.geometry),this.navigationPoint.lonlat=t,this.markerLayer.drawMarker(this.navigationPoint))},onNavigationPointChange:function(){var e,t;return t={point:this.navigationPoint.lonlat.toPoint(),entry:!0,exit:!0},e=new o(this.feature.model,{entryExitPoints:[t]}),e.eachGeometryField=function(e,t){var i,n,s,r,o;for(r=e.entryExitPoints,o=[],n=0,s=r.length;s>n;n++)i=r[n],o.push(t.call(this,"point",i.point,i));return o},this.removeDragBoundry(),this.model.actionManager.add(e)},onNavigationPointDrag:function(){return this.dragBoundary?void 0:this.addDragBoundry()},addDragBoundry:function(){return this.dragBoundary=new OL.Feature.Vector(this.navigationPoint.dragBounds.toGeometry(),{},{fillOpacity:.2,pointerEvents:"none"}),this.layer.addFeatures([this.dragBoundary],{silent:!0})},removeDragBoundry:function(){return this.dragBoundary&&this.layer.removeFeatures([this.dragBoundary],{silent:!0}),this.dragBoundary=null},removeNavigationPoint:function(){return null!=this.navigationPoint?(this.markerLayer.removeMarker(this.navigationPoint),this.navigationPoint.destroy(),this.navigationPoint=null):void 0},collectDragHandle:function(){var e,t,i;return e=_.max(this.feature.geometry.getVertices(),function(e){return e.y}),i=new OpenLayers.Geometry.Point(e.x,e.y+30*this.map.getResolution()),t=new OpenLayers.Feature.Vector(i),i.move=function(e){return function(t,n){return OpenLayers.Geometry.Point.prototype.move.call(i,t,n),e.feature.geometry.move(t,n)}}(this),t.dragPoint=!0,t._sketch=!0,this.dragHandle=t,this.layer.addFeatures([this.dragHandle],{silent:!0})}}),i.exports=n}).call(this)}}),this.require.define({"Waze/Control/GeometryEditing/NavigationPoint":function(e,t,i){(function(){var e,n,s,r;n=t("Waze/Handler/DragElement"),e=t("Waze/DivIcon"),s=t("Waze/Utils/Geo"),r=OL.Class(OL.Marker,{dragging:null,dragConstraint:null,MAX_DISTANCE_FROM_LANDMARK_METERS:50,initialize:function(t,i,s){var r;this.map=s,r=new e("navigation-point icon-screenshot"),OL.Marker.prototype.initialize.call(this,t,r),this.setLandmarkGeometry(i),this.dragging=new n(this.map),this.dragging.down=function(e){return function(t){return e.icon.$div.addClass("dragging"),e.events.triggerEvent("dragStart",{xy:null!=t?t.xy:void 0,marker:e})}}(this),this.dragging.move=function(e){return function(i){return t=e.map.getLonLatFromViewPortPx(i.xy),e.dragBounds.containsLonLat(t)||(t.lon<e.dragBounds.left&&(t.lon=e.dragBounds.left),t.lon>e.dragBounds.right&&(t.lon=e.dragBounds.right),t.lat>e.dragBounds.top&&(t.lat=e.dragBounds.top),t.lat<e.dragBounds.bottom&&(t.lat=e.dragBounds.bottom)),e.lonlat=t,e.layer.drawMarker(e),e.events.triggerEvent("drag",{xy:i.xy,marker:e})}}(this),this.dragging.done=function(e){return function(t){return e.icon.$div.removeClass("dragging"),e.events.triggerEvent("dragEnd",{xy:null!=t?t.xy:void 0,marker:e})}}(this),this.dragging.activate(this.icon.$div)},setLandmarkGeometry:function(e){var t,i,n,r;return t=e.getBounds().clone(),r=new OL.LonLat(t.left,t.top),r.transform(this.map.getProjectionObject(),this.map.displayProjection),i=s.destinationOnPlane(r,0,this.MAX_DISTANCE_FROM_LANDMARK_METERS),n=s.destinationOnPlane(r,90,this.MAX_DISTANCE_FROM_LANDMARK_METERS),i.transform(this.map.displayProjection,this.map.getProjectionObject()),n.transform(this.map.displayProjection,this.map.getProjectionObject()),i=i.lon-t.left,n=n.lat-t.top,t.left-=i,t.right+=i,t.top+=n,t.bottom-=n,this.dragBounds=t},destroy:function(){return OL.Marker.prototype.destroy.apply(this,arguments),this.dragging.deactivate()}}),i.exports=r}).call(this)}}),this.require.define({"Waze/Control/GooglePermalink":function(e,t,i){(function(){var e;e=OL.Class(OL.Control,{googleAerialLayer:null,$div:null,$link:null,destroy:function(){return this.map.events.un({changelayer:this.toggleVisibility,scope:this}),OL.Control.prototype.destroy.apply(this,arguments)},draw:function(){return OL.Control.prototype.draw.apply(this,arguments),this.map.events.on({changelayer:this.toggleVisibility,scope:this}),this.$div=$(this.div).addClass("google-permalink"),this.$link=$("<a/>").attr({target:"blank",href:"http://maps.google.com"}).appendTo(this.$div),this.div},toggleVisibility:function(){var e,t;return e=this.map.baseLayer,t=e&&e.getVisibility(),this.$div.toggle(t)}}),i.exports=e}).call(this)}}),this.require.define({"Waze/Control/HouseNumbers":function(e,t,i){(function(){var e,n,s,r,o,a,l,h,u,c,d={}.hasOwnProperty;r=t("Waze/Marker/HouseNumber"),o=t("Waze/Feature/HouseNumber/Number"),c=t("Waze/Action/UpdateHouseNumberGeometry"),u=t("Waze/Action/UpdateHouseNumber"),s=t("Waze/Action/HouseNumber"),h=t("Waze/Action/MultiAction"),l=t("Waze/Presenter/HouseNumbersLightbox"),e=t("Waze/Renderer/ExtendedSVG"),n=t("Waze/Marker/FractionPoint"),a=OL.Class(OL.Control,{MIN_EDIT_ZOOM:6,SAVE_ERROR_CODE:716,model:null,segments:null,houseNumberSets:null,layer:null,markerLayer:null,fractionPoint:null,fractionLine:null,originalGeometry:null,updating:!1,lightboxView:null,fogOfWar:null,selectedNumber:null,invalidHouseNumbers:null,failedLoading:!1,enabled:!0,segmentStyle:{fill:{strokeColor:"#00d8ff",strokeWidth:7,graphicZIndex:2},outline:{graphicZIndex:1,strokeColor:"#00a8ff",strokeWidth:11}},editAreaStyle:{maskID:"HNAreaMask",fillColor:"black",graphicZIndex:1},fractionLineStyle:{strokeWidth:2,strokeColor:"white",strokeDashstyle:"dash",strokeDashArray:"8, 8"},fractionLinePaddingStyle:{strokeWidth:4,strokeColor:"#000",strokeOpacity:.5,strokeDashstyle:"dash",strokeDashArray:"8, 8"},initialize:function(t,i){OL.Control.prototype.initialize.call(this,i),this.model=t,this.lightboxView=new l({model:this.model,pm:this}),this.lightboxView.olEvents.register("closed",this,function(){return this.events.triggerEvent("editingCancelled",{}),this.deactivate()}),this.lightboxView.onSave=function(e){return function(){return e.onSave()}}(this),this.lightboxView.onAdd=function(e){return function(){return e.onAddClicked()}}(this),this.lightboxView.onCancel=function(e){return function(){return e.onCancelClicked()}}(this),this.layer=new OL.Layer.Vector("houseNumbers",{displayInLayerSwitcher:!1,renderers:[e],rendererOptions:{zIndexing:!0}}),this.markerLayer=new OL.Layer.Markers("houseNumberMarkers",{displayInLayerSwitcher:!1}),this.events.addEventType("editingCancelled")},setSegments:function(e,t){var i,n,s,r;return this.editable=t,this.enabled=this.editable,this.failedLoading=!1,this.lightboxView.disabled=!this.editable,this.segments=e,i=function(){var e,t,i,r;for(i=this.segments,r=[],e=0,t=i.length;t>e;e++)s=i[e],n=s.geometry.clone(),n.model=s,r.push(n);return r}.call(this),this.joinedGeometry=new OL.Geometry.MultiLineString(i),r=function(){var e,t,i,n;for(i=this.segments,n=[],e=0,t=i.length;t>e;e++)s=i[e],n.push(s.getID());return n}.call(this),this.model.houseNumbers.get(r).done(function(e){return function(t){var i,n,s;if(e.active){for(e.houseNumberSets={},n=0,s=t.length;s>n;n++)i=t[n],e.houseNumberSets[i.id]=i;return e.render()}}}(this)).fail(function(e){return function(){return e.failedLoading=!0,e.lightboxView.render(),e.lightboxView.showErrorMessage()}}(this)).always(function(e){return function(){return e.lightboxView.setLoading(!1)}}(this)),this.lightboxView.address=this.segments.first().getAddressDetails(),this.activate(),this.lightboxView.setLoading(!0)},onDrag:function(){return this.selectedNumber.model.calculateProjection(this.joinedGeometry),this.fractionPoint.lonlat=this.selectedNumber.model.projectionLonLat,this.selectedNumber.updateSide(),this.markerLayer.drawMarker(this.fractionPoint),this.selectedNumber.icon.forceReflow(),this.fractionLine.geometry.components[0].x=this.fractionPoint.lonlat.lon,this.fractionLine.geometry.components[0].y=this.fractionPoint.lonlat.lat,this.fractionLine.geometry.components[1].x=this.selectedNumber.lonlat.lon,this.fractionLine.geometry.components[1].y=this.selectedNumber.lonlat.lat,this.fractionLinePadding.geometry.components[0].x=this.fractionPoint.lonlat.lon,this.fractionLinePadding.geometry.components[0].y=this.fractionPoint.lonlat.lat,this.fractionLinePadding.geometry.components[1].x=this.selectedNumber.lonlat.lon,this.fractionLinePadding.geometry.components[1].y=this.selectedNumber.lonlat.lat,this.layer.drawFeature(this.fractionLinePadding),this.layer.drawFeature(this.fractionLine)},onDragEnd:function(){var e,t;if(!this.selectedNumber.isNew)return t=new OL.Geometry.Point(this.selectedNumber.lonlat.lon,this.selectedNumber.lonlat.lat),e=new h,this.model.actionManager.add(e),this.ignoreUpdates(function(i){return function(){var n,r;return i.selectedNumber.model.changedSegment()&&(r=i.houseNumberSets[i.selectedNumber.model.closestSegment.getID()],n=new s.ReplaceHouseNumberSegment(i.selectedNumber.model,r),i.selectedNumber.model.geometry=i.originalGeometry.clone(),e.doSubAction(n),i.selectedNumber.model=n.newHouseNumber),e.doSubAction(new c(i.selectedNumber.model,i.originalGeometry,t)),e.doSubAction(new u(i.selectedNumber.model.parent,i.selectedNumber.model,{forced:!1,valid:!0})),i.selectedNumber.setValid(!0),i.selectedNumber.setForced(!1)}}(this)),this.originalGeometry=t.clone()},reset:function(){var e,t,i,n;for(this.adding&&null!=this.selectedNumber&&this.selectedNumber.dragging.forceEnd(),this.adding=!1,n=this.markerLayer.markers,t=0,i=n.length;i>t;t++)e=n[t],e.destroy();return this.markerLayer.clearMarkers(),this.fractionPoint=null,this.layer.destroyFeatures(this.layer.features),this.editArea=null},render:function(){var e,t,i,n,s,r,o;if(!this.updating&&this.active){this.reset(),r=this.houseNumberSets;for(i in r)if(d.call(r,i))for(e=r[i],o=e.numbers,n=0,s=o.length;s>n;n++)t=o[n],this.createHouseNumber(t);return this.drawFogOfWar(),this.drawEditArea(),this.drawSegments()}},drawSegments:function(){var e,t,i;return t=function(){var t,i,n,s;for(n=this.segments,s=[],t=0,i=n.length;i>t;t++)e=n[t],s.push(new OL.Feature.Vector(e.geometry.clone(),{},this.segmentStyle.outline));return s}.call(this),i=function(){var t,i,n,s;for(n=this.segments,s=[],t=0,i=n.length;i>t;t++)e=n[t],s.push(new OL.Feature.Vector(e.geometry.clone(),{},this.segmentStyle.fill));
return s}.call(this),this.layer.addFeatures(t),this.layer.addFeatures(i)},drawEditArea:function(){var e,t;return this.editAreas=function(){var i,n;i=this.houseNumberSets,n=[];for(t in i)d.call(i,t)&&(e=i[t],n.push(new OL.Feature.Vector(e.editArea,{},this.editAreaStyle)));return n}.call(this),this.layer.addFeatures(this.editAreas)},createHouseNumber:function(e){var t;return e.calculateProjection(this.joinedGeometry),t=new r(e,new OL.LonLat(e.geometry.x,e.geometry.y),this.map),this.markerLayer.addMarker(t),t.events.register("click:input",this,this.onMarkerClick),t.events.register("change:number",this,this.onValueChanged),t.events.register("delete",this,this.onMarkerDelete),t.events.register("unselect",null,function(e){return function(){return e.unselectNumber(e.selectedNumber)}}(this)),t.events.register("drag",this,this.onDrag),t.events.register("dragEnd",this,this.onDragEnd),t.layer=this.markerLayer,t},onValueChanged:function(e){var t,i;if(i=e.number,t=e.object,t.isNew&&""!==i)t.model.number=i,delete t.isNew,t.model.geometry=new OL.Geometry.Point(t.lonlat.lon,t.lonlat.lat),this.model.actionManager.add(new s.AddHouseNumber(t.model.parent,t.model));else if(""!==i)return this.model.actionManager.add(new u(t.model.parent,t.model,{number:i,forced:!1,valid:!0}))},onMarkerDelete:function(e){var t;return t=e.object,this.unselectNumber(t),t.isNew?this.cancelAdd():this.model.actionManager.add(new s.DeleteHouseNumber(t.model.parent,t.model))},onMarkerClick:function(e){var t;return t=e.object,this.selectNumber(t)},selectNumber:function(e){var t;if(this.enabled&&this.selectedNumber!==e)return this.unselectNumber(this.selectedNumber),this.selectedNumber=e,t=this.selectedNumber.model.fractionPoint.clone(),this.fractionPoint=new n(new OL.LonLat(t.x,t.y),this.joinedGeometry,this.map),this.markerLayer.addMarker(this.fractionPoint),this.fractionPoint.dragging.activate(this.fractionPoint.icon.$div),this.fractionPoint.layer=this.markerLayer,this.selectedNumber.icon.bringToFront(),this.selectedNumber.focus(),this.selectedNumber.setActive(!0),this.selectedNumber.dragging.activate(this.selectedNumber.icon.$div.find(".drag-handle")),this.originalGeometry=this.selectedNumber.model.geometry.clone(),this.fractionPoint.events.register("dragEnd",this,this.onFractionPointDragEnd),this.fractionPoint.events.register("drag",this,this.onFractionPointDrag),this.lightboxView.setLastEditedUser(this.selectedNumber.model.updatedBy),this.fractionLine=new OL.Feature.Vector(new OL.Geometry.LineString([new OL.Geometry.Point(t.x,t.y),new OL.Geometry.Point(this.originalGeometry.x,this.originalGeometry.y)]),{},this.fractionLineStyle),this.fractionLinePadding=new OL.Feature.Vector(new OL.Geometry.LineString([new OL.Geometry.Point(t.x,t.y),new OL.Geometry.Point(this.originalGeometry.x,this.originalGeometry.y)]),{},this.fractionLinePaddingStyle),this.layer.addFeatures([this.fractionLinePadding,this.fractionLine])},onFractionPointDrag:function(){return this.fractionLine.geometry.components[0].x=this.fractionPoint.lonlat.lon,this.fractionLine.geometry.components[0].y=this.fractionPoint.lonlat.lat,this.fractionLinePadding.geometry.components[0].x=this.fractionPoint.lonlat.lon,this.fractionLinePadding.geometry.components[0].y=this.fractionPoint.lonlat.lat,this.fractionPoint.icon.forceReflow(),this.layer.drawFeature(this.fractionLinePadding),this.layer.drawFeature(this.fractionLine)},onFractionPointDragEnd:function(){var e;e=new OL.Geometry.Point(this.fractionPoint.lonlat.lon,this.fractionPoint.lonlat.lat),this.selectedNumber.isNew?this.selectedNumber.model.fractionPoint=e:this.ignoreUpdates(function(e){return function(){var t,i,n;return t=new h,e.model.actionManager.add(t),i=e.houseNumberSets[e.fractionPoint.closestSegment.getID()],n=new s.UpdateFractionPoint(e.selectedNumber.model,i,e.fractionPoint),t.doSubAction(n),e.selectedNumber.model=n.newHouseNumber,t.doSubAction(new u(e.selectedNumber.model.parent,e.selectedNumber.model,{forced:!1,valid:!0})),e.selectedNumber.setValid(!0),e.selectedNumber.setForced(!1)}}(this))},ignoreUpdates:function(e){return this.updating=!0,e(),this.updating=!1},unselectNumber:function(e){var t;if(null!=e)return e.dragging.deactivate(),e.setActive(!1),this.selectedNumber=null,this.lightboxView.setLastEditedUser(null),this.fractionPoint&&(this.fractionPoint.events.unregister("dragEnd",this,this.onFractionPointDragEnd),this.fractionPoint.events.unregister("drag",this,this.onFractionPointDrag),this.markerLayer.removeMarker(this.fractionPoint)),this.fractionLine&&this.layer.destroyFeatures([this.fractionLine,this.fractionLinePadding]),""===e.input.val()?e.isNew?this.markerLayer.removeMarker(e):(t=e.input.get(0).valueAsNumber,isNaN(t)?e.input.val(e.model.number):this.model.actionManager.add(new s.DeleteHouseNumber(e.model.parent,e.model))):e.isNew?(e.model.number=e.input.val(),delete e.isNew,this.model.actionManager.add(new s.AddHouseNumber(e.model.parent,e.model))):void 0},setMap:function(){return OL.Control.prototype.setMap.apply(this,arguments),this.map.addLayer(this.layer),this.map.addLayer(this.markerLayer),$(this.markerLayer.div).addClass("house-numbers-layer")},onAddClicked:function(){var e,t;if(!this.adding&&this.enabled)return this.adding=!0,t=new o({number:"",geometry:new OL.Geometry.Point(0,0),fractionPoint:new OL.Geometry.Point(0,0),forced:!1}),e=this.createHouseNumber(t),t.parent=this.houseNumberSets[t.closestSegment.getID()],e.setNew(!0),e.isNew=!0,e.dragging.forceStart(),this.selectNumber(e),e.events.register("click:input",this,this.onAddEnd)},cancelAdd:function(){return this.adding?(this.adding=!1,this.selectedNumber.dragging.forceEnd(),this.unselectNumber(this.selectedNumber)):void 0},onAddEnd:function(e){var t,i;return t=e.object,i=new OL.Geometry.Point(t.lonlat.lon,t.lonlat.lat),this.editAreas.some(function(e){return e.geometry.containsPoint(i)})?(this.adding=!1,t.dragging.forceEnd(),t.model.geometry=i,t.model.fractionPoint=t.model.getFractionFromProjection(),t.model.parent=this.houseNumberSets[t.model.closestSegment.getID()],t.setNew(!1),t.events.unregister("click:input",this,this.onAddEnd),t.focus()):void 0},onMapClick:function(){return null!=this.selectedNumber?this.unselectNumber(this.selectedNumber):void 0},activate:function(){return OL.Control.prototype.activate.apply(this,arguments)?(W.editingMediator.set("editingEnabled",!1),this.map.showLightbox(this.lightboxView),this.map.events.register("click",this,this.onMapClick),this.map.events.register("moveend",this,this.drawFogOfWar),this.map.events.register("zoomend",this,this.onZoomChanged),this.onZoomChanged(),this.model.houseNumbers.events.register("objectschanged",this,this.render),W.controller.events.on({saveend:this.onSaveEnd,savestart:this.onSaveStart,scope:this}),W.track("enter_hn_mode")):void 0},deactivate:function(){return OL.Control.prototype.deactivate.apply(this,arguments)?(W.editingMediator.set("editingEnabled",!0),this.model.actionManager.clear(),this.map.events.unregister("click",this,this.onMapClick),this.map.events.unregister("moveend",this,this.drawFogOfWar),this.map.events.unregister("zoomend",this,this.onZoomChanged),this.model.houseNumbers.events.unregister("objectschanged",this,this.render),W.controller.events.un({saveend:this.onSaveEnd,savestart:this.onSaveStart,scope:this}),this.invalidHouseNumbers=null,this.reset()):void 0},drawFogOfWar:function(){return this.fogOfWar&&this.layer.destroyFeatures(this.fogOfWar),this.fogOfWar=new OL.Feature.Vector(this.map.getExtent().toGeometry(),{},{fillColor:"black",fillOpacity:.5,strokeWidth:0,mask:"url(#HNAreaMask)"}),this.layer.addFeatures(this.fogOfWar),this.layer.redraw()},onSave:function(){return W.track("save_hn"),this.saveChanges()},saveChanges:function(){return W.controller.save(),this.lightboxView.setLoading(!0)},onCancelClicked:function(){return this.lightboxView.close(),this.events.triggerEvent("editingCancelled",{})},onSaveEnd:function(e){var t,i,n,s,r;if(this.lightboxView.setLoading(!1),e.response.code===this.SAVE_ERROR_CODE){if(this.invalidHouseNumbers=e.response.objects,this.lightboxView.showSaveErrorMessage(),null!=this.invalidHouseNumbers)for(r=this.invalidHouseNumbers,n=0,s=r.length;s>n;n++)i=r[n],t=this.houseNumberSets[i.segID].getNumber(i.id),i.model=t,t.valid=!1,t.invalidCode=i.errorType;return this.render()}return e.success?(this.enabled=!0,this.lightboxView.enable(),this.lightboxView.showSuccessMessage(),this.setSegments(this.segments,this.editable)):void 0},onSaveStart:function(){return this.unselectNumber(this.selectedNumber),this.enabled=!1,this.lightboxView.disable()},editingAllowedInZoom:function(){return this.map.getZoom()>=W.Config.houseNumbers.minEditZoom},onZoomChanged:function(){return $(this.markerLayer.div).toggleClass("preview",!this.editingAllowedInZoom()),this.editingAllowedInZoom()||(this.cancelAdd(),this.unselectNumber(this.selectedNumber)),this.lightboxView.render()},canForcedInvalid:function(){return Object.values(this.houseNumberSets).every(function(e){var t;return t=e.getSegment(),null!=t&&t.canForceHouseNumbers()})},continueEditing:function(){return this.enabled=!0,this.lightboxView.enable()},forceInvalid:function(){return this.invalidHouseNumbers.isEmpty()||this.ignoreUpdates(function(e){return function(){var t,i,n,s,r,o;for(t=new h,e.model.actionManager.add(t),r=e.invalidHouseNumbers,o=[],n=0,s=r.length;s>n;n++)i=r[n],o.push(t.doSubAction(new u(i.model.parent,i.model,{forced:!0})));return o}}(this)),this.saveChanges()},CLASS_NAME:"W.Control.HouseNumbers"}),i.exports=a}).call(this)}}),this.require.define({"Waze/Control/KeyboardShortcuts":function(e,t,i){(function(){var e,t;t=OpenLayers.Class({LocalStorageKey:"keyboardShortcuts",shortcutToAction:null,events:null,_futureShortcutsByAction:{},SpecialKeys:{32:"Space",38:"\u2191",39:"\u2192",40:"\u2193",37:"\u2190",9:"Tab",46:"Del",187:"=",189:"-"},$element:null,Modifiers:{C:1,S:2,A:4},BitToModifier:null,ModifierToBrowserEvent:null,BrowserEventToModifier:{altKey:"A",metaKey:"C",ctrlKey:"C",shiftKey:"S"},Groups:{default:{members:[]},navigation:{members:[]},editing:{members:[]},drawing:{members:[]},layers:{members:[]}},Actions:null,initialize:function(e){return this.shortcutToAction={},this.Actions={},this.$element=e?e:$(window),this.events=new OpenLayers.Events(this),this.registerActions()},activate:function(){return this.$element.bind("keydown.shortcuts",OpenLayers.Function.bind(this.onKeyDown,this))},addAction:function(e,t){var i;return t=t||{},OpenLayers.Util.applyDefaults(t,{changeable:!0,group:"default"}),t.name=e,i=this.Groups[t.group],i.members.push(t),t.id=e,this.Actions[e]=t,this.events.addEventType(e)},registerShortcut:function(t,i,n){var s,r;return null!=this._futureShortcutsByAction[i]&&(t=this._futureShortcutsByAction[i],n=!0,delete this._futureShortcutsByAction[i]),r=n?e.prototype.fromString(t):e.prototype.fromEmacsNotation(t),(i=this.Actions[i])?(s=this.shortcutToAction[r],s&&(delete this.shortcutToAction[s.shortcut],delete s.shortcut),i.shortcut&&delete this.shortcutToAction[i.shortcut],this.shortcutToAction[r]=i,i.shortcut=r):void 0},registerShortcuts:function(e){return Object.forEach(e,function(e){return function(t,i){return e.registerShortcut(t,i)}}(this))},registerDefaultShortcuts:function(e){return this.registerShortcuts({"S+191":"showShortcutsDialog","C+z":"undo","CS+z":"redo","C+s":"save","AS+r":"reloadData",i:"drawSegment",o:"drawRoundabout",u:"drawLandmark",y:"drawPlace",g:"drawGasStation",p:"drawParkingLot",l:"displayLayerSwitcher",s:"spreadArrows",a:"hideArrows","S+z":"showAllArrows","S+d":"colorEmptyStreets","S+w":"closeStreetView",q:"disallowAllConnections",w:"allowAllConnections",m:"toggleMultipleSelection","S+f":"toggleFullscreen",r:"toggleSegmentDirection",e:"editSegmentAddress",h:"editHouseNumbers",t:"editRestrictions","C+a":"selectEntireStreet","C+38":"increaseSegmentLevel","C+40":"decreaseSegmentLevel",38:"panUp",39:"panRight",40:"panDown",37:"panLeft","S+38":"zoomIn","S+40":"zoomOut",f:"search"}),W.Config.chat.enable&&this.registerShortcut("A+c","toggleChat"),e.layers.forEach(function(e){return function(t){return e.registerLayerShortcut(t)}}(this)),e.events.on({addlayer:function(e){return function(t){return e.registerLayerAction(t.layer),e.registerLayerShortcut(t.layer)}}(this)})},registerLayerShortcut:function(e){var t;if(e.accelerator){if(e.shortcutKey)t=e.shortcutKey;else{if(!e.uniqueName)return;t="S+"+e.uniqueName.charAt(0).toLowerCase()}return this.registerShortcut(t,e.accelerator)}},onKeyDown:function(t){var i,n;if(!$(t.target).is(":input"))return n=new e(t),i=this.shortcutToAction[n],i?(this.events.triggerEvent(i.id),!1):void 0},registerActions:function(){return this.addAction("undo"),this.addAction("redo"),this.addAction("save"),this.addAction("delete",{changeable:!1}),this.addAction("search"),this.addAction("reloadData"),this.addAction("drawSegment",{group:"drawing"}),this.addAction("drawPlace",{group:"drawing"}),this.addAction("drawLandmark",{group:"drawing"}),this.addAction("drawGasStation",{group:"drawing"}),this.addAction("drawParkingLot",{group:"drawing"}),this.addAction("drawRoundabout",{group:"drawing"}),this.addAction("displayLayerSwitcher",{group:"layers"}),this.addAction("spreadArrows",{group:"layers"}),this.addAction("hideArrows",{group:"layers"}),this.addAction("showAllArrows",{group:"layers"}),this.addAction("colorEmptyStreets",{group:"layers"}),this.addAction("closeStreetView",{group:"layers"}),W.Config.chat.enable&&this.addAction("toggleChat",{group:"layers"}),this.addAction("toggleFullscreen",{group:"editing"}),this.addAction("toggleMultipleSelection",{group:"editing"}),this.addAction("allowAllConnections",{group:"editing"}),this.addAction("disallowAllConnections",{group:"editing"}),this.addAction("toggleSegmentDirection",{group:"editing"}),this.addAction("editSegmentAddress",{group:"editing"}),this.addAction("editHouseNumbers",{group:"editing"}),this.addAction("editRestrictions",{group:"editing"}),this.addAction("selectEntireStreet",{group:"editing"}),this.addAction("increaseSegmentLevel",{group:"editing"}),this.addAction("decreaseSegmentLevel",{group:"editing"}),this.addAction("showShortcutsDialog",{changeable:!1}),this.addAction("panUp",{group:"navigation"}),this.addAction("panDown",{group:"navigation"}),this.addAction("panLeft",{group:"navigation"}),this.addAction("panRight",{group:"navigation"}),this.addAction("zoomIn",{group:"navigation"}),this.addAction("zoomOut",{group:"navigation"})},registerLayersActions:function(e){return e.forEach(function(e){return function(t){return e.registerLayerAction(t)}}(this))},registerLayerAction:function(e){var t,i;return e.displayInLayerSwitcher?(i=new RegExp(" ","g"),t="toggle"+e.name.replace(i,""),this.addAction(t,{group:"layers",layerToggle:!0,layerKey:e.uniqueName}),e.accelerator=t):void 0},persist:function(){return localStorage.setItem(this.LocalStorageKey,JSON.stringify(this.serialize()))},restore:function(){var e,t;if(t=localStorage.getItem(this.LocalStorageKey),!t)return!1;try{t=JSON.parse(t)}catch(i){return e=i,!1}return Object.forEach(t,function(e){return function(t,i){return null!=e.Actions[t]?e.registerShortcut(i,t,!0):e._futureShortcutsByAction[t]=i}}(this)),!0},serialize:function(){var t;return t={},Object.values(this.Actions).forEach(function(i){var n;return n=i.shortcut||e.getEmpty(),t[i.id]=n.toString()}),t},CLASS_NAME:"Waze.Control.KeyboardShortcuts"}),e=OpenLayers.Class({ctrlKey:!1,metaKey:!1,altKey:!1,shiftKey:!1,keyCode:null,initialize:function(e){return e?(this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.keyCode=e.which):void 0},toString:function(){var e;return e=0,Object.forEach(t.prototype.BrowserEventToModifier,function(i){return function(n,s){return i[n]?e|=t.prototype.Modifiers[s]:void 0}}(this)),e+","+this.keyCode},isEmpty:function(){return-1===this.keyCode||"-1"===this.keyCode},fromString:function(i){var n,s,r,o;return r=i.split(","),s=r.first(),n=r.last(),o=new e,Object.forEach(t.prototype.BrowserEventToModifier,function(e,i){return t.prototype.Modifiers[i]&s?o[e]=!0:void 0}),o.keyCode=n,o},fromEmacsNotation:function(i){var n,s,r,o;return r=i.split("+"),s=r.first(),n=r.last(),o=new e,1===r.length&&(s=""),1===n.length&&(n=n.toUpperCase().charCodeAt()),o.keyCode=n,s.split("").forEach(function(e){var i;return i=t.prototype.ModifierToBrowserEvent[e],o[i]=!0}),o}}),e.getEmpty=function(){var t;return t=new e,t.keyCode=-1,t},t.prototype.BitToModifier={},Object.forEach(t.prototype.Modifiers,function(e,i){return t.prototype.BitToModifier[i]=e}),t.prototype.ModifierToBrowserEvent={},Object.forEach(t.prototype.BrowserEventToModifier,function(e,i){return t.prototype.ModifierToBrowserEvent[i]=e}),i.exports=t}).call(this)}}),this.require.define({"Waze/Control/LocationInfo":function(e,t,i){var n=OpenLayers.Class(OpenLayers.Control,{$element:null,model:null,location:null,initialize:function(e){OpenLayers.Control.prototype.initialize.apply(this),this.model=e},draw:function(){return OpenLayers.Control.prototype.draw.apply(this),this.$element=$(this.div),this.redraw(),this.div},setMap:function(){OpenLayers.Control.prototype.setMap.apply(this,arguments),this.map.events.on({moveend:this.onMoveEnd,scope:this}),this.model.events.on({mergeend:this.onMergeEnd,scope:this})},redraw:function(){this.location&&this.shouldDisplayLocationInfo()?this.$element.stacheComb("location-info",this.location):this.$element.empty()},onMergeEnd:function(){this.calcLocation(),this.redraw()},calcLocation:function(){var e,t,i;return(e=this.model.cities.get(this.model.segments.topCityID))?(i=this.model.countries.get(e.countryID),t=this.model.states.get(e.stateID),void(this.location={city:e.name,country:i.name,state:t.name,showState:function(){return!t.isDefault}})):void(this.location=null)},onMoveEnd:function(){this.shouldDisplayLocationInfo()||(this.location=null),this.redraw()},shouldDisplayLocationInfo:function(){return this.map.getZoom()>=Waze.Config.segments.minDisplayZoom},CLASS_NAME:"Waze.Control.LocationInfo"});i.exports=n}})


,this.require.define({"Waze/Control/MapProblems":function(e,t,i){var n,s=t("Waze/Control"),r=t("Waze/Action/UpdateProblem"),o=t("Waze/View/MapProblems"),a=t("Waze/Model/EventType");n=OpenLayers.Class(OpenLayers.Control,s,{panelView:null,layerView:null,$layerViewDiv:null,model:null,displayedSessionTypes:{all:!1,average:!0},initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments),this.panelView=new o($("#problem-edit-panel"),W.map),this.layerView=W.map.problemLayer,this.$layerViewDiv=$(this.layerView.div),this.panelView.pm=this,this.layerView.pm=this,this.model=W.model,this.repos=[this.model.problems,this.model.turnProblems]},destroy:function(){this.unregisterListeners()},unregisterListeners:function(){this.repos.forEach(function(e){e.events.unregister(a.CHANGED,this,this.onProblemChanged),e.events.unregister(a.ADDED,this,this.onProblemAdded)},this),this.panelView.un({panelClosed:this.onPanelClosed}),this.$layerViewDiv.off("click",".map-problem",$.proxy(this.onProblemClicked,this))},registerListeners:function(){this.repos.forEach(function(e){e.events.register(a.CHANGED,this,this.onProblemChanged),e.events.register(a.ADDED,this,this.onProblemAdded)},this),this.panelView.events.on({problemchanged:this.problemChanged,panelClosed:this.onPanelClosed,requestedSessionTypesChanged:this.onRequestedSessionTypesChanged,zoomToProblem:this.onZoomToProblem,scope:this}),this.$layerViewDiv.on("click",".map-problem",$.proxy(this.onProblemClicked,this))},onZoomToProblem:function(){this.layerView.zoomToProblem()},problemChanged:function(e){e.changes&&this.model.actionManager.add(new r(e.problem,e.changes.state))}



,onRequestedSessionTypesChanged:function(e){OpenLayers.Util.extend(this.displayedSessionTypes,e),this.layerView.drawGeometries(!0)},onSolveProblemsClicked:function(e){this.onProblemClicked(e.problem)},activate:function(){OpenLayers.Control.prototype.activate.apply(this,arguments),this.registerListeners()},onProblemClicked:function(e){var t=$(e.target),i=t.data("model");this.selectProblem(i,t)},selectById:function(e){var t;t=this.model.problems.get(e),t&&this.selectProblem(t)},selectProblem:function(e,t){var i=this;this.panelView.setProblem(e,this.showExtendedInfo()),this.panelView.show(),this.layerView.setProblem(e,t),e.getSessions().done(function(e){i.layerView.setGeometries(e)}),W.track("click_problem")},onProblemChanged:function(e){this.panelView.problemsChanged(e)},onProblemAdded:function(e){this.layerView.problemsAdded(e)},showExtendedInfo:function(){if(!this.model.loginManager.isLoggedIn())return!1;var e=this.model.loginManager.user.id,t=this.model.users.get(e);return t&&t.isStaff},onPanelClosed:function(){this.layerView.unselectProblem()},CLASS_NAME:"Waze.Control.MapProblems"}),i.exports=n}}),this.require.define({"Waze/Control/ModifyFeature":function(e,t,i){var n,s=t("Waze/Control"),r=t("Waze/Handler/Feature"),o=t("Waze/Control/Snapping"),a=t("Waze/Feature/AggregatePointVector"),l=t("Waze/Model/ObjectType");n=OpenLayers.Class(OpenLayers.Control,s,{geometryTypes:null,clickout:!0,toggle:!0,toggleKey:null,multiple:!1,multipleKey:null,standalone:!1,sketchLayer:null,segmentLayer:null,nodeLayer:null,draggingIntent:"drag",features:null,dragHandles:null,nodeDragHandles:null,virtualDragHandles:null,directionArrows:null,dragPointsPaddingVertices:null,selectControl:null,featureHover:null,dragControl:null,snapControl:null,handlers:null,deleteCodes:null,virtualStyle:null,verticesStyle:null,mode:null,modified:[],radiusHandle:null,dragHandle:null,initialize:function(e,t,i,n,s){this.sketchLayer=e,this.segmentLayer=t,this.nodeLayer=i,this.dragHandles={},this.nodeDragHandles={},this.virtualDragHandles={},this.directionArrows={},this.dragPointsPaddingVertices=[],this.features=[],this.deleteCodes=[68],this.mode=OpenLayers.Control.ModifyFeature.RESHAPE,OpenLayers.Control.prototype.initialize.apply(this,[s]),this.deleteCodes instanceof Array||(this.deleteCodes=[this.deleteCodes]),W.accelerators.events.register("toggleMultipleSelection",this,this.toggleMultipleSelection);var a=this;n instanceof Array||(n=[n]),[e,t,i].forEach(function(e){n.contains(e)||n.push(e)}),this.featureHover=new r(this,this.selectControl.layer,{over:function(e){var t=e.parent,i=this.dragControl.handlers.drag.started;!i&&(e._highlightPlaceHolder||e._fromNodeDragPoint||e._toNodeDragPoint)&&this.features.contains(t)&&(this.drawSegmentDraggingHandles(t),this.sketchLayer.removeFeatures(this.directionArrows[t.model.getID()]||[],{silent:!0}))},out:function(e){var t=e.parent,i=this.dragControl.handlers.drag.started;!i&&(e._highlightPlaceHolder||e._fromNodeDragPoint||e._toNodeDragPoint)&&this.features.contains(t)&&(this.removeAllFeatures(this.virtualDragHandles),this.removeAllFeatures(this.dragHandles),this.sketchLayer.addFeatures(this.directionArrows[t.model.getID()]||[],{silent:!0}))},click:function(e){var t=e.parent,i=this.dragControl.handlers.drag.started;return!i&&(e._highlightPlaceHolder||e._fromNodeDragPoint||e._toNodeDragPoint)&&this.features.contains(t)?(this.selectControl.unselect(t),!1):void 0}}),this.selectControl.events.on({activate:function(){this.featureHover.activate()},deactivate:function(){this.featureHover.deactivate()},scope:this}),null===this.virtualStyle&&(this.virtualStyle=OpenLayers.Util.extend({},this.sketchLayer.style||this.sketchLayer.styleMap.createSymbolizer()),this.virtualStyle.fillOpacity=.3,this.virtualStyle.strokeOpacity=.3);var l={geometryTypes:["OpenLayers.Geometry.Point"],snappingOptions:this.snappingOptions,onStart:function(e,t){a.dragStart.apply(a,[e,t])},onDrag:function(e,t){a.dragVertex.apply(a,[e,t])},onComplete:function(e){a.dragComplete.apply(a,[e])},featureCallbacks:{over:function(e){e._sketch&&a.dragControl.overFeature.apply(a.dragControl,[e])},click:function(e){a.clickOnDragPoint.apply(a,[e])}},dragCallbacks:{}};this.dragControl=new OpenLayers.Control.DragFeature(this.sketchLayer,l),this.dragControl.handlers.feature.geometryTypeMatches=function(e){return OpenLayers.Handler.Feature.prototype.geometryTypeMatches.apply(this,arguments)&&!e.uneditable};var h={keydown:this.handleKeypress};this.handlers={keyboard:new OpenLayers.Handler.Keyboard(this,h)},this.snapControl=new o({layer:this.sketchLayer,targets:[{layer:this.nodeLayer},{layer:this.segmentLayer,filter:{evaluate:function(e){return!e.model.outOfScope&&e.model.isGeometryEditable()}}}]});var u=function(e){this.dragControl.feature&&this.dragControl.feature._sketchNode&&e.point.translate(e.point.x,e.point.y)};this.snapControl.events.on({unsnap:u,snap:u,scope:this})},destroy:function(){this.dragPointsPaddingVertices=null,this.segmentLayer=null,this.nodeLayer=null,this.sketchLayer=null,this.dragControl.destroy(),this.snapControl.destroy(),this.featureHover.destroy(),this.standalone||this.selectControl.destroy(),W.accelerators.events.unregister("toggleMultipleSelection",this,this.toggleMultipleSelection),OpenLayers.Control.prototype.destroy.apply(this,[]),this.featureHover=null,this.snapControl=null},activate:function(){return(this.standalone||this.selectControl.activate())&&this.handlers.keyboard.activate()&&this.featureHover.activate()&&this.snapControl.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){var e=!1;return OpenLayers.Control.prototype.deactivate.apply(this,arguments)&&(this.removeAllFeatures(this.dragHandles),this.removeAllFeatures(this.virtualDragHandles),this.dragHandles=[],this.dragControl.deactivate(),this.handlers.keyboard.deactivate(),this.featureHover.deactivate(),this.snapControl.deactivate(),e=!0),e},removeAllFeatures:function(e){Object.forEach(e,function(e,t){this.sketchLayer.removeFeatures(t,{silent:!0})},this)},addAllFeatures:function(e){Object.forEach(e,function(e,t){this.sketchLayer.addFeatures(t,{silent:!0})},this)},selectFeature:function(e,t){e instanceof Array||(e=[e]),e.forEach(function(e){this.features.push(e),this.drawSegmentDraggingHandles(e)},this),this.mode=OpenLayers.Control.ModifyFeature.RESHAPE,this.reverseSegments=t,this.resetVertices(),this.dragControl.activate()},unselectFeature:function(e){e||(e=this.features),e instanceof Array||(e=[e]),e.clone().forEach(function(e){e._highlightPlaceHolder&&(e=e.parent),this.features.contains(e)&&(OpenLayers.Util.removeItem(this.features,e),e.layer&&(e.layer.events.triggerEvent("afterfeaturemodified",{feature:e,modified:OpenLayers.Util.indexOf(this.modified,e)>=0}),e._sketch&&(delete e._sketch,e.layer.drawFeature(e))),OpenLayers.Util.removeItem(this.modified,e))},this),0===this.features.length&&this.dragControl.deactivate(),this.resetVertices()},isActive:function(){return this.features.length>0},clickOnDragPoint:function(){},dragStart:function(e,t){this.onModificationStart(e),this.directionArrows[e.getID&&e.getID()]&&this.sketchLayer.removeFeatures(this.directionArrows[e.model.getID()],{silent:!0}),OpenLayers.Util.indexOf(this.features,e)<0&&!e.virtual&&e!==this.dragHandle&&e!==this.radiusHandle&&((null===this.geometryTypes||-1!==OpenLayers.Util.indexOf(this.geometryTypes,e.geometry.CLASS_NAME))&&(this.dragControl.overFeature.apply(this.dragControl,[e]),this.dragControl.lastPixel=t,this.dragControl.handlers.drag.started=!0,this.dragControl.handlers.drag.start=t,this.dragControl.handlers.drag.last=t),e.parents.forEach(function(e){e._sketch=!0}))},dragVertex:function(e,t){if(this.modified=!0,e.parent&&"OpenLayers.Geometry.Point"===e.parent.geometry.CLASS_NAME)this.sketchLayer.events.triggerEvent("vertexmodified",{vertex:e.geometry,feature:e,pixel:t});else if(e._index){var i=e.parent.model.getID(),n=e.parentGeom;n||(n=e.parent.geometry),n.addComponent(e.geometry,e._index),delete e._index,OpenLayers.Util.removeItem(this.virtualDragHandles[i],e),this.dragHandles[i].push(e)}else e===this.dragHandle?(this.removeAllFeatures(this.dragHandles),this.dragHandles={},this.radiusHandle&&(this.sketchLayer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null)):e!==this.radiusHandle&&this.sketchLayer.events.triggerEvent("vertexmodified",{vertex:e.geometry,feature:e.parent,pixel:t});Object.keys(this.virtualDragHandles).length>0&&(this.removeAllFeatures(this.virtualDragHandles),this.virtualDragHandles=[]),e.parents.forEach(function(e){e.layer&&e.layer.drawFeature(e,this.draggingIntent)},this),this.sketchLayer.drawFeature(e)},dragComplete:function(e){this.onModificationComplete(e),this.sketchLayer.events.triggerEvent("featuremodified",{feature:e});for(var t=0,i=e.parents.length;i>t;t++){var n=e.parents[t];delete n._sketch,n.layer&&(n.layer.drawFeature(e.parents[t],this.isSelected(e.parents[t])?this.selectControl.selectRenderIntent:"default"),n.layer.events.triggerEvent("featuremodified",{feature:e.parents[t]}))}this.resetVertices(),e.parent&&(this.sketchLayer.removeFeatures(this.directionArrows[e.parent.model.getID()],{silent:!0}),this.drawSegmentDraggingHandles(e.parent))},drawSegmentDraggingHandles:function(e){e&&(this.sketchLayer.addFeatures(this.virtualDragHandles[e.model.getID()]||[]),this.sketchLayer.addFeatures(this.dragHandles[e.model.getID()]||[]))},isSelected:function(e){return e.layer&&OpenLayers.Util.indexOf(e.layer.selectedFeatures,e)>=0},resetVertices:function(){if(this.dragControl.feature&&this.dragControl.outFeature(this.dragControl.feature),Object.keys(this.dragHandles).length>0&&(this.removeAllFeatures(this.dragHandles),this.dragHandles={}),Object.keys(this.virtualDragHandles).length>0&&(this.removeAllFeatures(this.virtualDragHandles),this.virtualDragHandles={}),Object.keys(this.nodeDragHandles).length>0&&(this.removeAllFeatures(this.nodeDragHandles),this.nodeDragHandles={}),Object.keys(this.directionArrows).length>0&&(this.removeAllFeatures(this.directionArrows),this.directionArrows={}),this.dragPointsPaddingVertices.length>0&&(this.sketchLayer.removeFeatures(this.dragPointsPaddingVertices,{silent:!0}),this.dragPointsPaddingVertices=[]),this.dragHandle&&(this.sketchLayer.destroyFeatures([this.dragHandle,this.dragBoundry],{silent:!0}),this.dragHandle=null,this.dragBoundry=null),this.radiusHandle&&(this.sketchLayer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null),this.features.length>0){var e=this.selectControl.handlers.feature.lastFeature;e&&!e.layer&&(this.selectControl.handlers.feature.lastFeature=this.features[0]),this.mode&OpenLayers.Control.ModifyFeature.DRAG&&this.collectDragHandle(),this.mode&(OpenLayers.Control.ModifyFeature.ROTATE|OpenLayers.Control.ModifyFeature.RESIZE)&&this.collectRadiusHandle(),this.mode&OpenLayers.Control.ModifyFeature.RESHAPE&&(this.mode&OpenLayers.Control.ModifyFeature.RESIZE||this.collectVertices())}},toggleMultipleSelection:function(){this.selectControl.multiple=!this.selectControl.multiple,this.selectControl.clickout=!this.selectControl.clickout},handleKeypress:function(e){var t=e.keyCode;if(this.features.length>0&&-1!==OpenLayers.Util.indexOf(this.deleteCodes,t)){var i=this.dragControl.feature;i&&i._dragPoint&&!this.dragControl.handlers.drag.dragging&&i.parent&&(this.onModificationStart(i),i.parentGeom?i.parentGeom.removeComponent(i.geometry):i.parent.geometry.removeComponent(i.geometry),i.parent.layer.drawFeature(i.parent,this.selectControl.renderIntent),this.onModificationComplete(i),this.sketchLayer.events.triggerEvent("featuremodified",{feature:i}))}},createGeometryCollection:function(){for(var e=[],t=0,i=this.features.length;i>t;t++)e.push(this.features[t].geometry);return new OpenLayers.Geometry.Collection(e)},collectVertices:function(){this.dragHandles={},this.virtualDragHandles={},this.nodeDragHandles={},this.directionArrows={},this.dragPointsPaddingVertices=[];this.collectVerticesFromFeatures(this.features,this.dragHandles,this.virtualDragHandles,this.nodeDragHandles),this.sketchLayer.addFeatures(this.dragPointsPaddingVertices,{silent:!0}),this.addAllFeatures(this.directionArrows),this.addAllFeatures(this.nodeDragHandles)},collectComponentVertices:function(e,t,i){var n,s,r,o,l=e.geometry;if("OpenLayers.Geometry.Point"===l.CLASS_NAME)s=new a([l],null,this.verticesStyle),s._sketch=!0,s.parent=e,t.push(s);else{var h=l.components.length;for("OpenLayers.Geometry.LinearRing"===l.CLASS_NAME&&(h-=1),n=0;h>n;++n)r=l.components[n],"OpenLayers.Geometry.Point"===r.CLASS_NAME?(s=new OL.Feature.Vector(r,null,this.verticesStyle),s._sketch=!0,s.renderIntent="sketch",s.parent=e,t.push(s)):this.collectComponentVertices(s,t,i);if("OpenLayers.Geometry.MultiPoint"!==l.CLASS_NAME)for(n=0,o=l.components.length;o-1>n;++n){var u=l.components[n],c=l.components[n+1];if("OpenLayers.Geometry.Point"===u.CLASS_NAME&&"OpenLayers.Geometry.Point"===c.CLASS_NAME){var d=(u.x+c.x)/2,p=(u.y+c.y)/2,m=new OL.Feature.Vector(new OpenLayers.Geometry.Point(d,p),null,this.virtualStyle);m.parent=e,m._index=n+1,m._sketch=!0,m.virtual=!0,i.push(m)}}}},collectVerticesFromFeatures:function(e,t,i){for(var n=0,s=e.length;s>n;n++)this.collectComponentVertices(e[n],t,i)
},setMap:function(e){this.standalone||this.selectControl.setMap(e),this.dragControl.setMap(e),this.featureHover.setMap(e),this.snapControl.setMap(e),e.events.on({zoomend:function(){1===this.features.length&&this.features.first().type===l.SPEED_CAMERA&&this.resetVertices()},scope:this}),OpenLayers.Control.prototype.setMap.apply(this,arguments)},onModificationStart:function(){},onModificationComplete:function(){},CLASS_NAME:"Waze.Control.ModifyFeature"}),i.exports=n}}),this.require.define({"Waze/Control/ModifyModelFeature":function(e,t,i){var n,s=t("Waze/Control/ModifyFeature"),r=t("Waze/Model/EventType"),o=t("Waze/Permissions"),a=t("Waze/Model/ObjectType"),l=t("Waze/Action/UpdateSegmentGeometry"),h=t("Waze/Action/MoveNode"),u=t("Waze/Feature/AggregatePointVector"),c=t("Waze/Util");n=OpenLayers.Class(s,{model:null,origGeometries:null,initialize:function(e,t,i,n,r,o){s.prototype.initialize.apply(this,[t,i,n,r,o]),this.model=e,this.origGeometries={}},enableAdvancedTools:function(){var e=this.selectControl;e.box&&!e.handlers.box.active&&e.handlers.box.activate()},disableAdvancedTools:function(){var e=this.selectControl;e.handlers.box&&e.handlers.box.active&&e.handlers.box.deactivate()},activate:function(){s.prototype.activate.apply(this),this.model.segments.events.register(r.CHANGED,this,this.onFeatureUpdated),this.model.nodes.events.register(r.CHANGED,this,this.onFeatureUpdated),this.model.events.register("mergeend",this,this.onFeaturesMerge)},deactivate:function(){this.model.events.unregister("mergeend",this,this.onFeaturesMerge),this.model.segments.events.unregister(r.CHANGED,this,this.onFeatureUpdated),this.model.nodes.events.unregister(r.CHANGED,this,this.onFeatureUpdated),s.prototype.deactivate.apply(this)},onFeatureUpdated:function(){this.isActive()&&this.resetVertices()},clickOnDragPoint:function(e){var t=null;if(e.parent&&e.parent.model.type===a.NODE)t=e.parent;else if(e.parent&&e.parent.model.type===a.SEGMENT){var i=e.parent.geometry.getVertices(!0);e.geometry.equals(i[0])&&e.parent.model.attributes.fromNodeID?t=this.model.nodes.get(e.parent.model.attributes.fromNodeID):e.geometry.equals(i[1])&&e.parent.model.attributes.toNodeID&&(t=this.model.nodes.get(e.parent.model.attributes.toNodeID))}t&&this.selectControl.clickFeature(t)},getFeaturesArray:function(e,t){var i=e[t.getID()];return i||(e[t.getID()]=[]),e[t.getID()]},_getArrowVector:function(e,t,i){var n,s,r;return e.isOneWay()?(n=t?"direction_arrow_restricted.png":"direction_arrow_standard.png",s=9,r=360-i.last().toDeg(),e.attributes.revDirection===!0&&(r-=180)):(s=5,n="restricted_segment.png"),new OpenLayers.Feature.Vector(i.first(),{},{externalGraphic:W.imagePath+n,rotation:r,graphicWidth:s,graphicHeight:5,pointerEvents:"none"})},collectVerticesFromFeatures:function(e,t,i,n){var s=this.calculateNodesToParents(e),r=this;Object.forEach(s,function(e,t){if(t&&t[0].model.isAllowed(o.Nodes.EDIT_GEOMETRY)&&t.allPresent){var i=new u(r.getFeatureGeometries(t),null);i._sketch=!0,i._sketchNode=!0,i.parents=t,i.parent=i.parents[0];var s=r.getFeaturesArray(n,i.parent.model);s.push(i)}});for(var l=function(e){return e&&!e.attributes.segIDs.every(function(t){var i=e.model.segments.get(t);return i&&i.isAllowed(o.Segments.EDIT_GEOMETRY)})},h=0;h<e.length;h++){var c=e[h],d=e[h].model,p=d.getID();if(d.type===a.SEGMENT&&d.isAllowed(o.Segments.EDIT_GEOMETRY)&&!d.outOfScope){var m=new OL.Feature.Vector(d.geometry.clone(),null);m.parent=c,m._highlightPlaceHolder=!0,this.dragPointsPaddingVertices.push(m);var g=d.getRestrictionCount();(g||d.isOneWay())&&(this.directionArrows[d.getID()]=d.getArrowPoints(42*this.map.getResolution(),20*this.map.getResolution(),20*this.map.getResolution()).map(_.partial(this._getArrowVector,d,g)));for(var f=this.getFeaturesArray(t,d),y=this.getFeaturesArray(i,d),v=this.getFeaturesArray(n,d),b=d.geometry,L=null,w=d.attributes.fromNodeID&&s[d.attributes.fromNodeID]?1:0,S=b.components.length-(d.attributes.toNodeID&&s[d.attributes.toNodeID]?1:0),C=w;S>C;++C){var O=b.components[C];if("OpenLayers.Geometry.Point"===O.CLASS_NAME){var E=new OL.Feature.Vector(O,null);if(L){var A=L.geometry.distanceTo(E.geometry)/this.map.getResolution();if(3>A&&C>0&&C<b.components.length-1)continue}L=E,E._sketch=!0,E._virtualParent=m,E.renderIntent="sketch",E.parent=c,E.parents=[c];var x;0===C&&d.attributes.fromNodeID||C===b.components.length-1&&d.attributes.toNodeID?(0===C?(x=this.model.nodes.get(d.attributes.fromNodeID),E.uneditable=l(x),E[this.reverseSegments[p]?"_toNodeDragPoint":"_fromNodeDragPoint"]=!0):C===b.components.length-1&&(x=this.model.nodes.get(d.attributes.toNodeID),E.uneditable=E.uneditable=l(x),E[this.reverseSegments[p]?"_fromNodeDragPoint":"_toNodeDragPoint"]=!0),v.push(E)):0===C?(E[this.reverseSegments[p]?"_toNodeDragPoint":"_fromNodeDragPoint"]=!0,v.push(E)):C===b.components.length-1?(E[this.reverseSegments[p]?"_fromNodeDragPoint":"_toNodeDragPoint"]=!0,v.push(E)):(E._dragPoint=!0,f.push(E))}}if("OpenLayers.Geometry.MultiPoint"!==b.CLASS_NAME)for(var M=0;M<b.components.length-1;++M){var T=b.components[M],k=b.components[M+1];if("OpenLayers.Geometry.Point"===T.CLASS_NAME&&"OpenLayers.Geometry.Point"===k.CLASS_NAME){var D=T.distanceTo(k)/this.map.getResolution();if(20>D)continue;var N=(T.x+k.x)/2,P=(T.y+k.y)/2,I=new OL.Feature.Vector(new OpenLayers.Geometry.Point(N,P),null,this.virtualStyle);I._virtualParent=m,I.parent=c,I.parents=[c],I._index=M+1,I._sketch=!0,I.virtual=!0,y.push(I)}}}}},getFeatureGeometries:function(e){var t=[],i=e[0].model;t.push(i.geometry);for(var n=1;n<e.length;n++){var s=e[n].model;s.attributes.fromNodeID===i.getID()?t.push(s.geometry.components[0]):s.attributes.toNodeID===i.getID()&&t.push(s.geometry.components[s.geometry.components.length-1])}return t},calculateNodesToParents:function(e){for(var t={},i={},n=0;n<e.length;n++){var s=e[n].model;if(s.type===a.SEGMENT){var r=s.attributes.fromNodeID,o=s.attributes.toNodeID;r&&!t[r]&&(i[r]?(t[r]=this.getNodeIDParents(r),delete i[r]):i[r]=!0),o&&!t[o]&&(i[o]?(t[o]=this.getNodeIDParents(o),delete i[o]):i[o]=!0)}else s.type===a.NODE&&(t[s.getID()]||(t[s.getID()]=this.getNodeIDParents(s.getID())))}return t},getNodeIDParents:function(e){var t=this.model.nodes.get(e);if(!c.defined(t))return null;var i=[this.map.nodeLayer.getVector(t)];i.allPresent=!0;for(var n=0;n<t.attributes.segIDs.length;n++){var s=t.attributes.segIDs[n],r=this.model.segments.get(s);r=this.map.segmentLayer.getVector(r),r?i.push(r):i.allPresent=!1}return i},onModificationStart:function(e){e.parents&&e.parents.forEach(function(e){var t=e.model.type+e.model.getID();this.origGeometries[t]||(this.origGeometries[t]=e.geometry.clone())},this)},onModificationComplete:function(e){var t,i={},n=this.snapControl.snappedFeature;if(n&&!n.feature.model.outOfScope&&(n.feature=n.feature.model,i.snappedFeatures=n),1===e.parents.length){if(e.parent.model.type===a.SEGMENT){var s=e.parent.model.getID(),r=e.parent.model;t=this.origGeometries["segment"+s],i.createNodes=!0,t&&this.model.actionManager.add(new l(r,t.clone(),e.parent.geometry,i))}}else{for(var o={},u=e.parent.model,c=0;c<u.attributes.segIDs.length;c++){var d=u.attributes.segIDs[c],p=this.model.segments.get(d);p&&(o[d]=this.origGeometries["segment"+d].clone())}this.model.actionManager.add(new h(u,this.origGeometries["node"+u.getID()].clone(),e.parent.geometry,o,i))}for(var m=0;m<this.origGeometries.length;m++)this.origGeometries[m].destroy();this.origGeometries={}},onFeaturesMerge:function(){this.verifySelectionValidity()},verifySelectionValidity:function(){this.resetVertices()},CLASS_NAME:"Waze.Control.ModifyModelFeature"}),i.exports=n}}),this.require.define({"Waze/Control/NodeCreator":function(e,t,i){var n,s=t("Waze/Control"),r=t("Waze/Action/AddJunction"),o=t("Waze/DivIcon"),a=t("Waze/Model/EventType"),l=t("Waze/Permissions");n=OL.Class(OL.Control,s,{model:null,layer:null,handler:null,segments:null,newNodeFeature:null,maxScaleForDisplay:1e4,initialize:function(e){OL.Control.prototype.initialize.apply(this,[e]),s.prototype.initialize.apply(this,[e]),this.model=W.model,this.layer=new OL.Layer.Markers("newNodes",{displayInLayerSwitcher:!1}),this.segments=[]},destroy:function(){this.layer.clearMarkers(),this.unregisterModelEvents(),this.segments=null},onAddClicked:function(e){var t=$(e.target).data("model");this.model.actionManager.add(new r(this.segments,t.splits))},activate:function(){OL.Control.prototype.activate.apply(this),W.selectionManager.events.register("selectionchanged",this,this.onSelectionChanged),$(this.layer.div).on("click",".add-junction",$.proxy(this.onAddClicked,this))},deactivate:function(){W.selectionManager.events.unregister("selectionchanged",this,this.onSelectionChanged),this.unselect(),$(this.layer.div).off("click",".add-junction",$.proxy(this.onAddClicked,this)),OL.Control.prototype.deactivate.apply(this)},onSelectionChanged:function(e){var t=e.selected||[],i=_(this.segments).invoke("getID");t=_(t).pluck("model");var n=_(t).invoke("getID"),s=!i.equals(n);s&&(this.selectionValid(t)||this.segments.isEmpty()?this.selectionValid(t)&&this.segments.isEmpty()&&this.registerModelEvents():this.unregisterModelEvents(),this.segments=t,this.resetConnections())},selectionValid:function(e){return!e.isEmpty()&&2===e.length},unselect:function(){this.onSelectionChanged({selected:[]})},registerModelEvents:function(){this.model.segments.events.register(a.CHANGED,this,this.onSegmentsChanged),this.model.segments.events.register(a.REMOVED,this,this.onSegmentsRemoved),this.model.nodes.events.register(a.CHANGED,this,this.onNodesChanged)},unregisterModelEvents:function(){this.model.segments.events.unregister(a.CHANGED,this,this.onSegmentsChanged),this.model.segments.events.unregister(a.REMOVED,this,this.onSegmentsRemoved),this.model.nodes.events.unregister(a.CHANGED,this,this.onNodesChanged)},onSegmentsChanged:function(e){null!==this.segment&&OL.Util.indexOf(e,this.segment)>=0&&this.resetConnections()},onSegmentsRemoved:function(e){null!==this.segment&&OL.Util.indexOf(e,this.segment)>=0&&this.unselect()},onNodesChanged:function(e){if(this.segment){var t=this.model.nodes.get(this.segment.attributes.fromNodeID),i=this.model.nodes.get(this.segment.attributes.toNodeID);(t&&OL.Util.indexOf(e,t)>=0||i&&OL.Util.indexOf(e,i)>=0)&&this.resetConnections()}},destroyConnections:function(){this.layer.clearMarkers(),this.newNodeFeature=null},resetConnections:function(){if(this.destroyConnections(),!(this.segments.isEmpty()||2!==this.segments.length||this.layer.map.getScale()>this.maxScaleForDisplay)){var e=this.segments[0],t=this.segments[1];if(e.geometry.bounds&&t.geometry.bounds&&e.attributes.level===t.attributes.level&&e.geometry.bounds.intersectsBounds(t.geometry.bounds)){var i=e.geometry.split(t.geometry,{edge:!0,mutual:!0});if(null!==i&&2===i.first().length){var n=this.segments.every(function(e){return e.isAllowed(l.Segments.EDIT_GEOMETRY)});if(n){var s=i.last().last().components.first().clone();this.newNodeFeature=new OL.Marker(new OL.LonLat(s.x,s.y),new o("add-junction")),this.newNodeFeature.icon.$div.data("model",{splits:i}),this.layer.addMarker(this.newNodeFeature)}}}}},setMap:function(){OL.Control.prototype.setMap.apply(this,arguments),this.map.addLayer(this.layer)},CLASS_NAME:"Waze.Control.NodeCreator"}),i.exports=n}}),this.require.define({"Waze/Control/PendingOperation":function(e,t,i){var n=OpenLayers.Class(OpenLayers.Control,{pending:null,$element:null,initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments),this.pending=[],W.vent.on("operationPending",this._onOperationPending,this),W.vent.on("operationDone",this._onOperationDone,this)},_onOperationPending:function(e){this.addOperation(e.operation)},_onOperationDone:function(e){this.removeOperation(e.operation)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.$element=$(this.div),this.$element.addClass("topbar-info"),this.div},addOperation:function(e){this.pending.push(e),this.updateUI()},removeOperation:function(e){OpenLayers.Util.removeItem(this.pending,e),this.updateUI()},updateUI:function(){if(this.pending.length>0){var e=this.pending[this.pending.length-1];this.$element.text(e.text||I18n.t(e.id)),this.$element.removeClass("hidden")}else this.$element.addClass("hidden")},CLASS_NAME:"Waze.Control.PendingOperation"});i.exports=n}}),this.require.define({"Waze/Control/RedoControl":function(e,t,i){var n,s=t("Waze/Control");n=OpenLayers.Class(OpenLayers.Control.Button,s,{actionManager:null,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]),this.actionManager=e,this.autoActivate=!1,this.onActionChange(),this.actionManager.events.on({scope:this,afteraction:this.onActionChange,afterundoaction:this.onActionChange,afterclearactions:this.onActionChange}),W.accelerators.events.register("redo",this,this.trigger)},destroy:function(){this.actionManager.events.un({scope:this,afteraction:this.onActionChange,afterundoaction:this.onActionChange,afterclearactions:this.onActionChange}),W.accelerators.events.unregister("redo",this,this.trigger),OpenLayers.Control.prototype.destroy.apply(this)},onActionChange:function(){this.actionManager.canRedo()?this.enable():this.disable()},trigger:function(){this.enabled&&(this.onRedo(),this.actionManager.redo())},onRedo:function(){},CLASS_NAME:"Waze.Control.RedoControl"}),i.exports=n}}),this.require.define({"Waze/Control/RoadClosures":function(e,t,i){(function(){var e,n,s,r,o;n=t("Waze/Layer/Markers"),r=t("Waze/View/RoadClosures"),s=t("Waze/Marker/RoadClosure"),e=t("Waze/Model/EventType"),o=OL.Class(OL.Control,{model:null,markerLayer:null,panel:null,selectedClosure:null,initialize:function(e,t){OL.Control.prototype.initialize.call(this,t),this.model=e,this.markerLayer=new n(I18n.t("layers.name.closures"),[this.model.roadClosures],{markerClass:s,uniqueName:"closures",visibility:Waze.Config.closures.shownByDefault,displayInLayerSwitcher:!1})},setMap:function(){return OL.Control.prototype.setMap.apply(this,arguments),this.map.addLayer(this.markerLayer),$(this.markerLayer.div).on("click",".road-closure",$.proxy(this.onClosureClicked,this)),this.panel=new r($("#closures-panel"),this.map),this.panel.events.register("panelClosed",this,this.onPanelClosed),this.panel.pm=this},onPanelClosed:function(){return this.deactivate(),this.selectedClosure=null},onClosureClicked:function(e){var t;return t=$(e.target).data("model"),t!==this.selectedClosure?(this.activate(),this.selectedClosure=t,this.panel.render(),this.panel.show(),this.drawSegmentGeometry()):void 0},drawSegmentGeometry:function(){},onClosureChanged:function(){return this.panel.render()},activate:function(){return OL.Control.prototype.activate.apply(this,arguments)?this.model.roadClosures.events.register(e.CHANGED,this,this.onClosureChanged):void 0},deactivate:function(){return OL.Control.prototype.deactivate.apply(this,arguments)?this.model.roadClosures.events.unregister(e.CHANGED,this,this.onClosureChanged):void 0},CLASS_NAME:"Waze.Control.RoadClosures"}),i.exports(o)}).call(this)}}),this.require.define({"Waze/Control/Save":function(e,t,i){var n,s=t("Waze/Control");n=OpenLayers.Class(OpenLayers.Control.Button,s,{actionManager:null,controller:null,$unsavedActionsCounter:null,CounterAlertThreshold:10,initialize:function(e,t,i){OpenLayers.Control.prototype.initialize.apply(this,[i]),this.actionManager=e,this.controller=t,this.autoActivate=!1,this.onActionChange(),this.actionManager.events.on({scope:this,afteraction:this.onActionChange,afterundoaction:this.onActionChange,afterclearactions:this.onActionChange}),this.controller.events.on({scope:this,savestart:this.onSaveStart,saveend:this.onSaveEnd}),W.accelerators.events.register("save",this,this.trigger),this.saveOperation={text:I18n.t("pending.save")}},onSaveStart:function(){W.vent.trigger("operationPending",{operation:this.saveOperation}),this.disable(),this._removePendingChangesMessage()},onSaveEnd:function(e){if(W.vent.trigger("operationDone",{operation:this.saveOperation}),this.actionManager.canSave()&&this.enable(),e.response.pendingEdits){var t,i=W.model.venues.getByIds(e.response.pendingEdits.venues),n=this;t=i.map(function(e){return e.attributes.name}),t=_.compact(t);var s=$(this._toolbarElement);s.popover({placement:"bottom",title:I18n.t("toolbar.save.success"),content:JST["templates/save/pending_venue_changes"]({names:t}),html:!0}).popover("show"),s.data("bs.popover").tip().on("click",function(){n._removePendingChangesMessage()})}},_removePendingChangesMessage:function(){var e=$(this._toolbarElement),t=e.data("bs.popover");t&&e.popover("destroy")},destroy:function(){this.actionManager.events.un({afteraction:this.onActionChange,afterundoaction:this.onActionChange,afterclearactions:this.onActionChange}),this.controller.events.un({savestart:this.onSaveStart,saveend:this.onSaveEnd}),W.accelerators.events.register("save",this,this.trigger),this.actionManager=null,this.controller=null,OpenLayers.Control.prototype.destroy.apply(this)},onActionChange:function(){var e=this.actionManager.unsavedActionsNum();!this.$unsavedActionsCounter&&this._toolbarElement&&(this.$unsavedActionsCounter=$("<div />").addClass("counter").appendTo(this._toolbarElement)),this.$unsavedActionsCounter&&(this.$unsavedActionsCounter.toggle(e>0&&this.actionManager.isAllowedToSave()),this.$unsavedActionsCounter.toggleClass("warning",e>=this.CounterAlertThreshold),this.$unsavedActionsCounter.text(e)),this.actionManager.canSave()?this.enable():this.disable()},trigger:function(){this.enabled&&this.controller.save()},CLASS_NAME:"Waze.Control.UndoControl"}),i.exports=n}}),this.require.define({"Waze/Control/SaveProblems":function(e,t,i){var n,s=t("Waze/Control"),r=t("Waze/Renderer/ExtendedSVG"),o=t("Waze/View/SaveProblems");n=OpenLayers.Class(OpenLayers.Control,s,{spotlightLayer:null,controller:null,model:null,remoteProjection:new OpenLayers.Projection("EPSG:4326"),panelView:null,spotlightPosition:null,spotlightRadius:70,spotlightAnimationRadius:100,initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,[]),this.initSpotlightLayer(),this.controller=W.controller,this.model=W.model,this.panelView=new o($("#save-problem-panel"))},destroy:function(){this.unregisterListeners()},initSpotlightLayer:function(){var e=OpenLayers.Layer.Vector.prototype.renderers;OpenLayers.Layer.Vector.prototype.renderers=[r],this.spotlightLayer=new OpenLayers.Layer.Vector("Spotlight",{displayInLayerSwitcher:!1}),OpenLayers.Layer.Vector.prototype.renderers=e},drawFogOfWar:function(){var e,t,i=this.map.getExtent();this.spotlightLayer.removeAllFeatures(),this.spotlightPosition&&(e=new OpenLayers.Feature.Vector(this.spotlightPosition,{},{maskID:"spotlightMask",filter:"url(#spotlightBlur)",pointRadius:70,fillColor:"black",fillOpacity:1,animation:{id:"spotlightAnimation",attributeName:"r",dur:"0.3s",from:this.spotlightAnimationRadius,to:this.spotlightRadius,fill:"freeze",begin:"indefinite"}}),this.spotlightLayer.addFeatures(e)),t=new OpenLayers.Feature.Vector(i.toGeometry(),{},{fillColor:"black",strokeWidth:"0",fillOpacity:"0.65",mask:"url(#spotlightMask)"}),this.spotlightLayer.addFeatures(t)},removeFogOfWar:function(){this.spotlightLayer.removeAllFeatures()},setMap:function(e){OpenLayers.Control.prototype.setMap.apply(this,arguments),e.addLayer(this.spotlightLayer)},unregisterListeners:function(){this.handler.deactivate()},registerListeners:function(){this.controller.events.on({savestart:this.onSaveStart,saveend:this.onSaveEnd,scope:this}),this.panelView.events.on({panelClosed:this.onPanelClosed,scope:this})},activate:function(){OpenLayers.Control.prototype.activate.apply(this,arguments),this.registerListeners()},onSaveStart:function(){this.spotlightPosition=null,this.drawFogOfWar()},onSaveEnd:function(e){var t;return e.success||W.loginManager.expired||716===e.response.code?void this.removeFogOfWar():(t=this.getErrorPoint(e.response),t&&(this.spotlightPosition=t,this.isSpotlightInBounds()||this.map.setCenter(new OpenLayers.LonLat(this.spotlightPosition.x,this.spotlightPosition.y)),this.drawFogOfWar(),this.animateSpotlight()),this.panelView.setProblem(e.response,this.showExtendedInfo()),this.panelView.show(),this.events.triggerEvent("saveProblemShown"),W.editingMediator.set("editingEnabled",!1),void W.editingMediator.set("navigation",!1))},showExtendedInfo:function(){return this.model.loginManager.isLoggedIn()?this.model.loginManager.user.isStaff:!1},getErrorPoint:function(e){var t,i,n,s=null;return e.geometry?(s=e.geometry,s=OpenLayers.Format.GeoJSON.prototype.parseGeometry(s),s.transform(this.remoteProjection,this.map.getProjectionObject())):e.objects&&!e.objects.isEmpty()&&(t=e.objects.first(),i=t.objectType.toLowerCase()+"s",n=this.model[i],n&&(t=n.get(t.id)),t&&t.geometry&&(s=t.geometry.getVertices().first().clone())),s},animateSpotlight:function(){var e=document.getElementById("spotlightAnimation");e.beginElement&&e.beginElement()},onPanelClosed:function(){this.removeFogOfWar(),this.spotlightPosition=null,this.events.triggerEvent("saveProblemHidden"),W.editingMediator.set("editingEnabled",!0),W.editingMediator.set("navigation",!0)},isSpotlightInBounds:function(){if(null===this.spotlightPosition)return!1;var e=this.spotlightRadius*this.map.getResolution(),t=new OpenLayers.Bounds(this.spotlightPosition.x-e,this.spotlightPosition.y+e,this.spotlightPosition.x+e,this.spotlightPosition.y-e);return this.map.getExtent().containsBounds(t)},CLASS_NAME:"Waze.Control.SaveProblems"}),i.exports=n}}),this.require.define({"Waze/Control/Search":function(e,t,i){var n,s=t("Waze/Control"),r=t("Waze/Renderer/ExtendedSVG");n=OpenLayers.Class(OpenLayers.Control,s,{layerView:null,model:null,$element:null,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,arguments),this.model=t,this.$element=e;var i=OpenLayers.Layer.Vector.prototype.renderers;OpenLayers.Layer.Vector.prototype.renderers=[r];var n=new OpenLayers.StyleMap({default:new OpenLayers.Style({externalGraphic:W.imagePath+"location_pin.png",graphicYOffset:-53,graphicWidth:37,graphicHeight:53})});this.searchProjection=new OpenLayers.Projection(Waze.Config.search.projection),this.layerView=new OpenLayers.Layer.Vector("Search",{styleMap:n,displayInLayerSwitcher:!1}),OpenLayers.Layer.Vector.prototype.renderers=i},destroy:function(){this.unregisterListeners()},unregisterListeners:function(){this.layerView.events.un({moveend:this.onMapMove})},registerListeners:function(){this.$element.searchbox({url:Waze.Config.search.server,map:this.map,remoteProjection:new OpenLayers.Projection("EPSG:4326"),maxDistance:Waze.Config.search.maxDistance,options:Waze.Config.search.options,onselect:OpenLayers.Function.bind(this.onResultSelect,this),onsearch:OpenLayers.Function.bind(this.onSearch,this)}),this.layerView.events.on({moveend:this.onMapMove,scope:this}),W.accelerators.events.register("search",this,function(){this.$element.data("searchbox").focus()})},activate:function(){OpenLayers.Control.prototype.activate.apply(this,arguments),this.registerListeners()},setMap:function(e){OpenLayers.Control.prototype.setMap.apply(this,arguments),e.addLayer(this.layerView)},onSearch:function(e){W.track("search",{numResults:e})},onResultSelect:function(e,t,i,n){var s=new OpenLayers.LonLat(e.location.lon,e.location.lat).transform(this.searchProjection,this.map.getProjectionObject()),r=new OpenLayers.Geometry.Point(s.lon,s.lat),o=new OpenLayers.Feature.Vector(r);this.layerView.removeAllFeatures(),this.map.setCenter(s,Waze.Config.search.resultZoom),this.map.focus(),this.layerView.addFeatures(o),n||W.track("search_result_select",{numResults:i,index:t})},onMapMove:function(e){e.zoomChanged||this.layerView.removeAllFeatures()},disable:function(){this.$element.find("input").attr("disabled","disabled")},enable:function(){this.$element.find("input").removeAttr("disabled")},CLASS_NAME:"Waze.Control.Search"}),i.exports=n}}),this.require.define({"Waze/Control/SelectHighlightFeature":function(e,t,i){var n,s=t("Waze/Handler/KeyboardShortcut");n=OpenLayers.Class(OpenLayers.Control,{multipleKeys:null,toggleKey:null,deselectKey:null,boxMask:OpenLayers.Handler.MOD_NONE,multiple:!1,clickout:!0,toggle:!1,box:!1,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,selectRenderIntent:"select",highlightRenderIntent:"highlight",highlightSelectedRenderIntent:"highlightselected",deletedRenderIntent:"delete",highlightDeletedRenderIntent:"highlightdeleted",handlers:null,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]),this.multipleKeys instanceof Array||(this.multipleKeys=[this.multipleKeys]),null===this.scope&&(this.scope=this),this.initLayer(e);var i={click:this.clickFeature,clickout:this.clickoutFeature,over:this.overFeature,out:this.outFeature};this.callbacks=OpenLayers.Util.extend(i,this.callbacks),this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes,stopDown:!1,geometryTypeMatches:function(){return this.feature.layer&&this.feature.layer.selectable}}),keyboard:new s(this,{keydown:this.handleKeypress})},this.box&&(OL.Handler.Drag.prototype.checkModifiers=function(e){if(null===this.keyMask)return!0;var t=(e.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(e.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(e.metaKey?OpenLayers.Handler.MOD_CTRL:0)|(e.altKey?OpenLayers.Handler.MOD_ALT:0);return t===this.keyMask},this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature",keyMask:this.boxMask}))},initLayer:function(e){e.forEach(function(e){e.selectControl=this},this),e instanceof Array?(this.layers=e,this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:e})):this.layer=e},destroy:function(){this.active&&this.layers&&this.map.removeLayer(this.layer),OpenLayers.Control.prototype.destroy.apply(this,arguments),this.layers&&this.layer.destroy()},activate:function(){return this.active||(this.layers&&this.map.addLayer(this.layer),this.handlers.feature.activate(),this.handlers.keyboard.activate(),this.box&&this.handlers.box&&this.handlers.box.activate()),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.active&&(this.handlers.feature.deactivate(),this.handlers.keyboard.deactivate(),this.handlers.box&&this.handlers.box.deactivate(),this.layers&&this.map.removeLayer(this.layer)),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},handleKeypress:function(e){this.deselectKey===e.keyCode&&this.unselectAll()},clickFeature:function(e){var t=e.layer&&OpenLayers.Util.indexOf(e.layer.selectedFeatures,e)>-1;t?this.toggleSelect()?this.unselect(e):this.multipleSelect()||this.unselectAll({except:e}):(this.multipleSelect()||this.unselectAll({except:e}),this.select(e))},multipleSelect:function(){var e=this.multipleKeys.some(function(e){return this.handlers.feature.evt[e]},this);return this.multiple||!this.duringBoxSelection&&this.handlers.feature.evt&&e||this.duringBoxSelection&&this.handlers.box&&this.handlers.box.dragHandler.evt&&e},toggleSelect:function(){return this.toggle||this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey]},clickoutFeature:function(){this.clickout&&!this.multipleSelect()&&this.unselectAll()},overFeature:function(e){this.highlight(e)},outFeature:function(e){if(e._lastHighlighter===this.id)if(e._prevHighlighter&&e._prevHighlighter!==this.id){delete e._lastHighlighter;var t=this.map.getControl(e._prevHighlighter);t&&t.highlight(e)}else this.unhighlight(e)},highlight:function(e){var t=e.layer;if(t){var i=this.events.triggerEvent("beforefeaturehighlighted",{feature:e});if(i!==!1){e._prevHighlighter=e._lastHighlighter,e._lastHighlighter=this.id;var n=OpenLayers.Util.indexOf(t.selectedFeatures,e)>-1,s=e.model&&e.model.isDeleted(),r=this.selectStyle;r||(r=s?this.highlightDeletedRenderIntent:n?this.duringBoxSelection?this.selectRenderIntent:this.highlightSelectedRenderIntent:this.highlightRenderIntent),t.drawFeature(e,r),this.events.triggerEvent("featurehighlighted",{feature:e})}}},unhighlight:function(e){var t=e.layer;e._lastHighlighter=e._prevHighlighter,delete e._prevHighlighter;var i=e.model&&e.model.isDeleted(),n=OpenLayers.Util.indexOf(t.selectedFeatures,e)>-1,s=this.selectStyle;s||(s=i?this.deletedRenderIntent:n?this.selectRenderIntent:e.layer.style||"default"),t.drawFeature(e,s),this.events.triggerEvent("featureunhighlighted",{feature:e})},select:function(e){if(!e.model.isDeleted()){var t=this.onBeforeSelect.call(this.scope,e),i=e.layer;i&&t!==!1&&(t=i.events.triggerEvent("beforefeatureselected",{feature:e}),t!==!1&&(i.selectedFeatures.push(e),this.highlight(e),this.handlers.feature.lastFeature||(this.handlers.feature.lastFeature=i.selectedFeatures[0]),e.model&&e.model.setSelected(!0),i.events.triggerEvent("featureselected",{feature:e}),this.onSelect.call(this.scope,e)))}},selectMultiple:function(e){var t,i={};e.forEach(function(e){t=e.layer,null!==t&&(i[t.id]=t,t.selectedFeatures.push(e),this.highlight(e),this.handlers.feature.lastFeature||(this.handlers.feature.lastFeature=t.selectedFeatures[0]),e.model&&e.model.setSelected(!0))},this),Object.values(i).forEach(function(t){t.events.triggerEvent("featureselected",{feature:e})}),this.onSelect.call(this.scope,e)},unselect:function(e,t){var i=e.layer;OpenLayers.Util.removeItem(i.selectedFeatures,e),this.unhighlight(e),e.model&&e.model.setSelected(!1),t!==!0&&(i.events.triggerEvent("featureunselected",{features:[e]}),this.onUnselect.call(this.scope,e))},unselectAll:function(e){var t,i,n,s,r=this.layers||[this.layer],o=[];for(t=0;t<r.length;++t)for(n=r[t],o[t]=[n],i=n.selectedFeatures.length-1;i>=0;--i)s=n.selectedFeatures[i],!s||e&&e.except===s||(s.model&&s.model.setSelected(!1),o[t].push(s),this.unselect(s,!0));o.forEach(function(e){n=e.first(),e=e.splice(1),e.isEmpty()||(n.events.triggerEvent("featureunselected",{features:e}),this.onUnselect.call(this.scope,e))},this)},selectBox:function(e){if(!(!e instanceof OpenLayers.Bounds)){for(var t,i=this.map.getLonLatFromPixel(new OpenLayers.Pixel(e.left,e.bottom)),n=this.map.getLonLatFromPixel(new OpenLayers.Pixel(e.right,e.top)),s=new OpenLayers.Bounds(i.lon,i.lat,n.lon,n.lat).toGeometry(),r=this.boxSelectionLayers||this.layers||[this.layer],o=[],a=0;a<r.length;++a){t=r[a];for(var l=0,h=t.features.length;h>l;++l){var u=t.features[l];u.getVisibility()&&s.intersects(u.geometry)&&o.push(u)}}this.multipleSelect()||this.unselectAll(),o.isEmpty()||this.selectMultiple(o)}},setMap:function(e){this.handlers.feature.setMap(e),this.box&&this.handlers.box.setMap(e),OpenLayers.Control.prototype.setMap.apply(this,arguments)},setLayer:function(e){var t=this.active;this.unselectAll(),this.deactivate(),this.layers&&(this.layer.destroy(),this.layers=null),this.initLayer(e),this.handlers.feature.layer=this.layer,t&&this.activate()},CLASS_NAME:"Waze.Control.SelectHighlightFeature"}),i.exports=n}}),this.require.define({"Waze/Control/Snapping":function(e,t,i){var n=OpenLayers.Class(OpenLayers.Control,{DEFAULTS:{tolerance:15,node:!0,edge:!0,vertex:!0},greedy:!0,precedence:["node","vertex","edge"],resolution:null,geoToleranceCache:null,layer:null,feature:null,snappedFeature:null,point:null,initialize:function(e){OpenLayers.Control.prototype.initialize.apply(this,[e]),this.options=e||{},this.options.layer&&this.setLayer(this.options.layer);var t=OpenLayers.Util.extend({},this.options.defaults);this.defaults=OpenLayers.Util.applyDefaults(t,this.DEFAULTS),this.setTargets(this.options.targets),0===this.targets.length&&this.layer&&this.addTargetLayer(this.layer),this.geoToleranceCache={}},setLayer:function(e){this.active?(this.deactivate(),this.layer=e,this.activate()):this.layer=e},setTargets:function(e){if(this.targets=[],e&&e.length)for(var t,i=0,n=e.length;n>i;++i)t=e[i],t instanceof OpenLayers.Layer.Vector?this.addTargetLayer(t):this.addTarget(t)},addTargetLayer:function(e){this.addTarget({layer:e})},addTarget:function(e){e=OpenLayers.Util.applyDefaults(e,this.defaults),e.nodeTolerance=e.nodeTolerance||e.tolerance,e.vertexTolerance=e.vertexTolerance||e.tolerance,e.edgeTolerance=e.edgeTolerance||e.tolerance,this.targets.push(e)},removeTargetLayer:function(e){for(var t,i=this.targets.length-1;i>=0;--i)t=this.targets[i],t.layer===e&&this.removeTarget(t)},removeTarget:function(e){return OpenLayers.Util.removeItem(this.targets,e)},activate:function(){var e=OpenLayers.Control.prototype.activate.call(this);return e&&this.layer&&this.layer.events&&this.layer.events.on({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this}),e},deactivate:function(){var e=OpenLayers.Control.prototype.deactivate.call(this);return e&&this.layer&&this.layer.events&&this.layer.events.un({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this}),this.feature=null,this.snappedFeature=null,this.point=null,e
},onSketchModified:function(e){this.feature=e.feature,this.considerSnapping(e.vertex,e.vertex)},onVertexModified:function(e){this.feature=e.feature;var t=this.layer.map.getLonLatFromViewPortPx(e.pixel);this.considerSnapping(e.vertex,new OpenLayers.Geometry.Point(t.lon,t.lat))},considerSnapping:function(e,t){for(var i,n,s={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY,x:null,y:null},r=!1,o=0,a=this.targets.length;a>o;++o)if(n=this.targets[o],i=this.testTarget(n,t)){if(this.greedy){s=i,s.target=n,r=!0;break}(i.rank<s.rank||i.rank===s.rank&&i.dist<s.dist)&&(s=i,s.target=n,r=!0)}if(r){var l=this.events.triggerEvent("beforesnap",{point:e,x:s.x,y:s.y,distance:s.dist,layer:s.target.layer,snapType:this.precedence[s.rank]});l!==!1?(this.snappedFeature={feature:s.feature,distance:s.dist,type:this.precedence[s.rank],point:new OpenLayers.Geometry.Point(s.x,s.y)},e.x=s.x,e.y=s.y,this.point=e,this.events.triggerEvent("snap",{point:e,feature:s.feature,snapType:this.precedence[s.rank],layer:s.target.layer,distance:s.dist})):r=!1}this.point&&!r&&(e.x=t.x,e.y=t.y,this.point=null,this.snappedFeature=null,this.events.triggerEvent("unsnap",{point:e}))},testTarget:function(e,t){for(var i,n,s,r,o,a,l,h={node:this.getGeoTolerance(e.nodeTolerance),vertex:this.getGeoTolerance(e.vertexTolerance),edge:this.getGeoTolerance(e.edgeTolerance)},u=Math.max(h.node,h.vertex,h.edge),c={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY},d=!1,p=e.layer.features,m=this.precedence.length,g=new OpenLayers.LonLat(t.x,t.y),f=0,y=p.length;y>f;++f)if(i=p[f],i!==this.feature&&!i._sketch&&i.state!==OpenLayers.State.DELETE&&(!e.filter||e.filter.evaluate(i))&&i.atPoint(g,u,u))for(var v=0,b=Math.min(c.rank+1,m);b>v;++v)if(n=this.precedence[v],e[n])if("edge"===n){if(o=i.geometry.distanceTo(t,{details:!0}),a=o.distance,a<=h[n]&&a<c.dist){c={feature:i,rank:v,dist:a,x:o.x0,y:o.y0},d=!0;break}}else{s=i.geometry.getVertices("node"===n),l=!1;for(var L=0,w=s.length;w>L;++L)r=s[L],a=r.distanceTo(t),a<=h[n]&&(v<c.rank||v===c.rank&&a<c.dist)&&(c={feature:i,rank:v,dist:a,x:r.x,y:r.y},d=!0,l=!0);if(l)break}return d?c:null},getGeoTolerance:function(e){var t=this.layer.map.getResolution();t!==this.resolution&&(this.resolution=t,this.geoToleranceCache={});var i=this.geoToleranceCache[e];return void 0===i&&(i=e*t,this.geoToleranceCache[e]=i),i},destroy:function(){this.active&&this.deactivate(),delete this.layer,delete this.targets,OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"Waze.Control.Snapping"});i.exports=n}}),this.require.define({"Waze/Control/Toolbar":function(e,t,i){var n,s=t("Waze/Control"),r=t("Waze/Control/DrawFeature"),o=t("Waze/Control/DrawRoundabout"),a=t("Waze/Action/AddLandmark"),l=t("Waze/Feature/Vector/Landmark"),h=t("Waze/Action/CreateRoundabout"),u=t("Waze/Control/Search"),c=t("Waze/VectorStyles/Venues"),d=t("Waze/Control/UndoControl"),p=t("Waze/Control/RedoControl"),m=t("Waze/Control/Save"),g=t("Waze/Control/DeleteFeature"),f=t("Waze/Presenter/LayerSwitcher");n=OpenLayers.Class(OpenLayers.Control,s,{$element:null,controls:null,groups:null,snapControl:null,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this),this.$element=e,this.controls=[],this.groups={},this.$element.delegate("div","click.toolbar",OpenLayers.Function.bind(this.controlClicked,this)),this.snapControl=t,this.initDrawingControls(),this.initActionControls(),this.addControls([this.deleteControl,this.redoControl,this.undoControl,this.saveControl,{name:"drawing",controls:[this.drawSegment,this.drawRAControl,this.drawGasStation,this.drawParkingLot,this.drawPointLandmark,this.drawLandmark]}]),this.initLayerSwitcher(),W.selectionManager.events.register("selectionchanged",this,function(e){var t=_(e.selected).pluck("model");this.deleteControl.setEnabledByFeatures(t||[])}),this.searchControl=new u($("#map-search"),W.model),W.map.addControl(this.searchControl),this.searchControl.activate()},addControls:function(e,t,i){var s,r,o,a;t||(t=this.$element),e.forEach(function(e){e.toolbar=this,"seperator"===e?s=$("<div/>").addClass("toolbar-seperator").appendTo(t):e instanceof OpenLayers.Control?(this.addControlToMap(e),a="toolbar-button",i&&(e._parentControl=i,a=i.name+"-"+a),s=$("<div/>").data("control",e).addClass(a).append($("<span/>").text(e.title)).addClass(e.displayClass).appendTo(t),e._toolbarElement=s,this.controls.push(e)):(o=new n.GroupControl(e.name),r=$("<menu/>").addClass("submenu"),s=$("<div/>").addClass("toolbar-button toolbar-submenu toolbar-group-"+e.name).appendTo(t),r.appendTo(s),o._toolbarElement=s,this.groups[name]={},this.groups[name].control=o,this.groups[name].children=e.controls,this.controls.push(o),this.addControls(e.controls,r,o))},this)},controlClicked:function(e){var t,i=$(e.currentTarget).data("control");if(i)return t=i._parentControl,this.active&&i.enabled?i.type===OpenLayers.Control.TYPE_BUTTON?(i.trigger(),void this.redraw()):i.type===OpenLayers.Control.TYPE_TOGGLE?(i.active?(i.deactivate(),t&&t.deactivate()):(i.activate(),t&&t.activate()),void this.redraw()):(i.activate(),!1):!1},addControlToMap:function(e){e.autoActivate===!0?(e.autoActivate=!1,W.map.addControl(e),e.autoActivate=!0):(W.map.addControl(e),e.deactivate()),e.events.on({activate:this.redraw,deactivate:this.redraw,visibilitychanged:this.redraw,enablechanged:this.redraw,scope:this}),this.redraw()},redraw:function(){var e=function(e){return e.active},t=function(e){return e.enabled};Object.forEach(this.groups,function(i,n){n.children.some(e)?n.control.activate():n.control.deactivate(),n.children.some(t)?n.control.setEnabled(!0,!0):n.control.setEnabled(!1,!0)}),this.controls.forEach(function(e){this.assignClass(e)},this)},assignClass:function(e){var t=e._toolbarElement;t.removeClass("ItemActive ItemDisabled ItemInactive"),t.addClass(e.enabled===!1||this.enabled===!1?"ItemDisabled":e.active?"ItemActive":"ItemInactive"),t.attr("title",e.title)},enable:function(){s.prototype.enable.apply(this,arguments),this.searchControl.enable(),this.searchControl.show(),this.redraw()},disable:function(){s.prototype.disable.apply(this,arguments),this.searchControl.disable(),this.searchControl.hide(),this.redraw()},initDrawingControls:function(){this.drawSegment=new r(W.map.sketchLayer,W.map.segmentLayer,OL.Handler.Path,this.snapControl,{title:I18n.t("drawing.road"),featureAdded:function(e,t,i){W.model.addNewSegment(e,t,i,!0),_.defer(function(){W.selectionManager.select([e])})},accelerator:"drawSegment"}),this.drawLandmarkLayer=new OpenLayers.Layer.Vector("drawLandmark",{styleMap:null,displayInLayerSwitcher:!1}),W.map.addLayer(this.drawLandmarkLayer),this.drawLandmark=new r(this.drawLandmarkLayer,W.map.landmarkLayer,OL.Handler.Polygon,null,{title:I18n.t("drawing.landmarks"),featureAdded:function(e){var t=new l({geometry:e.geometry});W.model.actionManager.add(new a(t)),_.defer(function(){W.selectionManager.select([t])})},accelerator:"drawLandmark"}),this.drawPointLandmark=new r(this.drawLandmarkLayer,W.map.landmarkLayer,OpenLayers.Handler.Point,null,{title:I18n.t("drawing.place"),featureAdded:function(e){var t=new l({geometry:e.geometry});W.model.actionManager.add(new a(t)),_.defer(function(){W.selectionManager.select([t])})},accelerator:"drawPlace",handlerOptions:{layerOptions:{styleMap:c.drawPlace}}}),this.drawGasStation=new r(W.map.sketchLayer,W.map.landmarkLayer,OL.Handler.Polygon,null,{title:I18n.t("drawing.gas_station"),featureAdded:function(e){W.model.actionManager.add(new a(new l({geometry:e.geometry,categories:["GAS_STATION"]})))},accelerator:"drawGasStation"}),this.drawParkingLot=new r(W.map.sketchLayer,W.map.landmarkLayer,OL.Handler.Polygon,null,{title:I18n.t("drawing.parking_lot"),featureAdded:function(e){W.model.actionManager.add(new a(new l({geometry:e.geometry,categories:["PARKING_LOT"]})))},accelerator:"drawParkingLot"}),this.drawRAControl=new o({title:I18n.t("drawing.roundabout"),onRoundaboutAdded:function(e){var t=new h(e);W.model.actionManager.add(t),_.defer(function(){W.selectionManager.select(t.roundaboutSegments)})}})},initActionControls:function(){W.map;this.deleteControl=new g(W.model,{title:I18n.t("toolbar.delete")}),this.undoControl=new d(W.model.actionManager,{title:I18n.t("toolbar.undo")}),this.redoControl=new p(W.model.actionManager,{title:I18n.t("toolbar.redo")}),this.saveControl=new m(W.model.actionManager,W.controller,{displayClass:"WazeControlSave"}),this.actionControls=[this.deleteControl,this.undoControl,this.redoControl,this.saveControl]},initLayerSwitcher:function(){var e=new f({map:W.map});e.render()},CLASS_NAME:"Waze.Control.Toolbar"}),n.GroupControl=OpenLayers.Class(OpenLayers.Control,s,{name:null,initialize:function(e){this.name=e,OpenLayers.Control.prototype.initialize.call(this)},CLASS_NAME:"Waze.Control.Toolbar.GroupControl"}),i.exports=n}}),this.require.define({"Waze/Control/UndoControl":function(e,t,i){var n,s=t("Waze/Control");n=OpenLayers.Class(OpenLayers.Control.Button,s,{actionManager:null,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]),this.actionManager=e,this.autoActivate=!1,this.onActionChange(),this.actionManager.events.on({scope:this,afteraction:this.onActionChange,afterundoaction:this.onActionChange,afterclearactions:this.onActionChange}),W.accelerators.events.register("undo",this,this.trigger)},destroy:function(){this.actionManager.events.un({scope:this,afteraction:this.onActionChange,afterundoaction:this.onActionChange,afterclearactions:this.onActionChange}),W.accelerators.events.unregister("undo",this,this.trigger),OpenLayers.Control.prototype.destroy.apply(this)},onActionChange:function(){this.actionManager.canUndo()?this.enable():this.disable()},trigger:function(){this.enabled&&(this.onUndo(),this.actionManager.undo())},onUndo:function(){},CLASS_NAME:"Waze.Control.UndoControl"}),i.exports=n}}),


this.require.define({"Waze/Control/UpdateRequests":function(e,t,i){var n,s=t("Waze/Control"),

r=t("Waze/Action/UpdateRequest"),o=t("Waze/View/UpdateRequests"),a=t("Waze/Model/EventType");n=OpenLayers.Class(OpenLayers.Control,s,{panelView:null,layerView:null,model:null,currentRequest:null,currentRequestMarker:null,requestSession:null,displayedSessionTypes:{drive:!0,route:!0},showCommentView:!1,initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments),this.panelView=new o($("#update-request-panel"),W.map),this.layerView=W.map.updateRequestLayer,this.model=W.model,this.panelView.pm=this,this.layerView.pm=this},destroy:function(){this.unregisterListeners()},unregisterListeners:function(){this.model.mapUpdateRequests.events.unregister(a.ADDED,this,this.onProblemsAdded),this.model.mapUpdateRequests.events.unregister(a.CHANGED,this,this.onProblemsChanged),this.model.mapUpdateRequests.events.unregister(a.REMOVED,this,this.onProblemsRemoved),this.panelView.un({requestChanges:this.problemchanged,commentAdded:this.commentAdded,panelClosed:this.onPanelClosed,requestedSessionTypesChanged:this.onRequestedSessionTypesChanged,showCommentViewToggled:this.onShowCommentViewToggled,zoomToUR:this.onZoomToUR}),$(this.layerView.div).off("click",".map-problem",$.proxy(this.onRequestClicked,this))},registerListeners:function(){this.model.mapUpdateRequests.events.register(a.ADDED,this,this.onProblemsAdded),this.model.mapUpdateRequests.events.register(a.CHANGED,this,this.onProblemsChanged),this.model.mapUpdateRequests.events.register(a.REMOVED,this,this.onProblemsRemoved),this.panelView.events.on({requestChanged:this.requestChanged,commentAdded:this.commentAdded,panelClosed:this.onPanelClosed,requestedSessionTypesChanged:this.onRequestedSessionTypesChanged,showCommentViewToggled:this.onShowCommentViewToggled,zoomToUR:this.onZoomToUR,scope:this}),$(this.layerView.div).on("click",".map-problem",$.proxy(this.onRequestClicked,this))},onZoomToUR:function(){this.layerView.zoomToSessions()},onRequestedSessionTypesChanged:function(e){var t=!1;Object.forEach(e.types,function(e,i){this.displayedSessionTypes[e]!==i&&(t=!0),this.displayedSessionTypes[e]=i},this),t&&this.layerView.update()},onShowCommentViewToggled:function(e){this.showCommentView=e.show},onProblemsChanged:function(){this.layerView.update(),this.panelView.update()},onProblemsAdded:function(){this.currentRequest&&(this.currentRequestMarker=this.getMarkerFromId(this.currentRequest.getID()),this.currentRequestMarker.addClass("selected"))},getMarkerFromId:function(e){return $(this.layerView.div).find("[data-id="+e+"]")},activate:function(){OpenLayers.Control.prototype.activate.apply(this,arguments),this.registerListeners()},shouldShowPanel:function(){return null!==this.currentRequest},isSessionAvailable:function(){return null!==this.requestSession},showExtendedInfo:function(){return this.model.loginManager.isLoggedIn()?this.model.loginManager.user.isStaff:!1},shouldShowCloseDetails:function(){return!this.currentRequest.attributes.open},shouldShowRequestID:function(){return this.showExtendedInfo()},shouldShowSessionCheckbox:function(){return this.isSessionAvailable()&&null!==this.requestSession.driveGeometry},shouldShowRouteCheckbox:function(){return this.isSessionAvailable()&&null!==this.requestSession.routeGeometry},shouldAllowCommenting:function(){return this.model.loginManager.isLoggedIn()},onRequestClicked:function(e){var t=$(e.target),i=t.data("model");this.selectRequest(i,t)},selectById:function(e){var t,i;t=this.model.mapUpdateRequests.get(e),t&&(i=this.getMarkerFromId(e),this.selectRequest(t,i))},selectRequest:function(e,t){var i=this;this.currentRequest!==e&&(this.unselectMarker(),this.currentRequest=e,this.currentRequestMarker=t,this.requestSession=null,this.currentRequestMarker.addClass("selected"),this.model.updateRequestSessions.get([e.getID()]).done(function(e){i.requestSession=e.first(),i.panelView.update(),i.layerView.update()}),this.layerView.update(),this.panelView.update(!0),$(this.map.div).addClass("problem-selected"),W.track("click_ur"))},unselectMarker:function(){this.currentRequestMarker&&this.currentRequestMarker.removeClass("selected")},

requestChanged:function(e){e.changes&&this.model.actionManager.add(new r(this.currentRequest,e.changes.state))}



,commentAdded:function(){this.currentRequest.attributes.hasComments=!0,this.model.mapUpdateRequests.changed(this.currentRequest)},onPanelClosed:function(){OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"PanelOpen"),$(this.map.div).removeClass("problem-selected"),this.unselectMarker(),this.currentRequest=null,this.currentRequestMarker=null,this.requestSession=null,this.layerView.update(),this.panelView.update()},CLASS_NAME:"Waze.Control.UpdateRequests"}),i.exports=n}}),this.require.define({"Waze/Control/ZoomBar":function(e,t,i){var n=OpenLayers.Class(OpenLayers.Control.PanZoomBar,{STREET_VIEW_MARGIN:5,zoomStopWidth:27,zoomStopHeight:9,streetViewContainer:null,draw:function(e){var t=null===this.div;OpenLayers.Control.prototype.draw.apply(this,arguments),this.div.style.left="",this.div.style.top="",e=this.position.clone(),this.buttons=[];{var i=new OpenLayers.Size(32,32),n=new OpenLayers.Pixel(e.x+i.w/2,e.y);i.w}return this._addButton("zoomin",n.add(-2,0*i.h+5),i,"zoom-plus-button"),this._addButton("zoomout",n.add(-2,1*i.h+5+this.getZoomStopsHeight()),i,"zoom-minus-button"),this.streetViewContainer=$("<div />").css({position:"absolute",top:2*i.h+this.getZoomStopsHeight()+this.STREET_VIEW_MARGIN}).appendTo($(this.div)),this.buttons.push(this.streetViewContainer.get(0)),this._addZoomBar(n.add(0,1*i.h+5)),t&&$(this.div).on("click",function(e){var t=e.target;switch(t.action){case"zoomin":t.map.zoomIn();break;case"zoomout":t.map.zoomOut()}return!1}).on("click mousedown dragstart",function(e){e.stopPropagation()}),this.events.triggerEvent("drawn"),this.div},_addZoomBar:function(e){var t=(OpenLayers.Util.getImagesLocation(),this.id+"_"+this.map.id,this.map.getNumZoomLevels()-1-this.map.getZoom()),i=document.createElement("div");i.style.top=e.y+t*this.zoomStopHeight+"px",$(i).addClass("slider"),this.slider=i,this.sliderEvents=new OpenLayers.Events(this,i,null,!0,{includeXY:!0}),this.sliderEvents.on({mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp,dblclick:this.doubleClick,click:this.doubleClick});var n=new OpenLayers.Size;n.h=this.zoomStopHeight*this.map.getNumZoomLevels(),n.w=this.zoomStopWidth;var s=null;return s=document.createElement("div"),s.id="OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,s.style.top=e.y-0*this.zoomStopHeight+"px",s.style.height=this.zoomStopHeight*(this.map.getNumZoomLevels()+0)+"px",$(s).addClass("slider-stops"),this.zoombarDiv=s,this.divEvents=new OpenLayers.Events(this,s,null,!0,{includeXY:!0}),this.divEvents.on({mousedown:this.divClick,mousemove:this.passEventToSlider,dblclick:this.doubleClick,click:this.doubleClick}),this.div.appendChild(s),this.startTop=parseInt(s.style.top,10),this.div.appendChild(i),this.map.events.register("zoomend",this,this.moveZoomBar),e=e.add(0,this.zoomStopHeight*this.map.getNumZoomLevels())},doubleClick:function(e){return OpenLayers.Event.stop(e),!1},divClick:function(e){if(OpenLayers.Event.isLeftClick(e)){var t=e.xy.y/this.zoomStopHeight;(this.forceFixedZoomLevel||!this.map.fractionalZoom)&&(t=Math.floor(t));var i=this.map.getNumZoomLevels()-1-t;i=Math.min(Math.max(i,0),this.map.getNumZoomLevels()-1),this.map.zoomTo(i),OpenLayers.Event.stop(e)}},getZoomStopsHeight:function(){return this.zoomStopHeight*this.map.getNumZoomLevels()},_addButton:function(e,t,i,n){{var s,r=document.createElement("div"),o=$(r);this.map}if(r.style.top=t.y+"px",r.id=this.id+"_"+e,o.addClass(n),o.addClass("zoom-button"),this.div.appendChild(r),r.action=e,r.map=this.map,this.slideRatio){var a=this.slideRatio;s=function(e){return this.map.getSize()[e]*a}}else{var l=this.slideFactor;s=function(){return l}}return r.getSlideFactor=s,this.buttons.push(r),r},show:function(){$(this.div).show()},hide:function(){$(this.div).hide()},CLASS_NAME:"OpenLayers.Control.PanZoomBar"});i.exports=n}}),this.require.define({"Waze/Controller":function(e,t,i){(function(){var e,n,s,r,o,a={}.hasOwnProperty;o=t("Waze/Util"),e=t("Waze/Utils/Activatable"),r=t("Waze/Format/Serializer"),s=t("Waze/Format/Operation"),n=OpenLayers.Class(e,{events:null,bounds:null,scale:null,zoom:null,oldScale:null,keepObjects:!1,map:null,model:null,ratio:1.7,serializer:null,operationSerializor:null,initialize:function(t){e.prototype.initialize.apply(this,[t]),OpenLayers.Util.extend(this,t),this.model=W.model,this.map=W.map,this.events=new OpenLayers.Events(this),this.serializer=new r,this.operationSerializor=new s,this.segmentProjection=new OpenLayers.Projection("EPSG:4326"),this.loadingOperation={id:"pending.road_data"}},activate:function(){var t;return t=e.prototype.activate.apply(this,arguments),t&&this.map.events.on({moveend:function(){return this.updateModel(!1)},changelayer:this.onLayerVisibilityChange,scope:this}),this.reload(),t},deactivate:function(){var t;return t=e.prototype.deactivate.call(this,arguments),t&&this.map.events.un({moveend:function(){return this.updateModel(!1)},changelayer:this.onLayerVisibilityChange,scope:this}),t},reload:function(){return this.model.clear(),this.updateModel(!1)},updateModel:function(e){var t,i,n,s,r,o;if(s=this.bounds,i={},this.keepObjects=e,this.oldScale=this.scale,this.scale=this.map.getScale(),this.zoom=this.map.getZoom(),this.bounds=this.calculateBounds(),null!==this.bounds){t={zoomChanged:this.scale!==this.oldScale,scale:this.scale,bounds:this.bounds},o=this.model.repos;for(n in o)a.call(o,n)&&(r=o[n],r.active&&OL.Util.extend(i,r.updateDataExtent(this.map.calculateBounds(),this.scale,this.zoom)));return Object.keys(i).isEmpty()?void 0:(this.isSandBoxMode()&&(i.sandbox=!0),this.sendReadFeatures(i))}},isSandBoxMode:function(){return W.app.get("sandbox")},onLayerVisibilityChange:function(e){var t,i,n,s,r,o,a,l,h,u,c,d,p,m;if("visibility"===e.property){if(i=e.layer,s=i.repo,o=i.getVisibility(),r=!1,s&&i.toggleRepo){for(a=0,u=s.length;u>a;a++)n=s[a],n.setActive(o);r=!0}if(s&&i.toggleFilter){for(l=0,c=s.length;c>l;l++)n=s[l],n[i.toggleFilter]=o;r=!0}if(r&&this.updateModel(!0),i.parentLayer&&o===!0&&i.parentLayer.setVisibility(!0),i.childLayers&&o===!1){for(p=i.childLayers,m=[],h=0,d=p.length;d>h;h++)t=p[h],m.push(t.setVisibility(!1));return m}}},calculateBounds:function(e){var t,i,n;return e||(e=this.map.calculateBounds()),null===e?null:(t=e.getCenterLonLat(),n=e.getWidth()*this.ratio,i=e.getHeight()*this.ratio,new OpenLayers.Bounds(t.lon-n/2,t.lat-i/2,t.lon+n/2,t.lat+i/2))},sendReadFeatures:function(e){var t;null!=(t=this.readRequest)&&t.abort(),this.events.triggerEvent("loadstart"),W.vent.trigger("operationPending",{operation:this.loadingOperation}),e.bbox=this.bounds.clone().transform(this.map.getProjectionObject(),this.segmentProjection).toBBOX(),e.language=I18n.locale,null!=this.model.lastTransactionID&&(e.mapVersionID=this.model.lastTransactionID),this.readRequest=$.get(W.Config.paths.features,e).done(function(e){return function(t){return e.serializer.read(t),e.model.mergeObjects(e.bounds,t,e.keepObjects)}}(this)).always(function(e){return function(){return e.events.triggerEvent("loadend"),W.vent.trigger("operationDone",{operation:e.loadingOperation}),e.keepObjects=!1,e.readRequest=null}}(this))},save:function(){return o.protect("saving",function(e){return function(){var t,i;return t=e.model.actionManager.serialize(),t=e.operationSerializor.write(t),e.events.triggerEvent("savestart"),i={language:I18n.locale,bbox:e.model.getChangesExtent().transform(e.map.getProjectionObject(),e.segmentProjection).toBBOX()},$.ajax({method:"post",url:W.Config.paths.features+"?"+$.param(i),data:t,dataType:"json",contentType:"application/json"}).done($.proxy(e.onSaveComplete,e)).error($.proxy(e.onSaveError,e)),W.track("save",{numActions:e.model.actionManager.unsavedActionsNum()})}}(this))},updateObject:function(e,t,i,n){var s;if(e)return t?(s=t.id,delete t.id,e.merge(t),e.setID(s),delete this.model[i].objects[n],this.model[i].objects[s]=e,e.state=null,this.model[i].changed(e)):(e.state=OpenLayers.State.DELETE,void this.model[i].remove(e))},onSaveError:function(e){var t,i;try{i=JSON.parse(e.responseText)}catch(n){t=n,i={code:500,details:"fatal server error"}}return _.defer(function(e){return function(){return e.events.triggerEvent("saveend",{success:!1,response:i})}}(this))},onSaveComplete:function(e){var t;return t=$.proxy(this.updateObject,this),o.protect("processing save results",function(i){return function(){var n,s,r,o,l,h,u,c,d,p,m;for(l in e)if(a.call(e,l)&&(o=e[l],i.model[l]))for(h in o)a.call(o,h)&&(n=o[h],$.when(i.model[l].get(h),n,l,h).done(t));p=i.model.getModifiedObjects();for(l in p)if(a.call(p,l))for(s=p[l],m=s[OL.State.DELETE],c=0,d=m.length;d>c;c++)r=m[c],i.model[l].remove(r);return i.model.actionManager.clear(),i.model.setLastTransactionID(e.mapVersionID),u=i.map.getLayersBy("uniqueName","roads")[0],u.params.waitFor=e.mapVersionID,u.redraw({force:!0}),u.removeBackBuffer(),i.events.triggerEvent("saveend",{success:!0,response:e})}}(this))},CLASS_NAME:"Waze.Controller"}),i.exports=n}).call(this)}}),this.require.define({"Waze/DataModel":function(e,t,i){var n,s,r=t("Waze/Util"),o=t("Waze/Model/ObjectRepository"),a=t("Waze/Model/OnDemandRepository"),l=t("Waze/Model/SegmentRepository"),h=t("Waze/Model/LandmarkRepository"),u=t("Waze/ActionManager"),c=t("Waze/Model/Location"),d=t("Waze/Model/ObjectType"),p=t("Waze/Action/AddSegment"),m=t("Waze/Action/DeleteSegment"),g=t("Waze/Action/DeleteObject"),f=t("Waze/Action/MergeSegments"),y=t("Waze/Action/MultiAction");s=OpenLayers.Class({events:null,actionManager:null,segments:null,nodes:null,users:null,streets:null,cities:null,states:null,countries:null,problems:null,mapUpdateRequests:null,venues:null,junctions:null,repos:null,distanceCache:null,isImperial:!1,isLeftHand:!1,locations:null,lastTransactionID:null,addRepository:function(e,t,i,n){n||(n=o),i=i||{},i.model=this,this[e]=new n(t,i),this.repos[e]=this[e]},initialize:function(e){var t=new OpenLayers.Projection("EPSG:900913");OpenLayers.Util.extend(this,e),this.events=new OpenLayers.Events(this),this.actionManager=new u(this),this.distanceCache=new n(new OpenLayers.Projection("EPSG:900913")),this.repos={},this.addRepository("segments",d.SEGMENT,{},l),this.addRepository("nodes",d.NODE,{onDemand:!1}),this.addRepository("users",d.USER,{onDemand:!1,useVersions:!1}),this.addRepository("streets",d.STREET,{onDemand:!1}),this.addRepository("cities",d.CITY,{onDemand:!1}),this.addRepository("countries",d.COUNTRY,{onDemand:!1}),this.addRepository("states",d.STATE,{onDemand:!1}),this.addRepository("junctions",d.JUNCTION,{onDemand:!1});var i=r.localStorage.get("layerFilters");null===i&&(i={});var s=i.problems;s=s?1:0,this.addRepository("problems",d.MAP_PROBLEM,{filterName:"problemFilter",filter:s}),s=i.update_requests,s=s?1:0,this.addRepository("turnProblems",d.TURN_PROBLEM,{filterName:"turnProblemFilter",filter:s}),this.addRepository("mapUpdateRequests",d.UPDATE_REQUEST,{filterName:"mapUpdateRequestFilter",filter:s}),this.addRepository("roadClosures",d.ROAD_CLOSURE,{minZoom:Waze.Config.closures.minDisplayZoom,active:Waze.Config.closures.shownByDefault}),this.addRepository("venues",d.VENUE,{active:Waze.Config.venues.shownByDefault},h),this.addRepository("cameras",d.SPEED_CAMERA,{minZoom:Waze.Config.cameras.minDisplayZoom,active:Waze.Config.cameras.shownByDefault}),this.addRepository("editableAreas","editableArea",{minZoom:Waze.Config.editable_areas.minDisplayZoom}),this.addRepository("problemSessions",d.PROBLEM_SESSION,{url:Waze.Config.paths.problemSessions,localProjection:t,onDemand:!1},a),this.addRepository("turnProblemDetails",d.TURN_PROBLEM_DETAILS,{url:Waze.Config.paths.turnProblemsDetails,localProjection:t,onDemand:!1},a),this.addRepository("houseNumbers",d.HOUSE_NUMBER,{url:Waze.Config.paths.houseNumbers,localProjection:t,onDemand:!1},a),this.addRepository("updateRequestSessions",d.UPDATE_REQUEST_SESSION,{url:Waze.Config.paths.updateRequestSessions,localProjection:t,onDemand:!1},a),this.addRepository("archives",d.ARCHIVE_SESSION,{url:Waze.Config.paths.archive,onDemand:!1},a),this.addRepository("archiveSessions",d.ARCHIVE_SESSION_DATA,{url:Waze.Config.paths.archiveSessions,onDemand:!1,localProjection:t},a),this.addRepository("managedAreas","managedArea"),this.locations=[]},clear:function(e){for(var t in this)this[t]instanceof o&&this[t].clear(e)},getRepository:function(e){for(var t in this)if(this[t]instanceof o&&this[t].objectType===e)return this[t];return null},mergeObjects:function(e,t,i){this.events.triggerEvent("mergestart");var n,s=t.segments;this.editableAreas.mergeObjects(null,null,e,this.scale,t),delete t.segments,s||(i=!0),Object.forEach(t,function(n,s){var r=this[n];r&&((!i||r.onDemand)&&r.clear({keepUnsaved:!0,keepSelected:!0}),r.mergeObjects(s,null,e,this.scale,t))},this),n=this.segments,s&&(n.clear({keepUnsaved:!0,keepSelected:!0}),n.mergeObjects(s,null,e,this.scale,t)),this.setMeasurementSystem(),this.setDrivingDirection(),this.setLocations(t.countries),this.setTopCountry(t),this.events.triggerEvent("mergeend")},setTopCountry:function(e){var t=e.countries,i=e.states;t&&t.mainObjectID?(this.countries.top=this.countries.objects[t.mainObjectID],i&&(this.states.top=this.states.objects[i.mainObjectID])):(this.countries.top=null,this.states.top=null)},setLocations:function(e){var t=[];e=e||{objects:[]},e=e.objects||[],e.forEach(function(e){var i=c.normalizeCode(e.env);t.push(i)}),t=t.unique(),t=t.sort(),t.equals(this.locations)||(this.locations=t,this.events.triggerEvent("change:locations"))},setMeasurementSystem:function(){this.isImperial=!1;var e=Object.values(this.countries.objects),t=null;e.isEmpty()||(t=e.first(),this.isImperial=234===t.id||235===t.id)},setDrivingDirection:function(){var e=Object.values(this.countries.objects);this.isLeftHand=!1,e.isEmpty()||(this.isLeftHand=!!e.first().leftHandTraffic)},addNewSegment:function(e,t,i,n){this.actionManager.add(new p(e,{createNodes:n,snappedFeatures:[t,i]}))},deleteSegments:function(e){if(1===e.length)this.actionManager.add(new m(e[0]));else if(e.length>1){for(var t=[],i=0,n=e.length;n>i;i++)t.push(new m(e[i]));this.actionManager.add(new y(t))}},deleteObjects:function(e){if(1===e.length)this.actionManager.add(new g(e[0]));else if(e.length>1){for(var t=[],i=0,n=e.length;n>i;i++)t.push(new g(e[i]));this.actionManager.add(new y(t))}},deleteNodes:function(e){if(1===e.length)this.actionManager.add(new f(null,e[0]));else if(e.length>1){for(var t=[],i=0,n=e.length;n>i;i++)t.push(new f(null,e[i]));this.actionManager.add(new y(t))}},getModifiedObjects:function(){return{segments:this.segments.getModifiedObjects(),nodes:this.nodes.getModifiedObjects(),cities:this.cities.getModifiedObjects(),streets:this.streets.getModifiedObjects(),venues:this.venues.getModifiedObjects()}},hasModifiedObjects:function(){return Object.values(this.repos).some(function(e){return e.hasModifiedObjects()})},getChangesExtent:function(){var e=new OpenLayers.Bounds;return[this.segments,this.nodes].forEach(function(t){Object.values(t.getModifiedObjects()).forEach(function(t){t.forEach(function(t){e.extend(t.geometry.bounds)})})}),e},hasStates:function(){var e=this.states.getObjectArray();return 1===e.length&&e.first().isDefault?!1:!0},setLastTransactionID:function(e){this.lastTransactionID=e,this.events.triggerEvent("change:lastTransactionID",{id:this.lastTransactionID})},CLASS_NAME:"Waze.DataModel"}),n=OpenLayers.Class({precision:1,distanceInMeters:1,currentDistance:null,currentLat:null,projection:null,inputProjection:null,initialize:function(e,t){OpenLayers.Util.extend(this,t),this.projection=new OpenLayers.Projection("EPSG:4326"),this.inputProjection=e},getValue:function(e,t){var i=e.clone();return i.transform(this.inputProjection,this.projection),(t||!this.isPointInCacheRange(i))&&this.calculateLat(e,i),this.currentDistance},isPointInCacheRange:function(e){return null!==this.currentDistance&&Math.abs(e.y-this.currentLat)<this.precision},calculateLat:function(e,t){var i,n;this.currentLat=t.y,i=OpenLayers.Util.destinationVincenty({lon:t.x,lat:t.y},90,this.distanceInMeters),n=new OpenLayers.Geometry.Point(i.lon,i.lat),n.transform(this.projection,this.inputProjection),this.currentDistance=Math.abs(n.x-e.x)},CLASS_NAME:"Waze.DataModel.DistanceCache"}),i.exports=s}}),this.require.define({"Waze/DivIcon":function(e,t,i){var n=OpenLayers.Class({className:null,$div:null,events:null,initialize:function(e,t){this.className=e,this.moveWithTransform=!!t,this.$div=$("<div />").addClass(e),this.imageDiv=this.$div.get(0)},destroy:function(){this.erase(),this.$div=null},clone:function(){return new n(this.className)},draw:function(e){return this.moveWithTransform?(this.$div.css({transform:"translate("+e.x+"px, "+e.y+"px)"}),this.$div.css({position:"absolute"})):this.$div.css({position:"absolute",left:e.x,top:e.y}),this.$div.get(0)},moveTo:function(e){null!==e&&(this.px=e),null===this.px?this.display(!1):this.$div.css(this.moveWithTransform?{transform:"translate("+this.px.x+"px, "+this.px.y+"px)"}:{left:this.px.x,top:this.px.y})},erase:function(){this.$div.remove()},display:function(e){this.$div.toggle(e)},isDrawn:function(){return!!this.$div.parent().length},bringToFront:function(){if(this.isDrawn()){var e=this.$div.parent();this.$div.detach().appendTo(e)}},forceReflow:function(){return this.$div.get(0).offsetWidth},CLASS_NAME:"Waze.DivIcon"});i.exports=n}}),this.require.define({"Waze/EditingMediator":function(e,t,i){(function(){var e,n;n=t("Waze/Model/Model"),e=OL.Class(n,{initialize:function(){return n.prototype.initialize.apply(this),this.set({drawing:!1,editingEnabled:!1,navigation:!1,advancedTools:!1})},activate:function(){return this.model=W.app,this.model.on("change:editing",this._onEditingChanged,this),W.controller.events.on({savestart:this._onSaveStart,saveend:this._onSaveEnd,scope:this})},_onEditingChanged:function(){var e,t,i;return t=this.model.get("loggedIn"),i=this.model.get("user"),e=this.model.get("editing"),this.set("editingEnabled",e),this.set("advancedTools",t&&i.isStaff),e?this.set("navigation",!0):void 0},_onSaveStart:function(){return this.set("editingEnabled",!1),this.set("navigation",!1)},_onSaveEnd:function(){return this.set("editingEnabled",!0),this.set("navigation",!0)},setDrawingInProgress:function(){return this.set("drawing",!0)},setDrawingDone:function(){return this.set("drawing",!1)}}),i.exports=e}).call(this)}}),this.require.define({"Waze/Feature/AggregatePointVector":function(e,t,i){var n,s=t("Waze/Geometry/AggregatePoint");n=OpenLayers.Class(OL.Feature.Vector,{initialize:function(e,t,i){OL.Feature.Vector.prototype.initialize.apply(this,[new s(e),t,i])},getID:function(){return this.id},clone:function(){return new n(this.geometry?this.geometry.clone():null,this.attributes,this.style)},CLASS_NAME:"Waze.Feature.AggregatePointVector"}),i.exports=n
}}),this.require.define({"Waze/Feature/HouseNumber/Collection":function(e,t,i){(function(){var e,n,s;n=t("Waze/Feature/HouseNumber/Number"),e=t("Waze/Model/Object"),s=OpenLayers.Class(e,{nested:{numbers:n,editArea:OL.Geometry},initialize:function(){return e.prototype.initialize.apply(this,arguments),this.createNumbers()},createNumbers:function(){var e,t,i,n,s;for(s=this.numbers,e=i=0,n=s.length;n>i;e=++i)t=s[e],this.numbers[e].parent=this},merge:function(){return e.prototype.merge.apply(this,arguments),this.createNumbers()},getNumber:function(e){var t,i,n,s;for(s=this.numbers,i=0,n=s.length;n>i;i++)if(t=s[i],t.id===e)return t;return null},getSegment:function(){return this.segment||(this.segment=this.model.segments.get(this.id))}}),i.exports=s}).call(this)}}),this.require.define({"Waze/Feature/HouseNumber/Number":function(e,t,i){(function(){var e,n,s;e=t("Waze/Model/Object"),n=t("Waze/Utils/Geo"),s=OpenLayers.Class(e,{nested:{geometry:OL.Geometry,fractionPoint:OL.Geometry},isLeft:!1,projectionLonLat:null,closestSegment:null,calculateProjection:function(e){var t,i,n,s,r,o;return r=new OL.Geometry.Point(this.geometry.x,this.geometry.y),t=e.distanceTo(r,{details:!0}),i=t.line,n={x:i.x1,y:i.y1},s={x:i.x2,y:i.y2},s.y>n.y&&(o=[s,n],n=o[0],s=o[1]),this.isLeft=(s.x-n.x)*(r.y-n.y)-(s.y-n.y)*(r.x-n.x)<=0,this.projectionLonLat=new OL.LonLat(t.x0,t.y0),this.closestSegment=t.model},getFractionFromProjection:function(){return new OL.Geometry.Point(this.projectionLonLat.lon,this.projectionLonLat.lat)},changedSegment:function(){return this.parent.id!==this.closestSegment.getID()},clone:function(){var e,t;return e=new s({fractionPoint:this.fractionPoint.clone(),projectionLonLat:null!=(t=this.projectionLonLat)?t.clone():void 0,number:this.number,valid:this.valid,forced:this.forced,id:this.id,side:this.side,version:this.version,geometry:this.geometry.clone()}),e.parent=this.parent,e}}),i.exports=s}).call(this)}}),this.require.define({"Waze/Feature/ManagedArea":function(e,t,i){(function(){var e,n;e=t("Waze/Model/Object"),n=OpenLayers.Class(e,{nested:{geometry:OL.Geometry},initialize:function(t){return t.id=t.id+"ma",e.prototype.initialize.apply(this,arguments)},getUserName:function(){var e;return e=this.model.users.get(this.userID),(null!=e?e.userName:void 0)||""}}),i.exports=n}).call(this)}}),this.require.define({"Waze/Feature/MapProblemDetails/Collection":function(e,t,i){(function(){var e,n,s;s=t("Waze/Feature/MapProblemDetails/Item"),e=t("Waze/Model/Object"),n=OL.Class(e,{nested:{sessions:s,average:s}}),i.exports=n}).call(this)}}),this.require.define({"Waze/Feature/MapProblemDetails/Item":function(e,t,i){(function(){var e,n;e=t("Waze/Model/Object"),n=OpenLayers.Class(e,{nested:{geometry:OL.Geometry,nextSegGeom:OL.Geometry,prevSegGeom:OL.Geometry}}),i.exports=n}).call(this)}}),this.require.define({"Waze/Feature/TurnProblemDetails/Alternative":function(e,t,i){(function(){var e,n;n=t("Waze/Model/Object"),e=OL.Class(n,{nested:{averageGeom:OL.Geometry}}),i.exports=e}).call(this)}}),this.require.define({"Waze/Feature/TurnProblemDetails/Collection":function(e,t,i){(function(){var e,n,s;e=t("Waze/Feature/TurnProblemDetails/Alternative"),n=t("Waze/Model/Object"),s=OL.Class(n,{nested:{routeNextSeg:OL.Geometry,routePrevSeg:OL.Geometry,alternatives:e}}),i.exports=s}).call(this)}}),this.require.define({"Waze/Feature/UpdateRequestSession":function(e,t,i){var n,s=t("Waze/Model/Object");n=OpenLayers.Class(s,{nested:{driveGeometry:OL.Geometry,routeGeometry:OL.Geometry},instructions:null,getRouteInstructions:function(){return null===this.instructions&&(this.instructions=this.routeInstructions?this.routeInstructions.split(",").map(function(e,t){return{code:e,point:this.routeGeometry.components[t].components.first()}},this):[]),this.instructions},addComment:function(e){var t=this;return $.post(W.Config.paths.updateRequestComments,{mapUpdateRequestID:this.getID(),text:e}).done(function(e){e.isAutoFollowed&&(t.isFollowing=!0),t.comments.push(e.comment)})},hasPendingComments:function(){var e,t,i=this.comments||[],n=+Date.today().setTimeToNow().add(-2).weeks();return e=i.filter(function(e){return e.createdOn>n}),0===e.length?!1:(t=e.some(function(e){return-1===e.userID}),!t)},toggleFollowConversation:function(e){return $.post(W.Config.paths.updateRequestFollow,{mapUpdateRequestID:this.getID(),follow:e})},CLASS_NAME:"Waze.Feature.UpdateRequestSession"}),i.exports=n}}),this.require.define({"Waze/Feature/Vector":function(e,t,i){var n,s=t("Waze/Model/Object"),r=t("Waze/Util");n=OpenLayers.Class(OpenLayers.Feature.Vector,s,{initialize:function(e,t){this.attributes={},t&&t.parse&&e&&this.parse(e),e&&(this.attributes=OL.Util.extend(this.attributes,e))},merge:function(e){this.parse(e),OpenLayers.Util.extend(this.attributes,e)},getID:function(){return this.attributes.id},setID:function(e){this.attributes.id=e},getVersion:function(){return this.attributes.version||s.prototype.getVersion.apply(this)},clone:function(){var e,t=null,i=_.extend({},this.attributes);return this.attributes.geometry&&(t=this.attributes.geometry.clone()),i.geometry=t,e=new n(i),e.state=this.state,e},getPermissions:function(){return r.isDefined(this.attributes.permissions)?this.attributes.permissions:0},CLASS_NAME:"Waze.Feature.Vector"}),Object.defineProperty(n.prototype,"geometry",{get:function(){return this.attributes.geometry},set:function(e){this.attributes.geometry=e}}),i.exports=n}}),this.require.define({"Waze/Feature/Vector/CompositeSegment":function(e,t,i){var n,s=t("Waze/Feature/Vector/Segment");n=OpenLayers.Class(s,{children:null,address:null,addressDetails:null,attributeToReducer:null,attributeNames:["roadType","direction","level","fwdToll","revToll","fwdDirection","revDirection","permissions","updatedBy","createdBy","createdOn","updatedOn","length","allowNoDirection","rank","lockRank","routingRoadType"],attributeReverses:{fwdDirection:"directionReverser",revDirection:"directionReverser"},initialize:function(e,t,i){this.children=e,this.model=t,this.reverseSegments=i,this.attributeToReducer={permissions:this.reducers.and,length:this.reducers.sum,rank:this.reducers.max},this.calcAttributes()},directionReverser:function(e,t){return e.isOneWay()?!e.attributes[t]:e.attributes[t]},calcAttributes:function(){var e=this;this.mixed={},this.attributes={},this.address=null,this.addressDetails=null,this.attributeNames.forEach(function(t){var i=e.attributeReverses[t];e.attributes[t]=[],e.children.forEach(function(n){e.attributes[t].push(i&&e.reverseSegments[n.getID()]?e[i](n,t):n.attributes[t])});var n=e.attributes[t].unique();n.length>1&&(e.mixed[t]=!0),e.attributes[t]=e.attributeToReducer[t]?e.attributes[t].reduce(e.attributeToReducer[t]):1===n.length?e.attributes[t].first():n}),this.attributes.toll=!this.mixed.fewToll&&!this.mixed.revToll&&this.isTollRoad(),this.mixed.fwdDirection||this.mixed.revDirection?(this.attributes.direction="",this.mixed.direction=!0):this.attributes.direction=this.getDirection(),1===this.children.length&&["fwdRestrictions","revRestrictions"].forEach(function(t){e.attributes[t]=e.children[0].attributes[t]})},getAddress:function(){if(null!==this.address)return this.address;var e,t,i,n=this;return t={street:[],city:[],state:[],country:[],altStreets:[]},this.mixed.streetIDs=!1,this.children.length>0&&(i=this.children.first().attributes.streetIDs),this.children.forEach(function(s){e=s.getAddress(),t.street.push(e.street),t.city.push(e.city),t.state.push(e.state),t.country.push(e.country),n.mixed.streetIDs||(n.mixed.streetIDs=!i.equals(s.attributes.streetIDs)),t.altStreets=t.altStreets.concat(s.attributes.streetIDs)}),t.anyStreet=t.street.some(function(e){return e&&!e.isEmpty}),t.altStreets=t.altStreets.unique(),t.altStreets=t.altStreets.map(function(e){var t,i;return(t=n.model.streets.get(e))?(i=n.model.cities.get(t.cityID),{street:t,city:i}):null}),t.altStreets=t.altStreets.filter(function(e){return null!==e}),["street","city","state","country"].forEach(function(e){t[e]=t[e].uniqueBy(function(e,t){return e&&t?e.id===t.id:e===t}),1===t[e].length?t[e]=t[e].first():n.mixed[e]=!0}),this.address=t,t},getAddressDetails:function(){if(null!==this.addressDetails)return this.addressDetails;var e=s.prototype.getAddressDetails.apply(this,arguments),t=this.getAddress();return t.street?(e.streetName=this.mixed.street?I18n.t("edit.segment.no_common.street"):e.streetName,e.cityName=this.mixed.city?I18n.t("edit.segment.no_common.city"):e.cityName,e.stateName=this.mixed.state?I18n.t("edit.segment.no_common.state"):e.stateName,e.countryName=this.mixed.country?I18n.t("edit.segment.no_common.country"):e.countryName,this.addressDetails=e,e):null},getID:function(){return this.children.map(function(e){return e.getID()}).join(", ")},isHighway:function(){return this.children.every(function(e){return e.isHighway()})},reducers:{sum:function(e,t){return(e||0)+(t||0)},and:function(e,t){return e&t},max:function(e,t){return Math.max(e,t)}},CLASS_NAME:"Waze.Feature.Vector.CompositeSegment"}),i.exports=n}}),this.require.define({"Waze/Feature/Vector/Landmark":function(e,t,i){var n,s=t("Waze/Feature/Vector"),r=t("Waze/Model/Object"),o=t("Waze/Model/OpeningHour"),a=t("Waze/Model/Object/Image"),l=t("Waze/Model/PlaceUpdate/Builder"),h=t("Waze/Model/Object/NavigationPoint");n=OpenLayers.Class(s,{defaults:function(){return{name:"",description:"",rank:0,lockRank:0,url:null,phone:null,residential:!1,openingHours:[],categories:[],services:[],entryExitPoints:[],images:[],venueUpdateRequests:[],aliases:[],approved:!0,permissions:r.ALL_PERMISSIONS}},nested:{geometry:OL.Geometry,images:a,entryExitPoints:h},SERVICE_TYPES:["VALLET_SERVICE","DRIVETHROUGH","WI_FI","RESTROOMS","CREDIT_CARDS","RESERVATIONS","OUTSIDE_SEATING","AIR_CONDITIONING","PARKING_FOR_CUSTOMERS","DELIVERIES"],PERMISSIONS:{EDIT_GEOMETRY:1,EDIT_PROPERTIES:2,DELETE:4},DEFAULT_POLYGON_SIZE_METERS:20,initialize:function(){s.prototype.initialize.apply(this,arguments),_.defaults(this.attributes,this.defaults())},parse:function(e){s.prototype.parse.apply(this,arguments),this.parseUpdateRequests(e)},merge:function(e){_.defaults(e,this.defaults()),s.prototype.merge.apply(this,arguments)},parseUpdateRequests:function(e){if(e.venueUpdateRequests){var t=new l({areRequestsEditable:W.loginManager.canEditPlaceUpdates()});e.venueUpdateRequests=e.venueUpdateRequests.map(function(e){return e.place=this,t.build(e)},this)}},getCategorySet:function(){return this.attributes.categories.toSet()},getMainCategory:function(){return this._categoryToParentMap||(this._categoryToParentMap=this._generateCategoryToParentMap()),0===this.attributes.categories.length?null:this._categoryToParentMap[this.attributes.categories.first()]},_generateCategoryToParentMap:function(){var e={};return Object.forEach(W.Config.venues.subcategories,function(t,i){e[t]=t,i.forEach(function(i){e[i]=t})}),e},getServiceSet:function(){return this.attributes.services.toSet()},getAddress:function(){var e,t,i,n=this.model.streets.get(this.attributes.streetID);return n&&(e=this.model.cities.get(n.cityID)),e&&(t=this.model.states.get(e.stateID)),t&&(i=this.model.countries.get(e.countryID)),e&&t&&i||(n=null),{street:n,city:e,state:t,country:i}},hasAddress:function(){return null!==this.getAddress().street},getAddressDetails:function(){var e=this.getAddress(),t={};return e.street?(t.streetName=e.street.isEmpty?I18n.t("edit.address.no_street"):e.street.name,t.cityName=e.city.isEmpty?I18n.t("edit.address.no_city"):e.city.name,t.hasState=this.model.hasStates()&&!e.state.isDefault,t.stateName=e.state.name,t.countryName=e.country.name,t.houseNumber=this.attributes.houseNumber,t):null},is2D:function(){return this.geometry.components&&this.geometry.components.every(function(e){return e.components.length>3})},isPoint:function(){return"OpenLayers.Geometry.Point"===this.geometry.CLASS_NAME},isGasStation:function(){return!!this.getCategorySet().GAS_STATION},getPolygonGeometry:function(){if(!this.isPoint())return this.geometry.clone();var e,t,i,n,s,r;return e=this.geometry.clone().transform(new OL.Projection("EPSG:900913"),new OL.Projection("EPSG:4326")),t=OL.Util.destinationVincenty({lon:e.x,lat:e.y},45,Math.sqrt(2*Math.pow(this.DEFAULT_POLYGON_SIZE_METERS/2,2))),i=e.x-t.lon,n=e.y-t.lat,s=new OL.Geometry.LinearRing([new OL.Geometry.Point(e.x-i,e.y-n),new OL.Geometry.Point(e.x+i,e.y-n),new OL.Geometry.Point(e.x+i,e.y+n),new OL.Geometry.Point(e.x-i,e.y+n)]),r=new OL.Geometry.Polygon([s]),r.transform(new OL.Projection("EPSG:4326"),new OL.Projection("EPSG:900913")),r},getPointGeometry:function(){if(this.isPoint())return this.geometry.clone();var e=this.geometry.getBounds().getCenterLonLat();return new OL.Geometry.Point(e.lon,e.lat)},getLockRank:function(){return Math.max(this.attributes.rank,this.attributes.lockRank)},getNavigationPoint:function(){return this.attributes.entryExitPoints.length>0?this.attributes.entryExitPoints[0]:new h({point:this.geometry.getCentroid(!0),entry:!0,exit:!0})},isApproved:function(){return this.attributes.approved},getOpeningHours:function(){return new o.Collection(this.attributes.openingHours.map(function(e){return new o.OpeningHour(e)}))},hasUpdateRequests:function(){return this.attributes.venueUpdateRequests.length>0},getImagesByUserId:function(e){return _.filter(this.attributes.images,function(t){return t.get("creatorUserId")===e})},arePropertiesEditable:function(){return r.prototype.arePropertiesEditable.apply(this,arguments)&&this.attributes.approved},CLASS_NAME:"Waze.Feature.Vector.Landmark"}),i.exports=n}}),this.require.define({"Waze/Feature/Vector/MapProblem":function(e,t,i){var n,s=t("Waze/Feature/Vector");n=OpenLayers.Class(s,{nested:{geometry:OL.Geometry,bounds:OL.Geometry},ONE_WEEK_IN_MILLIS:6048e5,SeverityThreshold:{low:3,medium:7},disconnectBounds:null,initialize:function(){s.prototype.initialize.apply(this,arguments),this.setSeverity(this.attributes.weight),this.editable=this.attributes.open},merge:function(){s.prototype.merge.apply(this,arguments),this.editable=this.attributes.open},getDisconnectBounds:function(){return this.disconnectBounds||(this.disconnectBounds=this.attributes.bounds.getBounds()),this.disconnectBounds},getState:function(){return this.attributes.open?n.State.first():n.State[this.attributes.resolution+1]},setState:function(e){e===n.State.first()?(this.attributes.open=!0,this.attributes.resolution=null):(this.attributes.open=!1,this.attributes.resolution=n.State.indexOf(e)-1)},setSeverity:function(e){var t="high";e<=this.SeverityThreshold.low?t="low":e<=this.SeverityThreshold.medium&&(t="medium"),this.attributes.severity=t},getSessions:function(){return this.model.problemSessions.get([this.getID()])},isRecentlyClosed:function(){return!this.attributes.open&&Date.now()-this.attributes.resolvedOn<=this.ONE_WEEK_IN_MILLIS},CLASS_NAME:"Waze.Feature.Vector.MapProblem"}),n.State=["open","solved","rejected","solved"],i.exports=n}}),this.require.define({"Waze/Feature/Vector/Node":function(e,t,i){var n,s=t("Waze/Feature/Vector"),r=t("Waze/Util");n=OpenLayers.Class(s,{nested:{geometry:OL.Geometry},eachSegmentPair:function(e,t,i){Object.forEach(e,function(e,n){var s=e.split(",");t.call(i,parseInt(s[0],10),parseInt(s[1],10),n,e)})},allConnectionKeys:function(e){var t=[],i=[];return this.attributes.segIDs.forEach(function(n){var s=this.model.segments.get(n);this.attributes.segIDs.forEach(function(n){var r=this.model.segments.get(n);s&&r&&(s!==r||e)&&(t.push({from:s,to:r}),this.isTurnAllowedBySegDirections(s,r)&&i.push({from:s,to:r}))},this)},this),{all:t,legal:i}},isTurnAllowedBySegDirections:function(e,t){if(!e||!t)return!1;var i=e.attributes.toNodeID===this.getID()?e.attributes.fwdDirection:e.attributes.revDirection,n=t.attributes.fromNodeID===this.getID()?t.attributes.fwdDirection:t.attributes.revDirection;return i&&n},getAngleToSegment:function(e){var t,i,n,s=e.geometry.getVertices();return e.attributes.fromNodeID===this.getID()?(t=s[0],i=s[1]):(t=s[s.length-1],i=s[s.length-2]),n=Math.atan2(i.y-t.y,i.x-t.x).toDeg(),0>n&&(n=360+n),n},getDirectionBetweenSegments:function(e,t){var i,n,s,r=e.geometry.components,o=r.length;return e.attributes.toNodeID===this.getID()?(i=r[o-2],n=r[o-1]):(i=r[1],n=r[0]),s=t.attributes.fromNodeID===this.getID()?t.geometry.components[1]:t.geometry.components[t.geometry.components.length-2],(n.x-i.x)*(s.y-i.y)-(n.y-i.y)*(s.x-i.x)>0},isDisconnected:function(){return this.attributes.segIDs.isEmpty()},isConnectedToSegment:function(e){return this.attributes.segIDs.contains(e.getID())},isDeleteable:function(e){var t=this.attributes.segIDs.map(function(t){return e.segments.get(t)});return t=t.filter(function(e){return r.defined(e)}),t.length!==this.attributes.segIDs.length?!1:this.areSegmentsBridgable(t)&&s.prototype.isDeletable.apply(this)},areSegmentsBridgable:function(e){return e&&2===e.length&&this.attributes.segIDs.contains(e[0].getID())&&this.attributes.segIDs.contains(e[1].getID())&&(this.isTurnAllowedBySegDirections(e[0],e[1])||this.isTurnAllowedBySegDirections(e[1],e[0]))?e[0].attributes.primaryStreetID!==e[1].attributes.primaryStreetID?!1:!0:!1},allSegmentsPresent:function(e){return this.attributes.segIDs.every(function(t){return e.segments.get(t)})},connectionsExist:function(){return!this.allConnectionKeys().legal.isEmpty()},areConnectionsEditable:function(){return this.isAllowed(this.PERMISSIONS.EDIT_OPEN_TURNS)&&this.isAllowed(this.PERMISSIONS.EDIT_CLOSE_TURNS)},areAllConnectionsEnabled:function(){var e=this.allConnectionKeys().legal;return!e.isEmpty()&&e.every(function(e){var t=this.model.segments.get(e.from.getID());return t.attributes.toNodeID===this.getID()?t.attributes.toConnections[e.to.getID()]:t.attributes.fromConnections[e.to.getID()]},this)},areAllConnectionsDisabled:function(){var e=this.allConnectionKeys().legal;return!e.isEmpty()&&e.every(function(e){var t=this.model.segments.get(e.from.getID());return t.attributes.toNodeID===this.getID()?!t.attributes.toConnections[e.to.getID()]:!t.attributes.fromConnections[e.to.getID()]},this)},PERMISSIONS:{EDIT_GEOMETRY:1,DELETE:2,EDIT_OPEN_TURNS:4,EDIT_CLOSE_TURNS:8},CLASS_NAME:"Waze.Feature.Vector.Node"}),i.exports=n}}),this.require.define({"Waze/Feature/Vector/Segment":function(e,t,i){var n,s=t("Waze/Feature/Vector"),r=t("Waze/Action/UpdateObject"),o=t("Waze/Util"),a=t("Waze/Utils/Geo"),l=t("Waze/Model/Object/Restriction");n=OpenLayers.Class(s,{nested:{fwdRestrictions:l,revRestrictions:l,geometry:OL.Geometry},initialize:function(){s.prototype.initialize.apply(this,arguments),OpenLayers.Util.applyDefaults(this.attributes,this.DEFAULT_NEW_SEGMENT_ATTRIBUTES),o.defined(this.attributes.streetIDs)||(this.attributes.streetIDs=[]),this.attributes.fromConnections||(this.attributes.fromConnections={}),this.attributes.toConnections||(this.attributes.toConnections={})},parse:function(e){s.prototype.parse.apply(this,arguments),this.parseTurnRestrictions(e)},parseTurnRestrictions:function(e){["fromRestrictions","toRestrictions"].forEach(function(t){Object.forEach(e[t]||{},function(i,n){e[t][i]=n.map(function(e){return new l(e,{parse:!0})})})})},cloneRestrictions:function(e){var t={};return Object.forEach(e,function(e,i){t[e]=i.map(function(e){return e.clone()})}),t},merge:function(){delete this.attributes.origIDs,s.prototype.merge.apply(this,arguments)},copyAttributes:function(e){var t=this.attributes,i=t.geometry;OpenLayers.Util.extend(t,e.attributes),Object.forEach(t,function(e,i){i instanceof Array&&(t[e]=i.slice(0))}),delete t.origIDs,t.geometry=i},getRestrictionsAtNode:function(e){return this.attributes.toNodeID===e.getID()?this.attributes.toRestrictions:this.attributes.fromRestrictions},getConnectionsAtNode:function(e){return this.attributes.toNodeID===e.getID()?this.attributes.toConnections:this.attributes.fromConnections},getAddress:function(){var e,t,i,n,s=this.model.streets.get(this.attributes.primaryStreetID),r=this;return s&&(e=this.model.cities.get(s.cityID)),e&&(t=this.model.states.get(e.stateID)),t&&(i=this.model.countries.get(e.countryID)),e&&t&&i?n=this.attributes.streetIDs.map(function(e){r.model.streets.get(e)}):s=null,{street:s,city:e,state:t,country:i,altStreets:n}},getAddressDetails:function(){var e=this.getAddress(),t={};return e.street?(t.streetName=e.street.isEmpty?I18n.t("edit.address.no_street"):e.street.name,t.cityName=e.city.isEmpty?I18n.t("edit.address.no_city"):e.city.name,t.hasState=this.model.hasStates()&&!e.state.isDefault,t.stateName=e.state.name,t.countryName=e.country.name,t):null},getCenter:function(){var e,t,i,n=this.geometry.getLength(),s=n/2,r=n;for(t=1,i=this.geometry.components.length;i>t&&(e=this.geometry.components[t-1].distanceTo(this.geometry.components[t]),r-=e,!(s>=r));t++);var o=this.geometry.components[t-1],a=this.geometry.components[t],l=Math.atan2(a.y-o.y,a.x-o.x),h=s-r,u=new OpenLayers.Geometry.Point(o.x,o.y);return u.x+=h*Math.cos(l),u.y+=h*Math.sin(l),u},getArrowPoints:function(e,t,i){var n,s,r,a,l,h=[],u=this.geometry.components,c=0,d=0;if(!o.defined(e))return[];for(t&&e>t&&(c+=e-t),n=u[d];d<u.length-1;)s=u[d+1],l=n.distanceTo(s),i&&d===u.length-2&&(l-=i),e>c+l?(c+=l,d++,n=s):(r=Math.atan2(s.y-n.y,s.x-n.x),a=e-c,n=new OpenLayers.Geometry.Point(n.x,n.y),n.move(a*Math.cos(r),a*Math.sin(r)),h.push([n.clone(),r]),c=0);return h},getSubSegment:function(e,t){var i,n,s,r,o,a=0,l=this.geometry.components,h=[],u=0;for(t&&(l=l.clone().reverse()),i=l.first(),h.push(new OpenLayers.Geometry.Point(i.x,i.y));e>a&&u<l.length-1;)n=l[u+1],s=i.distanceTo(n),e>a+s?(h.push(new OpenLayers.Geometry.Point(n.x,n.y)),a+=s,i=n,u++):(r=e-a,o=Math.atan2(n.y-i.y,n.x-i.x),i=new OpenLayers.Geometry.Point(i.x,i.y),i.move(r*Math.cos(o),r*Math.sin(o)),h.push(i),a=e);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(h))},clone:function(){var e,t=_.extend({},this.attributes);return this.attributes.geometry&&(t.geometry=this.attributes.geometry.clone()),e=new n(t),this.attributes.streetIDs&&(e.attributes.streetIDs=this.attributes.streetIDs.clone()),e.attributes.fromRestrictions=this.cloneRestrictions(this.attributes.fromRestrictions),e.attributes.toRestrictions=this.cloneRestrictions(this.attributes.toRestrictions),e.attributes.fromConnections=_.clone(this.attributes.fromConnections),e.attributes.toConnections=_.clone(this.attributes.toConnections),e.state=this.state,e},splitByGeoms:function(e){var t,i=this.clone(),n=[];return delete i.geometry,e.forEach(function(e){t=i.clone(),t.geometry=e,t.geometry.calculateBounds(),t.state=OpenLayers.State.INSERT,n.push(t)}),n},isDrivable:function(){return this.attributes.fwdDirection||this.attributes.revDirection},isOneWay:function(){return this.attributes.fwdDirection?!this.attributes.revDirection:this.attributes.revDirection},reverseDirection:function(){this.isOneWay()&&(this.attributes.fwdDirection=!this.attributes.fwdDirection,this.attributes.revDirection=!this.attributes.revDirection)},isConnectedToNode:function(e){return this.attributes.toNodeID===e.getID()||this.attributes.fromNodeID===e.getID()},isSingular:function(){var e=this.geometry.components.first();return this.geometry.components.every(function(t){return t.equals(e)})},edgeIntersectionWithEllipse:function(e,t,i,n,s){var r,o=1,a=1;i>n?(a=i/n,r=i):(o=n/i,r=n);var l,h,u,c,d,p,m,g=(e[1].x-e[0].x)*o,f=(e[1].y-e[0].y)*a,y=(e[0].x-t.x)*o,v=(e[0].y-t.y)*a,b=(e[1].x-t.x)*o,L=(e[1].y-t.y)*a,w=Math.sqrt(y*y+v*v),S=r>w,C=[];return l=g*g+f*f,h=2*(y*g+v*f),u=y*y+v*v-r*r,c=h*h-4*l*u,0>c?!1:(c=Math.sqrt(c),d=(-h+c)/(2*l),p=(-h-c)/(2*l),[d,p].sort().forEach(function(i){i>=0&&1>=i&&(m=new OpenLayers.Geometry.Point(e[0].x+i*g/o,e[0].y+i*f/a),C.push({point:m,angle:(2*Math.PI+Math.atan2((m.y-t.y)*a,(m.x-t.x)*o))%(2*Math.PI),goingOut:S,index:s}),S=!S)}),C.isEmpty()?r>w&&Math.sqrt(b*b+L*L)<r:C)},intersectionWithEllipse:function(e,t,i){var n,s,r,o,a=this.geometry.getVertices(),l=[],h=!0;for(n=a[0],r=0;r<a.length-1;r++){if(s=a[r+1],o=this.edgeIntersectionWithEllipse([n,s],e,t,i,r),o instanceof Array?l=l.concat(o):h&=o,l.length>2)return!1;n=s}return l.isEmpty()?h:l},is:function(){var e,t,i,n,s,r=this.geometry.components,o=r.length;for(t=r[0],n=r[1],e=0;o-2>e;e++){i=r[e+2];var a=[i.x-n.x,i.y-n.y],l=[t.x-n.x,t.y-n.y],h=Math.sqrt(a[0]*a[0]+a[1]*a[1]),u=Math.sqrt(l[0]*l[0]+l[1]*l[1]);s=Math.acos((a[0]*l[0]+a[1]*l[1])/(h*u)),t=n,n=i}},setDirection:function(e){this.attributes.fwdDirection=0!==(1&e),this.attributes.revDirection=0!==(2&e)},getDirection:function(){return(this.attributes.fwdDirection?1:0)+(this.attributes.revDirection?2:0)},isTollRoad:function(){return this.attributes.fwdToll||this.attributes.revToll},setTollRoad:function(e){this.attributes.fwdToll=this.attributes.revToll=e},getEntireStreet:function(){var e=this.attributes.primaryStreetID,t=this.model.streets.get(e);if(!t||t.isEmpty)return[this];var i=function(t){return t.attributes.primaryStreetID===e},n=W.selectionManager.bfs(this,i,function(){return!1});return this.model.segments.getByIds(Object.keys(n[1]))},getConnectedSegments:function(e){var t=this.model.nodes.get(this.attributes[e+"NodeID"]),i=this;return t?t.attributes.segIDs.map(function(e){return i.model.segments.get(e)}):[]},getTurnsLockAttribute:function(e){return e.getID()===this.attributes.toNodeID?"fwdTurnsLocked":"revTurnsLocked"},getNodeAttribute:function(e){return this.attributes.fromNodeID===e.getID()?"from":this.attributes.toNodeID===e.getID()?"to":null},areTurnsLocked:function(e){return e.getID()===this.attributes.toNodeID?this.attributes.fwdTurnsLocked:this.attributes.revTurnsLocked},setTurnsLock:function(e,t){e.getID()===this.attributes.toNodeID?this.attributes.fwdTurnsLocked=t:this.attributes.revTurnsLocked=t},equals:function(e){return e.getID()===this.getID()&&e.type===this.type},isLockedByHigherRank:function(){return this.attributes.lockRank&&this.model.loginManager.isLoggedIn()?this.getLockRank()>this.model.loginManager.user.rank:!1},getLockRank:function(){return null===this.attributes.lockRank?this.attributes.rank:this.attributes.lockRank},hasEmptyStreet:function(){var e=this.model.streets.get(this.attributes.primaryStreetID);return e&&e.isEmpty},isHighway:function(){return this.HIGHWAY_ROAD_TYPES.contains(this.attributes.roadType)},hasFromNode:function(){return null!==this.attributes.fromNodeID},getFromNode:function(){return this.hasFromNode()?this.model.nodes.get(this.attributes.fromNodeID):null},hasToNode:function(){return null!==this.attributes.toNodeID},getToNode:function(){return this.hasToNode()?this.model.nodes.get(this.attributes.toNodeID):null},canForceHouseNumbers:function(){return this.isAllowed(this.PERMISSIONS.FORCE_HOUSE_NUMBERS)},canEditHouseNumbers:function(){return this.isAllowed(this.PERMISSIONS.EDIT_HOUSE_NUMBERS)},getRestrictionCount:function(){var e=0;return this.attributes.fwdRestrictions&&(e+=this.attributes.fwdRestrictions.length),this.attributes.revRestrictions&&(e+=this.attributes.revRestrictions.length),e},lockTurns:function(e,t){var i,n={};return n[this.getTurnsLockAttribute(e)]=!0,i=new r(this,n),t?i:void this.model.actionManager.add(i)},getFwdHeading:function(){var e=this.geometry.components;return a.getHeading(e[0],e[e.length-1])},getRevHeading:function(){var e=this.geometry.components;return a.getHeading(e[e.length-1],e[0])},isTurnAllowed:function(e,t){var i=e.getID(),n=this.getNodeAttribute(t);return n?this.attributes[n+"Connections"][i]:!1},canUserSetDefaultRank:function(e){return e>=this.attributes.rank},canEditRoutingRoadTypes:function(){return this.isAllowed(this.PERMISSIONS.EDIT_ROUTING_ROAD_TYPES)},isRoutable:function(){return this.ROUTING_ROAD_TYPES.contains(this.attributes.roadType)},getRoutingRoadTypes:function(){{var e,t;this.attributes.roadType}return t={prev:null,next:null},this.isRoutable()?(e=this.ROUTING_ROAD_TYPES.indexOf(this.attributes.roadType),t.prev=this.ROUTING_ROAD_TYPES[e-1]||null,t.next=this.ROUTING_ROAD_TYPES[e+1]||null,t):t},MinLevel:-5,MaxLevel:9,HIGHWAY_ROAD_TYPES:[3,4,6,7],ROUTING_ROAD_TYPES:[1,2,7,6,3],DEFAULT_NEW_SEGMENT_ATTRIBUTES:{type:1,roadType:1,fromNodeID:null,toNodeID:null,fwdDirection:!0,revDirection:!1,fwdTurnsLocked:!0,revTurnsLocked:!0,level:0,allowNoDirection:!0,rank:0,lockRank:null,permissions:2147483647,routingRoadType:null},PERMISSIONS:{EDIT_GEOMETRY:1,EDIT_PROPERTIES:2,DELETE:4,EDIT_EMPTY_STREET:8,SPLIT_DIRECTIONS:16,SET_UNKNOWN_DIRECTIONS:32,EDIT_HOUSE_NUMBERS:64,FORCE_HOUSE_NUMBERS:128,EDIT_CONNECTIONS:256,EDIT_ROUTING_ROAD_TYPES:512},CLASS_NAME:"Waze.Feature.Vector.Segment"}),i.exports=n}}),this.require.define({"Waze/Feature/Vector/SpeedCamera":function(e,t,i){var n,s=t("Waze/Feature/Vector");n=OpenLayers.Class(s,{nested:{geometry:OL.Geometry},initialize:function(){s.prototype.initialize.apply(this,arguments),this.typeName=this.TYPES[this.attributes.type]},isValidationStateEditable:function(){return this.state===OpenLayers.State.UPDATE||!this.attributes.validated},PERMISSIONS:{EDIT_GEOMETRY:1,EDIT_PROPERTIES:2,DELETE:4},UNITS:{speed:"km"},TYPES:{2:"Speed camera",3:"Dummy",4:"Red light camera"},CLASS_NAME:"Waze.Feature.Vector.SpeedCamera"}),i.exports=n}}),this.require.define({"Waze/Feature/Vector/TurnProblem":function(e,t,i){var n,s=t("Waze/Feature/Vector/MapProblem"),r=t("Waze/Feature/Vector");n=OpenLayers.Class(s,{initialize:function(){r.prototype.initialize.apply(this,arguments),this.editable=this.attributes.open,this.attributes.reroutePercent=this.reroutePercent(),this.setSeverity(this.attributes.priority),this.attributes.problemType="turn"},getSessions:function(){return this.model.turnProblemDetails.get([this.getID()])},reroutePercent:function(){return(this.attributes.reroutesCounter/(this.attributes.reroutesCounter+this.attributes.routesCounter)*100).toFixed(0)},setSeverity:function(e){var t="high";t=-1===e?"low":this.attributes.reroutePercent>=90?"high":"medium",this.attributes.severity=t},CLASS_NAME:"Waze.Feature.Vector.TurnProblem"}),i.exports=n}}),this.require.define({"Waze/Format/Operation":function(e,t,i){var n=OpenLayers.Class(OpenLayers.Format.JSON,{initialize:function(e){OpenLayers.Format.JSON.prototype.initialize.apply(this,[e])},write:function(e){return this.writeSubActions(e._subActions?e._subActions:e),OpenLayers.Format.JSON.prototype.write.apply(this,[{actions:e}])},writeSubActions:function(e){e.forEach(function(e){e._subActions&&this.writeSubActions(e._subActions)},this)},CLASS_NAME:"Waze.Format.Operation"});i.exports=n}}),this.require.define({"Waze/Format/ParseMixin":function(e,t,i){(function(){var e,n,s={}.hasOwnProperty;e=t("Waze/Utils/Geo"),n={parse:function(e){var t,i,n,r;r=this.nested;for(t in r)s.call(r,t)&&(i=r[t],n=e[t],n&&(e[t]=_.isArray(n)?n.map(function(e){return function(n){return e.parseField(n,i,t)}}(this)):this.parseField(n,i,t)))},parseField:function(t,i,n){var s,r;return i===OL.Geometry?(s=e.parse(t),(null!=(r=this.attributes)?r[n]:void 0)&&(s.id=this.attributes[n].id),s):new i(t,{parse:!0})}},i.exports=n}).call(this)}}),this.require.define({"Waze/Format/Serializer":function(e,t,i){(function(){var e,n,s={}.hasOwnProperty;e=t("Waze/Model/Object"),n=OL.Class(OL.Format.GeoJSON,{TYPE_TO_CLASS:{segments:t("Waze/Feature/Vector/Segment"),nodes:t("Waze/Feature/Vector/Node"),problems:t("Waze/Feature/Vector/MapProblem"),turnProblems:t("Waze/Feature/Vector/TurnProblem"),problemSessions:t("Waze/Feature/MapProblemDetails/Collection"),turnProblemDetails:t("Waze/Feature/TurnProblemDetails/Collection"),updateRequestSessions:t("Waze/Feature/UpdateRequestSession"),archives:t("Waze/Model/Object/Archive"),archiveSessions:t("Waze/Model/Object/ArchiveSession"),venues:t("Waze/Feature/Vector/Landmark"),users:t("Waze/Model/Object/User"),cameras:t("Waze/Feature/Vector/SpeedCamera"),mapUpdateRequests:t("Waze/Feature/Vector/UpdateRequest"),houseNumbers:t("Waze/Feature/HouseNumber/Collection"),roadClosures:t("Waze/Model/Object/RoadClosure"),managedAreas:t("Waze/Feature/ManagedArea")},read:function(e){var t,i,n;n=[];for(i in e)s.call(e,i)&&(t=e[i],n.push(this._parseObjects(i,t.objects)));return n},_parseObjects:function(t,i){var n,s,r,o,a,l;for(n=this.TYPE_TO_CLASS[t]||e,l=[],s=o=0,a=i.length;a>o;s=++o)r=i[s],l.push(i[s]=new n(r,{parse:!0}));return l}}),i.exports=n}).call(this)}}),this.require.define({"Waze/Geometry/AggregatePoint":function(e,t,i){var n=OpenLayers.Class(OpenLayers.Geometry.Point,{points:null,initialize:function(e){OpenLayers.Geometry.Point.prototype.initialize.apply(this,[e[0].x,e[0].y]),this.points=e},clone:function(){return new n(this.points)},calculateBounds:function(){OpenLayers.Geometry.Point.prototype.calculateBounds.apply(this);for(var e=0;e<this.points.length;e++)this.points[e].calculateBounds()},move:function(e,t){OpenLayers.Geometry.Point.prototype.move.apply(this,arguments);for(var i=0;i<this.points.length;i++)this.points[i].move(e,t)},translate:function(e,t){this.x=e,this.y=t,this.clearBounds(),this.points.forEach(function(i){i.x=e,i.y=t,i.clearBounds()})
},rotate:function(e,t){OpenLayers.Geometry.Point.prototype.rotate.apply(this,arguments);for(var i=0;i<this.points.length;i++)this.points[i].rotate(e,t)},resize:function(e,t,i){OpenLayers.Geometry.Point.prototype.resize.apply(this,arguments);for(var n=0;n<this.points.length;n++)this.points[n].resize(e,t,i)},transform:function(e,t){OpenLayers.Geometry.Point.prototype.transform.apply(this,arguments);for(var i=0;i<this.points.length;i++)this.points[i].transform(e,t)}});i.exports=n}}),this.require.define({"Waze/Handler/DragElement":function(e,t,i){(function(){var e;e=OL.Class({started:!1,stopDown:!0,dragging:!1,touch:!1,last:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,forced:!1,active:!1,initialize:function(t){this.map=t,this.uniqueID=e.baseID--},callback:function(e,t){return this[e]?this[e].apply(this,t):void 0},dragstart:function(e){var t;return e.xy=new OL.Pixel(e.clientX-this.map.viewPortDiv.offsets[0],e.clientY-this.map.viewPortDiv.offsets[1]),t=!0,this.dragging=!1,(OL.Event.isLeftClick(e)||OL.Event.isSingleTouch(e))&&(this.started=!0,this.start=e.xy,this.last=e.xy,OL.Element.addClass(this.map.viewPortDiv,"olDragDown"),this.down(e),this.callback("down",[e.xy]),OL.Event.stop(e),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart?document.onselectstart:OL.Function.True),document.onselectstart=OL.Function.False,t=!this.stopDown),t},forceStart:function(e){return null==e&&(e=!1),this.started=!0,this.endOnMouseUp=e,this.forced=!0,this.last={x:0,y:0},this.callback("force")},forceEnd:function(){return this.forced?this.endDrag():void 0},dragmove:function(e){return this.map.viewPortDiv.offsets&&(e.xy=new OL.Pixel(e.clientX-this.map.viewPortDiv.offsets[0],e.clientY-this.map.viewPortDiv.offsets[1])),this.lastMoveEvt=e,!this.started||this.timeoutId||e.xy.x===this.last.x&&e.xy.y===this.last.y||(this.interval>0&&(this.timeoutId=setTimeout(OL.Function.bind(this.removeTimeout,this),this.interval)),this.dragging=!0,this.move(e),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart,document.onselectstart=OL.Function.False),this.last=e.xy),!0},dragend:function(e){var t;return e.xy=new OL.Pixel(e.clientX-this.map.viewPortDiv.offsets[0],e.clientY-this.map.viewPortDiv.offsets[1]),this.started&&(t=this.start!==this.last,this.endDrag(),this.up(e),this.callback("up",[e.xy]),t&&this.callback("done",[e.xy])),!0},endDrag:function(){return this.started=!1,this.dragging=!1,this.forced=!1,OL.Element.removeClass(this.map.viewPortDiv,"olDragDown"),document.onselectstart=this.oldOnselectstart},down:function(){},move:function(){},up:function(){},out:function(){},mousedown:function(e){return this.dragstart(e)},touchstart:function(e){return this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,scope:this})),this.dragstart(e)},mousemove:function(e){return this.dragmove(e)},touchmove:function(e){return this.dragmove(e)},removeTimeout:function(){return this.timeoutId=null,this.dragging?this.mousemove(this.lastMoveEvt):void 0},mouseup:function(e){return(!this.forced||this.endOnMouseUp)&&this.started?this.dragend(e):void 0},touchend:function(e){return e.xy=this.last,this.forced?void 0:this.dragend(e)},click:function(){return this.start===this.last},activate:function(e){var t;return this.$el=e,this.active=!0,t=$(this.map.viewPortDiv),this.$el.on("mousedown.drag-"+this.uniqueID,$.proxy(this.mousedown,this)),this.$el.on("touchstart.drag-"+this.uniqueID,$.proxy(this.touchstart,this)),$(document).on("mouseup.drag-"+this.uniqueID,$.proxy(this.mouseup,this)),t.on("mousemove.drag-"+this.uniqueID,$.proxy(this.mousemove,this)),t.on("touchmove.drag-"+this.uniqueID,$.proxy(this.touchmove,this)),t.on("touchend.drag-"+this.uniqueID,$.proxy(this.touchend,this))},deactivate:function(){return this.active=!1,this.$el.off(".drag-"+this.uniqueID),$(this.map.viewPortDiv).off(".drag-"+this.uniqueID),$(document).off(".drag-"+this.uniqueID),this.touch=!1,this.started=!1,this.forced=!1,this.dragging=!1,this.start=null,this.last=null,OL.Element.removeClass(this.map.viewPortDiv,"olDragDown")},adjustXY:function(e){var t;return t=OL.Util.pagePosition(this.map.viewPortDiv),e.xy.x-=t[0],e.xy.y-=t[1]},CLASS_NAME:"W.Handler.DragElement"}),e.baseID=0,i.exports=e}).call(this)}}),this.require.define({"Waze/Handler/Ellipse":function(e,t,i){var n,s=t("Waze/Renderer/ExtendedSVG");n=OpenLayers.Class(OpenLayers.Handler,{drawing:!1,dragging:!1,layer:null,style:null,point:null,lastDown:null,lastMove:null,distanceLine:null,radius:0,rx:0,ry:0,regular:!1,geodesicPixelSize:null,MinEllipseSize:15,MaxEllipseSizeMeters:100,oldOnselectstart:null,initialize:function(e,t,i){i&&i.layerOptions&&i.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style.default,{})),OpenLayers.Handler.prototype.initialize.apply(this,arguments)},setRegular:function(e){this.regular!==e&&(this.regular=e,this.modifyFeature(this.lastMove))},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments))return!1;var e=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True},this.layerOptions),t=OpenLayers.Layer.Vector.prototype.renderers;return OpenLayers.Layer.Vector.prototype.renderers=[s],this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,e),OpenLayers.Layer.Vector.prototype.renderers=t,this.map.addLayer(this.layer),this.map.events.on({zoomend:this.onZoom,scope:this}),!0},deactivate:function(){return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)?(this.drawing&&this.cancel(),this.destroyFeature(),null!==this.layer.map&&this.layer.destroy(!1),this.map.events.un({zoomend:this.zoomend}),this.layer=null,!0):!1},onZoom:function(){this.drawing&&this.cancel()},dblclick:function(e){return OpenLayers.Event.stop(e),!1},mouseup:function(){return this.drawing&&this.dragging?(this.finalize(),!1):void 0},mousedown:function(e){return this.drawing?(this.finalize(),!1):(this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart?document.onselectstart:OpenLayers.Function.True),document.onselectstart=OpenLayers.Function.False,this.checkModifiers(e)?this.lastDown&&this.lastDown.equals(e.xy)?!0:(this.drawing=!0,this.geodesicPixelSize=this.map.getGeodesicPixelSize().w,null===this.lastDown&&this.createFeature(e.xy),this.lastDown=e.xy,!1):!0)},createFeature:function(e){var t,i=this.map.getLonLatFromPixel(e),n=new OpenLayers.Geometry.LineString;t=this.style?OpenLayers.Util.extend({},this.style):OpenLayers.Util.extend({},this.layerOptions.styleMap.styles.default.defaultStyle),t.rx=this.MinEllipseSize,t.ry=this.MinEllipseSize,this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(i.lon,i.lat),{},t),n.addPoint(this.point.geometry.clone()),n.addPoint(this.point.geometry.clone()),this.distanceLine=new OpenLayers.Feature.Vector(n),this.callback("create",[this.point.geometry,this.point]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.point],{silent:!0})},finalize:function(e){document.onselectstart=this.oldOnselectstart;var t,i=e?"cancel":"done";this.point&&(t=new OpenLayers.LonLat(this.point.geometry.x,this.point.geometry.y)),this.drawing=!1,this.dragging=!1,this.regular=!1,this.destroyFeature(),Math.min(this.rx,this.ry)>this.MinEllipseSize&&this.callback(i,[{x:t.lon,y:t.lat,rx:this.rx,ry:this.ry}]),this.lastDown=null,this.rx=0,this.ry=0},destroyFeature:function(){this.layer&&this.layer.destroyFeatures(),this.point=null,this.distanceLine=null},cancel:function(){this.finalize(!0)},modifyFeature:function(e,t){var i,n,s,r,o,a,l,h,u,c,d=this.distanceLine.geometry.components.last(),p=new OpenLayers.LonLat(this.point.geometry.x,this.point.geometry.y);this.lastMove=e,c=this.map.getPixelFromLonLat(p),l=e.y-c.y,a=e.x-c.x,o=Math.atan2(l,a),this.rx=Math.abs(a),this.ry=Math.abs(l),this.rx<this.MinEllipseSize&&(this.rx=this.MinEllipseSize),this.ry<this.MinEllipseSize&&(this.ry=this.MinEllipseSize),n=Math.floor(this.geodesicPixelSize*this.rx*1e3),s=Math.floor(this.geodesicPixelSize*this.ry*1e3),n>this.MaxEllipseSizeMeters&&(this.rx=1/(10*this.geodesicPixelSize)),s>this.MaxEllipseSizeMeters&&(this.ry=1/(10*this.geodesicPixelSize)),r=Math.max(this.rx,this.ry),i=Math.ceil(this.geodesicPixelSize*r*1e3),t.shiftKey||(this.rx=r,this.ry=r),this.ry>this.rx?(h=this.rx/this.ry,u=1):(u=this.ry/this.rx,h=1),o=Math.atan2(l/u,a/h),this.callback("modify",[this.point.geometry,this.point]),d.x=p.lon+this.rx*Math.cos(o)*this.map.getResolution(),d.y=p.lat-this.ry*Math.sin(o)*this.map.getResolution(),d.clearBounds(),this.distanceLine.geometry.clearBounds(),this.point.geometry.clearBounds(),this.point.style.rx=this.rx,this.point.style.ry=this.ry,this.point.style.label=i+"m",this.drawCircle()},drawCircle:function(){this.layer.drawFeature(this.point),this.layer.drawFeature(this.distanceLine)},mousemove:function(e){return this.drawing&&(this.dragging=!0,this.modifyFeature(e.xy,e),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart,document.onselectstart=OpenLayers.Function.False)),!1},CLASS_NAME:"Waze.Handler.Ellipse"}),i.exports=n}}),this.require.define({"Waze/Handler/Feature":function(e,t,i){var n=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{mousemove:{in:"over",out:"out"},click:{in:"click"},dblclick:{in:"dblclick",out:null}},feature:null,lastFeature:null,geometryTypes:null,initialize:function(e,t,i,n){OpenLayers.Handler.prototype.initialize.apply(this,[e,i,n]),this.layer=t},mousemove:function(e){return this.callbacks.over||this.callbacks.out?(this.handle(e),!0):!0},click:function(e){return this.handle(e)?!this.stopClick:!0},geometryTypeMatches:function(e){return null===this.geometryTypes||OpenLayers.Util.indexOf(this.geometryTypes,e.geometry.CLASS_NAME)>-1},handle:function(e){this.feature&&!this.feature.layer&&(this.feature=null);var t=e.type,i=!1,n=!!this.feature;if(this.feature=this.layer.getFeatureFromEvent(e),this.feature&&!this.feature.layer&&(this.feature=null),this.lastFeature&&!this.lastFeature.layer&&(this.lastFeature=null),this.feature){var s=this.feature!==this.lastFeature,r=s&&this.feature._virtualParent===this.lastFeature,o="click"===t||"dblclick"===t||"touchstart"===t;this.geometryTypeMatches(this.feature)&&this.feature.layer&&!this.feature.layer.featuresNonSelectable?(n&&s&&!r?(this.lastFeature&&this.triggerCallback(t,"out",[this.lastFeature]),this.triggerCallback(t,"in",[this.feature])):(!n||o)&&this.triggerCallback(t,"in",[this.feature]),this.lastFeature=this.feature,i=!0):(this.lastFeature&&n&&s&&this.triggerCallback(t,"out",[this.lastFeature]),this.feature=null)}else this.lastFeature&&n&&this.triggerCallback(t,"out",[this.lastFeature]);return i},triggerCallback:function(e,t,i){var n=this.EVENTMAP[e][t];n&&this.callback(n,i)},activate:function(){var e=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.moveLayerToTop(),this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),e=!0),e},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.moveLayerBack(),this.feature=null,this.lastFeature=null,this.down=null,this.up=null,this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),e=!0),e},handleMapEvents:function(e){e.property&&"order"!==e.property||this.moveLayerToTop()},moveLayerToTop:function(){var e=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(e)},moveLayerBack:function(){var e=this.layer.getZIndex()-1;e>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(e):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"Waze.Handler.Feature"});i.exports=n}}),this.require.define({"Waze/Handler/KeyboardShortcut":function(e,t,i){var n=OpenLayers.Class(OpenLayers.Handler.Keyboard,{initialize:function(){OpenLayers.Handler.Keyboard.prototype.initialize.apply(this,arguments)},destroy:function(){OpenLayers.Handler.Keyboard.prototype.destroy.apply(this,arguments)},handleKeyEvent:function(e){$(e.target).is(":input")||OpenLayers.Handler.Keyboard.prototype.handleKeyEvent.apply(this,arguments)},CLASS_NAME:"Waze.Handler.KeyboardShortcut"});i.exports=n}}),this.require.define({"Waze/HidableMessage":function(e,t,i){(function(){var e;e=OL.Class({LocalStorageKey:"hiddenMessages",name:null,initialize:function(e){return this.name=e},shouldShow:function(){return!this.hiddenMessages[this.name]},render:function(){return JST["templates/"+this.name]()},hide:function(t){var i,n;return null!=t&&"function"==typeof t.preventDefault&&t.preventDefault(),i=$(this),n=i.data("hide-message"),i.parents(".hidable-message").fadeOut("fast"),e.prototype.hiddenMessages[n]=!0,e.persist()}}),e.restore=function(){var e,t;return e=localStorage.getItem(this.prototype.LocalStorageKey),this.prototype.hiddenMessages=function(){if(null==e)return{};try{return JSON.parse(e)}catch(i){return t=i,{}}}()},e.persist=function(){try{return localStorage.setItem(this.prototype.LocalStorageKey,JSON.stringify(this.prototype.hiddenMessages))}catch(e){}},e.init=function(){return this.restore(),$(document).on("click.hidable-messages","[data-hide-message]",e.prototype.hide)},e.init(),i.exports=e}).call(this)}}),this.require.define({"Waze/Layer/ArchiveLayer":function(e,t,i){var n,s=t("Waze/Layer/UserDrive"),r=t("Waze/Renderer/ExtendedSVG");n=OpenLayers.Class(OpenLayers.Layer.Vector,s,{renderers:[r],initialize:function(){s.prototype.initialize.apply(this,arguments),OpenLayers.Layer.Vector.prototype.initialize.apply(this,arguments),this.styleMap.styles.select=new OpenLayers.Style({strokeColor:"black",strokeWidth:10,pointerEvents:"none"}),this.styleMap.styles.highlight=new OpenLayers.Style({strokeWidth:10,strokeOpacity:1})},setMap:function(){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments),s.prototype.setMap.apply(this,arguments)},destroy:function(){OpenLayers.Layer.Vector.prototype.destroy.apply(this,arguments),s.prototype.destroy.apply(this,arguments)},drawDrive:function(){this.clearDrive();var e=this.pm.currentSessionData;e&&e.drive&&e.drive.forEach(function(t){e.isDrivePartMatched(t)?this.drawUserDrive(t.geometry):this.drawDisconnect(t.geometry)},this)},clearDrive:function(){this.removeAllFeatures()},zoomToDrive:function(){var e,t,i=this.pm.currentSessionData;i&&(e=i.getDriveBounds(),t=this.map.getZoomForExtent(e),this.map.setCenter(e.getCenterLonLat(),t))},redraw:function(){this.pm&&this.drawDrive()},CLASS_NAME:"Waze.Layer.ArchiveLayer"}),i.exports=n}}),this.require.define({"Waze/Layer/FeatureLayer":function(e,t,i){(function(){var e,n;e=t("Waze/Model/EventType"),n=OL.Class(OL.Layer.Vector,{repo:null,_featureMap:null,model:null,initialize:function(e,t,i,n){var s,r,o,a;for(this.model=t,this.repo=i,OL.Layer.Vector.prototype.initialize.apply(this,[e,n]),this._featureMap={},_(this.repo).isArray()||(this.repo=[this.repo]),a=this.repo,r=0,o=a.length;o>r;r++)s=a[r],this.registerRepoEvents(s)},registerRepoEvents:function(t){return t.events.register(e.ADDED,this,this.onFeaturesAdded),t.events.register(e.CHANGED,this,this.onFeaturesChanged),t.events.register(e.REMOVED,this,this.onFeaturesRemoved)},unregisterRepoEvents:function(t){return t.events.unregister(e.ADDED,this,this.onFeaturesAdded),t.events.unregister(e.CHANGED,this,this.onFeaturesChanged),t.events.unregister(e.REMOVED,this,this.onFeaturesRemoved)},destroy:function(){var e,t,i,n;for(n=this.repo,t=0,i=n.length;i>t;t++)e=n[t],this.unregisterRepoEvents(e);return OL.Layer.Vector.prototype.destroy.apply(this)},getVector:function(e){return this._featureMap[e.getID()]||null},onFeaturesAdded:function(e){return e=e.map(function(e){return function(t){var i;return i=new OL.Feature.Vector(t.geometry),i.model=t,e._featureMap[t.getID()]=i,e.fixRenderIntent(i),i}}(this)),this.addFeatures(e)},onFeaturesChanged:function(e){var t,i,n,s,r,o,a,l;for(r=[],o=[],s=[],a=0,l=e.length;l>a;a++)i=e[a],t=this._featureMap[i.getID()],this.fixRenderIntent(t),t?(i.hidden?(delete this._featureMap[i.getID()],r.push(t)):(t.geometry=i.geometry,this.drawFeature(t)),(i.isDeleted()||i.hidden)&&this.selectedFeatures.contains(t)&&(OL.Util.removeItem(this.selectedFeatures,t),o.push(t))):(n=new OL.Feature.Vector(i.geometry),n.model=i,s.push(n),this._featureMap[i.getID()]=n);return this.events.triggerEvent("featureunselected",{features:o}),this.removeFeatures(r),this.addFeatures(s)},onFeaturesRemoved:function(e){var t,i;return i=e.map(function(e){return function(t){return e._featureMap[t.getID()]}}(this)),i=_(i).filter(function(e){return null!=e}),t=_(i).filter(function(e){return function(t){return e.selectedFeatures.contains(t)}}(this)),this.events.triggerEvent("featureunselected",{features:t}),this.removeFeatures(i)},fixRenderIntent:function(e){var t;if(e)return e.model.isDeleted()?e.renderIntent="delete":"delete"===e.renderIntent?e.renderIntent=null!=(t=e.model.isSelected())?t:{select:"default"}:void 0},CLASS_NAME:"Waze.Layer.FeatureLayer"}),i.exports=n}).call(this)}}),this.require.define({"Waze/Layer/Google":function(e,t,i){{var n;t("Waze/Util")}n=OpenLayers.Class(OpenLayers.Layer.XYZ,{key:null,tileUrl:"https://www.googleapis.com/tile/v1/tiles/${z}/${x}/${y}?session=${session}&key=${key}",type:"satellite",language:"en-US",region:"us",sessionKey:null,gettingSession:!1,sessionError:!1,attributionRequest:null,ATTRIBUTION_THROTTLE:1e3,initialize:function(e){e=OpenLayers.Util.applyDefaults({sphericalMercator:!0},e);var t=e.name||"Google "+(e.type||this.type),i=[t,null,e];OpenLayers.Layer.XYZ.prototype.initialize.apply(this,i),this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:null},this.options.tileOptions),this.getSessionKey(),this.updateAttribution=_.debounce(this.updateAttribution,this.ATTRIBUTION_THROTTLE)},getSessionKey:function(){if(!this.gettingSession&&!this.sessionError){this.gettingSession=!0;var e=this;$.ajax({type:"post",url:"https://www.googleapis.com/tile/v1/createSession?key="+this.key,contentType:"application/json; charset=utf-8",crossDomain:!0,data:JSON.stringify({mapType:this.type,language:this.language,region:this.region})}).done(function(t){e.sessionKey=t.session,window.setTimeout($.proxy(e.onSessionExpire,e),72e6),e.redraw(),e.updateAttribution()}).error(function(){e.sessionError=!0,e.events.triggerEvent("loaderror")}).always(function(){e.gettingSession=!1})}},onSessionExpire:function(){this.map.events.register("movestart",this,this.renewSessionKey)},renewSessionKey:function(){this.map.events.unregister("movestart",this,this.renewSessionKey),this.sessionKey=null,this.getSessionKey()},getURL:function(e){if(this.sessionKey){{var t=this.getXYZ(e);t.x,t.y,t.z}return t.session=this.sessionKey,t.key=this.key,OpenLayers.String.format(this.tileUrl,t)}},updateAttribution:function(){if(null!==this.sessionKey){null!==this.attributionRequest&&this.attributionRequest.abort();var e=this.map.getExtent(),t=this;null!==e&&(e.transform(this.map.getProjectionObject(),new OpenLayers.Projection("EPSG:4326")),this.attributionRequest=$.get("https://www.googleapis.com/tile/v1/viewport",{key:this.key,session:this.sessionKey,zoom:this.getServerZoom(),north:e.top,south:e.bottom,east:e.right,west:e.left}).done(function(e){t.attribution=e.copyright,t.attribution.length>0&&(t.attribution+=" "),t.attribution+="<a href='http://www.google.com/intl/en-US_US/help/terms_maps.html' target='_blank'>Terms</a>",t.attribution+="<a href='https://www.waze.com/legal/notices' target='_blank'>Notices</a>"}).error(function(){t.attribution=""}).always(function(){t.attributionRequest=null,t.map.events.triggerEvent("changelayer",{layer:t,property:"attribution"})}))}},setMap:function(){OpenLayers.Layer.XYZ.prototype.setMap.apply(this,arguments),this.updateAttribution(),this.map.events.register("moveend",this,this.updateAttribution)},clone:function(e){return null===e&&(e=new OpenLayers.Layer.Google(this.options)),e=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[e])},destroy:function(){this.map&&this.map.events.unregister("moveend",this,this.updateAttribution),OpenLayers.Layer.XYZ.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.Google"}),i.exports=n}}),this.require.define({"Waze/Layer/Markers":function(e,t,i){(function(){var e,t={}.hasOwnProperty;e=OL.Class(OL.Layer,{isBaseLayer:!1,markers:null,repo:null,drawn:!1,$div:null,className:null,markerClass:OL.Marker,filter:null,initialize:function(e,t,i){OL.Layer.prototype.initialize.apply(this,[e,i]),this.markers={},this.repo=t,this.registerRepoEvents(),i.className&&(this.className=i.className)},destroy:function(){return this.clearMarkers(),this.markers=null,this.unregisterRepoEvents(),OL.Layer.prototype.destroy.apply(this,arguments)},registerRepoEvents:function(){var e,t,i,n,s;for(n=this.repo,s=[],t=0,i=n.length;i>t;t++)e=n[t],e.events.register("objectsadded",this,this.onFeaturesAdded),e.events.register("objectschanged",this,this.onFeaturesChanged),s.push(e.events.register("objectsremoved",this,this.onFeaturesRemoved));return s},unregisterRepoEvents:function(){var e,t,i,n,s;for(n=this.repo,s=[],t=0,i=n.length;i>t;t++)e=n[t],e.events.unregister("objectsadded",this,this.onFeaturesAdded),e.events.unregister("objectschanged",this,this.onFeaturesChanged),s.push(e.events.unregister("objectsremoved",this,this.onFeaturesRemoved));return s},shouldAddFeature:function(e){return!this.filter||this.filter(e)},onFeaturesAdded:function(e){var t,i,n,s;for(n=0,s=e.length;s>n;n++)t=e[n],this.shouldAddFeature(t)&&(i=new this.markerClass(t),this.addMarker(i,t.getID()))},onFeaturesChanged:function(e){var t,i,n,s;for(n=0,s=e.length;s>n;n++)t=e[n],i=this.markers[t.getID()],null!=i?this.shouldAddFeature(t)?(this.drawMarker(i),i.render()):this.removeMarker(i):this.shouldAddFeature(t)&&(i=new this.markerClass(t),this.addMarker(i,t.getID()))},onFeaturesRemoved:function(e){var t,i,n,s;for(n=0,s=e.length;s>n;n++)t=e[n],i=this.markers[t.getID()],null!=i&&this.removeMarker(i)},setOpacity:function(e){var i,n,s,r;if(e!==this.opacity){this.opacity=e,s=this.markers,r=[];for(i in s)t.call(s,i)&&(n=s[i],r.push(n.setOpacity(this.opacity)));return r}},moveTo:function(e,i){var n,s,r;if(OL.Layer.prototype.moveTo.apply(this,arguments),i||!this.drawn){r=this.markers;for(n in r)t.call(r,n)&&(s=r[n],this.drawMarker(s));return this.drawn=!0}},addMarker:function(e,t){return this.markers[t]=e,e.id=t,this.map&&this.map.getExtent()?(e.map=this.map,this.drawMarker(e)):void 0},removeMarker:function(e){return this.markers?(OL.Util.removeItem(this.markers,e),e.erase(),delete this.markers[e.id]):void 0},clearMarkers:function(){var e,i,n,s;n=this.markers,s=[];for(e in n)t.call(n,e)&&(i=n[e],s.push(this.removeMarker(i)));return s},drawMarker:function(e){var t,i;return i=this.map.getLayerPxFromLonLat(e.lonlat),null==i?e.display(!1):e.isDrawn()?e.icon?e.icon.moveTo(i):void 0:(t=e.draw(i),this.div.appendChild(t))},setMap:function(){return OL.Layer.prototype.setMap.apply(this,arguments),this.$div=$(this.div),this.$div.addClass("marker-layer"),this.className?this.$div.addClass(this.className):void 0},getDataExtent:function(){var e,i,n,s;if(n=null,this.markers){n=new OL.Bounds,s=this.markers;for(e in s)t.call(s,e)&&(i=s[e],n.extend(i.lonlat))}return n},CLASS_NAME:"W.Layer.Markers"}),i.exports=e}).call(this)}}),this.require.define({"Waze/Layer/NodeLayer":function(e,t,i){var n,s=t("Waze/Layer/FeatureLayer");n=OpenLayers.Class(s,{nodeDisplayMaxScale:1e4,shouldDisplayFeature:function(){return!0},onNodesAdded:function(e){this.onFeaturesAdded(e)},onNodesChanged:function(e){this.onFeaturesChanged(e)},onNodesRemoved:function(e){this.onFeaturesRemoved(e)},onDisplayChanged:function(e){this.displayedNodes=e.scale<=this.nodeDisplayMaxScale},updateDisplayedFeatures:function(e){s.prototype.updateDisplayedFeatures.apply(this,[OpenLayers.Util.extend({},e.nodes)])},CLASS_NAME:"Waze.Layer.NodeLayer"}),i.exports=n}}),this.require.define({"Waze/Layer/ProblemLayer":function(e,t,i){var n,s=t("Waze/Layer/Markers"),r=t("Waze/Layer/UserDrive"),o=t("Waze/Renderer/ExtendedSVG");n=OL.Class(s,{sessions:null,sessionsLayer:null,sessionsDrawn:!1,currentProblemID:null,currentProblem:null,currentProblemMarker:null,problemZoomed:!1,showClosed:!1,$div:null,initialize:function(e,t,i,n){var a;s.prototype.initialize.apply(this,[e,i,n]),a=OL.Class(OL.Layer.Vector,r,{initialize:function(){r.prototype.initialize.apply(this,arguments),OL.Layer.Vector.prototype.initialize.apply(this,arguments)},setMap:function(){OL.Layer.Vector.prototype.setMap.apply(this,arguments),r.prototype.setMap.apply(this,arguments)},renderers:[o]}),this.sessionsLayer=new a("Sessions",{rendererOptions:{zIndexing:!0},displayInLayerSwitcher:!1})},setMap:function(){s.prototype.setMap.apply(this,arguments),this.map.addLayer(this.sessionsLayer),this.map.events.on({moveend:this.onMoveEnd,zoomend:this.onZoomEnd,scope:this}),this.$div=$(this.div)},destroy:function(){s.prototype.destroy.apply(this),this.map&&this.map.events.un({moveend:this.onMoveEnd,zoomend:this.onZoomEnd})},updateDisplayedFeatures:function(e){s.prototype.updateDisplayedFeatures.apply(this,[OL.Util.extend({},e.problems)])},setProblem:function(e,t){this.currentProblemID!==e.getID()&&(t||(t=this.getMarkerFromId(e.getID())),this.unselectMarker(),this.sessions=null,this.sessionsDrawn=!1,this.currentProblem=e,this.currentProblemMarker=t,this.currentProblemMarker.addClass("selected"),$(this.map.div).addClass("problem-selected"),this.currentProblemID=e.getID(),this.problemZoomed=!1)},setGeometries:function(e){e=e.first(),e.id===this.currentProblemID&&(this.sessions=e,this.drawGeometries())},zoomToProblem:function(){var e,t=this.currentProblem.geometry.getBounds();this.problemZoomed||(this.currentProblem.getDisconnectBounds()?(e=this.map.getZoomForExtent(this.currentProblem.getDisconnectBounds(),!1,!0),e=Math.min(e,W.Config.problems.maxDetailsZoom),this.map.setCenter(this.currentProblem.getDisconnectBounds().getCenterLonLat(),e,!1,!1,!0)):this.map.setCenter(t.getCenterLonLat(),W.Config.problems.initialDetailsZoom)),this.problemZoomed=!0},drawGeometries:function(e){!this.sessions||this.sessionsDrawn&&!e||(this.sessionsLayer.removeAllFeatures(),this.sessionsDrawn=!0,"turnProblem"===this.currentProblem.type?this.drawTurnProblem():this.drawProblemSessions())},drawTurnProblem:function(){var e=this.sessions.routePrevSeg.components.last().clone();this.sessionsLayer.drawSuggestedRoute(this.sessions.routePrevSeg),this.sessionsLayer.drawSuggestedRoute(this.sessions.routeNextSeg),this.sessions.alternatives.forEach(function(t){this.sessionsLayer.drawUserDrive(t.averageGeom),this.sessionsLayer.drawDriveWeightPoint(e,t.averageGeom,t.numDrives.toString())},this)},drawProblemSessions:function(){var e=this.sessions.sessions,t=this.sessions.average;this.drawSegments(t),this.pm.displayedSessionTypes.all&&e.forEach(function(e){e.geometry.components.forEach(function(e){this.sessionsLayer.drawSession(e)},this)},this),this.pm.displayedSessionTypes.average&&this.drawAverageSession(t),this.drawPins(t)},drawPins:function(e){var t=e.prevSegGeom.getVertices(!0).last(),i=e.nextSegGeom.getVertices(!0).first();t.equals(i)||(this.sessionsLayer.drawPin(t,"A"),this.sessionsLayer.drawPin(i,"B"))},drawSegments:function(e){e.nextSegGeom&&this.sessionsLayer.drawRoutes(e.nextSegGeom),e.prevSegGeom&&this.sessionsLayer.drawRoutes(e.prevSegGeom)},drawAverageSession:function(e){e.geometry&&(this.sessionsLayer.drawDisconnect(e.geometry.components[1]),this.sessionsLayer.drawUserDrive(e.geometry.components[0]),this.sessionsLayer.drawUserDrive(e.geometry.components[2]))},onMoveEnd:function(){this.problemZoomed=!1},onZoomEnd:function(){this.sessionsDrawn&&(this.sessionsDrawn=!1,this.drawGeometries())},onProblemChanged:function(e){this.drawFeature(e)},problemsAdded:function(){this.currentProblem&&(this.currentProblemMarker=this.getMarkerFromId(this.currentProblemID),this.currentProblemMarker.addClass("selected"))},getMarkerFromId:function(e){return this.$div.find("[data-id="+e+"]")},unselectProblem:function(){this.hideSessions(),this.unselectMarker(),$(this.map.div).removeClass("problem-selected")},unselectMarker:function(){this.currentProblemMarker&&this.currentProblemMarker.removeClass("selected")},hideSessions:function(){this.sessions=null,this.sessionsDrawn=!1,this.currentProblemID=null,this.currentProblem=null,this.problemZoomed=!1,this.sessionsLayer.removeAllFeatures()},CLASS_NAME:"W.Layer.ProblemLayer"}),i.exports=n}}),this.require.define({"Waze/Layer/SegmentLayer":function(e,t,i){var n,s=t("Waze/Layer/FeatureLayer");n=OpenLayers.Class(s,{colorEmptyStreetSegments:!1,initialize:function(){s.prototype.initialize.apply(this,arguments),W.accelerators.events.register("colorEmptyStreets",this,this.colorEmptyStreetsToggled)},colorEmptyStreetsToggled:function(){this.colorEmptyStreetSegments=!this.colorEmptyStreetSegments,this.redraw()},CLASS_NAME:"Waze.Layer.SegmentLayer"}),i.exports=s}}),this.require.define({"Waze/Layer/UpdateRequests":function(e,t,i){var n,s=t("Waze/Layer/Markers"),r=t("Waze/Layer/UserDrive"),o=t("Waze/Renderer/ExtendedSVG");n=OL.Class(s,{sessionsLayer:null,sessionsDrawn:!1,initialize:function(e,t,i,n){var a;s.prototype.initialize.apply(this,[e,i,n]),a=OL.Class(OL.Layer.Vector,r,{initialize:function(){r.prototype.initialize.apply(this,arguments),OL.Layer.Vector.prototype.initialize.apply(this,arguments)},setMap:function(){OL.Layer.Vector.prototype.setMap.apply(this,arguments),r.prototype.setMap.apply(this,arguments)},renderers:[o]}),this.sessionsLayer=new a("URSessions",{rendererOptions:{zIndexing:!0},displayInLayerSwitcher:!1})},setMap:function(){s.prototype.setMap.apply(this,arguments),this.map.addLayer(this.sessionsLayer),this.map.events.on({moveend:this.onMoveEnd,zoomend:this.onZoomEnd,scope:this})},destroy:function(){s.prototype.destroy.apply(this),this.map&&this.map.events.un({moveend:this.onMoveEnd,zoomend:this.onZoomEnd})},zoomToSessions:function(){var e,t,i=this.pm.currentRequest.getRequestBounds();i?(i=i.getBounds(),t=i.getCenterLonLat(),e=this.map.getZoomForExtent(i),e=Math.min(e,W.Config.update_request_zooms.maxDetailsZoom),e=Math.max(e,W.Config.update_request_zooms.initialDetailsZoom)):(e=W.Config.update_request_zooms.initialDetailsZoom,t=this.pm.currentRequest.geometry.getCentroid(),t=new OL.LonLat(t.x,t.y)),this.map.setCenter(t,e)},onMoveEnd:function(){},onZoomEnd:function(){this.drawRequestSession()},onProblemChanged:function(e){this.drawFeature(e)},update:function(){this.drawRequestSession()},drawRequestSession:function(){if(!this.pm||!this.pm.isSessionAvailable())return this.sessionsLayer.removeAllFeatures(),void(this.sessionsDrawn=!1);this.sessionsLayer.removeAllFeatures();var e=this.pm.requestSession;this.sessionsDrawn=!0,this.pm.displayedSessionTypes.drive&&e.driveGeometry&&e.driveGeometry.components.forEach(function(e){this.sessionsLayer.drawUserDrive(e)},this),this.pm.displayedSessionTypes.route&&e.routeGeometry&&e.routeGeometry.components.forEach(function(e){this.sessionsLayer.drawSuggestedRoute(e),this.sessionsLayer.drawRouteInstructions(e,this.pm.requestSession.getRouteInstructions())},this)},CLASS_NAME:"Waze.Layer.UpdateRequests"}),i.exports=n}}),this.require.define({"Waze/Layer/UserDrive":function(e,t,i){var n,s=t("Waze/Utils/Geo"),r=t("Waze/Feature/Vector/Segment");n=OpenLayers.Class({ARROW_DISTANCE:70,DISCONNECT_GUTTER_SIZE:5,WEIGHT_POINT_DISTANCE:70,HIDDEN_INSTRUCTION_CODES:[0,5],routeInstructionCodes:{0:"unknown",1:"big_direction_left",2:"big_direction_right",3:"big_direction_exit_left",4:"big_direction_exit_right",5:"big_direction_forward",6:"big_directions_roundabout",7:"big_directions_roundabout",8:"big_directions_roundabout_l",9:"big_directions_roundabout_l",10:"big_directions_roundabout_s",11:"big_directions_roundabout_s",12:"big_directions_roundabout_r",13:"big_directions_roundabout_r",14:"big_directions_roundabout_u",15:"big_directions_roundabout_u",16:"big_direction_end",17:"big_direction_exit_left",18:"big_direction_exit_right"},initialize:function(e,t){var i=this;t||(t={}),t.styleMap=new OpenLayers.StyleMap({default:new OpenLayers.Style({pointerEvents:"none",strokeOpacity:1,strokeWidth:5},{context:{getInstructionCodeImages:function(e){return W.imagePath+"vectors/routeInstructions/"+i.routeInstructionCodes[e.attributes.code]+".png"}}})}),t.styleMap.addUniqueValueRules("default","type",{routeArrow:{externalGraphic:W.imagePath+"direction_arrow_standard.png",rotation:"${angle}",fillOpacity:.7,graphicWidth:9,graphicHeight:5,graphicZIndex:3},driveArrow:{externalGraphic:W.imagePath+"direction_arrow_standard.png",rotation:"${angle}",fillOpacity:1,graphicWidth:9,graphicHeight:5,graphicZIndex:2},session:{strokeColor:"#73A802",strokeOpacity:1,strokeWidth:2,graphicZIndex:0},drive:{strokeLinecap:"square",strokeColor:"#89cd67",graphicZIndex:2,strokeWidth:6},drivePadding:{strokeWidth:9,fillOpacity:.7,strokeLinecap:"square",strokeColor:"#638844",graphicZIndex:1},disconnect:{strokeLinecap:"square",strokeColor:"#f5421f",graphicZIndex:2,strokeWidth:6,strokeDashstyle:"dash",strokeDashArray:"32, 16"},disconnectPadding:{strokeLinecap:"square",strokeColor:"#e12c0e",fillOpacity:.7,strokeWidth:8,graphicZIndex:1,strokeDashstyle:"dash",strokeDashArray:"32, 16"},route:{strokeWidth:8,strokeColor:"#3a582c",strokeOpacity:.65,graphicZIndex:2},routePadding:{strokeWidth:10,strokeColor:"#4d6c36",strokeOpacity:.7,graphicZIndex:1},gutter:{strokeLinecap:"square",strokeColor:"black",graphicZIndex:2},pinA:{pointerEvents:"visiblePainted",externalGraphic:W.imagePath+"problem_pin_A.png",graphicYOffset:-40,fillOpacity:1,pointRadius:20},pinB:{pointerEvents:"visiblePainted",externalGraphic:W.imagePath+"problem_pin_B.png",graphicYOffset:-40,fillOpacity:1,pointRadius:20},suggestedRoute:{strokeWidth:8,strokeColor:"#b580ff",strokeLinecap:"square",graphicZIndex:3},suggestedRoutePadding:{strokeLinecap:"square",strokeWidth:12,fillOpacity:.7,strokeColor:"#8663c5",graphicZIndex:1},suggestedRouteArrow:{externalGraphic:W.imagePath+"direction_arrow_standard.png",rotation:"${angle}",graphicWidth:9,graphicHeight:5,graphicZIndex:3},driveWeight:{label:"${weight}",fontSize:12,fontColor:"#3d5028",fontWeight:"bold",strokeWidth:3,strokeOpacity:1,pointRadius:14,fillColor:"#89cd67",strokeColor:"#638844"},routeInstruction:{externalGraphic:"${getInstructionCodeImages}",graphicWidth:30,graphicHeight:32}})
},setMap:function(){this.map.events.on({zoomend:this.onZoomEnd,scope:this})},destroy:function(){this.map&&this.map.events.un({zoomend:this.onZoomEnd})},drawUserDrive:function(e){var t=[];return t.push(new OpenLayers.Feature.Vector(e.clone(),{type:"drive"})),t.push(new OpenLayers.Feature.Vector(e.clone(),{type:"drivePadding"})),this.drawArrows(e,t,"driveArrow","driveArrowContour"),this.addFeatures(t),t},drawDriveWeightPoint:function(e,t,i){if(this.map.getZoom()>=W.Config.user_drive.weightMinDisplayZoom){var n,r=e.distanceTo(t,{details:!0});r=new OpenLayers.Geometry.Point(r.x1,r.y1),r=s.getPointAlongLine(t.getVertices(),this.WEIGHT_POINT_DISTANCE*this.map.getResolution(),r),n=new OpenLayers.Feature.Vector(r,{weight:i.toString(),type:"driveWeight"}),this.addFeatures(n)}},drawRoutes:function(e){var t=[];t.push(new OpenLayers.Feature.Vector(e.clone(),{type:"route"})),t.push(new OpenLayers.Feature.Vector(e.clone(),{type:"routePadding"})),this.drawArrows(e,t,"routeArrow","routeArrowContour"),this.addFeatures(t)},drawSuggestedRoute:function(e){var t=[];t.push(new OpenLayers.Feature.Vector(e.clone(),{type:"suggestedRoute"})),t.push(new OpenLayers.Feature.Vector(e.clone(),{type:"suggestedRoutePadding"})),this.drawArrows(e,t,"suggestedRouteArrow","suggestedRouteArrowContour"),this.addFeatures(t)},drawSession:function(e){this.addFeatures(new OpenLayers.Feature.Vector(e.clone(),{type:"session"}))},drawArrows:function(e,t,i){if(this.map.getZoom()>=W.Config.user_drive.arrowsMinDisplayZoom){var n=this.ARROW_DISTANCE*this.map.getResolution();new r({geometry:e}).getArrowPoints(n).forEach(function(e){t.push(new OpenLayers.Feature.Vector(e.first(),{type:i,angle:360-OpenLayers.Util.deg(e.last())}))})}},drawDisconnect:function(e,t){var i=[];i.push(new OpenLayers.Feature.Vector(e.clone(),{type:"disconnect"})),i.push(new OpenLayers.Feature.Vector(e.clone(),{type:"disconnectPadding"})),t&&this.drawDisconnectGutters(e,i),this.addFeatures(i)},drawDisconnectGutters:function(e,t){if(this.map.getZoom()>=W.Config.user_drive.gutterMinDisplayZoom){var i,n=this.DISCONNECT_GUTTER_SIZE*this.map.getResolution();[!0,!1].forEach(function(s){i=new r({geometry:e}).getSubSegment(n,s),i.attributes.type="gutter",t.push(i)})}},drawPin:function(e,t){this.addFeatures(new OpenLayers.Feature.Vector(e.clone(),{type:"pin"+t}))},drawRouteInstructions:function(e,t){var i=[];t.isEmpty()||this.map.getZoom()<W.Config.user_drive.instructionsMinDisplayZoom||(t.forEach(function(e){this.HIDDEN_INSTRUCTION_CODES.contains(+e.code)||i.push(new OpenLayers.Feature.Vector(e.point,{type:"routeInstruction",code:e.code}))},this),this.addFeatures(i))},onZoomEnd:function(){this.redraw()},redraw:function(){},CLASS_NAME:"Waze.Layer.UserDrive"}),i.exports=n}}),this.require.define({"Waze/Layer/UserLayer":function(e,t,i){var n,s=t("Waze/Layer/FeatureLayer"),r=t("Waze/Renderer/ExtendedSVG");n=OpenLayers.Class(s,{userManager:null,currentUserID:null,fogOfWar:null,renderers:[r],initialize:function(e,t,i){i||(i={});var n=new OpenLayers.StyleMap({default:new OpenLayers.Style({fillOpacity:.3,strokeOpacity:1,strokeWidth:6,fillColor:"white"})});n.addUniqueValueRules("default","type",{managedArea:{fillColor:"green"},updatableArea:{}}),i.styleMap=n,i.uniqueName="editable_areas",s.prototype.initialize.call(this,I18n.t("layers.name.editable_areas"),t,t.users,i),this.userManager=e,W.app.on("change:user",this.onUserChanged,this)},setMap:function(){s.prototype.setMap.apply(this,arguments),this.map.events.on({moveend:this.onMoveEnd,scope:this})},onMoveEnd:function(){this.refreshFogOfWar()},refreshFogOfWar:function(){this.fogOfWar&&this.getVisibility()&&(this.removeFeatures(this.fogOfWar),this.fogOfWar=this.createFogOfWar(),this.addFeatures(this.fogOfWar),this.redraw())},onUserChanged:function(){var e=W.app.get("user");this.currentUserID=e?e.id:null},setVisibility:function(e){var t=e&&!this.visibility;s.prototype.setVisibility.apply(this,arguments),t&&this.updateUserAreas()},onFeaturesAdded:function(){this.updateUserAreas()},updateUserAreas:function(){if(this.map.center&&(this.removeAllFeatures(),this.getVisibility())){var e=this.model.users.get(this.currentUserID),t=[];e&&e.updatableArea&&(t.push(new OpenLayers.Feature.Vector(e.updatableArea,{},{maskID:"editableAreaMask",fillColor:"#000000",fillOpacity:1})),t.push(new OpenLayers.Feature.Vector(e.updatableArea.clone(),{},{fillColor:"transparent",fillOpacity:0,strokeColor:"gray",strokeWidth:1}))),this.fogOfWar=this.createFogOfWar(),this.addFeatures(t),this.addFeatures(this.fogOfWar)}},createFogOfWar:function(){return new OpenLayers.Feature.Vector(this.map.getExtent().toGeometry(),{},{fillColor:"black",fillOpacity:.5,strokeWidth:0,mask:"url(#editableAreaMask)"})},CLASS_NAME:"Waze.Layer.UserLayer"}),i.exports=n}}),this.require.define({"Waze/LoginManager":function(e,t,i){var n,s=t("Waze/Model/Object/LoggedInUser"),r=t("Waze/Model/Object/User"),o=t("Waze/Model/PlaceUpdate");n=OpenLayers.Class({COOKIE_NAME:"_web_session",CSRF_COOKIE_NAME:"_csrf_token",NOT_LOGGED_IN_CODE:100,INVALID_CSRF_CODE:103,UNAUTHORIZED_CODE:403,events:null,expired:!1,returningUser:!1,user:null,getLoggedInUser:function(){var e=this;return null!==this.user?this.user:$.get(Waze.Config.paths.auth,{language:I18n.locale}).then(function(t){e.user=new s(t,{parse:!0})}).always(function(){e.events.triggerEvent("loginStatus",{user:e.user,automatic:!0})}).promise()},initialize:function(){this.events=new OpenLayers.Events(this),$(document).ajaxError($.proxy(this._onServerResponse,this)),$.ajaxPrefilter($.proxy(this._addCsrfToken,this))},_addCsrfToken:function(e,t,i){var n=e.type||"";n=n.toLowerCase(),"post"!==n||e.crossDomain||i.setRequestHeader("X-CSRF-Token",$.cookie(this.CSRF_COOKIE_NAME))},_onServerResponse:function(e,t){if(this.hasUser()&&!this.expired&&t.status===this.UNAUTHORIZED_CODE)try{var i=JSON.parse(t.responseText);(i.code===this.INVALID_CSRF_CODE||i.code===this.NOT_LOGGED_IN_CODE)&&(this.previousUser=this.user,this.expired=!0,this.returningUser=!1,this.events.triggerEvent("sessionExpired"))}catch(n){}},hasUser:function(){return null!==this.user},isLoggedIn:function(){return null!==this.user&&!this.expired},getUserRank:function(){return this.isLoggedIn()?this.user.rank:r.prototype.MaxLevel},canEditPlaceUpdates:function(){return this.getUserRank()>=o.MIN_EDIT_RANK},login:function(e,t){var i=this;return this.expired&&e!==this.user.userName&&this.events.triggerEvent("beforeloginchanged")===!1?$.Deferred().resolve().promise():this.doLogin(e,t).done(function(e){var t=new s(e);i.returningUser=i.hasUser()&&i.user.userName===t.userName,i.user=t,i.expired=!1,i.events.triggerEvent("login",{user:i.user})}).fail(function(e){i.events.triggerEvent("loginfailed",e)}).promise()},getCsrfToken:function(){var e=$.cookie(this.CSRF_COOKIE_NAME);return null!==e?e:$.get("/login/get")},doLogin:function(e,t){var i=$.Deferred(),n=function(){return $.post(Waze.Config.loginPath,{user_id:e,password:t})};return $.when(this.getCsrfToken()).then(n).done(function(e){e.reply&&e.reply.login?i.resolve():i.reject({status:406})}).fail(function(){i.reject({status:500})}),i.then(function(){return $.get(Waze.Config.paths.auth)})},logout:function(){null!==this.user&&this.events.triggerEvent("beforeloginchanged")!==!1&&(this.user=null,this.expired=!1,this.returningUser=!1,$.cookie(this.COOKIE_NAME,null,{path:"/"}),$.cookie(this.CSRF_COOKIE_NAME,null,{path:"/"}),this.events.triggerEvent("logout",{user:null,logout:!0}))},CLASS_NAME:"Waze.LoginManager"}),i.exports=n}}),this.require.define({"Waze/Map":function(e,t,i){var n,s=t("Waze/MapLayers"),r=t("Waze/Control/ZoomBar"),o=t("Waze/Control/GooglePermalink"),a=t("Waze/Control/LocationInfo"),l=t("Waze/Control/PendingOperation"),h=t("Waze/Model/MapState"),u=t("Waze/Presenter/LocationMessage"),c=t("Waze/Presenter/Permalink"),d=t("Waze/Presenter/StreetView"),p=t("Waze/Region/Panel"),m=t("Waze/SelectionManager");n=OpenLayers.Class(OL.Map,s,{DefaultPanInPixel:20,navigationControl:null,zoomBar:null,mapState:null,currentPanel:null,popup:null,lightbox:null,popupOverlay:null,topControls:null,navigationEnabled:!0,$el:null,$map:null,initialize:function(e){e=e||{},$("#editor-container").html(JST["templates/map"]),this.$el=$("#map"),this.$modalContainer=this.$el.find("#map-modal-container"),this.$map=$("#WazeMap"),this.popupOverlay=$("#popup-overlay"),this.inputOverlay=$("#input-overlay"),this.panelRegion=new p,this.resize(),this.navigationControl=new OpenLayers.Control.Navigation,this.zoomBar=new r({displayClass:"control-top olControlPanZoomBar"}),this.footerControl=new OpenLayers.Control({displayClass:"WazeMapFooter"}),this.footerMessages=new OpenLayers.Control({displayClass:"footer-messages"}),e.controls=[this.navigationControl,this.zoomBar,this.footerControl,this.footerMessages],e.projection=new OpenLayers.Projection("EPSG:900913"),e.displayProjection=new OpenLayers.Projection("EPSG:4326"),e.theme=null,this.panels=[],OpenLayers.Map.prototype.initialize.apply(this,["WazeMap",e]),this.streetViewControl=new d({map:this,zoomBarControl:this.zoomBar}),$(this.div).on("click",$.proxy(this.focus,this)),$(window).on("resize",$.proxy(this.resize,this)),W.accelerators.events.on({panUp:this.panUp,panRight:this.panRight,panDown:this.panDown,panLeft:this.panLeft,zoomIn:this.zoomIn,zoomOut:this.zoomOut,toggleFullscreen:this.toggleFullscreen,scope:this}),this.addAerials(),this.addRasterLayers(),this.addVectorLayers(),W.accelerators.registerLayersActions(this.layers),W.selectionManager=new m(W.model,this.layers),this.addControl(new a(W.model)),this.addControl(new l),this.mapState=new h(this,W.selectionManager),this._addFooterControls()},_addFooterControls:function(){new c({mapState:this.mapState,$el:$("<div/>").addClass("WazeControlPermalink").appendTo(this.footerControl.div)}).render();this.addFooterControl({displayClass:"olControlAttribution",control:new OpenLayers.Control.Attribution});var e=new OpenLayers.Control.MousePosition({numDigits:5,emptyString:"00.00000, 00.00000"});this.addFooterControl({displayClass:"olControlMousePosition",control:e}),this.addFooterControl({displayClass:"olControlScaleLine",control:new OpenLayers.Control.ScaleLine}),this.addControl(new o({div:$("<div/>").appendTo(this.footerMessages.div)}));new u({mapView:this,model:W.model,$el:$("<div/>").appendTo(this.footerMessages.div)})},addFooterControl:function(e){var t=$("<div>").addClass(e.displayClass);t.appendTo(this.footerControl.div),e.control.div=t[0],this.addControl(e.control)},focus:function(){$(this.div).focus()},panLeft:function(){this.navigationEnabled&&this.pan(-this.DefaultPanInPixel,0,{animate:!1})},panRight:function(){this.navigationEnabled&&this.pan(this.DefaultPanInPixel,0,{animate:!1})},panUp:function(){this.navigationEnabled&&this.pan(0,-this.DefaultPanInPixel,{animate:!1})},panDown:function(){this.navigationEnabled&&this.pan(0,this.DefaultPanInPixel,{animate:!1})},zoomIn:function(){this.navigationEnabled&&OL.Map.prototype.zoomIn.apply(this,arguments)},zoomOut:function(){this.navigationEnabled&&OL.Map.prototype.zoomOut.apply(this,arguments)},toggleFullscreen:function(){$(document.body).toggleClass("fullscreen"),this.resize()},showOverlay:function(){$("#map-overlay").fadeIn("fast")},hideOverlay:function(){$("#map-overlay").fadeOut("fast")},setEditingMediator:function(){W.editingMediator.on("change:editingEnabled",this._onEditingEnabledChanged,this),W.editingMediator.on("change:navigation",this._onNavigationChanged,this)},_onEditingEnabledChanged:function(){var e=W.editingMediator.get("editingEnabled");e||(this.panelRegion.close(),this.removePanel())},_onNavigationChanged:function(){var e=W.editingMediator.get("navigation");e?(this.zoomBar.show(),this.popupOverlay.hide(),this.navigationEnabled=!0):(this.zoomBar.hide(),this.popupOverlay.show(),this.navigationEnabled=!1)},showPopup:function(e){var t=this;this.popup!==e&&(this.popup&&this.popup.close(),this.popup=e,this.popupOverlay.show(),this.removePanel(),this.removeLightbox(),e.olEvents.register("closed",this,function(){this.removePopup()}),e.render(this.$modalContainer).then(function(){t.positionPopup()}))},positionPopup:function(){var e=this.$modalContainer.find(".map-modal");e.css("left",(this.$map.outerWidth(!0)-e.outerWidth())/2)},removePopup:function(){this.popup=null,this.popupOverlay.hide(),this.$el.find(".map-modal").removeClass("show").addClass("hide")},showLightbox:function(e){this.removePanel(),this.lightbox=e,this.$el.addClass("lightboxShown"),e.show(),e.olEvents.register("closed",this,this.onLightboxClosed)},onLightboxClosed:function(){this.removeLightbox(!0)},removeLightbox:function(e){null===this.lightbox||e||(this.lightbox.olEvents.unregister("closed",this,this.onLightboxClosed),this.lightbox.close()),this.lightbox=null,this.$el.removeClass("lightboxShown")},addPanel:function(e){this.currentPanel!==e&&(this.removePanel(e),this.currentPanel=e,this.removeLightbox(),this.currentPanel.events.register("render",this,this.moveTopControls),this.moveTopControls(),OpenLayers.Element.addClass(this.viewPortDiv,"PanelOpen"))},removePanel:function(e){this.currentPanel&&this.currentPanel!==e&&(this.currentPanel.hide(),this.currentPanel.events.unregister("render",this,this.moveTopControls),this.currentPanel=null)},moveTopControls:function(){var e=this.topControls||$(".control-top"),t=0;this.currentPanel&&(t=this.currentPanel.getHeight()),this.topControls=e,e.css("top",""),$.each(e,function(e,i){var n=$(i),s=10;n.css("top",s+t)})},restoreTopControls:function(){$(".control-top").css("top","")},getZoomForExtent:function(e,t,i){var n,s=this.getSize();return this.currentPanel&&i&&(s.h-=this.currentPanel.getHeight()),n=Math.max(e.getWidth()/s.w,e.getHeight()/s.h),this.baseLayer.getZoomForResolution(n,t)},setCenter:function(e,t,i,n,s){OpenLayers.Map.prototype.setCenter.apply(this,arguments),s&&this.currentPanel&&(e=e.clone(),e.lat+=this.currentPanel.getHeight()*this.getResolution()/2,OpenLayers.Map.prototype.setCenter.apply(this,[e]))},toggleSVMode:function(e){this.$el.toggleClass("street-view-mode",e),this.updateSize()},resize:function(){var e=$("#toolbar"),t=parseInt(this.$map.css("max-height"),10),i=parseInt(this.$map.css("min-height"),10),n=$(window).height()-this.$map.offset().top;n>t?n=t:i>n&&(n=i),this.$el.find(".view-area").css("height",n),$("#sidebar").css("height",n+e.height()),this.positionPopup(),null!==this.div&&(this.updateSize(),this.events.triggerEvent("resize",{height:n}))},getHeight:function(){return this.$map.height()},setLayerZIndex:function(e,t){var i=!!e.markers;e.setZIndex(this.Z_INDEX_BASE[e.isBaseLayer?"BaseLayer":i?"MarkerOverlay":"Overlay"]+5*t)},setLayerVisibility:function(e,t){var i=this.getLayersBy("uniqueName",e).first();i&&(i.setVisibility(t),i.repo&&(i.toggleRepo&&i.repo.forEach(function(e){e.setActive(t)}),i.toggleFilter&&i.repo.forEach(function(e){e[i.toggleFilter]=t})),i.parentLayer&&t===!0&&i.parentLayer.setVisibility(!0))},setLayerFilterClosed:function(e,t){var i=this.getLayersBy("uniqueName",e).first();i&&i.$div&&(i.$div.toggleClass("show-closed",t),i.showHidden=t,i.repo&&i.repo.forEach(function(e){e.setFilterBit(1,t)}))},isLayerVisible:function(e){return 0!==(this.layers&1<<e)},CLASS_NAME:"Waze.Map"}),OL.Map.prototype.Z_INDEX_BASE.MarkerOverlay=850,i.exports=n}}),this.require.define({"Waze/MapLayers":function(e,t,i){(function(){var e,n,s,r,o,a,l,h,u,c,d,p,m,g,f,y,v,b,L,w,S,C,O={}.hasOwnProperty;S=t("Waze/VectorStyles/All"),C=t("Waze/VectorStyles/Venues"),d=t("Waze/VectorStyles/Nodes"),y=t("Waze/VectorStyles/Segments"),n=t("Waze/VectorStyles/Cameras"),v=t("Waze/VectorStyles/Sketch"),a=t("Waze/VectorStyles/ManagedAreas"),f=t("Waze/Layer/SegmentLayer"),c=t("Waze/Layer/NodeLayer"),s=t("Waze/Layer/FeatureLayer"),g=t("Waze/Layer/ProblemLayer"),b=t("Waze/Layer/UpdateRequests"),e=t("Waze/Layer/ArchiveLayer"),w=t("Waze/Layer/UserLayer"),o=t("Waze/Layer/Google"),h=t("Waze/Marker/MapProblem"),L=t("Waze/Marker/UpdateRequest"),m=t("Waze/Marker/PlaceUpdate"),u=t("Waze/Layer/Markers"),p=t("Waze/Model/ObjectType"),r=t("Waze/Utils/Geo"),l={addRasterLayers:function(){var e,t,i,n,s,r,o,a,l,h,u,c;u=W.Config.raster_layers.layers,c=[];for(t in u)O.call(u,t)&&(i=u[t],o={},l=i.type||"wms",(!i.envs||i.envs.contains(W.location.code))&&(n=I18n.t("layers.name."+i.uniqueName),e=i.file_name||W.Config.raster_layers[l].file_name,a=W.Config.raster_layers[l].servers.map(function(t){return""+t+"/"+e}),$.extend(o,W.Config.raster_layers.options,i.options),o.tileSize=new OL.Size(o.tileWidth,o.tileHeight),o.removeBackBufferDelay=0,o.uniqueName=i.uniqueName,o.visibility=i.visible,s={text:I18n.t("layers.loading",{layer_name:n})},"wms"===l?(h={},$.extend(h,W.Config.raster_layers.wms.params,i.params),h.layers=i.layers,r=new OL.Layer.WMS(n,a,h,o)):r=new OL.Layer.XYZ(n,a,o),r.events.on({loadstart:function(e){return function(){return W.vent.trigger("operationPending",{operation:e})}}(s),loadend:function(e){return function(){return W.vent.trigger("operationDone",{operation:e})}}(s)}),c.push(this.addLayer(r))));return c},addVectorLayers:function(){return this.segmentLayer=new f(I18n.t("layers.name.segments"),W.model,W.model.segments,{styleMap:y,displayInLayerSwitcher:!1,uniqueName:"segments",selectable:!0,featureType:p.SEGMENT}),this.nodeLayer=new c(I18n.t("layers.name.nodes"),W.model,W.model.nodes,{styleMap:d,displayInLayerSwitcher:!1,uniqueName:"nodes",selectable:!0,featureType:p.NODE}),this.landmarkLayer=new s(I18n.t("layers.name.landmarks"),W.model,W.model.venues,{styleMap:C,displayInLayerSwitcher:!0,visibility:W.Config.venues.shownByDefault,uniqueName:"landmarks",rendererOptions:{zIndexing:!0},selectable:!0,featureType:p.VENUE,toggleRepo:!0}),this.camerasLayer=new s(I18n.t("layers.name.speed_cameras"),W.model,W.model.cameras,{styleMap:n,displayInLayerSwitcher:!0,visibility:W.Config.cameras.shownByDefault,uniqueName:"speed_cameras",selectable:!0,featureType:p.SPEED_CAMERA,toggleRepo:!0}),this.problemLayer=new g(I18n.t("layers.name.problems"),W.model,[W.model.problems,W.model.turnProblems],{markerClass:h,uniqueName:"problems",className:"map-problems",closedFilter:!0,toggleRepo:!0}),this.updateRequestLayer=new b(I18n.t("layers.name.update_requests"),W.model,[W.model.mapUpdateRequests],{markerClass:L,uniqueName:"update_requests",className:"update-requests",visibility:W.Config.update_requests.shownByDefault,closedFilter:!0,toggleRepo:!0}),this.archiveLayer=new e(I18n.t("layers.name.archive"),{displayInLayerSwitcher:!1,rendererOptions:{zIndexing:!0},uniqueName:"archive"}),this.userLayer=new w(W.loginManager,W.model,{visibility:!1,displayInLayerSwitcher:!0}),this.managedAreasLayer=new s(I18n.t("layers.name.area_managers"),W.model,W.model.managedAreas,{styleMap:a,displayInLayerSwitcher:!0,visibility:!1,uniqueName:"area_managers"}),this.sketchLayer=new OpenLayers.Layer.Vector("sketch",{styleMap:v,displayInLayerSwitcher:!1}),this.placeUpdatesLayer=new u(I18n.t("layers.name.place_updates"),[W.model.venues],{markerClass:m,uniqueName:"place_updates",className:"place-updates",displayInLayerSwitcher:!0,visibility:W.Config.place_updates.shownByDefault,parentLayer:this.landmarkLayer,toggleFilter:"retrieveUpdateRequests",filter:function(e){return e.hasUpdateRequests()}}),this.landmarkLayer.childLayers=[this.placeUpdatesLayer],this.addLayers([this.archiveLayer,this.managedAreasLayer,this.landmarkLayer,this.segmentLayer,this.nodeLayer,this.camerasLayer,this.sketchLayer,this.problemLayer,this.updateRequestLayer,this.placeUpdatesLayer,this.userLayer])},addAerials:function(){var e,t,i,n;return i=W.Config.map.initialPosition[W.location.code],t=new OL.LonLat(i.lon,i.lat),r.project(t),e=new o({name:I18n.t("layers.name.satellite_imagery"),key:"AIzaSyBqNsU8C7J58w88XgvCnAwwEnFWpD_i0ac",type:"satellite",zoomOffset:12,numZoomLevels:11,zoom:i.initialZoom,minResolution:.037322767712175846,center:t,uniqueName:"satellite_imagery",shortcutKey:"S+i",transitionEffect:"resize"}),this.addLayer(e),n={text:I18n.t("layers.loading",{layer_name:I18n.t("layers.name.satellite_imagery")})},e.events.on({loadstart:function(){return this.getVisibility()?W.vent.trigger("operationPending",{operation:n}):void 0},loadend:function(){return W.vent.trigger("operationDone",{operation:n})},loaderror:function(){return W.vent.trigger("operationDone",{operation:n})}}),this.setCenter(t,i.initialZoom)}},l.layerVisibilityBitmask={satellite_imagery:0,cities:1,roads:2,gps_points:3,area_managers:4,landmarks:5,speed_cameras:6,problems:7,update_requests:8,editable_areas:9,live_users:10,place_updates:11},i.exports=l}).call(this)}}),this.require.define({"Waze/Marker/FractionPoint":function(e,t,i){(function(){var e,n,s;e=t("Waze/DivIcon"),n=t("Waze/Handler/DragElement"),s=OL.Class(OL.Marker,{dragging:null,dragConstraint:null,closestSegment:null,initialize:function(t,i,s){var r,o,a,l,h;for(this.map=s,o=new e("fraction-point"),OL.Marker.prototype.initialize.call(this,t,o),this.dragConstraint=i,h=["drag","dragEnd"],a=0,l=h.length;l>a;a++)r=h[a],this.events.addEventType(r);this.dragging=new n(this.map),this.dragging.down=function(e){return function(){return e.icon.$div.addClass("dragging")}}(this),this.dragging.move=function(e){return function(i){var n;return t=e.map.getLonLatFromViewPortPx(i.xy),n=e.dragConstraint.distanceTo(new OL.Geometry.Point(t.lon,t.lat),{details:!0}),e.lonlat=new OL.LonLat(n.x0,n.y0),e.closestSegment=n.model,e.layer.drawMarker(e),e.events.triggerEvent("drag",{xy:i.xy,marker:e})}}(this),this.dragging.done=function(e){return function(t){return e.icon.$div.removeClass("dragging"),e.events.triggerEvent("dragEnd",{xy:null!=t?t.xy:void 0,marker:e})}}(this),this.icon.$div.on("click",function(){return!1})}}),i.exports=s}).call(this)}}),this.require.define({"Waze/Marker/HouseNumber":function(e,t,i){(function(){var e,n,s;e=t("Waze/DivIcon"),n=t("Waze/Handler/DragElement"),s=OL.Class(OL.Marker,{model:null,input:null,ENTER:13,ESC:27,dragging:null,hasTooltip:!1,initialize:function(t,i,s){var r,o,a,l,h;for(this.map=s,this.model=t,o=new e("house-number"),OL.Marker.prototype.initialize.call(this,i,o),this.render(),this.input=this.icon.$div.find("input"),this.inputWrapper=this.icon.$div.find(".input-wrapper"),this.icon.$div.find(".input-wrapper, .drag-handle").on("click",function(e){return function(){return e.events.triggerEvent("click:input"),!1}}(this)),this.input.on("click",function(e){return function(){return e.input.focus()}}(this)),this.input.on("dblclick",function(e){return e.stopPropagation()}),this.input.on("mousedown",function(e){return e.stopPropagation()}),this.input.on("keydown",this.forceNumeric),this.input.on("keyup",function(e){return function(t){return t.which===e.ESC?(t.stopPropagation(),e.input.blur(),e.events.triggerEvent("unselect")):void 0}}(this)),this.input.on("change",function(e){return function(){return e.events.triggerEvent("change:number",{number:e.input.val()})}}(this)),this.inputWrapper.find(".delete-button").on("click",function(e){return function(){return e.events.triggerEvent("delete")}}(this)),h=["change:number","delete","drag","dragEnd","unselect","click:input"],a=0,l=h.length;l>a;a++)r=h[a],this.events.addEventType(r);this.dragging=new n(this.map),this.dragging.move=function(e){return function(t){return e.destroyTooltip(),e.lonlat=e.map.getLonLatFromViewPortPx(t.xy),e.layer.drawMarker(e),e.model.geometry.x=e.lonlat.lon,e.model.geometry.y=e.lonlat.lat,e.events.triggerEvent("drag",{xy:t.xy,marker:e})}}(this),this.dragging.done=function(e){return function(t){return e.createTooltip(),e.events.triggerEvent("dragEnd",{xy:null!=t?t.xy:void 0,marker:e})}}(this),this.createTooltip()},createTooltip:function(){return this.model.valid!==!1||this.hasTooltip?void 0:(this.hasTooltip=!0,this.inputWrapper.tooltip({title:I18n.t("edit.house_numbers.errors")[this.model.invalidCode],placement:"bottom"}))},destroyTooltip:function(){return this.hasTooltip&&this.inputWrapper.tooltip("destroy"),this.hasTooltip=!1},destroy:function(){return this.destroyTooltip()},focus:function(){return this.input.focus(),this.input.val(this.input.val())},select:function(e){e.stopPropagation(),this.input.focus()},render:function(){return this.icon.$div.stacheComb("house-number",this.model)},setActive:function(e){return this.icon.$div.find(".content").toggleClass("active",e)},setNew:function(e){return this.icon.$div.find(".content").toggleClass("new",e)},setValid:function(e){var t;return e&&this.destroyTooltip(),t=this.icon.$div.find(".content"),t.removeClass("valid-"+!e),t.addClass("valid-"+e)},setForced:function(e){var t;return t=this.icon.$div.find(".content"),t.removeClass("forced-"+!e),t.addClass("forced-"+e)},updateSide:function(){return this.inputWrapper.toggleClass("side-left",this.model.isLeft)},forceNumeric:function(e){var t,i;return t=e.which,i=65===t&&(e.ctrlKey||e.metaKey),(!e.shiftKey&&!e.altKey&&!e.ctrlKey||i)&&t>=48&&57>=t||t>=97&&122>=t||t>=65&&90>=t||32===t||191===t||189===t||t>=96&&105>=t||8===t||9===t||13===t||35===t||36===t||37===t||39===t||46===t||45===t||i?!0:!1}}),i.exports=s}).call(this)}}),this.require.define({"Waze/Marker/LiveUser":function(e,t,i){(function(){var e,n;e=t("Waze/DivIcon"),n=OL.Class(OL.Marker,{initialize:function(t,i,n){var s;return this.model=t,this.map=i,this.layer=n,s=new e("live-user-marker",!0),OL.Marker.prototype.initialize.call(this,this.getLonLat(),s),this.model.on("moved",this._onMoved,this)},render:function(){return this.icon.$div.tooltip({title:this.model.get("name")})},getLonLat:function(){return this.model.get("center")},_onMoved:function(){return this.icon.$div.one("transitionend",function(e){return function(){return e.icon.$div.removeClass("moving")}}(this)),this.lonlat=this.getLonLat(),this.icon.$div.addClass("moving"),this.layer.drawMarker(this)},center:function(){return this.map.setCenter(this.getLonLat())},destroy:function(){return this.icon.$div.tooltip("destroy")}}),i.exports=n}).call(this)}}),this.require.define({"Waze/Marker/MapProblem":function(e,t,i){(function(){var e,n;e=t("Waze/DivIcon"),n=OL.Class(OL.Marker,{model:null,initialize:function(t){var i,n;this.model=t,i=new e("map-problem"),n=new OL.LonLat(this.model.geometry.x,this.model.geometry.y),OL.Marker.prototype.initialize.call(this,n,i),this.render(),this.icon.$div.data("model",this.model)},render:function(){var e,t;return e=this.icon.$div,e.attr("data-id",this.model.getID()),t=e.hasClass("selected"),e.removeClass(),e.addClass("map-problem"),e.toggleClass("selected",t),e.toggleClass("uneditable",!this.model.editable),e.toggleClass("recently-closed",this.model.isRecentlyClosed()),e.addClass(this.model.attributes.severity),e.addClass(this.model.getState())}}),i.exports=n}).call(this)}}),this.require.define({"Waze/Marker/PlaceUpdate":function(e,t,i){(function(){var e,n;e=t("Waze/DivIcon"),n=OL.Class(OL.Marker,{model:null,initialize:function(t){var i,n;this.model=t,i=new e("place-update"),n=this._getLocation(),OL.Marker.prototype.initialize.call(this,n,i),this.render(),this.icon.$div.data("model",this.model),this.icon.$div.data("venueID",this.model.getID())},render:function(){var e;return e=this.icon.$div,e.removeClass(),e.addClass("place-update"),this._hasMultipleUpdates()?(e.addClass("multiple"),e.attr("data-update-count",this._getUpdateCount())):e.addClass(this._getUpdateType()),e.data("venueID",this.model.getID()),this._reposition(this._getLocation())},_reposition:function(e){return e.equals(this.lonlat)?void 0:(this.lonlat=e,this.moveTo(this.map.getLayerPxFromLonLat(this.lonlat)))},_getLocation:function(){return this.model.geometry.getBounds().getCenterLonLat()},_hasMultipleUpdates:function(){return this.model.attributes.venueUpdateRequests.length>1},_getUpdateCount:function(){return this.model.attributes.venueUpdateRequests.length},_getUpdateType:function(){var e;return e=this.model.attributes.venueUpdateRequests[0],e.get("updateType").toLowerCase()}}),i.exports=n}).call(this)}}),this.require.define({"Waze/Marker/RoadClosure":function(e,t,i){(function(){var e,n;e=t("Waze/DivIcon"),n=OL.Class(OL.Marker,{model:null,initialize:function(t){var i,n;this.model=t,i=new e("road-closure"),n=new OL.LonLat(this.model.geometry.x,this.model.geometry.y),OL.Marker.prototype.initialize.call(this,n,i),this.icon.$div.data("model",this.model)}}),i.exports=n}).call(this)}}),this.require.define({"Waze/Marker/UpdateRequest":function(e,t,i){(function(){var e,n;e=t("Waze/Marker/MapProblem"),n=OL.Class(e,{initialize:function(){e.prototype.initialize.apply(this,arguments)},render:function(){return e.prototype.render.apply(this,arguments),this.icon.$div.addClass("user-generated"),this.model.attributes.hasComments?this.icon.$div.addClass("has-comments"):void 0}}),i.exports=n}).call(this)}}),this.require.define({"Waze/Model/Alias":function(e,t,i){(function(){var e,t;t=Backbone.Model.extend(),e=Backbone.Collection.extend({model:t,removeEmpty:function(){return this.remove(this.where({name:""}),{silent:!0}),this}}),i.exports={Item:t,Collection:e}}).call(this)}}),this.require.define({"Waze/Model/Chat":function(e,t,i){(function(){var e,n,s,r,o,a,l,h,u,c={}.hasOwnProperty;l=t("Waze/Model/Model"),a=t("Waze/Model/Collection"),o=t("Waze/Model/ChatUser"),n=t("Waze/Model/ChatMessage"),u=t("Waze/Util"),h="chatSettings",e=OL.Class(l,{initialize:function(e,t){return this._wazeModel=e,this._marx=t,l.prototype.initialize.apply(this),this.messages=new n.Collection,this.users=new a([],{model:o}),this.rooms=new r,this._refreshRooms(),this._marx.on("firstConnect",this._onMarxFirstConnect,this),this._marx.on("reconnect",this._onMarxReconnect,this),this._marx.on("disconnect",this._onMarxDisconnect,this),this._registerWazeModelEvents(),this.set({room:this._getTopRoom(),currentUser:null,active:!1,visible:null,open:!1}),this._loadFromLocalStorage(),this.on("change:room",this._onRoomChange,this),this.on("change:visible",this._onVisibilityChanged,this),this.on("change:open",this._onOpenChanged,this)},_loadFromLocalStorage:function(){var e;return e=u.localStorage.get(h),null!=e?this.set(e):void 0},_saveToLocalStorage:function(){return u.localStorage.set(h,{visible:this.get("visible"),open:this.get("open")})},_onMarxFirstConnect:function(){this._registerSocketEvents(),this._activate()},_onMarxReconnect:function(){this._activate()},_onMarxDisconnect:function(){this._deactivate()},_canActivate:function(){var e;return e=this._wazeModel.loginManager.user,null!=e&&this._canUserChat(e)},_canUserChat:function(e){return W.Config.chat.staffOnly?e.isStaff:!0},_getDefaultVisibility:function(){return!1},_activate:function(){var e,t;if(this._canActivate())return t=this.get("visible"),null==t&&(t=this._getDefaultVisibility()),this._refreshRooms(),e=this.get("room")||this._getTopRoom(),this.set({currentUser:this._createMyUser(),visible:t,active:this._canActivate(),room:e}),null==this.get("visible")&&(t=this._getDefaultVisibility()),null!=e&&this._onRoomChange(),this._onVisibilityChanged()},_createMyUser:function(){var e;return e=this._wazeModel.loginManager.user,new o({id:e.id,rank:e.rank,name:e.userName})},_registerWazeModelEvents:function(){return this._wazeModel.events.on({mergeend:this._onMergeEnd,scope:this})},_registerSocketEvents:function(){return this._marx.socket.on("room:userJoin",$.proxy(this._onRoomUserJoin,this)),this._marx.socket.on("room:userLeave",$.proxy(this._onRoomUserLeave,this)),this._marx.socket.on("room:userPan",$.proxy(this._onRoomUserPan,this)),this._marx.socket.on("room:userEdit",$.proxy(this._onRoomUserEdit,this)),this._marx.socket.on("room:newMessage",$.proxy(this._onMessage,this)),this._marx.socket.on("me:newMessage",$.proxy(this._onMessageFromOtherTab,this)),this._marx.socket.on("me:change:room",$.proxy(this._onMeChangeRoom,this)),this._marx.socket.on("me:change:visible",$.proxy(this._onMeChangeVisible,this))},_onMergeEnd:function(){this.get("active")&&(this._refreshRooms(),null==this.get("room")&&this.set("room",this._getTopRoom()))},_getTopRoom:function(){return null!=this._wazeModel.countries.top?this.rooms.findById(this._wazeModel.countries.top.id):this.rooms.first()},_refreshRooms:function(){var e;return e=this._wazeModel.countries.objects||{},this.rooms.update(e)},_deactivate:function(){return this.users.reset([]),this.set({active:!1})},_onMeChangeVisible:function(e){return this._silent=!0,this.set("visible",e.visible),this._silent=!1},_onMeChangeRoom:function(e){var t;return t=e.room,this.users.reset(t.users||[]),this.set({room:this._findOrCreateRoom(t.name)},{pushToServer:!1}),this.messages.add({type:"system",body:"Joined room "+t.name,from:{}}),this._showOrHideMeInUsersList()},_findOrCreateRoom:function(e){var t;return t=this.rooms.findWhere({name:e}),null==t&&(t=new s({name:e}),this.rooms.add(t)),t},_onRoomUserJoin:function(e){var t;t=this.getUserById(e.user.id),null==t&&this.users.addSorted(e.user,{ascending:!1,attribute:"rank"})},_onRoomUserLeave:function(e){var t;t=this.getUserById(e.user.id),null!=t&&this.users.remove(t)
},_onRoomUserPan:function(e){var t;t=this.getUserById(e.user.id),t.set(e.user)},_onRoomUserEdit:function(e){var t;t=this.getUserById(e.user.id),t.set(e.user)},_onMessage:function(e){this.messages.add(e)},_onMessageFromOtherTab:function(e){e.from=this.get("currentUser").toJSON(),this.messages.add(e)},getUserById:function(e){return this.users.first(function(t){return t.get("id")===e})},_onRoomChange:function(e){null==e&&(e={}),this.set({roomName:this._getCurrentRoomName()}),e=_.defaults(e,{pushToServer:!0}),this.get("active")&&e.pushToServer&&this._marx.socket.emit("user:change:roomName",{roomName:this.get("roomName")})},_getCurrentRoomName:function(){var e;return(null!=(e=this.get("room"))&&"function"==typeof e.get?e.get("name"):void 0)||null},_onVisibilityChanged:function(){this.get("active")&&(this._saveToLocalStorage(),this._silent||this._sendVisibilityChangedMessage(),this._showOrHideMeInUsersList())},_showOrHideMeInUsersList:function(){return this.get("visible")?this._addMeToUsers():this._removeMeFromUsers()},_addMeToUsers:function(){var e,t;return t=this.get("currentUser"),e=this.getUserById(t.get("id")),null==e?this.users.add(t):void 0},_removeMeFromUsers:function(){var e,t;return t=this.get("currentUser").get("id"),e=this.getUserById(t),null!=e?this.users.remove(e):void 0},_onOpenChanged:function(){this.get("active")&&this._saveToLocalStorage()},_sendVisibilityChangedMessage:function(){return this._marx.socket.emit("user:change:visible",{visible:this.get("visible")})},sendMessage:function(e){var t,i,n;return n=this.get("currentUser"),t={body:e},this._marx.socket.emit("user:newMessage",t),i={body:e,from:{id:n.get("id"),name:n.get("name")}},this.messages.add(i)}}),s=OL.Class(l,{initialize:function(){return l.prototype.initialize.apply(this,arguments)},getName:function(){return this.attributes.name},equals:function(e){return null!=e&&this.getName()===e.getName()},matchesId:function(e){var t;return t=this.get("ids")||[],-1!==t.indexOf(e)},addId:function(e){var t;return t=this.get("ids")||[],-1===t.indexOf(e)?(t.push(e),this.set({ids:t})):void 0}}),r=OL.Class(a,{model:s,_aliases:{Belgium:"Benelux",Netherlands:"Benelux",Luxembourg:"Benelux","Palestinian Territory":"Israel","West Bank":"Israel","Gaza Strip":"Israel"},update:function(e){var t,i,n,r,o,a,l,h,u;for(o={},h=this.models,a=0,l=h.length;l>a;a++)r=h[a],o[r.getName()]=r;u=[];for(i in e)c.call(e,i)&&(t=e[i],n=this._getRoomNameByCountry(t),r=o[n],null!=r?u.push(r.addId(t.id)):(r=new s({name:n,ids:[t.id]}),o[n]=r,u.push(this.add(r))));return u},_getRoomNameByCountry:function(e){return this._aliases[e.name]||e.name},findById:function(e){var t,i,n,s;for(s=this.models,i=0,n=s.length;n>i;i++)if(t=s[i],t.matchesId(e))return t;return null}}),i.exports={Chat:e,ChatRoom:s,ChatRooms:r}}).call(this)}}),this.require.define({"Waze/Model/ChatMessage":function(e,t,i){(function(){var e,n,s,r;r=t("Waze/Model/Model"),s=t("Waze/Model/Collection"),e=OL.Class(r,{getSenderID:function(){return this.get("from").id},addLine:function(e){var t;return t=this.get("body")+"\n"+e,this.set("body",t)},getType:function(){return this.get("type")||"normal"},isSystem:function(){return"normal"!==this.getType()}}),n=OL.Class(s,{model:e,_beforeAdd:function(e){var t;return t=this.last(),null!=t&&t.getSenderID()===e.getSenderID()?(this.trigger("beforeMessageUpdated",t),t.addLine(e.get("body")),this.trigger("messageUpdated",t),!1):!0}}),i.exports={ChatMessage:e,Collection:n}}).call(this)}}),this.require.define({"Waze/Model/ChatUser":function(e,t,i){(function(){var e,n;n=t("Waze/Model/Model"),e=OL.Class(n,{getCenter:function(){var e;return e=this.get("center"),null!=e?new OL.LonLat(e.lon,e.lat):null}}),i.exports=e}).call(this)}}),this.require.define({"Waze/Model/Collection":function(e,t,i){(function(){var e,n,s,r={}.hasOwnProperty;n=t("Waze/Model/EventsMixin"),s=t("Waze/Model/Model"),e=OL.Class(n,{initialize:function(e,t){null==e&&(e=[]),this.options=null!=t?t:{},this.models=e,null!=this.options.model&&(this.model=this.options.model)},model:s,add:function(e,t){return null==t&&(t={}),e instanceof this.model||(e=new this.model(e)),this._beforeAdd(e)&&(this.models.push(e),t.silent||this.trigger("add",e)),e},addSorted:function(e,t){var i,n,s,r,o,a;for(null==t&&(t={}),e instanceof this.model||(e=new this.model(e)),s=e.get(t.attribute),i=0,a=this.models,r=0,o=a.length;o>r;r++){if(n=a[r],t.ascending){if(n.get(t.attribute)>=s)break}else if(n.get(t.attribute)<=s)break;i++}return this._beforeAdd(e)&&(this.models.splice(i,0,e),t.silent||this.trigger("add",e)),e},_beforeAdd:function(){return!0},remove:function(e){return this.removeAt(this.models.indexOf(e))},removeAt:function(e){var t;if(e>=0&&e<this.models.length)return t=this.models[e],this.models.splice(e,1),this.trigger("remove",{item:t,index:e})},reset:function(e){var t,i,n;for(this.models=[],i=0,n=e.length;n>i;i++)t=e[i],this.add(t,{silent:!0});return this.trigger("reset")},first:function(e){var t,i,n,s;if(null!=e){for(s=this.models,i=0,n=s.length;n>i;i++)if(t=s[i],e(t))return t;return null}return this.models[0]},findWhere:function(e){return null==e&&(e={}),this.first(function(t){var i,n,s;i=!0;for(n in e)r.call(e,n)&&(s=e[n],t.get(n)!==s&&(i=!1));return i})},last:function(){return this.models.length>0?this.models[this.models.length-1]:null},map:function(e){var t,i,n,s,r;for(i=[],r=this.models,n=0,s=r.length;s>n;n++)t=r[n],i.push(e(t));return i},toJSON:function(){var e,t,i,n,s;for(n=this.models,s=[],t=0,i=n.length;i>t;t++)e=n[t],s.push(e.toJSON());return s}}),i.exports=e}).call(this)}}),this.require.define({"Waze/Model/EventType":function(e,t,i){i.exports={ADDED:"objectsadded",CHANGED:"objectschanged",REMOVED:"objectsremoved"}}}),this.require.define({"Waze/Model/EventsMixin":function(e,t,i){(function(){var e;e={},e.prototype={_getEvents:function(){return this._events||(this._events=new OpenLayers.Events(this))},on:function(e,t,i){return null==i&&(i=null),this._getEvents().register(e,i,t)},trigger:function(){var e;return e=this._getEvents(),e.triggerEvent.apply(e,arguments)}},i.exports=e}).call(this)}}),this.require.define({"Waze/Model/IDGenerator":function(e,t,i){i.exports=OpenLayers.Class({lastValue:null,step:null,initialize:function(e,t){var i=isNaN(e)?0:e;this.step=isNaN(t)||0===t?1:t,this.lastValue=i-this.step},last:function(){return this.lastValue},next:function(){return this.lastValue+=this.step,this.lastValue},peek:function(){return this.lastValue+this.step},CLASS_NAME:"Waze.Model.IDGenerator"})}}),this.require.define({"Waze/Model/LandmarkRepository":function(e,t,i){var n,s=t("Waze/Model/ObjectRepository");n=OpenLayers.Class(s,{landmarkBounds:null,updateRequestBounds:null,venueLevel:null,venueBrands:null,zoomToSize:null,retrieveUpdateRequests:!1,initialize:function(){s.prototype.initialize.apply(this,arguments),this.zoomToSize=W.Config.venues.zoomToSize,this.venueBrands=[]},destroy:function(){this.landmarkBounds=null,this.updateRequestBounds(),s.prototype.destroy.apply(this,arguments)},updateDataExtent:function(e,t,i){var n=this.zoomToSize[i],s={};return n?(this._areLandmarksInBounds(e)&&this.venueLevel===n||(s.venueLevel=n),this.retrieveUpdateRequests&&!this._areUpdateRequestsInBounds(e)&&(s.venueUpdateRequests=!0,s.venueLevel=n),s):s},_areLandmarksInBounds:function(e){return this.landmarkBounds&&this.landmarkBounds.containsBounds(e)},_areUpdateRequestsInBounds:function(e){return this.updateRequestBounds&&this.updateRequestBounds.containsBounds(e)},mergeObjects:function(e,t,i){this.landmarkBounds=i.clone(),this.updateRequestBounds=this.retrieveUpdateRequests?i.clone():null,this.venueLevel=e.venueLevel,this.venueBrands=e.brands||[],s.prototype.mergeObjects.apply(this,arguments)},clear:function(){this.landmarkBounds=null,this.updateRequestBounds=null,this.venueLevel=null,s.prototype.clear.apply(this,arguments)},CLASS_NAME:"Waze.Model.LandmarkRepository"}),i.exports=n}}),this.require.define({"Waze/Model/LiveUsers":function(e,t,i){(function(){var e,n,s,r,o,a,l;o=t("Waze/Model/Model"),e=t("Waze/Model/Collection"),l=t("Waze/Util"),a=3e3,n=3e3,r=OL.Class(o,{initialize:function(t,i,r){this._wazeModel=t,this._marx=i,this._adapter=r,o.prototype.initialize.apply(this),this.users=new e([],{model:s}),this.throttleUserPanMessage=_.throttle(this.sendUserPanMessage,a,{leading:!1}),this.throttleUserEditMessage=_.throttle(this.sendUserEditMessage,n,{leading:!1}),this._connected=!1,this._adapter.events.on({"change:editArea":this._onEditAreaChange,"change:viewArea":this._onViewAreaChange,scope:this}),this._marx.on("firstConnect",this._onMarxFirstConnect,this),this._marx.on("reconnect",this._onMarxReconnect,this),this._marx.on("disconnect",this._onMarxDisconnect,this)},_onMarxFirstConnect:function(){this._isUserAuthorized()&&this._registerMarxEvents(),this._activate()},_registerMarxEvents:function(){return this._marx.socket.on("viewport:userPan",$.proxy(this._onUserPan,this)),this._marx.socket.on("viewport:userEdit",$.proxy(this._onUserEdit,this)),this._marx.socket.on("viewport:userLeave",$.proxy(this._onUserLeave,this)),this._marx.socket.on("viewport:reset",$.proxy(this._onViewportReset,this))},_onMarxReconnect:function(){this._activate()},_activate:function(){return this._connected||(this._connected=!0,this._adapter.activate(),this._isUserAuthorized()&&this.set({showLayer:!0})),this.sendUserPanMessage()},_onUserPan:function(e){return this._mergeUser(e.user)},_onUserEdit:function(e){return this._mergeUser(e.user)},_onUserLeave:function(e){var t;return t=this.findUserById(e.user.id),null!=t?this.users.remove(t):void 0},_isUserAuthorized:function(){return W.Config.chat.staffOnly?this._wazeModel.loginManager.user.isStaff:!0},_onMarxDisconnect:function(){this._connected&&(this._adapter.deactivate(),this._connected=!1)},_onViewportReset:function(e){return this.mergeUsers(e)},mergeUsers:function(e){var t,i,n,s;for(this._removeUsersNotIn(e),s=[],i=0,n=e.length;n>i;i++)t=e[i],s.push(this._mergeUser(t));return s},_mergeUser:function(e){var t;return e=$.extend({},e),this._transformCenterFromMarx(e),t=this.findUserById(e.id),null!=t?t.set(e):this.users.add(e)},_removeUsersNotIn:function(e){var t,i,n,s,r,o;for(i={},s=0,r=e.length;r>s;s++)n=e[s],i[n.id]=!0;for(t=0,o=[];t<this.users.models.length;)n=this.users.models[t],o.push(i[n.get("id")]?t++:this.users.removeAt(t));return o},_transformCenterFromMarx:function(e){var t;return null!=e.center?(t=e.center,t=new OL.LonLat(t.lon,t.lat),e.center=this._adapter.convertFromMarx(t)):void 0},findUserById:function(e){return this.users.first(function(t){return t.get("id")===e})},_onEditAreaChange:function(){return this.throttleUserEditMessage()},sendUserEditMessage:function(){var e;return e={editArea:this._adapter.getEditArea()},this._marx.socket.emit("user:edit",e)},_onViewAreaChange:function(){return this.throttleUserPanMessage()},sendUserPanMessage:function(){var e;if(null!=this._marx.socket)return e={center:this._adapter.getCenter(),viewArea:this._adapter.getViewArea()},this._marx.socket.emit("user:pan",e)}}),s=OL.Class(o,{initialize:function(){return o.prototype.initialize.apply(this,arguments),this.on("change:center",this._onCenterChanged,this)},_onCenterChanged:function(e){return null!=e.newValue&&null!=e.oldValue&&e.newValue.lon!==e.oldValue.lon&&e.newValue.lat!==e.oldValue.lat?this.trigger("moved"):void 0}}),i.exports=r}).call(this)}}),this.require.define({"Waze/Model/LiveUsersMapAdapter":function(e,t,i){(function(){var e;e=OL.Class({initialize:function(e,t,i){return this._wazeModel=e,this._marx=t,this._map=i,this.events=new OL.Events,this._active=!1,this},activate:function(){return this._active?void 0:(this._active=!0,this._wazeModel.actionManager.events.on({afteraction:this._onEditAreaChange,afterundoaction:this._onEditAreaChange,afterclearactions:this._onEditAreaChange,scope:this}),this._map.events.on({moveend:this._onViewAreaChange,scope:this}))},deactivate:function(){return this._active?(this._wazeModel.actionManager.events.un({afteraction:this._onEditAreaChange,afterundoaction:this._onEditAreaChange,afterclearactions:this._onEditAreaChange,scope:this}),this._map.events.un({moveend:this._onViewAreaChange,scope:this}),this._active=!1):void 0},_onEditAreaChange:function(){return this.events.triggerEvent("change:editArea",{editArea:this.getEditArea()})},_onViewAreaChange:function(){return this.events.triggerEvent("change:viewArea",{viewArea:this.getViewArea()})},getEditArea:function(){var e;return e=this._wazeModel.actionManager.getChangesBounds(),this.convertToMarx(e)},getCenter:function(){return this.convertToMarx(this._map.getCenter())},getViewArea:function(){return this.convertToMarx(this._map.getExtent())},convertToMarx:function(e){return null==e&&(e=null),e=this.parseGeometry(e),null!=e&&(e=e.transform(this._map.getProjectionObject(),this._marx.displayProjection)),e},convertFromMarx:function(e){return null==e&&(e=null),e=this.parseGeometry(e),null!=e&&(e=e.transform(this._marx.displayProjection,this._map.getProjectionObject())),e},parseGeometry:function(e){return null!=e&&(e instanceof OL.LonLat||(e instanceof OL.Bounds?0===e.getWidth()&&0===e.getHeight()&&(e=null):null!=e.lon&&null!=e.lat&&(e=new OL.LonLat(e.lon,e.lat)))),e}}),i.exports=e}).call(this)}}),this.require.define({"Waze/Model/Location":function(e,t,i){(function(){var e,n,s={}.hasOwnProperty;n=t("Waze/Util"),e=function(){function e(e){var t,i;this.events=new OL.Events;for(t in e)s.call(e,t)&&(i=e[t],this[t]=i);this.Codes.contains(this.code)||(this.code=null),this.code||(this.code=this.abbrToLocation[this.abbr],this.code||(this.code="row"))}return e.prototype.storeKey="editorLocation",e.prototype.cookieName="editor_env",e.prototype.cookieExpiryInDays=61,e.prototype.cookiePath="/",e.prototype.abbrToLocation={US:"usa",CA:"usa",IL:"il"},e.prototype.Codes=["row","usa","il"],e.prototype.persist=function(){return n.localStorage.set(this.storeKey,{code:this.code}),$.cookie(this.cookieName,this.code,{expires:this.cookieExpiryInDays,path:this.cookiePath})},e.prototype.change=function(e){return e!==this.code?(this.code=e,this.persist(),this.events.triggerEvent("change")):void 0},e.getFromIP=function(){var t;return null!=this._promise?this._promise:(t=$.Deferred(),$.get("/WAS/country_by_ip").done(function(i){var n;return n=new e(i),n.persist(),t.resolve(n)}).error(function(){var i;return i=new e,i.persist(),t.resolve(i)}),this._promise=t.promise())},e.getCurrent=function(){var e;return e=this.restore(),null!=e?e:this.getFromIP().then(function(e){return e.newCookie=!0,e})},e.restore=function(){var t,i,s;return i=n.localStorage.get(this.prototype.storeKey),i?(t=$.cookie(this.prototype.cookieName),s=new e(i),s.code!==t&&(s.newCookie=!0,s.persist()),s):null},e.normalizeCode=function(e){return e=e.toLowerCase(),"na"===e&&(e="usa"),e},e}(),i.exports=e}).call(this)}}),this.require.define({"Waze/Model/MapState":function(e,t,i){(function(){var e,n,s,r,o,a={}.hasOwnProperty;s=t("Waze/Model/Model"),o=t("Waze/VectorStyles/All"),e=t("Waze/MapLayers"),r=t("Waze/Util"),n=OL.Class(s,{locationsPerEnv:null,layerVisibility:null,layerFilters:null,mapLocation:null,mapSelection:null,marker:null,urlParams:null,initialize:function(e,t,i){return this.map=e,this.selectionManager=t,this.attributes=null!=i?i:{},s.prototype.initialize.apply(this,arguments),this.layerFilters={},this.mapSelection={},this.marker=!1,this.layerVisibility=this.map.layers.reduce(function(e,t){return t.displayInLayerSwitcher&&(e[t.uniqueName]=t.getVisibility()),e},{}),this.locationsPerEnv={},this._restore(),this.map.events.on({changelayer:this._onLayerVisibilityChanged,moveend:this.updateMapLocation,addlayer:this._onLayerAdd,scope:this}),this.selectionManager.events.on({selectionchanged:this._onSelectionChanged,scope:this}),!0},destroy:function(){return this.map.events.un({changelayer:this._onLayerVisibilityChanged,moveend:this.updateMapLocation,addlayer:this._onLayerAdd,scope:this}),this.selectionManager.events.un({selectionchanged:this._onSelectionChanged,scope:this})},getLayerVisibilityBitmask:function(){var t,i,n,s,r;i=e.layerVisibilityBitmask,n=0,r=this.layerVisibility;for(t in r)a.call(r,t)&&(s=r[t],s&&!_.isUndefined(i[t])&&(n+=1<<i[t]));return n},_onLayerAdd:function(e){var t;return(t=e.layer.uniqueName)&&null!=this.layerVisibility[t]?this.map.setLayerVisibility(t,this.layerVisibility[t]):void 0},_onLayerVisibilityChanged:function(e){var t;return t=e.layer.uniqueName,"visibility"===e.property&&null!=this.layerVisibility[t]&&(this.layerVisibility[t]=e.layer.visibility,r.localStorage.set(n.LOCAL_STORAGE_LAYER_VISIBILITY,this.layerVisibility),this._triggerStateChanged()),!0},updateMapLocation:function(){var e,t;return e=this.map.getCenter(),t=this.map.getZoom(),null!=e?(e.zoom=t,this.mapLocation=e,this.locationsPerEnv[W.location.code]=e,r.localStorage.set(n.LOCAL_STORAGE_MAP_LOCATION,this.locationsPerEnv),this._triggerStateChanged(),!0):void 0},_getSelectedFeaturesByType:function(){var e,t,i,n,s,r;for(i={},r=this.selectionManager.selectedItems,n=0,s=r.length;s>n;n++)e=r[n],e.model.isNew()||(t=i[e.model.type+"s"]||[],i[e.model.type+"s"]=t,t.push(e.model.getID()));return i},_onSelectionChanged:function(){return this.mapSelection=this._getSelectedFeaturesByType(),this._triggerStateChanged(),!0},_triggerStateChanged:function(){return this.trigger("statechanged",{loc:this.mapLocation,layers:this.layerVisibility,selection:this.mapSelection,marker:this.marker})},_restoreLayerVisibility:function(){var t,i,s,o;if(this.urlParams.layers&&/^\d+$/.test(this.urlParams.layers)){o=e.layerVisibilityBitmask;for(i in o)a.call(o,i)&&(t=o[i],s=0!==(this.urlParams.layers&1<<t),this.layerVisibility[i]=s)}else this.layerVisibility=_.extend(this.layerVisibility,r.localStorage.get(n.LOCAL_STORAGE_LAYER_VISIBILITY));return this.layerFilters=r.localStorage.get(n.LOCAL_STORAGE_LAYER_FILTERS)},_restoreMapLocation:function(){var e,t,i,s;return this.locationsPerEnv=r.localStorage.get(n.LOCAL_STORAGE_MAP_LOCATION),null==this.locationsPerEnv&&(this.locationsPerEnv={}),i=this.locationsPerEnv[W.location.code],this.urlParams.lat&&this.urlParams.lon?(e=new OL.LonLat(parseFloat(this.urlParams.lon),parseFloat(this.urlParams.lat)),e.transform(this.map.displayProjection,this.map.getProjectionObject()),this.urlParams.zoom&&(s=parseFloat(this.urlParams.zoom),e.zoom=s),this.mapLocation=e):null!=i?(t=new OL.LonLat(i.lon,i.lat),t.zoom=i.zoom,this.mapLocation=t):void 0},_restoreMarker:function(){return this.marker=this.urlParams.marker},_restoreSelection:function(){var e,t,i,n,s,r,o;for(r=W.Config.permalink.features,o=[],n=0,s=r.length;s>n;n++)i=r[n],e=[],t=this.urlParams[i],t?(t instanceof Array||(t=[t]),o.push(this.mapSelection[i]=t)):o.push(void 0);return o},_selectObjects:function(){var e,t,i,n,s,r,o,l,h;if(W.model.events.unregister("mergeend",this,this._selectObjects),this.mapSelection){n=[],h=this.mapSelection;for(i in h)if(a.call(h,i)&&(t=h[i],r=W.model[i],t&&r))for(o=0,l=t.length;l>o;o++)s=t[o],e=r.get(s),e&&n.push(e);n.isEmpty()||this.selectionManager.select(n)}return this._selectProblems(W.model.mapUpdateRequests.objectType,W.updateRequestsControl),this._selectProblems(W.model.problems.objectType,W.problemsControl)},_selectProblems:function(e,t){var i;return i=this.urlParams[e],null!=i?t.selectById(i):void 0},_setupMap:function(){var e,t,i,n,s,r,l;l=this.layerVisibility;for(s in l)a.call(l,s)&&(r=l[s],this.map.setLayerVisibility(s,r),null!=this.layerFilters&&null!=this.layerFilters[s]&&this.map.setLayerFilterClosed(s,this.layerFilters[s]));return this.mapLocation&&(e=this.mapLocation.clone(),this.map.setCenter(e,this.mapLocation.zoom)),this.marker&&(i=new OL.Layer.Vector("PermalinkMarker",{styleMap:o.permalinkMarker,displayInLayerSwitcher:!1}),e=this.mapLocation?this.mapLocation.clone():this.map.getCenter(),t=new OL.Geometry.Point(e.lon,e.lat),n=new OL.Feature.Vector(t),this.map.addLayer(i),i.addFeatures(n)),W.model.events.register("mergeend",this,this._selectObjects)},_restore:function(){return this.urlParams=OL.Util.getParameters(window.location.href),this._restoreLayerVisibility(),this._restoreMapLocation(),this._restoreMarker(),this._restoreSelection(),this._setupMap()}}),_.extend(n,{LOCAL_STORAGE_MAP_LOCATION:"mapLocation",LOCAL_STORAGE_LAYER_FILTERS:"layerFilters",LOCAL_STORAGE_LAYER_VISIBILITY:"layerVisibility"}),i.exports=n}).call(this)}}),this.require.define({"Waze/Model/Marx":function(e,t,i){(function(){var e,n,s;e=t("Waze/LoginManager"),s={NotConnected:0,FirstConnection:1,Reconnection:2},n=Backbone.Model.extend({socket:null,displayProjection:new OpenLayers.Projection("EPSG:4326"),initialize:function(){return this.mode=s.NotConnected,W.app.on("change:user",this._onLoginChanged,this)},_onLoginChanged:function(){var e;e=W.app.get("user"),null!=e&&this.activate()},activate:function(){var t,i,n;if(null==this.socket){t={};try{n=$.cookie(e.prototype.COOKIE_NAME)}catch(r){}return t.sessionId=n,i=Waze.Config.marx.server+"/chat?"+$.param(t),this.socket=io.connect(i,{"try multiple transports":!1}),this.socket.on("connect",function(e){return function(){return e.mode===s.NotConnected?(e.mode=s.FirstConnection,e.trigger("firstConnect")):(e.mode=s.Reconnection,e.trigger("reconnect"))}}(this)),this.socket.on("disconnect",function(e){return function(){return e.trigger("disconnect")}}(this))}},CLASS_NAME:"Waze.Model.Marx"}),i.exports=n}).call(this)}}),this.require.define({"Waze/Model/Model":function(e,t,i){(function(){var e,n,s={}.hasOwnProperty;e=t("Waze/Model/EventsMixin"),n=OL.Class(e,{initialize:function(e){this.attributes=null!=e?e:{}},set:function(e,t){var i,n,r,o;null==t&&(t={}),"string"==typeof e&&(n=e,o=arguments[1],e={},e[n]=o,t=arguments[2]||{}),i=!1;for(n in e)s.call(e,n)&&(o=e[n],this.attributes[n]!==o&&(r=this.attributes[n],this.attributes[n]=o,i=!0,this.trigger("change:"+n,_.extend({newValue:o,oldValue:r},t))));return i?this.trigger("change",t):void 0},get:function(e){return this.attributes[e]},toJSON:function(){return $.extend({},this.attributes)}}),i.exports=n}).call(this)}}),this.require.define({"Waze/Model/Object":function(e,t,i){var n,s=t("Waze/Util"),r=t("Waze/Format/ParseMixin");n=OpenLayers.Class({id:null,state:null,initialize:function(e,t){t&&t.parse&&e&&this.parse(e),OpenLayers.Util.extend(this,e)},getID:function(){return this.id||this.ID},setID:function(e){this.id=e},isNew:function(){return this.getID()<0},isDeleted:function(){return!(!this.state||this.state!==OpenLayers.State.DELETE)},isUpdated:function(){return this.state===OpenLayers.State.UPDATE},isUnchanged:function(){return!this.state},getVersion:function(){return this.version||1},clone:function(){return new n(this)},setSelected:function(e){this.selected=e},isSelected:function(){return!!this.selected},setSnapped:function(e){this.snapped=e},isSnapped:function(){return!!this.snapped},getPermissions:function(){return s.isDefined(this.permissions)?this.permissions:0},isAllowed:function(e){return e&&0!==(this.getPermissions()&e)},isDeletable:function(){return this.PERMISSIONS.DELETE&&this.isAllowed(this.PERMISSIONS.DELETE)},arePropertiesEditable:function(){return this.PERMISSIONS.EDIT_PROPERTIES&&this.isAllowed(this.PERMISSIONS.EDIT_PROPERTIES)},isGeometryEditable:function(){return this.PERMISSIONS.EDIT_GEOMETRY&&this.isAllowed(this.PERMISSIONS.EDIT_GEOMETRY)},merge:function(e){this.parse(e),_.extend(this,e)},CLASS_NAME:"Waze.Model.Object"}),_.extend(n.prototype,r),n.ALL_PERMISSIONS=2147483647,i.exports=n}}),this.require.define({"Waze/Model/Object/Archive":function(e,t,i){var n,s=t("Waze/Model/Object");n=OpenLayers.Class(s,{averageSpeed:null,getAverageSpeed:function(){return this.averageSpeed||(this.averageSpeed=this.totalRoadMeters/(this.endTime-this.startTime)*3600),this.averageSpeed},CLASS_NAME:"Waze.Feature.Vector.Archive"}),i.exports=n}}),this.require.define({"Waze/Model/Object/ArchiveSession":function(e,t,i){var n,s=t("Waze/Model/Object");n=OpenLayers.Class(s,{drive:null,endPointAddresses:null,driveBounds:null,gmlFormat:new OpenLayers.Format.GML,initialize:function(){s.prototype.initialize.apply(this,arguments)},parse:function(e){s.prototype.parse.apply(this,arguments),e.data&&(e.drive=this.gmlFormat.read(e.data),e.drive.forEach(function(e){e.geometry.transform(W.Config.map.projection.remote,W.Config.map.projection.local)})),e.data=null},isDrivePartMatched:function(e){return"Matched"===e.attributes.info},getGroupedDriveParts:function(){var e=this.drive.groupBy(function(e){return this.isDrivePartMatched(e)},this);return{matched:e[!0],unmatched:e[!1]}},getEndPointAddresses:function(){if(!this.endPointAddresses){var e=[];if(this.drive&&(e=this.drive.filter(function(e){return"Matched"===e.attributes.info})),this.endPointAddresses={},e.isEmpty())return this.endPointAddresses;this.endPointAddresses.from=e.first().attributes.name,this.drive.length>1&&(this.endPointAddresses.to=e.last().attributes.name)}return this.endPointAddresses},getDriveBounds:function(){return this.bounds||(this.bounds=new OpenLayers.Bounds,this.drive&&this.drive.forEach(function(e){e.geometry.calculateBounds(),this.bounds.extend(e.geometry.bounds)},this)),this.bounds},CLASS_NAME:"Waze.Feature.Vector.ArchiveSession"}),i.exports=n}}),this.require.define({"Waze/Model/Object/Image":function(e,t,i){(function(){var e,n;e=t("Waze/Model/Object"),n=Backbone.Model.extend({getUrl:function(e){return this.getUrlById(e,this.id)},getUrlById:function(e,t){return e===n.SIZE.ORIGINAL?W.Config.venues.image_bucket_url+t:""+W.Config.venues.image_bucket_url+"thumbs/thumb"+e+"_"+t}}),n.SIZE={ORIGINAL:0,SMALL:32,WEB:100,MOBILE:347},i.exports=n}).call(this)}}),this.require.define({"Waze/Model/Object/Junction":function(e,t,i){var n,s=t("Waze/Model/Object"),r=t("Waze/Feature/Vector");n=OpenLayers.Class(s,{initialize:function(){r.prototype.initialize.apply(this,arguments),OpenLayers.Util.applyDefaults(this.attributes,this.DEFAULT_NEW_LANDMARK_ATTRIBUTES)},DEFAULT_NEW_LANDMARK_ATTRIBUTES:{permissions:2147483647,mtfcc:"W0003",name:"",description:""},CLASS_NAME:"Waze.Model.Object.Junction"}),i.exports=n}}),this.require.define({"Waze/Model/Object/LoggedInUser":function(e,t,i){var n,s=t("Waze/Model/Object"),r=t("Waze/Model/Object/User");n=OpenLayers.Class(s,{nested:{editableAreas:OL.Geometry},LevelToMiles:{1:1,2:2,3:3,4:4,5:4,6:4},initialize:function(){s.prototype.initialize.apply(this,arguments),this.editableAreasMeters=this.editableAreasMeters.map(function(e,t){return{area:e,geomIndex:t}}),this.normalizedLevel=r.prototype.NormalizedLevels[this.rank],this.editableMiles=this.LevelToMiles[this.normalizedLevel]},isCountryManager:function(){return this.editableCountryIDs&&!this.editableCountryIDs.isEmpty()},CLASS_NAME:"Waze.Feature.Vector.LoggedInUser"}),i.exports=n}}),this.require.define({"Waze/Model/Object/NavigationPoint":function(e,t,i){(function(){var e,n;e=t("Waze/Model/Object"),n=OL.Class(e,{nested:{point:OL.Geometry}}),i.exports=n}).call(this)}}),this.require.define({"Waze/Model/Object/Restriction":function(e,t,i){(function(){var e,n;e=t("Waze/Model/Object"),n=OL.Class(e,{attributesToCompare:["fromTime","toTime","fromDate","toDate","vehicleTypes","days","description"],MaxVehicleType:11,DescriptionMaxLength:100,allDay:!0,fromTime:null,toTime:null,fromDate:null,toDate:null,DateFormat:"yyyy-MM-dd",days:0,vehicleTypes:0,description:null,initialize:function(e){OL.Util.extend(this,e)},setTime:function(e,t){return this.allDay=!1,this.fromTime=e,this.toTime=t},setAllDay:function(){return this.allDay=!0,this.fromTime=null,this.toTime=null},isAllDay:function(){return this.allDay},setDates:function(e,t){return this.fromDate=new Date(e).toString(this.DateFormat),this.toDate=new Date(t).toString(this.DateFormat)},getFromDate:function(){return this.parseDate(this.fromDate)},getToDate:function(){return this.parseDate(this.toDate)},parseDate:function(e){var t,i,n,s;return e?(s=e.split("-"),n=s[0],i=s[1],t=s[2],new Date(n,i-1,t)):null},setPermanent:function(){return this.fromDate=null,this.toDate=null},isPermanent:function(){return null===this.fromDate&&null===this.toDate},isTwoDay:function(){var e,t;return this.isAllDay()?!1:(e=this.parseTime(this.fromTime),t=this.parseTime(this.toTime),1===this.compareHours(e,t))},compareHours:function(e,t){return e.hour===t.hour?e.minute>t.minute?1:e.minute<t.minute?-1:0:e.hour>t.hour?1:e.hour<t.hour?-1:0},isInThePast:function(){var e;return this.isPermanent()?!1:(e=new Date.today,+this.getToDate()<+e)},parseTime:function(e){var t;return t=e.split(":"),{hour:t[0],minute:t[1]}},includesVehicleType:function(e){return e=Math.pow(2,e),0!==(this.vehicleTypes&e)},allVehiclesIncluded:function(){return this.vehicleTypes===this.allVehicleTypes},clone:function(){return new n({allDay:this.allDay,fromTime:this.fromTime,toTime:this.toTime,fromDate:this.fromDate,toDate:this.toDate,vehicleTypes:this.vehicleTypes,days:this.days,description:this.description})},includesDay:function(e){return 0!==(this.days&1<<e)},getDays:function(){var e,t,i;for(i=[],e=t=0;6>=t;e=++t)this.includesDay(e)&&i.push(e);return i},setDays:function(e){return this.days=e.reduce(function(e,t){return e+=1<<t},0)},equals:function(e){return this.attributesToCompare.every(function(t){return function(i){return e[i]===t[i]}}(this))},toString:function(){return""+this.days+","+this.fromTime+","+this.toTime+","+this.fromDate+","+this.toDate+","+this.vehicleTypes+","+this.description},CLASS_NAME:"Waze.Model.Object.Restriction"}),n.prototype.allVehicleTypes=-1,n.prototype.allDays=127,i.exports=n}).call(this)}}),this.require.define({"Waze/Model/Object/RoadClosure":function(e,t,i){(function(){var e,n;e=t("Waze/Model/Object"),n=OL.Class(e,{nested:{geometry:OL.Geometry},isFwdDirection:function(){return!!(this.id%2)},getEndTime:function(){var e;return e=new Date(this.endDate),""+e.getHours()+":"+e.getMinutes()},CLASS_NAME:"Waze.Model.Object.RoadClosure"}),i.exports=n}).call(this)}}),this.require.define({"Waze/Model/Object/User":function(e,t,i){var n,s=t("Waze/Model/Object");n=OpenLayers.Class(s,{nested:{managedArea:OL.Geometry,updatableArea:OL.Geometry},initialize:function(){s.prototype.initialize.apply(this,arguments),this.normalizedLevel=this.NormalizedLevels[this.rank]},isStaffUser:function(){return this.rank>=this.StaffRank},isCountryManager:function(){return this.editableCountryIDs&&this.editableCountryIDs.length>0},NormalizedLevels:{0:1,1:2,2:3,3:4,4:5,5:6,6:6},MinLevel:0,MaxLevel:5,StaffRank:6,CLASS_NAME:"Waze.Feature.Vector.User"}),n.normalizeLevel=function(e){return n.prototype.NormalizedLevels[e]},i.exports=n}}),this.require.define({"Waze/Model/ObjectRepository":function(e,t,i){var n,s=t("Waze/Model/IDGenerator"),r=t("Waze/Model/EventType"),o=t("Waze/Util");n=OpenLayers.Class({KEEP_CHANGED:function(e){return e},REPLACE_CHANGED:function(e,t){return t},DEFAULT_PROJECTION:new OpenLayers.Projection("EPSG:4326"),GENERATED_ID_BASE:-100,GENERATED_ID_STEP:-1,objectType:null,objects:null,events:null,idGenerator:null,projection:null,active:null,currentDataBounds:null,minZoom:0,onDemand:!0,additionalInfo:null,useVersions:!0,filterName:null,initialize:function(e,t){OpenLayers.Util.extend(this,t),this.objects={},this.objectType=e,this.events=new OpenLayers.Events(this),this.idGenerator=new s(this.GENERATED_ID_BASE,this.GENERATED_ID_STEP),null===this.projection&&(this.projection=this.DEFAULT_PROJECTION),this.active=o.defined(t.active)?t.active:!0},setActive:function(e){this.active=e},updateDataExtent:function(e,t,i){var n={};return i<this.minZoom?(this.clear({keepUnsaved:!0,keepSelected:!0}),null):!this.filtered&&(!this.onDemand||this.currentDataBounds&&this.currentDataBounds.containsBounds(e))?null:this.filterName?(n[this.filterName]=this.filter,n):(n[this.objectType+"s"]=!0,n)},get:function(e){return this.objects[e]},getByAttributes:function(e){return _.where(this.objects,e)},put:function(e){e instanceof Array||(e=[e]);for(var t=[],i=[],n=0,s=e.length;s>n;n++){var o=e[n];o.type=this.objectType,o.model=this.model,this.objects[o.getID()]?t.push(o):(this.objects[o.getID()]=o,i.push(o))}t.length>0&&this.events.triggerEvent(r.CHANGED,t),i.length>0&&this.events.triggerEvent(r.ADDED,i)},changed:function(e){e instanceof Array||(e=[e]),this.events.triggerEvent(r.CHANGED,e)},remove:function(e){e instanceof Array||(e=[e]);for(var t=[],i=0,n=e.length;n>i;i++){var s=e[i];this.objects[s.getID()]&&(delete this.objects[s.getID()],t.push(s))}t.length>0&&this.events.triggerEvent(r.REMOVED,t)},updateID:function(e,t){delete this.objects[t],this.objects[e.getID()]=e,e.type=this.objectType,this.changed(e)},generateUniqueID:function(){return this.idGenerator.next()},getObjectArray:function(e){return _.isUndefined(e)?Object.values(this.objects):_.filter(this.objects,e)},clear:function(e){this.currentDataBounds=null;var t=[];e&&(e.keepUnsaved||e.keepSelected)?Object.forEach(this.objects,function(i,n){var s=o.isDefined(n.state)&&null!==n.state;
e.keepUnsaved&&s||e.keepSelected&&(n.isSelected()||n.isSnapped())?n.state!==OpenLayers.State.INSERT&&(n.outOfScope=!0):(t.push(n),delete this.objects[i])},this):(t=_.values(this.objects),this.objects={}),e&&e.silent||t.length>0&&this.events.triggerEvent(r.REMOVED,t)},setFilterBit:function(e,t){t?this.filter|=e:this.filter&=~e},mergeObjects:function(e,t,i){this.currentDataBounds=i.clone(),t||(t=this.KEEP_CHANGED),this.filtered=!!e&&!!e.filtered,e=e?e.objects:[],e||(e=[]);for(var n=[],s=[],o=0,a=e.length;a>o;++o){var l=e[o].getID();if(this.objects[l])if(!this.useVersions||e[o].getVersion()>this.objects[l].getVersion())if(this.objects[l].state){var h=t(this.objects[l],e[o]);h&&h!==this.objects[l]&&(s.push(this.objects[l]),this.objects[l]=e[o],n.push(e[o]),e[o].type=this.objectType,e[o].model=this.model)}else s.push(this.objects[l]),this.objects[l]=e[o],n.push(e[o]),e[o].type=this.objectType,e[o].model=this.model;else delete this.objects[l].outOfScope;else this.objects[l]=e[o],n.push(e[o]),e[o].type=this.objectType,e[o].model=this.model}delete e.objects,this.additionalInfo=e,s.length>0&&this.events.triggerEvent(r.REMOVED,s),n.length>0&&this.events.triggerEvent(r.ADDED,n)},getModifiedObjects:function(){var e={};e[OpenLayers.State.INSERT]=[],e[OpenLayers.State.UPDATE]=[],e[OpenLayers.State.DELETE]=[];for(var t in this.objects)this.objects[t].state&&e[this.objects[t].state].push(this.objects[t]);return e},hasModifiedObjects:function(){for(var e in this.objects)if(this.objects[e].state)return!0;return!1},getByIds:function(e){var t,i=[];return e.forEach(function(e){t=this.get(e),t&&i.push(t)},this),i},CLASS_NAME:"Waze.Model.ObjectRepository"}),i.exports=n}}),this.require.define({"Waze/Model/ObjectType":function(e,t,i){i.exports={SEGMENT:"segment",NODE:"node",VENUE:"venue",SPEED_CAMERA:"camera",JUNCTION:"junction",USER:"user",STREET:"street",CITY:"city",COUNTRY:"country",MAP_PROBLEM:"mapProblem",TURN_PROBLEM:"turnProblem",UPDATE_REQUEST:"mapUpdateRequest",NC:"nodeConnection",RESTRICTION:"restriction",MERGED_NODE:"mergedNode",state:"state",PROBLEM_SESSION:"problemSession",TURN_PROBLEM_DETAILS:"turnProblemDetail",UPDATE_REQUEST_SESSION:"updateRequestSession",ARCHIVE_SESSION:"archive",ARCHIVE_SESSION_DATA:"archiveSession",HOUSE_NUMBER:"houseNumber",ROAD_CLOSURE:"roadClosure"}}}),this.require.define({"Waze/Model/OnDemandRepository":function(e,t,i){var n,s=t("Waze/Model/ObjectRepository"),r=t("Waze/Format/Serializer"),o=t("Waze/Util");n=OpenLayers.Class(s,{serializer:null,initialize:function(){s.prototype.initialize.apply(this,arguments),this.serializer=new r},get:function(e,t){var i,n=this,r={},a=$.Deferred();return null!==e&&(o.is("Array",e)?r={ids:e.join(",")}:(i=s.prototype.get.apply(this,arguments),r={id:e})),this.model.loginManager.isLoggedIn()||(r.sandbox=!0),o.defined(i)?a.resolve(i):(OpenLayers.Util.extend(r,t),$.get(this.url,r).then(function(e){return n.serializer.read(e),e}).done(function(t){n.onFeatureRead(t,a,e)}).fail(function(){a.reject()})),a},onFeatureRead:function(e,t){e.users&&this.model.users.mergeObjects(e.users,null,new OL.Bounds),e=e[this.objectType+"s"];var i=e.objects;delete e.objects,this.put(i),this.additionalInfo=e,t.resolve(i)},CLASS_NAME:"Waze.Model.OnDemandRepository"}),i.exports=n}}),this.require.define({"Waze/Model/OpeningHour":function(e,t,i){(function(){var e,t;t=Backbone.Model.extend({ALL_DAY_FROM:"00:00",ALL_DAY_TO:"00:00",defaults:function(){return{fromHour:"09:00",toHour:"17:00",days:this.defaultDays.clone()}},defaultDays:[1,2,3,4,5],isAllDay:function(){return this.get("fromHour")===this.ALL_DAY_FROM&&this.get("toHour")===this.ALL_DAY_TO},setAllDay:function(){return this.set("fromHour",this.ALL_DAY_FROM),this.set("toHour",this.ALL_DAY_TO)}}),e=Backbone.Collection.extend({model:t}),i.exports={OpeningHour:t,Collection:e}}).call(this)}}),this.require.define({"Waze/Model/PlaceUpdate":function(e,t,i){(function(){var e;e=Backbone.Model.extend({SUBJECT:{VENUE:"VENUE",IMAGE:"IMAGE"},ACTION:{ADD:"ADD",UPDATE:"UPDATE",DELETE:"DELETE"},defaults:{approved:null},initialize:function(){return this.set({updateType:""+this.get("action")+"_"+this.get("subject")})},isVenue:function(){return this.get("subject")===this.SUBJECT.VENUE},isImage:function(){return this.get("subject")===this.SUBJECT.IMAGE},getAddedImage:function(){return this._findImage(this.id)},_findImage:function(e){return _(this.get("place").attributes.images).find(function(t){return t.get("id")===e})}}),e.MIN_EDIT_RANK=1,i.exports=e}).call(this)}}),this.require.define({"Waze/Model/PlaceUpdate/Builder":function(e,t,i){(function(){var e,n,s,r,o={}.hasOwnProperty;s=t("Waze/Model/PlaceUpdate"),n=t("Waze/Model/PlaceUpdate/Flag"),e=t("Waze/Model/PlaceUpdate/ChangedField"),r=OL.Class({TYPE:{VENUE:"VENUE",REQUEST:"REQUEST",IMAGE:"IMAGE"},SUB_TYPE:{UPDATE:"UPDATE",DELETE:"DELETE",FLAG:"FLAG"},initialize:function(e){return _.extend(this,e)},build:function(e){return this._isFlag(e)?this._buildFlag(e):this._buildRegularUpdate(e)},_isFlag:function(e){return e.type===this.TYPE.REQUEST&&e.subType===this.SUB_TYPE.FLAG},_buildFlag:function(e){return new n({subject:e.flagSubjectType,type:e.flagType,comment:e.flagComment,place:e.place,dateAdded:e.dateAdded,createdBy:e.createdBy,entityId:e.flagEntityID,id:e.id,isEditable:this.areRequestsEditable})},_buildRegularUpdate:function(e){var t,i,n;return n=s.prototype.SUBJECT.VENUE,t=s.prototype.ACTION.ADD,e.type===this.TYPE.REQUEST?t=e.subType===this.SUB_TYPE.UPDATE?s.prototype.ACTION.UPDATE:s.prototype.ACTION.DELETE:e.type===this.TYPE.IMAGE&&(n=s.prototype.SUBJECT.IMAGE),i=this._parseChangedFields(e.changedVenue,e.place),new s({action:t,subject:n,changedFields:i,place:e.place,dateAdded:e.dateAdded,createdBy:e.createdBy,id:e.id,isEditable:this.areRequestsEditable})},_parseChangedFields:function(t,i){var n,s,r;return null==t&&(t={}),delete t.permissions,s=function(){var s;s=[];for(n in t)o.call(t,n)&&(r=t[n],s.push(new e({fieldName:n,suggestedValue:r,venue:i},{parse:!0})));return s}()}}),i.exports=r}).call(this)}}),this.require.define({"Waze/Model/PlaceUpdate/ChangedField":function(e,t,i){(function(){var e,n;n=null,_.defer(function(){return n=t("Waze/Feature/Vector/Landmark")}),e=Backbone.Model.extend({GEOMETRY_FIELDS:{entryExitPoints:!0,geometry:!0},initialize:function(e,t){var i;return e={},e[this.get("fieldName")]=this.get("suggestedValue"),i=new n(e,{parse:null!=t?t.parse:void 0}),i.model=W.model,this.set({suggestedVenue:i})},isGeometry:function(){return this.GEOMETRY_FIELDS[this.get("fieldName")]===!0}}),i.exports=e}).call(this)}}),this.require.define({"Waze/Model/PlaceUpdate/Flag":function(e,t,i){(function(){var e,n;n=t("Waze/Model/PlaceUpdate"),e=n.extend({TYPE:{CLOSED:"CLOSED",MOVED:"MOVED",RESIDENTIAL:"RESIDENTIAL",DUPLICATE:"DUPLICATE",INAPPROPRIATE:"INAPPROPRIATE",WRONG_DETAILS:"WRONG_DETAILS",LOW_QUALITY:"LOW_QUALITY",UNRELATED:"UNRELATED",OTHER:"OTHER"},initialize:function(){return this.set("updateType","flag"),this.isImage()&&this.set("imageId",this.get("entityId")),this.isVenue()&&this.get("type")===this.TYPE.DUPLICATE?this.set("duplicateVenueId",this.get("entityId")):void 0},getDuplicateVenue:function(){var e;return e=this.get("duplicateVenueId"),this.get("place").model.venues.get(e)},getImage:function(){return this._findImage(this.getImageId())},getImageId:function(){return this.get("imageId")}}),i.exports=e}).call(this)}}),this.require.define({"Waze/Model/SegmentRepository":function(e,t,i){var n,s=t("Waze/Model/ObjectRepository");n=OpenLayers.Class(s,{zoomToRoadType:null,roadTypeBounds:null,topCityID:null,initialize:function(){s.prototype.initialize.apply(this,arguments),this.zoomToRoadType=W.Config.segments.zoomToRoadType,this.roadTypeBounds={}},destroy:function(){this.roadTypeBounds=null,s.prototype.destroy.apply(this,arguments)},updateDataExtent:function(e,t,i){var n=this,s=this.zoomToRoadType[i]||[],r=[];return-1===s&&(s=W.Config.segments.allTypes),Object.keys(this.zoomToRoadType).forEach(function(t){t=parseInt(t,10);var i=s.contains(t),o=n.roadTypeBounds[t]&&n.roadTypeBounds[t].containsBounds(e);o||i&&r.push(t)}),r.isEmpty()?null:{roadTypes:s.toString()}},mergeObjects:function(e,t,i){var n=e.roadTypes||[];n.forEach(function(e){this.roadTypeBounds[e]=i},this),this.calcTopCity(e),s.prototype.mergeObjects.apply(this,arguments)},calcTopCity:function(e){var t,i,n,s,r={},o=0;this.topCityID=null,e.objects.forEach(function(e){s=this.model.streets.get(e.attributes.primaryStreetID),s&&(n=s.cityID,i=this.model.cities.get(n),i&&!i.isEmpty&&(t=r[n]||0,r[n]=t++,t>=o&&(o=t,this.topCityID=n)))},this)},clear:function(){this.roadTypeBounds={},s.prototype.clear.apply(this,arguments)},CLASS_NAME:"Waze.Model.SegmentRepository"}),i.exports=n}}),this.require.define({"Waze/Permissions":function(e,t,i){i.exports={Segments:{EDIT_GEOMETRY:1,EDIT_PROPERTIES:2,DELETE:4,EDIT_EMPTY_STREET:8,SPLIT_DIRECTIONS:16},Nodes:{EDIT_GEOMETRY:1,DELETE:2,EDIT_OPEN_TURNS:4,EDIT_CLOSE_TURNS:8},Landmarks:{EDIT_GEOMETRY:1,EDIT_PROPERTIES:2,DELETE:4}}}}),this.require.define({"Waze/Presenter":function(e,t,i){var n=OpenLayers.Class({uniqueID:null,events:null,$el:null,elSelector:null,tagName:"div",ui:null,className:null,attr:null,template:null,olEvents:null,initialize:function(e){OpenLayers.Util.extend(this,e),null===this.$el&&null===this.elSelector?this.$el=$("<"+this.tagName+"/>"):null!==this.elSelector&&(this.$el=$(this.elSelector)),null!==this.className&&this.$el.addClass(this.className),this.olEvents=new OpenLayers.Events(this),this.uniqueID="presenter-"+n.baseID--,Object.forEach(this.events||{},function(e,t){var i,n,s=e.indexOf(" ");-1!==s?(i=e.slice(0,s),n=e.slice(s+1)):(i=e,n=""),i+="."+this.uniqueID,this.$el.on(i,n,$.proxy(this,t))},this)},render:function(){var e=this.$el.stacheComb(this.template,this.serialize());return this._findUiElements(),this.onRender(),e},onRender:function(){},_findUiElements:function(){var e=this;null!==this.ui&&(this._uiBindings||(this._uiBindings=this.ui),this.ui={},Object.forEach(this._uiBindings,function(t,i){e.ui[t]=e.$el.find(i)}))},_eventStopPropagation:function(e){e.stopPropagation()},serialize:function(){return{}},hide:function(){this.$el.hide()},show:function(){this.$el.show()},on:function(e,t,i){this.olEvents.register(e,i,t)},off:function(e,t,i){this.olEvents.unregister(e,i,t)},fire:function(e,t){this.olEvents.triggerEvent(e,t)},destroy:function(){null!==this.$el&&this.$el.off("."+this.uniqueID),this.$el=null,this.olEvents.destroy()}});n.baseID=0,i.exports=n}}),this.require.define({"Waze/Presenter/Alias/Item":function(e,t,i){(function(){var e;e=Marionette.ItemView.extend({template:JST["templates/venue/alias"],tagName:"li",ui:{name:".alias-name"},events:{"click .delete":"_onDeleteClicked","change .alias-name":"_onNameChanged"},_onNameChanged:function(){return this.model.set("name",this.ui.name.val())},_onDeleteClicked:function(){return this.model.collection.remove(this.model)}}),i.exports=e}).call(this)}}),this.require.define({"Waze/Presenter/Alias/Layout":function(e,t,i){(function(){var e,n,s;e=t("Waze/Model/Alias").Item,n=t("Waze/Presenter/Alias/Item"),s=Marionette.CompositeView.extend({MAX_ALIASES:4,template:JST["templates/venue/aliases-layout"],itemView:n,itemViewContainer:".list",events:{"click .add":"_onAddClicked"},ui:{addButton:".add"},initialize:function(){return this.collection.on("add remove",this._toggleAddButton,this)},serializeData:function(){return{hideAddButton:this._shouldHideAddButton()}},_onAddClicked:function(t){return"function"==typeof t.preventDefault&&t.preventDefault(),this.collection.add(new e({name:""}))},_shouldHideAddButton:function(){return this.collection.length>=this.MAX_ALIASES||!this.options.editable},_toggleAddButton:function(){return this.ui.addButton.toggleClass("hidden",this._shouldHideAddButton())}}),i.exports=s}).call(this)}}),function(){var e,t,i;e="\u05d0".charCodeAt(0),i="\u05ea".charCodeAt(0),t=function(t){var n;return e<=(n=t.charCodeAt(0))&&i>=n},$.fn.autoRTL=function(e){return null==e&&(e={}),this.each(function(){var e,i,n;return e=$(this),n=e.is(":input")?e.val():e.text(),n=$.trim(n),0!==n.length?(i=t(n.charAt(0)),e.css(i?{direction:"rtl",textAlign:"right"}:{direction:"ltr",textAlign:"left"})):void 0})},$("body").on("keypress","[data-auto-rtl]",function(){return $(this).autoRTL()})}.call(this),this.require.define({"Waze/Presenter/Chat":function(e,t,i){(function(){var e,n,s,r,o,a,l;l=t("Waze/Presenter"),r=t("Waze/Model/ChatUser"),e=t("Waze/Model/ChatMessage").ChatMessage,o=t("Waze/Presenter/ChatUser"),n=t("Waze/Presenter/ChatMessage"),a=13,s=OpenLayers.Class(l,{template:"chat",events:{"click .toggle":"toggleOpen","click .minimize":"toggleOpen","keypress .message-input":"_onMessageInputClicked","click ul.visibility a":"_toggleVisibility","click .header":"_onHeaderClicked","click .chat-intro-tip .go-visible":"_onGoVisible","click .chat-intro-tip .go-invisible":"_onGoInvisible","click .chat-intro-tip .close":"_closeIntroTip","click .unread-messages-notification":"_onUnreadMessagesNotificationClicked","click .rooms a":"_onRoomClicked"},ui:{toggle:".toggle",roomName:".room-name",popup:"#chat",messages:".message-list",users:".user-list",rooms:".rooms",messageInput:".message-input",status:".status",visibleButton:".visibility-visible",invisibleButton:".visibility-invisible",introTip:".chat-intro-tip",unreadMessagesNotification:".unread-messages-notification"},initialize:function(e){l.prototype.initialize.apply(this,arguments),this.$el.attr({id:"chat-overlay"}).appendTo($(e.map.div)),this.$el.on("click mousedown dragstart","input",function(e){return e.stopPropagation()}),this.model=e.model,this.model.users.on("reset",this._onUsersReset,this),this.model.users.on("add",this._addUser,this),this.model.users.on("remove",this._onUserRemoved,this),this.model.on("change:open",this._onOpenChanged,this),this.model.on("change:active",this._onActiveChanged,this),this.model.on("change:visible",this._updateStatus,this),this.model.on("change:roomName",function(e){return function(){return e.ui.roomName.text(e.model.get("roomName")||I18n.t("chat.connecting")),e.$el.toggleClass("connected",null!=e.model.get("roomName")),e._resetRooms()}}(this)),this.model.messages.on("add",this._addMessage,this),this.model.messages.on("reset",this._resetMessages,this),this.model.messages.on("beforeMessageUpdated",function(e){return function(){return e._wasScrolledToBottom=e._isScrolledToBottomMessage()}}(this)),this.model.messages.on("messageUpdated",function(e){return function(t){return t.isSystem()?void 0:e._afterContentAdded(e._wasScrolledToBottom)}}(this)),this.model.rooms.on("reset",this._resetRooms,this),this.model.rooms.on("add",this._resetRooms,this),this.userPresenters={},this.render(),this.ui.messages.on("scroll",function(e){return function(){return e._hideUnreadMessagesNotification()}}(this)),this._updateStatus(),this._onOpenChanged(),W.accelerators.events.on({toggleChat:this.toggleOpen,scope:this})},_onGoVisible:function(e){return"function"==typeof e.preventDefault&&e.preventDefault(),this.model.set({visible:!0,open:!0})},_onGoInvisible:function(e){return"function"==typeof e.preventDefault&&e.preventDefault(),this.model.set({visible:!1,open:!0})},_closeIntroTip:function(){return this.ui.introTip.hide()},_onHeaderClicked:function(e){return $(e.target).hasClass("header")?this.toggleOpen():void 0},_onUsersReset:function(){var e,t,i,n,s;for(this.ui.users.empty(),n=this.model.users.models,s=[],t=0,i=n.length;i>t;t++)e=n[t],s.push(this._addUser(e));return s},_addUser:function(e){var t,i,n;return n=new o({model:e,map:this.map,marx:this.marx,currentUser:this.model.get("currentUser")}),n.render(),this.userPresenters[e.get("id")]=n,i=this.model.users.models.indexOf(e),t=this.ui.users.children().eq(i),t.length?n.$el.insertBefore(t):n.$el.appendTo(this.ui.users)},_onUserRemoved:function(e){var t,i;return t=e.item.get("id"),i=".user[data-id='"+t+"']",this.ui.users.find(i).remove(),delete this.userPresenters[t]},_onOpenChanged:function(){var e;return e=this.model.get("open")===!0,this.$el.toggleClass("open",e),e?(this._closeIntroTip(),this._scrollToBottomMessage(),this._hideUnreadMessagesNotification()):void 0},_onActiveChanged:function(){var e;return e=this.model.get("active"),this.$el.toggle(e),this.ui.toggle.toggle(e)},_onRoomClicked:function(e){var t;return e.preventDefault(),t=$(e.target).data("room"),this.model.set("room",t)},_updateStatus:function(){var e;return e=this.model.get("visible"),this.ui.status.text(this._getStatusText()),this.ui.visibleButton.toggleClass("checked",e),this.ui.invisibleButton.toggleClass("checked",!e),this.$el.toggleClass("visible-true",e),this.$el.toggleClass("visible-false",!e)},toggleOpen:function(){return this._closeIntroTip(),this.model.set("open",!this.model.get("open"))},_toggleVisibility:function(e){return null!=e&&e.preventDefault(),this.model.set("visible",!this.model.get("visible"))},_onMessageInputClicked:function(e){var t;if(e.keyCode===a)return t=$.trim(this.ui.messageInput.val()),null!=this.model.get("room")&&""!==t&&(this.model.sendMessage(t),this.ui.messageInput.val("")),!1},_addMessage:function(e){var t,i;return t=new n({model:e}),t.render(),i=this._isScrolledToBottomMessage(),this.ui.messages.append(t.$el),e.isSystem()?void 0:this._afterContentAdded(i)},_afterContentAdded:function(e){return e?this._scrollToBottomMessage():this._showUnreadMessagesNotification(),this.model.get("open")?void 0:this.$el.addClass("has-unread-messages")},_showUnreadMessagesNotification:function(){return this._unreadMessagesCount||(this._unreadMessagesCount=0),this._unreadMessagesCount++,this.ui.unreadMessagesNotification.text(I18n.t("chat.unread",{count:this._unreadMessagesCount})).show()},_onUnreadMessagesNotificationClicked:function(e){return"function"==typeof e.preventDefault&&e.preventDefault(),this._scrollToBottomMessage(),this._hideUnreadMessagesNotification()},_hideUnreadMessagesNotification:function(){return this._unreadMessagesCount=0,this.ui.unreadMessagesNotification.hide(),this.$el.removeClass("has-unread-messages")},_isScrolledToBottomMessage:function(){var e;return e=this.ui.messages,e.scrollTop()+e.outerHeight()>=e[0].scrollHeight},_scrollToBottomMessage:function(){return this.ui.messages.scrollTop(this.ui.messages[0].scrollHeight)},_resetMessages:function(){var e,t,i,n,s;for(this.ui.messages.empty(),n=this.model.messages.models,s=[],t=0,i=n.length;i>t;t++)e=n[t],s.push(this._addMessage(e));return s},_resetRooms:function(){var e,t,i,n,s;for(this.ui.rooms.empty(),n=this.model.rooms.models,s=[],t=0,i=n.length;i>t;t++)e=n[t],s.push(this._addRoom(e));return s},_addRoom:function(e){var t,i;return t=this.model.get("room"),i=this._createRoomMenuItem(e),e.equals(t)&&i.addClass("checked"),i.appendTo(this.ui.rooms),this.$el.toggleClass("multiple-rooms",this.model.rooms.models.length>1)},_createRoomMenuItem:function(e){var t,i,n;return n=e.getName(),i=$("<li>"),t=$("<a>").attr({href:"#"}).text(n).data({room:e}).appendTo(i),i},serialize:function(){var e;return e=this.model.toJSON(),e.status=this._getStatusText(),e},_getStatusText:function(){return I18n.t(this.model.get("visible")?"chat.visible":"chat.invisible")}}),i.exports=s}).call(this)}}),this.require.define({"Waze/Presenter/ChatMessage":function(e,t,i){(function(){var e,n;n=t("Waze/Presenter"),e=OpenLayers.Class(n,{template:"chat_message",ui:{body:".body"},initialize:function(){return n.prototype.initialize.apply(this,arguments),this.model.on("change:body",$.proxy(this.render,this)),this},onRender:function(){return this.$el.addClass("message "+this.model.getType()+"-message"),this.$el.find(".body div").autoRTL()},serialize:function(){return{message:this.model.toJSON()}}}),i.exports=e}).call(this)}}),this.require.define({"Waze/Presenter/ChatUser":function(e,t,i){(function(){var e,n;n=t("Waze/Presenter"),e=OpenLayers.Class(n,{tagName:"li",template:"chat_user",events:{"click .user":"_onClick"},serialize:function(){return{user:this.model.toJSON(),className:this._isCurrentUser()?"current-user":""}},_isCurrentUser:function(){return this.model.get("id").toString()===this.currentUser.get("id").toString()},_onClick:function(e){var t;return e.preventDefault(),t=this._transformFromMarx(this.model.getCenter()),this.map.setCenter(t)},_transformFromMarx:function(e){return e.transform(this.marx.displayProjection,this.map.getProjectionObject())}}),i.exports=e}).call(this)}}),this.require.define({"Waze/Presenter/EditPanel":function(e,t,i){var n,s=t("Waze/Presenter"),r=t("Waze/Presenter/FeatureEditor"),o=t("Waze/Presenter/FeatureEditor/Segment"),a=t("Waze/Presenter/FeatureEditor/Node"),l=t("Waze/Presenter/FeatureEditor/Landmark"),h=t("Waze/Model/EventType");n=OL.Class(s,{typeToEditorClass:null,$el:$("#edit-panel .contents"),template:"segment-edit",selection:null,dataModel:null,lastEditorClass:null,initialize:function(){var e=this;s.prototype.initialize.apply(this,arguments),this.typeToEditorClass={node:new a({dataModel:this.dataModel}),segment:new o({dataModel:this.dataModel,selectionManager:this.selectionManager}),camera:new r({dataModel:this.dataModel,template:"camera-edit"}),venue:new l({dataModel:this.dataModel})},this.selectionManager.events.register("selectionchanged",this,this.selectionChanged),["segments","venues","cameras","nodes"].forEach(function(t){e.dataModel[t].events.register(h.CHANGED,e,e.featuresChanged)})},selectionChanged:function(e){var t,i=e.selected;this.selection=_(i).pluck("model"),null!==this.lastEditorClass&&(this.lastEditorClass.disable(),this.lastEditorClass=null),this.selectionManager.hasSelectedItems()&&(t=this.typeToEditorClass[this.selection.first().type],this.lastEditorClass=t,t.enable(),t.setFeature(this.selection,e.reversedSegments))},featuresChanged:function(e){null!==this.lastEditorClass&&this.lastEditorClass.featuresChanged(e)}}),i.exports=n}}),this.require.define({"Waze/Presenter/FeatureEditor":function(e,t,i){var n,s=t("Waze/Presenter"),r=t("Waze/Action/UpdateObject");n=OpenLayers.Class(s,{$el:$("#edit-panel .contents"),selectedFeature:null,dataModel:null,enabled:!1,initialize:function(){s.prototype.initialize.apply(this,arguments),this.$el.on("change",".attributes-form input, .attributes-form select, .attributes-form textarea",$.proxy(this.attributeChanged,this))},setFeature:function(e){this.selectedFeature=e.first();var t=this;this.render().then(function(){t.selectedFeature.arePropertiesEditable()||t.$el.find(".attributes-form input, textarea, select").prop("disabled",!0)})},serializeElement:function(e){var t,i,n=e.data("units"),s=e.data("display-units"),r=e.data("round");if("checkbox"===e.attr("type")&&e.is("[data-multiple]"))i=this.$el.find("input[name="+e.attr("name")+"]:checked"),t=i.toArray().map(function(e){return $(e).val()});else{if("checkbox"===e.attr("type"))return e.is(":checked");t=e.is("select")&&e.prop("multiple")?e.find("option:selected").toArray().map(function(e){return $(e).val()}):e.is("select")?e.find("option:selected").val():e.val()}return"boolean"===e.data("type")&&(t=e.booleanVal()),"numeric"===e.data("type")&&(t=e.is("[data-nullable]")&&"null"===t?null:parseInt(t,10)),n&&(t=t*OpenLayers.INCHES_PER_UNIT[s]/OpenLayers.INCHES_PER_UNIT[n]),r&&(t=Math.round(t)),t},removeMixedOption:function(e){return e.find("[data-mixed-indicator]").remove()},attributeChanged:function(e){if(this.enabled){var t=$(e.target),i=t.attr("name"),n=this.serializeElement(t),s=this[i+"Changed"],r=t.is("[data-refresh]"),o={};t.is("select")&&this.removeMixedOption(t),s?s.call(this,n):(o[i]=n,this.changed(o,r))}},changed:function(e,t){t||(this.changing=!0),this.dataModel.actionManager.add(new r(this.selectedFeature,e)),this.changing=!1},featuresChanged:function(e){return this.changing||1!==e.length||e.first().getID()!==this.selectedFeature.getID()||e.first().type!==this.selectedFeature.type?!1:(this.render(),!0)},serialize:function(){return this.selectedFeature||{}},enable:function(){this.enabled=!0},disable:function(){this.$el.find("input,textarea").blur(),this.enabled=!1}}),i.exports=n}}),this.require.define({"Waze/Presenter/FeatureEditor/Landmark":function(e,t,i){(function(){var e,n,s,r,o,a,l,h,u,c,d,p,m,g,f;r=t("Waze/Presenter/FeatureEditor"),l=t("Waze/Presenter/FeatureEditor/LandmarkCategories"),m=t("Waze/Action/UpdateLandmarkAddress"),c=t("Waze/Presenter/OpeningHour/Layout"),u=t("Waze/Action/MultiAction"),g=t("Waze/Action/UpdateObject"),m=t("Waze/Action/UpdateLandmarkAddress"),p=t("Waze/Action/UpdateFeatureGeometry"),a=t("Waze/Feature/Vector/Landmark"),f=t("Waze/Model/Object/User"),o=t("Waze/Presenter/PlaceUpdate/ImageDialog"),e=t("Waze/Model/Alias").Item,n=t("Waze/Model/Alias").Collection,s=t("Waze/Presenter/Alias/Layout"),d=t("Waze/Presenter/PlaceUpdate/Layout"),h=OL.Class(r,{events:{"click .landmark .address-edit-btn":"_editAddressClicked","click .landmark .address-edit-cancel":"_cancelEditAddressClicked","submit .landmark .landmark-address-form":"_addressEdited","change .landmark .toggleEmptyAddress":"_emptyAddressToggled","show.bs.tab a[data-toggle=tab]":"_onTabShown","click .image-delete-button":"_onDeleteImageClicked","click .image-preview-container":"_onImagePreviewClicked","click .pending-changes-alert":"_onPendingChangesAlertClicked"},$el:$("#edit-panel .contents"),template:"venue/venue-edit",cityNames:null,streetNames:null,previousGeometry:null,lastTab:null,imageDialogView:null,serialize:function(){var e,t;return e=this.selectedFeature.getAddressDetails(),t=this._getApprovedImages(),{landmark:this.selectedFeature,dataModel:this.dataModel,showStatesSelection:this.dataModel.hasStates(),address:this.selectedFeature.getAddress(),showAddress:this.selectedFeature.hasAddress(),showStaffLockOption:this._isStaffLocked(),lockRankRange:this._getLockRankRange(),serviceSet:this.selectedFeature.getServiceSet(),serviceTypes:a.prototype.SERVICE_TYPES,imageCount:t.length,hasImages:t.length>0,showUnapprovedAlert:!this.selectedFeature.attributes.approved,showPendingChangesAlert:this.selectedFeature.hasUpdateRequests(),images:t}},_getApprovedImages:function(){return _.filter(this.selectedFeature.attributes.images,function(e){return e.get("approved")})},_isStaffLocked:function(){return this.selectedFeature.getLockRank()===f.prototype.StaffRank},_getLockRankRange:function(){var e,t,i,n;return t=Math.min(this.dataModel.loginManager.getUserRank(),f.prototype.MaxLevel),i=this.selectedFeature.attributes.lockRank,e=Math.max(t,i),function(){n=[];for(var t=0;e>=0?e>=t:t>=e;e>=0?t++:t--)n.push(t);return n}.apply(this)},_onPendingChangesAlertClicked:function(){return W.map.panelRegion.show(new d({model:this.selectedFeature}))},_onTabShown:function(e){return this.lastTab=$(e.target).attr("href")},_restoreLastTab:function(){return this.lastTab?this.$el.find("a[href="+this.lastTab+"]").tab("show"):void 0},_emptyAddressToggled:function(e){var t,i,n;return t=$(e.target),i=t.parents(".toggle-empty").find("input:not([type=checkbox])"),n=t.is(":checked"),i.prop({disabled:n,required:!n})},_editAddressClicked:function(e){return e.preventDefault(),this._enableAddressEditing()},_cancelEditAddressClicked:function(e){return e.preventDefault(),this._disableAddressEditing()},_enableAddressEditing:function(){return this.$el.find(".landmark-address-edit").addClass("editing").removeClass("preview")},_disableAddressEditing:function(){return this.$el.find(".landmark-address-edit").removeClass("editing").addClass("preview")},_addressEdited:function(e){var t,i,n,s,r,o,a,l;for(i={},r=new u,this.changing=!0,this.dataModel.actionManager.add(r),e.preventDefault(),l=this.$el.find(".landmark-address-form").find("select,input,textarea"),o=0,a=l.length;a>o;o++)n=l[o],t=$(n),i[t.attr("name")]=this.serializeElement(t);return this._disableAddressEditing(),s=_(i).pick("houseNumber"),i=_(i).omit("houseNumber"),r.doSubAction(new g(this.selectedFeature,s)),r.doSubAction(new m(this.selectedFeature,i)),this.changing=!1,this.render()},isPointChanged:function(e){var t,i,n;return i=this.selectedFeature,n="true"===e?i.getPointGeometry():this.previousGeometry?this.previousGeometry.clone():i.getPolygonGeometry(),t=new p(i,this.dataModel.venues,i.geometry,n),this.changing=!0,this.dataModel.actionManager.add(t),this.changing=!1},categoriesChanged:function(e){return _.isArray(e)||(e=_(e.split(",")).compact()),this.changed({categories:e}),this.suggestedCategoriesPresenter.categoriesChanged(e),this.$el.find(".brand").toggle(this.selectedFeature.isGasStation())},setFeature:function(){var e,t;return e=_.values(this.dataModel.cities.objects),t=_.values(this.dataModel.streets.objects),this.cityNames=_(e).pluck("name").filter(function(e){return e}),this.streetNames=_(t).pluck("name").filter(function(e){return e}),this.lastTab=null,r.prototype.setFeature.apply(this,arguments),this.previousGeometry=null,this.selectedFeature.isPoint()?void 0:this.previousGeometry=this.selectedFeature.geometry},featuresChanged:function(){var e;return e=r.prototype.featuresChanged.apply(this,arguments),e&&!this.selectedFeature.isPoint()?this.previousGeometry=this.selectedFeature.geometry:void 0},_onCategoryClicked:function(e){var t;return t=this.selectedFeature.attributes.categories.clone(),e.replace&&t.pop(),t.push(e.category),this.categoriesChanged(t)},onOpeningHoursChanged:function(){var e;return this.changing=!0,e={openingHours:this.openingHoursLayout.collection.toJSON()},this.dataModel.actionManager.add(new g(this.selectedFeature,e)),this.changing=!1},_onDeleteImageClicked:function(e){var t,i,n;return i=$(e.target).parent(".image-preview-container").data("id"),n=_(this.selectedFeature.attributes.images).reject(function(e){return e.id===i}),t={images:n},this.dataModel.actionManager.add(new g(this.selectedFeature,t)),!1},_onImagePreviewClicked:function(e){var t;return t=$(e.currentTarget).data("id"),null==this.imageDialogView&&(this.imageDialogView=new o),this.imageDialogView.setImageId(t),W.appPresenter.dialogRegion.show(this.imageDialogView),"function"==typeof e.preventDefault?e.preventDefault():void 0},_onAliasesChanged:function(){var e,t;return e=this.aliasesLayout.collection.removeEmpty().map(function(e){return e.get("name")}),t={aliases:e},this.dataModel.actionManager.add(new g(this.selectedFeature,t))},_initAliasesView:function(){var t;return t=this.selectedFeature.attributes.aliases.map(function(t){return new e({name:t})}),null!=this.aliasesLayout&&(this.aliasesLayout.collection.off(),this.aliasesLayout.remove()),this.aliasesLayout=new s({el:this.$el.find(".aliases-view").get(0),collection:new n(t),editable:this.selectedFeature.arePropertiesEditable()}),this.aliasesLayout.collection.on("remove change",this._onAliasesChanged,this),this.aliasesLayout.render()},render:function(){return r.prototype.render.apply(this,arguments).then(function(e){return function(){return e.suggestedCategoriesPresenter&&e.suggestedCategoriesPresenter.destroy(),e.suggestedCategoriesPresenter=new l({$el:e.$el.find(".categories"),venue:e.selectedFeature,editable:e.selectedFeature.arePropertiesEditable()}),e.suggestedCategoriesPresenter.olEvents.register("categoryClicked",e,e._onCategoryClicked),null!=e.openingHoursLayout&&(e.openingHoursLayout.collection.off(),e.openingHoursLayout.remove()),e.openingHoursLayout=new c({el:e.$el.find(".opening-hours").get(0),collection:e.selectedFeature.getOpeningHours(),editable:e.selectedFeature.arePropertiesEditable()&&!e.selectedFeature.attributes.residential}),e.openingHoursLayout.collection.on("remove add change",e.onOpeningHoursChanged,e),e.openingHoursLayout.render(),e._initAliasesView(),e.$el.find(".landmark-address-form input[name=streetName]").typeahead({source:e.streetNames}),e.$el.find(".landmark-address-form input[name=cityName]").typeahead({source:e.cityNames}),e._disableAddressEditing(),e._restoreLastTab()}}(this))}}),i.exports=h}).call(this)}}),this.require.define({"Waze/Presenter/FeatureEditor/LandmarkCategories":function(e,t,i){(function(){var e,n,s,r,o,a,l,h,u,c,d;for(n=t("Waze/Presenter"),e=OpenLayers.Class(n,{events:{"click .category":"onCategoryClicked"},template:"venue/venue-categories",ui:{select:"[name=categories]",suggestedCategories:".suggested-categories"},initialize:function(){n.prototype.initialize.apply(this,arguments),this.mainCategories=W.Config.venues.categories,this.categoryMap=this.venue.getCategorySet(),this.render()},serialize:function(){return{view:this,categoryMap:this.categoryMap}},getSuggestedCategories:function(){var e,t;return this.editable?(e=this.venue.attributes.categories,e.isEmpty()?this.mainCategories:(t=1===e.length&&this.isMainCategory(e.first()),t?W.Config.venues.subcategories[e.first()]:[])):[]},isMainCategory:function(e){return this.mainCategoryMap[e]},categoriesChanged:function(){return this.categoryMap=this.venue.getCategorySet(),this.setSelectedCategories(),this.ui.suggestedCategories.hide(),this.ui.suggestedCategories.stacheComb("venue/suggested-categories",this.serialize()),this.ui.suggestedCategories.fadeIn("fast")
},render:function(){return n.prototype.render.apply(this,arguments),this.ui.select.select2({width:"100%",formatResult:this.format,formatSelection:function(e){return function(t){return JST["templates/venue/category-tag"]({category:t.id,hideClose:!e.editable})}}(this),data:{results:this.allCategories,text:this.format},multiple:!0,sortResults:function(e){return e.sort(function(e,t){return e.id.localeCompare(t.id)})}}),this.setSelectedCategories()},setSelectedCategories:function(){return this.ui.select.select2("data",_(this.venue.attributes.categories).map(function(e){return{id:e}}))},format:function(e){return I18n.t("venues.categories."+e.id)},onCategoryClicked:function(e){var t;return e.preventDefault(),t=$(e.target).data("category"),this.olEvents.triggerEvent("categoryClicked",{category:t,replace:!this.isMainCategory(t)})}}),e.prototype.mainCategoryMap=_.object(W.Config.venues.categories,W.Config.venues.categories),s=[],e.prototype.allCategories=s,c=W.Config.venues.categories,a=0,h=c.length;h>a;a++)for(o=c[a],s.push({id:o}),d=W.Config.venues.subcategories[o],l=0,u=d.length;u>l;l++)r=d[l],s.push({id:r});i.exports=e}).call(this)}}),this.require.define({"Waze/Presenter/FeatureEditor/Node":function(e,t,i){var n,s=t("Waze/Presenter/FeatureEditor"),r=t("Waze/Action/ModifyAllConnections");n=OpenLayers.Class(s,{events:{"click .disallow-connections":"disallowAllConnections","click .allow-connections":"allowAllConnections"},$el:$("#edit-panel .contents"),template:"node-edit",initialize:function(){s.prototype.initialize.apply(this,arguments),W.accelerators.events.register("disallowAllConnections",this,this.disallowAllConnections),W.accelerators.events.register("allowAllConnections",this,this.allowAllConnections)},setAllConnections:function(e){var t=this.selectedFeature;this.enabled&&t.areConnectionsEditable()&&(this.changing=!0,this.dataModel.actionManager.add(new r(t,e)),this.changing=!1,this.render())},featuresChanged:function(e){if(!this.changing){var t=this.selectedFeature.attributes.segIDs,i=e.some(function(e){return"segment"===e.type&&t.contains(e.getID())});return i&&this.render(),i}},allowAllConnections:function(){this.setAllConnections(!0)},disallowAllConnections:function(){this.setAllConnections(!1)}}),i.exports=n}}),this.require.define({"Waze/Presenter/FeatureEditor/Segment":function(e,t,i){var n,s=t("Waze/Presenter/FeatureEditor"),r=t("Waze/Presenter/Restriction/Modal"),o=t("Waze/Feature/Vector/CompositeSegment"),a=t("Waze/Action/MultiAction"),l=t("Waze/Action/AddAlternateStreet"),h=t("Waze/Action/UpdateObject"),u=t("Waze/Model/Object/User"),c=t("Waze/Control/HouseNumbers"),d=t("Waze/Action/UpdateSegmentAddress"),p=t("Waze/Feature/Vector/Segment"),m=t("Waze/ViewHelpers");n=OpenLayers.Class(s,{events:{"click .segment .address-edit-btn":"editAddressClicked","click .segment .address-edit-cancel":"cancelEditAddressClicked","submit .segment .address-form":"addressEdited","click .segment .select-entire-street":"selectEntireStreetClicked","click .segment .edit-house-numbers":"editHouseNumbersClicked","click .segment .edit-restrictions":"editRestrictionsClicked","click .segment .add-alt-street-btn":"addAltStreetClicked","click .segment .alt-street-delete":"deleteAltStreetClicked","change .segment input[name=emptyStreet], .segment input[name=emptyCity]":"emptyAddressToggled"},$el:$("#edit-panel .contents"),template:"segment-edit",lastTab:null,changing:!1,cityNames:null,streetNames:null,restrictionsView:null,initialize:function(){var e=this;s.prototype.initialize.apply(this,arguments),this.$el.on("show.bs.tab","a[data-toggle=tab]",function(){e.lastTab=$(this).attr("href")}),this.houseNumbersControl=new c(W.model),W.map.addControl(this.houseNumbersControl),W.accelerators.events.register("toggleSegmentDirection",this,this.toggleDirection),W.accelerators.events.register("editSegmentAddress",this,this.editSegmentShortcutClicked),W.accelerators.events.register("editHouseNumbers",this,this.editHouseNumbersShortcutClicked),W.accelerators.events.register("editRestrictions",this,this.editRestrictionsShortcutClicked),W.accelerators.events.register("selectEntireStreet",this,this.selectEntireStreet),W.accelerators.events.register("increaseSegmentLevel",this,this.increaseSegmentLevel),W.accelerators.events.register("decreaseSegmentLevel",this,this.decreaseSegmentLevel),this.houseNumbersControl.events.register("editingCancelled",this,this.houseNumberEditingCancelled)},selectEntireStreetClicked:function(e){e&&e.preventDefault(),this.selectEntireStreet()},selectEntireStreet:function(){this.enabled&&this.selectionManager.select(this.selectedFeature.children.first().getEntireStreet(this.dataModel))},setFeature:function(e,t){this.selectedFeature=new o(e,this.dataModel,t);var i=_.values(this.dataModel.cities.objects);this.cityNames=_(i).pluck("name").filter(function(e){return e});var n=_.values(this.dataModel.streets.objects);this.streetNames=_(n).pluck("name").filter(function(e){return e}),this.reverseSegments=t,this.consistentDirection=0===this.reverseSegments.numReversed&&!this.reverseSegments.multipleConnectedComponents,this.render()},render:function(){var e=this;this.$el.stacheComb(this.template,this.serialize()).then(function(){e.renderAddressEdit().then(function(){e.renderAltStreetsEdit()}),null!==e.lastTab&&e.$el.find("a[href="+e.lastTab+"]").tab("show"),e.selectedFeature.arePropertiesEditable()||e.$el.find(".attributes-form input, textarea, select").prop("disabled",!0)})},renderAddressEdit:function(){var e=this.$el.find(".address-edit"),t=this;return e.stacheComb("segment-address-edit",this.serialize()).pipe(function(){t.disableAddressEditing(),t.$el.find(".address-edit-btn").prop("disabled",!t.selectedFeature.arePropertiesEditable()),t.$el.find(".address-edit input[name=streetName]").typeahead({source:t.streetNames}),t.$el.find(".address-edit input[name=cityName]").typeahead({source:t.cityNames})})},renderAltStreetsEdit:function(){var e=this.$el.find(".alt-street-controls"),t=this;return e.stacheComb("segment-alt-streets-edit",this.serialize()).pipe(function(){t.$altStreetFormTemplate=t.$el.find(".alt-street-form-template").detach(),t.selectedFeature.arePropertiesEditable()||(t.$el.find(".add-alt-street-btn").prop("disabled",!0),t.$el.find(".alt-street-list").addClass("undeletable")),t.toggleAltStreetTable()})},emptyAddressToggled:function(e){var t=$(e.target),i=t.parents(".toggle-empty").find("input:not([type=checkbox])"),n=t.is(":checked");i.prop({disabled:n,required:!n})},editAddressClicked:function(e){e.preventDefault(),this.enableAddressEditing()},cancelEditAddressClicked:function(e){var t=this;e.preventDefault(),this.renderAddressEdit().then(function(){t.renderAltStreetsEdit()})},enableAddressEditing:function(){this.$el.find(".address-edit").addClass("editing").removeClass("preview")},disableAddressEditing:function(){this.$el.find(".address-edit").removeClass("editing").addClass("preview")},serialize:function(){var e=this.getUserRank(),t=this.selectedFeature.getRoutingRoadTypes();return{segment:this.selectedFeature,segmentId:this.selectedFeature.getID(),isLockedForUser:this.selectedFeature.isLockedByHigherRank(),isStaffLocked:this.selectedFeature.getLockRank()===u.prototype.StaffRank,userRank:e,editable:this.selectedFeature.arePropertiesEditable(),address:this.selectedFeature.getAddress(),addressDetails:this.selectedFeature.getAddressDetails(),isHighway:this.selectedFeature.isHighway(),hasStates:this.dataModel.hasStates(),editingMultiple:this.selectedFeature.children.length>1,allowEditingHouseNumbers:Waze.Config.houseNumbers.allowEditing&&1===this.selectedFeature.children.length,allowDefaultRank:this.selectedFeature.canUserSetDefaultRank(e),numSegments:this.selectedFeature.children.length,prevRouteRankDisabled:null===t.prev,nextRouteRankDisabled:null===t.next,routingRoadTypes:t,dataModel:this.dataModel,view:this}},getUserRank:function(){return Math.min(this.dataModel.loginManager.getUserRank(),u.prototype.MaxLevel)},directionChanged:function(e){if(e>=0){var t=0!==(1&e),i=0!==(2&e),n=null;t!==i&&(n={fwdDirection:!t,revDirection:!i}),this.changed({fwdDirection:t,revDirection:i},n),this.selectedFeature.calcAttributes()}},tollRoadChanged:function(e){this.changed({fwdToll:e,revToll:e})},roadTypeChanged:function(e){this.changed({roadType:e,routingRoadType:null}),this.selectedFeature.calcAttributes(),this.render()},routingRoadTypeChanged:function(e){this.changed({routingRoadType:e}),this.selectedFeature.calcAttributes(),this.render()},shouldShowRoutingRoadTypeMessage:function(){var e=this.selectedFeature.attributes.routingRoadType,t=this.selectedFeature.attributes.roadType;return null!==e&&t!==e},getRoutingRoadTypeMessage:function(){var e,t=this.selectedFeature.attributes.routingRoadType;return e=m.contentTag("strong",I18n.t("segment.road_types."+t)),m.safe_t("edit.segment.routing.info",{roadType:e})},shouldShowRoutingSelect:function(){var e=this.selectedFeature;return!e.mixed.roadType&&e.isRoutable()&&e.canEditRoutingRoadTypes()},changed:function(e,t){var i=new a,n=this;this.changing=!0,this.dataModel.actionManager.add(i),this.selectedFeature.children.forEach(function(s){i.doSubAction(t&&n.reverseSegments[s.getID()]?new h(s,t):new h(s,e))}),this.changing=!1},addressEdited:function(e){var t,i=this,n={},s=new a;this.changing=!0,this.dataModel.actionManager.add(s),e.preventDefault(),$.each(this.$el.find(".address-edit .primary-street").find("select,input,textarea"),function(e,s){t=$(s),n[t.attr("name")]=i.serializeElement(t)}),this.disableAddressEditing(),this.selectedFeature.children.forEach(function(e){s.doSubAction(new d(e,n))}),this.processAltStreets(s),this.changing=!1,this.selectedFeature.calcAttributes(),this.render()},addAltStreetClicked:function(e){e.preventDefault(),this.addAltStreetFrom(),this.toggleAltStreetTable()},toggleAltStreetTable:function(){var e=this.$el.find(".add-alt-street-form");e.toggle(e.find("tr:not(.deleted)").length>1)},processAltStreets:function(e){var t,i,n=[],s={},r=this;t=$.map(this.$el.find(".alt-street.deleted"),function(e){return $(e).data("id")}),t.isEmpty()||t.forEach(function(t){this.selectedFeature.children.forEach(function(i){e.doSubAction(new h(i,{streetIDs:i.attributes.streetIDs.remove(t)}))},this)},this),$.each(this.$el.find(".new-alt-street"),function(t,o){n.push(s={}),$.each($(o).find("input"),function(e,t){i=$(t),s[i.attr("name")]=r.serializeElement(i)}),r.selectedFeature.children.forEach(function(t){e.doSubAction(new l(t,s))})})},deleteAltStreetClicked:function(e){var t=$(e.target).parents(".alt-street, .new-alt-street"),i=this;e.preventDefault(),t.fadeOut("fast",function(){t.hasClass("new-alt-street")?t.remove():t.addClass("deleted"),i.toggleAltStreetTable()})},addAltStreetFrom:function(){var e,t,i=this.$altStreetFormTemplate.clone().appendTo(this.$el.find(".add-alt-street-form"));e=this.$el.find(".add-alt-street-form .new-alt-street").length,t="alt-city-"+e,i.find("input[name=emptyCity]").attr("id",t),i.find("input[name=emptyCity] + label").attr("for",t),i.find("input[name=streetName]").typeahead({source:this.streetNames}),i.find("input[name=cityName]").typeahead({source:this.cityNames})},featuresChanged:function(e){var t=!1,i=this;this.changing||(t=e.some(function(e){return i.selectedFeature.children.some(function(t){return t.equals(e)})}),t&&(this.selectedFeature.calcAttributes(),this.render()))},increaseSegmentLevel:function(){this.changeSegmentLevelBy(1)},decreaseSegmentLevel:function(){this.changeSegmentLevelBy(-1)},changeSegmentLevelBy:function(e){if(this.enabled&&!this.selectedFeature.mixed.level&&this.selectedFeature.arePropertiesEditable()){var t=this.selectedFeature.attributes.level||0;t+=e,t>=p.prototype.MinLevel&&t<=p.prototype.MaxLevel&&(this.changed({level:t}),this.selectedFeature.calcAttributes(),this.render())}},toggleDirection:function(){if(this.enabled&&!this.selectedFeature.mixed.direction&&this.selectedFeature.arePropertiesEditable()){var e=(this.selectedFeature.attributes.direction+1)%4;0===e&&e++,this.directionChanged(e),this.selectedFeature.calcAttributes(),this.render()}},editSegmentShortcutClicked:function(){this.enabled&&this.selectedFeature.arePropertiesEditable()&&this.enableAddressEditing()},editHouseNumbersShortcutClicked:function(){if(this.enabled){var e=this.$el.find(".segment .edit-house-numbers");e.length&&!e.prop("disabled")&&this.editHouseNumbers()}},editHouseNumbersClicked:function(e){e&&e.preventDefault(),this.editHouseNumbers()},editHouseNumbers:function(){this.lastSelectedSegments=this.selectedFeature.children.clone();var e=this.selectedFeature.children.first(),t=e.getEntireStreet(this.dataModel);this.houseNumbersControl.setSegments(t,e.canEditHouseNumbers())},editRestrictionsClicked:function(e){e.preventDefault(),this.editRestrictions()},editRestrictionsShortcutClicked:function(){this.enabled&&this.shouldAllowRestrictionEditing()&&this.editRestrictions()},editRestrictions:function(){this.restrictionsView&&(this.restrictionsView.hide(),this.restrictionsView.destroy()),this.restrictionsView=new r,this.restrictionsView.on("done",this.onRestrictionsEdited,this),this.restrictionsView.on("cancel",this.onRestrictionsEditCancel,this);var e={},t=[],i=!this.selectedFeature.attributes.fwdDirection&&!this.selectedFeature.attributes.revDirection;(i||this.selectedFeature.attributes.fwdDirection||this.selectedFeature.mixed.fwdDirection)&&t.push("fwdRestrictions"),(i||this.selectedFeature.attributes.revDirection||this.selectedFeature.mixed.revDirection)&&t.push("revRestrictions"),t.forEach(function(t){var i={};this.selectedFeature.children.forEach(function(e){var n=e.attributes[t];this.reverseSegments[e.getID()]&&(n="fwdRestrictions"===t?e.attributes.revRestrictions:e.attributes.fwdRestrictions),(n||[]).forEach(function(t){i[t]?t=i[t]:(t=t.clone(),i[t]=t),t.models?t.models.push(e):t.models=[e]},this)},this),e[t]={restrictions:Object.values(i),name:t}},this),this.restrictionsView.setModel(e,this.selectedFeature.children.clone(),this.selectedFeature.arePropertiesEditable()),this.restrictionsView.setSelectedGroup(1===t.length?t.first():"fwdRestrictions"),this.restrictionsView.show()},onRestrictionsEdited:function(){var e=new a,t={},i=this.restrictionsView.model,n=this;this.changing=!0,this.dataModel.actionManager.add(e),Object.forEach(i,function(e,i){i.restrictions.forEach(function(i){i.models||(i.models=n.selectedFeature.children.clone()),i.models.forEach(function(n){t[n.getID()]||(t[n.getID()]={}),t[n.getID()][e]=t[n.getID()][e]||[],t[n.getID()][e].push(i.clone())}),delete i.models})}),this.selectedFeature.children.forEach(function(i){var s,r=t[i.getID()]||{fwdRestrictions:[],revRestrictions:[]};n.reverseSegments[i.getID()]&&(s=r.fwdRestrictions,r.fwdRestrictions=r.revRestrictions,r.revRestrictions=s),e.doSubAction(new h(i,{fwdRestrictions:r.fwdRestrictions||[],revRestrictions:r.revRestrictions||[]}))}),this.changing=!1,this.restrictionsView.hide(),this.restrictionsView.destroy(),this.restrictionsView=null,this.selectedFeature.calcAttributes(),this.render()},onRestrictionsEditCancel:function(){this.restrictionsView.hide(),this.restrictionsView.destroy(),this.restrictionsView=null},houseNumberEditingCancelled:function(){this.selectionManager.select(this.lastSelectedSegments)},onActionsChanged:function(){this.enabled&&!this.changing&&this.render()},shouldAllowRestrictionEditing:function(){return W.Config.restrictions.allowEditing},enable:function(){s.prototype.enable.apply(this,arguments),this.dataModel.actionManager.events.on({hasActions:this.onActionsChanged,noActions:this.onActionsChanged,scope:this})},disable:function(){s.prototype.disable.apply(this,arguments),this.dataModel.actionManager.events.un({hasActions:this.onActionsChanged,noActions:this.onActionsChanged,scope:this})}}),i.exports=n}}),this.require.define({"Waze/Presenter/HouseNumbersLightbox":function(e,t,i){(function(){var e,n,s;n=t("Waze/Presenter/MapLightbox"),s=t("Waze/ViewHelpers"),e=OL.Class(n,{loadingAnimation:null,toolbar:null,disabled:!1,template:"house-numbers-lightbox",events:{"click .add":"addClicked","click .undo":"undoClicked","click .redo":"redoClicked","click .save":"saveClicked","click .cancel":"cancelClicked","click .continue-editing":"onContinueEditingClicked","click .force-invalid":"onForceInvalidClicked"},initialize:function(){n.prototype.initialize.apply(this,arguments)},render:function(){var e;return n.prototype.render.apply(this,arguments),this.toolbar=this.$el.find(".toolbar"),this.loadingAnimation=this.$el.find(".loading-animation"),this.zoomMessage=this.$el.find(".zoom-message"),this.lastEditedUsername=this.$el.find(".last-edited"),(null!=(e=this.pm.selectedNumber)?e.model.updatedBy:void 0)?void 0:this.lastEditedUsername.hide()},registerEvents:function(){return this.model.actionManager.events.on({afteraction:this.render,afterundoaction:this.render,afterclearactions:this.render,scope:this}),W.accelerators.events.register("editHouseNumbers",this,this.editHouseNumbersShortcutClicked),$(document).on("keyup.house-numbers-lightbox",function(e){return function(t){return 27===t.which?e.confirmClose():void 0}}(this))},unregisterEvents:function(){return this.model.actionManager.events.un({afteraction:this.render,afterundoaction:this.render,afterclearactions:this.render,scope:this}),W.accelerators.events.unregister("editHouseNumbers",this,this.editHouseNumbersShortcutClicked),$(document).off("keyup.house-numbers-lightbox")},show:function(){return n.prototype.show.apply(this,arguments),this.render(),this.registerEvents()},undoClicked:function(){return this.model.actionManager.undo()},redoClicked:function(){return this.model.actionManager.redo()},saveClicked:function(){return this.onSave()},addClicked:function(){return this.onAdd()},cancelClicked:function(){return this.confirmClose()},onClickout:function(){return this.confirmClose()},editHouseNumbersShortcutClicked:function(){return this.onAdd()},confirmClose:function(){var e;return e=!0,this.model.actionManager.canSave()&&(e=window.confirm(I18n.t("edit.unsaved_changes"))),e?this.onCancel():void 0},close:function(){return this.unregisterEvents(),n.prototype.close.apply(this,arguments)},onSave:function(){},onAdd:function(){},onCancel:function(){},setLoading:function(e){return this.toolbar.toggle(!e),this.loadingAnimation.toggle(e)},showSuccessMessage:function(){var e;return e=this.$el.find(".success-message"),e.fadeIn().delay(3e3).fadeOut()},showErrorMessage:function(){var e;return e=this.$el.find(".error-message"),e.show()},showSaveErrorMessage:function(){var e;return e=this.$el.find(".force-message"),e.show()},setLastEditedUser:function(e){return e?(this.lastEditedUsername.show(),this.lastEditedUsername.find(".username").text(s.formatUserName(e))):this.lastEditedUsername.hide()},disable:function(){return this.disabled=!0,this.render()},enable:function(){return this.disabled=!1,this.render()},serialize:function(){return this},onForceInvalidClicked:function(){return this.pm.forceInvalid()},onContinueEditingClicked:function(){return this.pm.continueEditing()}}),i.exports=e}).call(this)}}),this.require.define({"Waze/Presenter/LayerSwitcher":function(e,t,i){(function(){var e,n,s;n=t("Waze/Presenter"),s=t("Waze/Util"),e=OL.Class(n,{template:"layer-switcher",elSelector:"#layer-switcher",className:"layer-switcher",dropdownOpen:!1,events:{"click .reload-button":"_onReloadClick","click .closed-filter":"_onClosedFilterClick","change input.toggle":"_onVisibilityChanged"},ui:{layerTogglers:".layer-togglers",reloadButton:".reload-button",dropdown:".dropdown",dropdownToggle:".dropdown > a",dropdownMenu:".dropdown-menu"},initialize:function(){var e,t,i,s;for(n.prototype.initialize.apply(this,arguments),this.map.events.on({addlayer:this._onAddLayer,changelayer:this.render,removelayer:this.render,changebaselayer:this.render,scope:this}),s=this.map.layers,t=0,i=s.length;i>t;t++)e=s[t],this._registerLayerAccelerator(e),{reloadData:this._onReloadClick,scope:this};W.model.actionManager.events.on({hasActions:this._reloadButtonToggleEvent,noActions:this._reloadButtonToggleEvent,scope:this}),W.accelerators.events.on({reloadData:this._onReloadClick,displayLayerSwitcher:function(){return this.ui.dropdownToggle.dropdown("toggle")},scope:this})},onRender:function(){return this.ui.layerTogglers.sortable({handle:".handle",items:".draggable",forcePlaceholderSize:!0}).bind("sortupdate",function(e){return function(t,i){var n;return n=e.ui.dropdownMenu.find(".toggler").index(i.item)-i.item.data("position")+1,e.map.raiseLayer(e.map.getLayer(i.item.find("input").data("id")),n)}}(this)),this.ui.dropdown.on({"show.bs.dropdown hide.bs.dropdown":function(e){return function(t){return e.dropdownOpen="show"===t.type,W.map.$map.toggleClass("layerSwitcherOpen",e.dropdownOpen)}}(this)}),this.ui.dropdownToggle.dropdownHover(),this.dropdownOpen&&this.ui.dropdown.addClass("open"),this._reloadButtonToggle(this._isReloadEnabled())},_isReloadEnabled:function(){return!W.model.actionManager.canUndo()},_reloadButtonToggleEvent:function(){return this._reloadButtonToggle(this._isReloadEnabled())},_reloadButtonToggle:function(e){return this.ui.reloadButton.toggleClass("reload-disabled",!e),this.ui.reloadButton.tooltip(e?"destroy":{title:I18n.t("layer_switcher.reload"),placement:"auto left"})},_registerLayerAccelerator:function(e){return e.accelerator?W.accelerators.events.register(e.accelerator,this,function(){return e.setVisibility(!e.visibility)}):void 0},_onAddLayer:function(e){return this._registerLayerAccelerator(e.layer),this.render()},serialize:function(){return{layers:this.map.layers,reloadEnabled:W.model.actionManager.canUndo}},_changeLayerVisibility:function(){},_onVisibilityChanged:function(e){var t,i;return t=this.map.getLayer(e.target.dataset.id),i=e.target.checked,t.setVisibility(i),W.track("toggle_layer_visibilty",{name:t.uniqueName,visibility:i})},_onClosedFilterClick:function(e){var t,i,n,r,o,a,l,h,u,c;for(e.stopPropagation,r=$(e.target).parent().prev("input").data("id"),i=this.map.getLayer(r),o=i.showHidden,l=o=!o,i.showHidden=o,c=i.repo,h=0,u=c.length;u>h;h++)a=c[h],a.setFilterBit(1,o),l&&a.clear();return l&&W.controller.updateModel(!0),i.$div.toggleClass("show-closed",o),t=I18n.t(o?"layer_switcher.hide_closed":"layer_switcher.show_closed"),$(e.target).text(t),$(e.target).data("layer-shown",o),n=s.localStorage.get("layerFilters"),null==n&&(n={}),n[i.uniqueName]=o,s.localStorage.set("layerFilters",n),!1},_onReloadClick:function(){var e;return this._isReloadEnabled()?(e=this.map.getLayersBy("uniqueName","roads")[0],e.redraw({force:!0}),e.removeBackBuffer(),W.controller.reload()):void 0}}),i.exports=e}).call(this)}}),this.require.define({"Waze/Presenter/LiveUsers":function(e,t,i){(function(){var e,n,s;s=t("Waze/Presenter"),e=t("Waze/Marker/LiveUser"),n=OpenLayers.Class(s,{initialize:function(e){return s.prototype.initialize.apply(this,arguments),this.map=e.map,this.model=e.model,this.model.users.on("add",this._addUser,this),this.model.users.on("remove",this._onRemoveUser,this),this.layer=new OL.Layer.Markers("Live Users",{shortcutKey:"S+v",accelerator:"toggleLiveUsers",uniqueName:"live_users",className:"live-users"}),this.model.on("change:showLayer",function(e){return function(){return e.model.get("showLayer")?e.map.addLayer(e.layer):void 0}}(this)),this._markersByUserId={},this},_addUser:function(t){var i;return i=new e(t,this.map,this.layer),this._markersByUserId[t.get("id")]=i,this.layer.addMarker(i),i.render()},_onRemoveUser:function(e){var t,i;return i=e.item,t=i.get("id"),this._removeMarker(t)},_removeMarker:function(e){var t;return t=this._markersByUserId[e],t.destroy(),this.layer.removeMarker(t),delete this._markersByUserId[e]},centerUser:function(e){var t;return null!=(t=this._markersByUserId[e])?t.center():void 0}}),i.exports=n}).call(this)}}),this.require.define({"Waze/Presenter/LocationMessage":function(e,t,i){(function(){var e,n;n=t("Waze/Presenter"),e=OL.Class(n,{template:"location-message",events:{"click a":"onLocationLinkClicked","click .close":"onCloseClicked"},initialize:function(){return n.prototype.initialize.apply(this,arguments),this.model.events.register("change:locations",this,this.onLocationsChange),this.onLocationsChange()},onLocationsChange:function(){var e,t;if(e=this.model.locations,t=e.length,this.mixed=t>1,this.mixed)this.otherEnv=e.remove(W.location.code).first(),e.contains(W.location.code)||(this.mixed=!1);else{if(1!==t)return void this.hide();this.otherEnv=e.first()}return this.mixed||this.otherEnv===W.location.code?this.hide():(this.render(),this.show())},serialize:function(){return{model:this.model,view:this}},onLocationLinkClicked:function(e){var t;return e.preventDefault(),t=$(e.target).data("env"),W.location.change(t),W.map.mapState.updateMapLocation(),window.location.reload(!0)},hide:function(){return n.prototype.hide.apply(this,arguments)},onCloseClicked:function(){return this.hide(),this.model.events.unregister("change:locations",this,this.onLocationsChange)}}),i.exports=e}).call(this)}}),this.require.define({"Waze/Presenter/LocationSwitcher":function(e,t,i){(function(){var e,n;n=t("Waze/Presenter"),e=OL.Class(n,{template:"location-switcher",$el:$("#env-select"),events:{"click .env-link":"onLocationChanged"},onLocationChanged:function(e){var t;return e.preventDefault(),t=$(e.target).data("env"),this.changeLocation(t)},changeLocation:function(e){return W.location.change(e),window.location.reload(!0)}}),i.exports=e}).call(this)}}),this.require.define({"Waze/Presenter/Login":function(e,t,i){(function(){var e,n,s,r,o,a;s=t("Waze/Presenter"),a=t("Waze/Presenter/WelcomePopup"),n=t("Waze/Presenter/LoginStatus"),o=t("Waze/Presenter/UserInfo"),r=t("Waze/Presenter/SandboxMessage"),e=OL.Class(s,{initialize:function(){s.prototype.initialize.apply(this,arguments),this.model.on("change:editing",this._onEditingInChange,this),this.model.on("change:sandbox",this._onSandboxChange,this),this.model.on("change:user",this._onUserChange,this),W.loginManager.events.register("beforeloginchanged",null,function(){return!W.controller.isSandBoxMode()&&W.model.actionManager.canUndo()?confirm(I18n.t("edit.unsaved_changes")):void 0}),this.loginStatusPresenter=new n({model:this.model}),this.userInfoPresenter=new o({model:this.model}),this._toggleEditing()},_onEditingInChange:function(){return this._toggleEditing()},_onUserChange:function(){return W.loginManager.isLoggedIn()?this.userInfoPresenter.render():void 0},_toggleEditing:function(){var e,t;return e=this.model.get("editing"),e?(null!=(t=this.welcomePopup)?t.isShown():void 0)?(this.welcomePopup.close(),this.welcomePopup.destroy()):void 0:this._showWelcomePopup()},_showWelcomePopup:function(){var e;return null!=(e=this.welcomePopup)&&e.destroy(),this.welcomePopup=new a,W.map.showPopup(this.welcomePopup)},_onSandboxChange:function(){var e;return e=this.model.get("sandbox"),e&&this.userInfoPresenter.render(),this.sandboxMessagePresenter||(null==this.sandboxMessagePresenter&&(this.sandboxMessagePresenter=new r({$el:$("<div/>").appendTo(W.map.footerMessages.div)})),this.sandboxMessagePresenter.render()),this.model.get("sandbox")?this.sandboxMessagePresenter.show():this.sandboxMessagePresenter.hide()}}),i.exports=e}).call(this)}}),this.require.define({"Waze/Presenter/LoginForm":function(e,t,i){(function(){var e,n;n=t("Waze/Presenter"),e=OL.Class(n,{ErrorMessages:{406:I18n.t("login.form.error")},template:"login/login-form",events:{"submit form":"_onSubmit"},ui:{form:"form",loading:".loading",errorMessage:".error-message",username:".username"},render:function(){var e;return e=n.prototype.render.apply(this,arguments),this.reset(),e},reset:function(){return this.ui.errorMessage.hide(),this.ui.loading.hide(),this.ui.username.focus()},_onSubmit:function(){var e,t;return this.ui.loading.show(),this.ui.errorMessage.hide(),t=this.ui.username.val(),e=this.ui.form.find(".password").val(),W.loginManager.login(t,e).fail(function(e){return function(t){return e.ui.errorMessage.text(e.ErrorMessages[t.status]||I18n.t("login.form.server_error")).show()}}(this)).always(function(e){return function(){return e.ui.loading.hide()}}(this)),!1}}),i.exports=e}).call(this)}}),this.require.define({"Waze/Presenter/LoginStatus":function(e,t,i){(function(){var e,n;n=t("Waze/Presenter"),e=OL.Class(n,{template:"login/login-status",$el:$("#login-status"),events:{"click .logout-link":"_onLogoutClicked"},initialize:function(){n.prototype.initialize.apply(this,arguments),this.model.on("change:loggedIn",this.render,this)},_onLogoutClicked:function(){return W.loginManager.logout()},serialize:function(){return{isLoggedIn:this.model.get("loggedIn"),user:this.model.get("user")}}}),i.exports=e}).call(this)}}),this.require.define({"Waze/Presenter/Map":function(e,t,i){(function(){var e,n;n=t("Waze/Presenter"),e=OL.Class(n,{template:"map",$el:$("#editor-container"),initialize:function(){n.prototype.initialize.apply(this,arguments),this._init()},_init:function(){}}),i.exports=e}).call(this)}}),this.require.define({"Waze/Presenter/MapLightbox":function(e,t,i){(function(){var e,n;n=t("Waze/Presenter"),e=OL.Class(n,{olEvents:null,shown:!1,initialize:function(){this.$el=$("#map-lightbox .content"),n.prototype.initialize.apply(this,arguments),this.olEvents=new OL.Events(this),$("#map-lightbox .overlay").on("click",function(e){return function(){return e.onClickout()}}(this))},onClose:function(e){return e&&e.preventDefault(),this.close()},onClickout:function(){return this.close()},close:function(){return this.shown=!1,$("#map-lightbox").hide(),this.olEvents.triggerEvent("closed")},render:function(){return n.prototype.render.apply(this,arguments),$("#map-lightbox").show(),this.shown=!0}}),i.exports=e}).call(this)}}),this.require.define({"Waze/Presenter/OpeningHour/Add":function(e,t,i){(function(){var e,n;e=t("Waze/Model/OpeningHour").OpeningHour,n=Marionette.ItemView.extend({template:JST["templates/opening_hours/add"],ui:{form:"form",timeSelectors:".time-selector",fromTime:"input[name=fromTime]",toTime:"input[name=toTime]",dayCheckboxes:"input[name=days]",validationErrors:".validation-errors"},events:{submit:"onSubmit","click .select-all":"selectAllDays","click .select-none":"deselectAllDays","change input[name=allDay]":"onTimeToggled"},HOUR_FORMAT:"HH:mm",selectAllDays:function(e){return e.preventDefault(),this.toggleDayCheckboxes(!0)},deselectAllDays:function(e){return e.preventDefault(),this.toggleDayCheckboxes(!1)},onTimeToggled:function(){return this.toggleTimeSelectors(!this.isAllDaySelected())},isAllDaySelected:function(){return"on"===this.$("input[name=allDay]:checked").val()},toggleTimeSelectors:function(e){return this.ui.timeSelectors.prop({disabled:!e,required:e})},toggleDayCheckboxes:function(e){return this.ui.dayCheckboxes.prop("checked",e)},onRender:function(){return this.ui.timeSelectors.timepicker({showMeridian:!1})},onClose:function(){return this.$el.remove(),this.ui.timeSelectors.timepicker("remove")},serializeData:function(){var t;return t=e.prototype.defaults(),{dayCallback:this.isDayCheckedByDefault,defaultFromTime:t.fromHour,defaultToTime:t.toHour}},isDayCheckedByDefault:function(t){return e.prototype.defaultDays.contains(t)},onSubmit:function(t){var i,n,s,r;return t.preventDefault(),n=this.ui.fromTime.val(),r=this.ui.toTime.val(),i=this.readDays(),this._clearValidationErrors(),this._vaildate(n,r,i)?(s=new e({days:i,fromHour:n,toHour:r}),this.isAllDaySelected()&&s.setAllDay(),this.collection.add(s),this.close()):void 0},_vaildate:function(e,t,i){var n,s;return s=[],0===i.length&&s.push(I18n.t("edit.landmark.opening_hours.errors.days")),e=Date.parseExact(e,this.HOUR_FORMAT),t=Date.parseExact(t,this.HOUR_FORMAT),this.isAllDaySelected()||(null===e&&s.push(I18n.t("edit.landmark.opening_hours.errors.fromHour")),null===t&&s.push(I18n.t("edit.landmark.opening_hours.errors.toHour")),e>=t&&!this._isMidnight(t)&&s.push(I18n.t("edit.landmark.opening_hours.errors.range"))),s.length>0&&(n=s.map(function(e){return $("<div/>").text(e)}),this.ui.validationErrors.append(n)),0===s.length},_isMidnight:function(e){return 0===e.getHours()&&0===e.getMinutes()},_clearValidationErrors:function(){return this.ui.validationErrors.empty()},readDays:function(){return this.ui.form.find("input[name=days]:checked").toArray().map(function(e){return parseInt($(e).val(),10)})}}),i.exports=n}).call(this)}}),this.require.define({"Waze/Presenter/OpeningHour/Item":function(e,t,i){(function(){var e;e=Marionette.ItemView.extend({tagName:"li",template:JST["templates/opening_hours/item"],events:{"click .delete":"onDelete"},serializeData:function(){return{model:this.model,isEditable:this.options.editable}},onDelete:function(){return this.model.collection.remove(this.model)}}),i.exports=e}).call(this)}}),this.require.define({"Waze/Presenter/OpeningHour/Layout":function(e,t,i){(function(){var e,n,s;n=t("Waze/Presenter/OpeningHour/Item"),e=t("Waze/Presenter/OpeningHour/Add"),s=Marionette.CompositeView.extend({template:JST["templates/opening_hours/layout"],itemView:n,itemViewContainer:".list",events:{"click .add":"onAddClicked"},itemViewOptions:function(){return{editable:this.options.editable}
},onAddClicked:function(e){return e.preventDefault(),this.showAddDialog()},showAddDialog:function(){var t;return t=new e({collection:this.collection}),W.appPresenter.dialogRegion.show(t)},serializeData:function(){return{isEditable:this.options.editable}}}),i.exports=s}).call(this)}}),this.require.define({"Waze/Presenter/Permalink":function(e,t,i){(function(){var e,n,s,r={}.hasOwnProperty;s=t("Waze/Service/PseudoClipboard"),n=t("Waze/Presenter"),e=OL.Class(n,{template:"permalink",elSelector:".WazeControlPermalink",mapState:null,marker:null,clipboard:null,ui:{permalink:".icon-link"},events:{"click a":"_onPermalinkClick","mouseover a":"_onPermalinkMouseOver"},initialize:function(){return n.prototype.initialize.apply(this,arguments),this.clipboard=new s,this.clipboard.events.on({copied:this._onClipboardCopied,scope:this}),this.mapState.on("statechanged",this._onMapStateChanged,this),!0},_onPermalinkClick:function(e){return e.stopPropagation()},_onPermalinkMouseOver:function(e){return this.clipboard.set($(e.target).attr("href"))},_onClipboardCopied:function(){return this.ui.permalink.next(".tooltip").find(".tooltip-inner").text(I18n.t("footer.copied"))},_onMapStateChanged:function(e){var t,i,n,s,r,o;return t=e.loc,r=e.selection,n=e.marker,o=t.zoom,s=t.clone(),s.transform(W.map.getProjectionObject(),W.map.displayProjection),s.zoom=o,i=W.map.mapState.getLayerVisibilityBitmask(),this._setPermalinkLink(s,i,r,n),this._setLivemapLink(s)},_setPermalinkLink:function(e,t,i,n){var s,o,a;s={env:W.location.code,lon:e.lon.toFixed(W.Config.units.lonLatPrecision),lat:e.lat.toFixed(W.Config.units.lonLatPrecision),layers:t,zoom:e.zoom};for(o in i)r.call(i,o)&&(a=i[o],s[o]=a);return n&&(s.marker=!0),this.ui.permalink.attr("href",window.location.origin+window.location.pathname+"?"+OL.Util.getParameterString(s))},_setLivemapLink:function(t){var i;return i=t.zoom+e.LIVEMAP_ZOOM_OFFSET,i=Math.min(e.LIVEMAP_MAX_ZOOM,i),this.ui.livemapLink.attr("href","/livemap?"+$.param({lon:t.lon.toFixed(W.Config.units.lonLatPrecision),lat:t.lat.toFixed(W.Config.units.lonLatPrecision),zoom:i}))},serialize:function(){var e;return e=$.browser.mac?"&#8984;+C":"Ctrl+C",{copyShortcut:e}},onRender:function(){var e,t;return e=this.$el,null==(t=this.ui).livemapLink&&(t.livemapLink=$("#livemap-link")),this.ui.permalink.tooltip({placement:"top"}),this.clipboard.setEl(this.ui.permalink),!0}}),_.extend(e,{LIVEMAP_ZOOM_OFFSET:12,LIVEMAP_MAX_ZOOM:17}),i.exports=e}).call(this)}}),this.require.define({"Waze/Presenter/PlaceUpdate/ChangedField":function(e,t,i){(function(){var e,n,s,r;r=t("Waze/ViewHelpers"),s=t("Waze/VectorStyles/Venues"),n=t("Waze/DivIcon"),e=Marionette.ItemView.extend({tagName:"li",template:JST["templates/place_updates/changed_field"],events:{"mouseover .location-button.current":"_onCurrentOver","mouseover .location-button.suggested":"_onSuggestedOver","mouseout .location-button.current":"_onLocationOut","mouseout .location-button.suggested":"_onLocationOut"},_layersAdded:!1,_suggestedLocationDrawn:!1,_currentLocationDrawn:!1,_markerLayer:null,_vectorLayer:null,_createTooltip:function(e,t,i){var s;return this._ensureLayers(),s=new OL.Marker(e,new n("location-tooltip "+i)),s.icon.$div.text(t),this._markerLayer.addMarker(s)},_onCurrentOver:function(){var e;if(!this._currentLocationDrawn)return e=this._getValue(this.model.get("venue")).getBounds().getCenterLonLat(),this._createTooltip(e,I18n.t("venues.update_requests.panel.change.current_location"),""),this._currentLocationDrawn=!0},_onSuggestedOver:function(){var e,t,i;if(!this._suggestedLocationDrawn)return this._ensureLayers(),t=this._getValue(this.model.get("suggestedVenue")),e=new OL.Feature.Vector(t),this._vectorLayer.addFeatures(e),i=t.getBounds().getCenterLonLat(),this._createTooltip(i,I18n.t("venues.update_requests.panel.change.suggested_location"),"suggested"),this._suggestedLocationDrawn=!0},_onLocationOut:function(){return this._ensureLayers(),this._vectorLayer.removeAllFeatures(),this._markerLayer.clearMarkers(),this._currentLocationDrawn=!1,this._suggestedLocationDrawn=!1},_ensureLayers:function(){return this._layersAdded?void 0:(this._vectorLayer=new OL.Layer.Vector("",{displayInLayerSwitcher:!1,styleMap:s}),this._markerLayer=new OL.Layer.Markers("",{displayInLayerSwitcher:!1}),W.map.addLayers([this._vectorLayer,this._markerLayer]),$(this._vectorLayer.div).addClass("suggested-geometry-layer"),this._layersAdded=!0)},_destroyLayers:function(){var e,t;return null!=(e=this._vectorLayer)&&e.destroy(),null!=(t=this._markerLayer)&&t.destroy(),this._layersAdded=!1},onClose:function(){return this._destroyLayers()},_getValue:function(e){var t;return t=this.model.get("fieldName"),this.valueGetters[t]?this.valueGetters[t](e):e.attributes[t]},serializeData:function(){return{currentValue:this._getValue(this.model.get("venue")),suggestedValue:this._getValue(this.model.get("suggestedVenue")),fieldName:this.model.get("fieldName"),isGeometry:this.model.isGeometry(),model:this.model}},templateHelpers:{getRemovedImages:function(){var e,t,i,n;return n=this.model.get("venue"),e=_(n.attributes.images),t=_(this.model.get("suggestedVenue").attributes.images),i=_.difference(e.pluck("id"),t.pluck("id")),i.map(function(t){return e.find(function(e){return e.get("id")===t})})}},valueGetters:{categories:function(e){return r.formatVenueCategories(e.attributes.categories)},streetID:function(e){return r.formatPlaceAddress(e)},entryExitPoints:function(e){return e.getNavigationPoint().point},services:function(e){return r.formatVenueServices(e.attributes.services)},openingHours:function(e){var t;return t=e.getOpeningHours().map(r.formatOpeningHour),t.join(", ")}}}),i.exports=e}).call(this)}}),this.require.define({"Waze/Presenter/PlaceUpdate/ChangedFields":function(e,t,i){(function(){var e,n;n=t("Waze/Presenter/PlaceUpdate/ChangedField"),e=Marionette.CollectionView.extend({itemView:n}),i.exports=e}).call(this)}}),this.require.define({"Waze/Presenter/PlaceUpdate/Flag":function(e,t,i){(function(){var e,n;n=t("Waze/Presenter/PlaceUpdate/Item"),e=n.extend({template:JST["templates/place_updates/flag"],APPROVE_ACTION_NAMES:{default:I18n.t("venues.update_requests.panel.action.solved"),DUPLICATE:I18n.t("venues.update_requests.panel.action.merge"),CLOSED:I18n.t("venues.update_requests.panel.action.delete")},APPROVE_ACTION_INTENT:{CLOSED:"danger"},serializeData:function(){var e,t;return t=this.model.isImage(),e=t?this.model.getImage():null,{model:this.model,venue:this.options.venue,showImage:t,image:e,showAddingUser:t,showComment:this.model.get("type")===this.model.TYPE.WRONG_DETAILS,showDuplicateVenue:this.model.get("type")===this.model.TYPE.DUPLICATE}},templateHelpers:_({}).extend(n.prototype.templateHelpers,{getTitle:function(){return I18n.t("venues.update_requests.panel.flag_title."+this.model.get("subject"))},getApproveActionName:function(){var t,i;return this.model.isVenue()?(i=e.prototype.APPROVE_ACTION_NAMES,t=i[this.model.get("type")],t||i.default):I18n.t("venues.update_requests.panel.action.delete_picture")},getApproveActionIntent:function(){var t;return this.model.isImage()?"danger":(t=e.prototype.APPROVE_ACTION_INTENT,t[this.model.get("type")]||"default")},getRejectActionName:function(){return I18n.t("venues.update_requests.panel.action.reject_flag")}})}),i.exports=e}).call(this)}}),this.require.define({"Waze/Presenter/PlaceUpdate/ImageDialog":function(e,t,i){(function(){var e,n;e=t("Waze/Model/Object/Image"),n=Marionette.ItemView.extend({template:JST["templates/place_updates/image_dialog"],_imageId:null,setImageId:function(e){return this._imageId=e},serializeData:function(){return{imageUrl:e.prototype.getUrlById(e.SIZE.ORIGINAL,this._imageId)}}}),i.exports=n}).call(this)}}),this.require.define({"Waze/Presenter/PlaceUpdate/Item":function(e,t,i){(function(){var e,n,s,r,o,a;e=t("Waze/Presenter/PlaceUpdate/ChangedFields"),r=t("Waze/Action/UpdatePlaceUpdate"),s=t("Waze/Model/PlaceUpdate"),n=t("Waze/Presenter/PlaceUpdate/ImageDialog"),a=t("Waze/ViewHelpers"),o=Marionette.ItemView.extend({APPROVE_ACTION_NAMES:{default:I18n.t("venues.update_requests.panel.action.approve"),ADD_VENUE:I18n.t("venues.update_requests.panel.action.add_to_map")},HIDE_PLACE_DETAILS:{ADD_VENUE:!0},template:JST["templates/place_updates/item"],events:{"change [name=approved]":"_onApproveChanged","click .image-preview":"_onImagePreviewClicked"},ui:{approvedDropdown:"[name=approved]"},fieldChangeView:null,imageDialogView:null,initialize:function(){return this.listenTo(this.model,"change:approved",this._onModelChanged)},serializeData:function(){return{model:this.model,venue:this.options.venue,hidePlaceDetails:!!this.HIDE_PLACE_DETAILS[this.model.get("updateType")]}},_onModelChanged:function(){return this.render()},_onApproveChanged:function(){var e,t;return t=this.ui.approvedDropdown.filter(":checked").booleanVal(),e=new r(this.options.venue,this.model,t),this.options.venue.model.actionManager.add(e)},_onImagePreviewClicked:function(e){var t;return t=$(e.target).data("image-id"),null==this.imageDialogView&&(this.imageDialogView=new n),this.imageDialogView.setImageId(t),W.appPresenter.dialogRegion.show(this.imageDialogView),e.preventDefault()},onRender:function(){var t;return"UPDATE_VENUE"===this.model.get("updateType")?(null!=(t=this.fieldChangeView)&&t.close(),this.fieldChangeView=new e({collection:new Backbone.Collection(this.model.get("changedFields"),{sort:!1}),el:this.$(".changed-fields")}),this.fieldChangeView.render()):void 0},onClose:function(){var e,t;return null!=(e=this.fieldChangeView)&&e.close(),null!=(t=this.imageDialogView)?t.close():void 0},templateHelpers:{getTitle:function(){return I18n.t("venues.update_requests.panel.title."+this.model.get("updateType"))},getApproveActionName:function(){var e,t;return t=this.model.get("updateType"),e=o.prototype.APPROVE_ACTION_NAMES,e[t]||e.default},getChangesTemplate:function(){var e;return e=this.model.get("updateType").toLowerCase(),"templates/place_updates/"+e},getApproveActionIntent:function(){return"default"},getRejectActionName:function(){return I18n.t("venues.update_requests.panel.action.reject")},getMinEditLevelMessage:function(){var e;return e=a.formatRank(s.MIN_EDIT_RANK),I18n.t("venues.update_requests.panel.uneditable",{level:e})},getNewPlaceImages:function(){return this.model.get("place").getImagesByUserId(this.model.get("createdBy"))}}}),i.exports=o}).call(this)}}),this.require.define({"Waze/Presenter/PlaceUpdate/Layer":function(e,t,i){(function(){var e,n,s;s=t("Waze/Presenter"),n=t("Waze/Presenter/PlaceUpdate/Layout"),e=OL.Class(s,{events:{"click .place-update":"_onMarkerClicked"},_onMarkerClicked:function(e){var t;return t=$(e.target).data("model"),W.map.panelRegion.show(new n({model:t}))}}),i.exports=e}).call(this)}}),this.require.define({"Waze/Presenter/PlaceUpdate/Layout":function(e,t,i){(function(){var e,n,s,r;r=t("Waze/Presenter/PlaceUpdate/Item"),n=t("Waze/Presenter/PlaceUpdate/Flag"),e=t("Waze/Model/EventType"),s=Marionette.Layout.extend({template:JST["templates/place_updates/layout"],regions:{placeUpdate:".place-update"},events:{"click .navigation-button":"_onNavigationClicked"},className:"place-update-edit",currentIndex:0,dataModel:null,initialize:function(){return this.dataModel=this.model.model,this._setUpdateRequests(),this.dataModel.venues.events.register(e.CHANGED,this,this._onVenuesChanged),this.dataModel.venues.events.register(e.REMOVED,this,this._onVenuesDeleted)},_setUpdateRequests:function(){return this.updateRequests=_(this.model.attributes.venueUpdateRequests).sortBy(function(e){return e.get("dateAdded")})},_onVenuesChanged:function(e){var t;return t=e.some(function(e){return function(t){return t.getID()===e.model.getID()&&t.isDeleted()}}(this)),t?this.close():void 0},_onVenuesDeleted:function(e){var t;return t=e.some(function(e){return function(t){return t.getID()===e.model.getID()}}(this)),t?this.close():void 0},onClose:function(){return this.dataModel.venues.events.unregister(e.CHANGED,this,this._onVenuesChanged),this.dataModel.venues.events.unregister(e.REMOVED,this,this._onVenuesDeleted)},serializeData:function(){return{showNextButton:this._hasMoreUpdates()}},onRender:function(){return this._showCurrentUpdateView()},_showCurrentUpdateView:function(){var e,t,i;return i=this.updateRequests[this.currentIndex],e=r,"flag"===i.get("updateType")&&(e=n),t=new e({model:i,venue:this.model}),this.placeUpdate.show(t)},_hasMoreUpdates:function(){return this.currentIndex<this.updateRequests.length-1},_onNavigationClicked:function(){return this._hasMoreUpdates()?(this.currentIndex++,this.render()):this.close()}}),i.exports=s}).call(this)}}),this.require.define({"Waze/Presenter/Popup":function(e,t,i){var n,s=t("Waze/Presenter");n=OpenLayers.Class(s,{olEvents:null,events:{"click .modal-close":"onClose"},shown:!1,initialize:function(){s.prototype.initialize.apply(this,arguments),this.olEvents=new OpenLayers.Events(this)},onClose:function(e){e&&e.preventDefault(),this.close(),this.destroy()},close:function(){this.shown=!1,this.olEvents.triggerEvent("closed")},render:function(e){var t=this;return s.prototype.render.apply(this,arguments).done(function(){e.empty(),e.append(t.$el),t.shown=!0})},isShown:function(){return this.shown}}),i.exports=n}}),this.require.define({"Waze/Presenter/Restriction/Edit":function(e,t,i){(function(){var e,n,s;e=t("Waze/Presenter"),n=t("Waze/Model/Object/Restriction"),s=OL.Class(e,{template:"restriction/edit",events:{"click .cancel":"onCancelClicked","submit form":"onSubmit","change input[name=allDay]":"onTimeToggled","change input[name=permanent]":"onDateToggled","click .select-all":"onSelectAllClicked","click .select-none":"onSelectNoneClicked","click .toggle-vehicles":"onToggleVehiclesClicked"},model:null,dateRangePicker:null,dateFormat:"dd/MM/yyyy",initialize:function(){e.prototype.initialize.apply(this,arguments)},render:function(){return this.cleanupDateRangePicker(),this.cleanupTimePicker(),e.prototype.render.apply(this,arguments),this.$el.find(".time-selector").timepicker({showMeridian:!1}).on("changeTime.timepicker",$.proxy(this.toggleTwoDayMessage,this)),this.fromTime=this.$el.find(".from-time").data("timepicker"),this.toTime=this.$el.find(".to-time").data("timepicker"),this.$wraparoundMessage=this.$el.find(".wraparound"),this.$el.find(".bootstrap-timepicker").on("click",function(e){return function(){return e.$el.find("input[name=allDay][value=off]").prop("checked",!0),e.toggleTimeSelectors(!0)}}(this)),this.dateRangePicker=this.$el.find(".daterange-selector").data("from",this.model.getFromDate()||this.getDefaultFromDate()).data("to",this.model.getToDate()||this.getDefaultToDate()),this.dateRangePicker.daterangepicker({format:this.dateFormat,startDate:this.model.getFromDate()||this.getDefaultFromDate(),endDate:this.model.getToDate()||this.getDefaultToDate()},function(e){return function(t,i){return e.dateRangePicker.data("from",t),e.dateRangePicker.data("to",i),e.dateRangePicker.text(e.getDateRangeText(t,i))}}(this)),this.$el.find(".collapse-toggle").collapse()},toggleTwoDayMessage:function(){var e;return e=1===this.model.compareHours(this.fromTime,this.toTime)&&!this.isAllDaySelected(),this.$wraparoundMessage.toggleClass("hidden",!e)},cleanupDateRangePicker:function(){var e,t;return t=this.$el.find(".daterange-selector"),e=t.data("daterangepicker"),e?(e.element.off(),e.container.remove(),t.removeData("daterangepicker")):void 0},cleanupTimePicker:function(){return this.$el.find(".time-selector").timepicker("remove")},getDateRangeText:function(e,t){return""+e.toString(this.dateFormat)+" - "+t.toString(this.dateFormat)},onSubmit:function(e){var t;return e.preventDefault(),this.readRestriction(),t=this.validate(),t?this.fire("done",{model:this.model,group:this.group}):void 0},validate:function(){var e;return this.$el.find(".validation-error").hide(),e=!0,0===this.model.days&&(this.$el.find(".days .validation-error").show(),e=!1),0===this.model.vehicleTypes&&(this.$el.find(".vehicle-types .validation-error").show(),e=!1),this.model.isAllDay()||this.model.fromTime!==this.model.toTime||(this.$el.find(".hours .validation-error").show(),e=!1),e||this.$el.find(".controls .validation-error").show(),e},onCancelClicked:function(e){return e.preventDefault(),this.fire("cancel",{model:this.model})},onTimeToggled:function(){this.toggleTimeSelectors(!this.isAllDaySelected()),this.toggleTwoDayMessage()},isAllDaySelected:function(){return"on"===this.$el.find("input[name=allDay]:checked").val()},onDateToggled:function(){this.toggleDateSelectors(!this.isEveryWeekSelected())},isEveryWeekSelected:function(){return"on"===this.$el.find("input[name=permanent]:checked").val()},toggleTimeSelectors:function(e){return this.$el.find(".time-selector").prop({disabled:!e,required:e})},toggleDateSelectors:function(e){return this.$el.find(".daterange-selector").prop({disabled:!e,required:e})},readRestriction:function(){var e,t,i,s,r,o,a,l,h,u,c,d,p,m;return e=this.$el.find("form"),r=function(){var t,i,n,s;for(n=e.find("input[name=days]:checked"),s=[],t=0,i=n.length;i>t;t++)h=n[t],s.push(parseInt($(h).val(),10));return s}(),l=e.find("input[name=fromTime]").val(),d=e.find("input[name=toTime]").val(),u=this.isEveryWeekSelected(),o=e.find("textarea.description").val(),t=this.isAllDaySelected(),a=this.dateRangePicker.data("from"),c=this.dateRangePicker.data("to"),p=e.find(".vehicle_type"),s=e.find(".vehicle_type:checked"),i=p.length===s.length,m=i?n.prototype.allVehicleTypes:s.toArray().reduce(function(e,t){var i;return i=$(t),i.is(":checked")&&(e+=Math.pow(2,i.val())),e},0),this.model.vehicleTypes=m,this.model.description=o,this.model.setDays(r),t?this.model.setAllDay():this.model.setTime(l,d),u?this.model.setPermanent():this.model.setDates(a,c)},getDefaultFromDate:function(){return Date.today()},getDefaultToDate:function(){return Date.today().next().month()},getDefaultFromTime:function(){return"08:00"},getDefaultToTime:function(){return"17:00"},onSelectAllClicked:function(e){return this.toggleCheckBoxes($(e.target),!0),!1},onSelectNoneClicked:function(e){return this.toggleCheckBoxes($(e.target),!1),!1},toggleCheckBoxes:function(e,t){return e.parents(".section").find("input[type=checkbox]").prop("checked",t)},onToggleVehiclesClicked:function(){return this.$el.find(".vehicle-types").removeClass("all-included"),!1},serialize:function(){return{model:this.model,view:this,descriptionMaxLength:n.prototype.DescriptionMaxLength}},destroy:function(){return this.cleanupDateRangePicker(),this.cleanupTimePicker(),e.prototype.destroy.apply(this,arguments)}}),i.exports=s}).call(this)}}),this.require.define({"Waze/Presenter/Restriction/List":function(e,t,i){(function(){var e,n,s={}.hasOwnProperty;e=t("Waze/Presenter"),n=OL.Class(e,{dateFormat:"dd/MM/yyyy",template:"restriction/list",events:{"click .edit":"onEditClicked","click .remove":"onRemoveClicked","click .add-to-all":"onAddToAllClicked","click .copy":"onCopyAllClicked","show.bs.tab a[data-toggle=tab]":"onTabShown"},model:null,features:null,editable:!1,selectedGroup:null,shouldShowTabs:!1,lastTab:null,initialize:function(){e.prototype.initialize.apply(this,arguments)},setModel:function(e,t,i){var n,s,r,o;if(this.model=e,this.features=t,this.editable=i,this.multipleFeatures=this.features.length>1,s=Object.values(this.model),this.numGroups=s.length,!this.multipleFeatures)for(r=0,o=s.length;o>r;r++)n=s[r],n.title=this.getGroupTitle(n);return this.shouldShowTabs="default"!==s.first().name},onTabShown:function(e){return this.selectedGroup=$(e.target).data("group"),this.lastTab=$(e.target).attr("href")},onEditClicked:function(e){var t,i,n,s,r;return r=this.getRestrictionFromEvent(e),s=r[0],i=r[1],n=r[2],t=r[3],this.fire("editClicked",{restriction:s,group:t})},onRemoveClicked:function(e){var t,i,n,s,r;return r=this.getRestrictionFromEvent(e),s=r[0],i=r[1],n=r[2],t=r[3],t.restrictions.splice(i,1),this.render()},onAddToAllClicked:function(e){var t;return t=this.getRestrictionFromEvent(e)[0],t.models=this.features.clone(),this.render()},onCopyAllClicked:function(e){var t,i,n,r,o,a,l,h,u,c,d;e.preventDefault(),a=this.model[this.selectedGroup],l=null,c=this.model;for(i in c)s.call(c,i)&&(t=c[i],i!==a.name&&(l=t));for(d=a.restrictions,h=0,u=d.length;u>h;h++)r=d[h],o=l.restrictions.some(function(e){return e.equals(r)}),n=r.clone(),r.models&&(n.models=r.models.clone()),o||l.restrictions.push(n);return this.selectedGroup=l.name,this.render()},getRestrictionFromEvent:function(e){var t,i,n,s;return t=$(e.target),s=t.parents("tr"),n=s.data("index"),i=t.parents(".tab-pane").data("group"),i=this.model[i],[i.restrictions[n],n,s,i]},serialize:function(){return{model:this.model,view:this,features:this.features,selectedGroup:this.selectedGroup}},getMixedGroups:function(){var e,t,i,n;i={},n=this.model;for(t in n)s.call(n,t)&&(e=n[t],i[t]=e.restrictions.some(function(e){return function(t){return null!=t.models&&t.models.length<e.features.length}}(this)));return i},getGroupTitle:function(e){var t,i,n;return e.fromSeg?e.fromSeg===e.toSeg?I18n.t("restrictions.group_title.uturn",{street:this.getStreetName(e.fromSeg)}):I18n.t("restrictions.group_title.node",{from_street:this.getStreetName(e.fromSeg),to_street:this.getStreetName(e.toSeg)}):(i=this.features.first(),n=this.getStreetName(i),t="fwdRestrictions"===e.name?i.getFwdHeading():i.getRevHeading(),I18n.t("restrictions.group_title.segment",{direction:I18n.t("segment.heading")[t],street:n}))},getStreetName:function(e){var t;return t=e.getAddressDetails(),(null!=t?t.streetName:void 0)||I18n.t("segment.address.none")},render:function(){return this.mixedGroups=this.getMixedGroups(),e.prototype.render.apply(this,arguments),this.$el.find(".past span").tooltip({title:I18n.t("restrictions.past")}),this.lastTab&&this.$el.find("a[href="+this.lastTab+"]").tab("show"),this.$el.find("tr.new").length?(this.$el.find("tr.new:first").get(0).offsetWidth,this.$el.find("tr").removeClass("new")):void 0}}),i.exports=n}).call(this)}}),this.require.define({"Waze/Presenter/Restriction/Modal":function(e,t,i){(function(){var e,n,s,r,o;s=t("Waze/Presenter/Restriction/Edit"),r=t("Waze/Presenter/Restriction/List"),n=t("Waze/Model/Object/Restriction"),e=t("Waze/Presenter"),o=OL.Class(e,{template:"restriction/layout",events:{"click .add-restriction":"addRestrictionClicked","click .done":"onDoneClicked","click .cancel-edit":"onCancelClicked",keydown:"onKeyDown"},listView:null,editView:null,model:null,editable:!1,features:null,initialize:function(){e.prototype.initialize.apply(this,arguments),this.listView=new r,this.editView=new s,this.editView.on("done",this.onEditDone,this),this.editView.on("cancel",this.onEditCancel,this),this.listView.on("editClicked",this.onEditClicked,this)},onKeyDown:function(e){return e.stopPropagation()},render:function(){return e.prototype.render.apply(this,arguments),this.$content=this.$el.find(".content"),this.$modal=this.$el.find(".modal"),this.$el.appendTo("body")},setModel:function(e,t,i){return this.model=e,this.features=t,this.editable=i,this.listView.setModel(this.model,this.features,this.editable)},setSelectedGroup:function(e){return this.listView.selectedGroup=e},insertInnerView:function(e){return this.$content.find(":first").detach(),this.$content.append(e.$el)},show:function(){return this.render(),this.listView.render(),this.insertInnerView(this.listView),this.$modal.modal({keyboard:!0,backdrop:"static"})},hide:function(){return this.$modal.modal("hide")},showEditViewFor:function(e,t){return this.editView.model=e,this.editView.group=t,this.editView.render(),this.insertInnerView(this.editView)},addRestrictionClicked:function(e){var t;return t=new n({isNew:!0,days:n.prototype.allDays,vehicleTypes:n.prototype.allVehicleTypes}),this.showEditViewFor(t,this.getGroupFromEvent(e))},onEditClicked:function(e){return this.showEditViewFor(e.restriction,e.group)},getGroupFromEvent:function(e){var t;return t=$(e.target).parents(".tab-pane").data("group"),this.model[t]},onEditDone:function(e){var t,i,n;return i=e.model,t=e.group,i.isNew&&(n=t.restrictions.some(function(e){return e.equals(i)}),n||(t.restrictions.push(i),i.models=this.features.clone())),this.insertInnerView(this.listView),n||this.listView.render(),delete i.isNew},onEditCancel:function(){return this.insertInnerView(this.listView)},onDoneClicked:function(){return this.fire("done")},onCancelClicked:function(){return this.fire("cancel")},destroy:function(){return this.$modal.removeData("modal"),this.$el.remove(),e.prototype.destroy.apply(this,arguments),this.editView.destroy(),this.listView.destroy()}}),i.exports=o}).call(this)}}),this.require.define({"Waze/Presenter/SandboxMessage":function(e,t,i){(function(){var e,n,s;n=t("Waze/Presenter"),e=t("Waze/Presenter/LoginForm"),s=OL.Class(n,{template:"login/sandbox-message",render:function(){var t;return t=n.prototype.render.apply(this,arguments),this.loginPresenter=new e({$el:this.$el.find(".login-form")}),this.loginPresenter.render(),this.loginPresenter.$el.on("click mousedown dragstart","input",function(e){return e.stopPropagation()}),this.loginPresenter.reset(),t},_onPlaymodeClicked:function(e){return e.preventDefault(),W.app.activateSandboxMode()},destroy:function(){return null!=this.loginPresenter&&this.loginPresenter.destroy(),n.prototype.destroy.apply(this,arguments)}}),i.exports=s}).call(this)}}),this.require.define({"Waze/Presenter/Sidebar":function(e,t,i){var n,s=t("Waze/Presenter"),r=t("Waze/Presenter/EditPanel");n=OpenLayers.Class(s,{$el:$("#sidebar"),featuresSelected:!1,loggedIn:!1,initialize:function(){s.prototype.initialize.apply(this,arguments),this.userTabs=$("#user-info"),this.editPanel=new r({dataModel:W.model,selectionManager:W.selectionManager}),W.selectionManager.events.on({selectionchanged:this.onSelectionChanged,scope:this})},onSelectionChanged:function(){this.featuresSelected=W.selectionManager.hasSelectedItems(),this.render()},onLoginChanged:function(){this.loggedIn=W.app.get("loggedIn"),this.render()},render:function(){this.featuresSelected?(this.editPanel.show(),this.userTabs.hide()):(this.editPanel.hide(),this.userTabs.show())}}),i.exports=n}}),this.require.define({"Waze/Presenter/StreetView":function(e,t,i){(function(){var e,n,s,r,o,a;s=t("Waze/Presenter"),a=t("Waze/Util"),e=t("Waze/DivIcon"),n=t("Waze/Handler/DragElement"),o=OL.Class(s,{DRAG_THROTTLE_MILLIS:200,elSelector:"#street-view-container",allowSelection:!0,panoramaView:null,panoramaOptions:{panControl:!0,panControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},enableCloseButton:!1,addressControl:!1,visible:!0},service:null,availabilityRadius:null,lastLocation:null,lastAngle:0,svActive:!1,map:null,zoomBarControl:null,events:{"click .close-button":"_closePanoramaView"},ui:{panoramaEl:".panorama"},initialize:function(){s.prototype.initialize.apply(this,arguments),this._findUiElements(),W.accelerators.events.register("closeStreetView",this,this._closePanoramaView),this.zoomBarControl.events.register("drawn",this,this._renderCrosshair),this._setupMap()},_activateSv:function(){return this.svActive?void 0:(this.svActive=!0,this.map.toggleSVMode(!0))},_deactivateSv:function(){return this.svActive?(this.lastLocation=null,this.lastAngle=0,this.svActive=!1,this.el.show(),this._getPanoramaView().setVisible(!1),this.pin.toggleVisibility(!1),this.map.toggleSVMode(!1)):void 0},_setupMap:function(){var e;return this.map.events.register("moveend",this,function(){var e;return this.availabilityRadius=null,e=this.map.getExtent().containsLonLat(this.pin.lonlat),this.svActive?this.el.toggle(!e):void 0}),this.markerLayer=new OL.Layer.Markers("streetViewPin",{displayInLayerSwitcher:!1}),this.map.addLayer(this.markerLayer),this.pin=new r(this.map.getCenter()||new OL.LonLat(0,0),this.map),this.pin.toggleVisibility(!1),this.markerLayer.addMarker(this.pin),this.pin.layer=this.markerLayer,$(this.markerLayer.div).addClass("street-view-layer"),e=_.throttle(this._onPinDrag,this.DRAG_THROTTLE_MILLIS),this.pin.events.on({dragStart:function(){return this.pin.toggleVisibility(!0),this.el.hide()},drag:function(t){return e.call(this,t)},dragCancel:function(){},dragDone:this._onPinDragDone,scope:this})},_onPinDrag:function(e){return this._isAvailable(e.svLonlat).done(function(e){return function(t){return e.pin.setPanoAvailable(!0),e.lastLocation=t.location}}(this)).fail(function(e){return function(){return e.lastLocation=null,e.pinLonlat=null,e.pin.setPanoAvailable(!1)}}(this))},_onPinDragDone:function(){return this.lastLocation?(this._activateSv(),this.pin.resetCrosshairAngle(),this._getPanoramaView(!0).setPano(this.lastLocation.pano),this._getPanoramaView().setPov({heading:this.lastAngle,pitch:0}),this._getPanoramaView().setVisible(!0)):(this._deactivateSv(),this.pin.toggleVisibility(!1),this.el.show())},_renderCrosshair:function(){return this.el&&this.el.off(".street-view-control"),this.el=$("<div/>").appendTo(this.zoomBarControl.streetViewContainer),this.el.addClass("street-view-control"),this.el.tooltip({title:I18n.t("street_view.tooltip"),placement:"right",container:"body",delay:{show:750}}),this.el.on("mousedown.street-view-control",function(e){return function(){return e.pin.setCrosshairLonlat(new OL.LonLat(0,0)),e.pin.setPanoAvailable(!1),e.pin.dragging.forceStart(!0),!1}}(this))},_getPanoramaView:function(e){return null==e&&(e=!1),null==this.panoramaView||e?(this.panoramaView=new google.maps.StreetViewPanorama(this.ui.panoramaEl.get(0),this.panoramaOptions),google.maps.event.addListener(this.panoramaView,"position_changed",function(e){return function(){var t,i;return i=e.panoramaView.getPosition(),i&&(t=new OL.LonLat(i.lng(),i.lat()),e.pin.setCrosshairLonlat(t),!e.map.getExtent().containsLonLat(t))?e.map.setCenter(t):void 0}}(this)),google.maps.event.addListener(this.panoramaView,"pov_changed",function(e){return function(){return e.lastAngle=e.panoramaView.getPov().heading,e.pin.setCrosshairAngle(e.lastAngle)}}(this)),google.maps.event.addListener(this.panoramaView,"visible_changed",function(e){return function(){return e.panoramaView.getVisible()?void 0:e._deactivateSv()}}(this)),this.panoramaView):this.panoramaView},_closePanoramaView:function(){return this.panoramaView.setVisible(!1)},_getService:function(){return this.service||(this.service=new google.maps.StreetViewService)},_getAvailabilityRadius:function(){return this.availabilityRadius||(this.availabilityRadius=2*this.pin.getCrosshairRadius())},_isAvailable:function(e,t){var i,n;return null==t&&(t=this._getAvailabilityRadius()),i=$.Deferred(),n=new google.maps.LatLng(e.lat,e.lon),this._getService().getPanoramaByLocation(n,Math.floor(t),function(e,t){return t===google.maps.StreetViewStatus.OK?i.resolve(e):i.reject()}),i},CLASS_NAME:"W.Presenter.StreetView"}),r=OL.Class(OL.Marker,{dragPointRadius:7,crossHairRadius:22,initialize:function(t,i){var s,r;null==i&&(i=null),OL.Marker.prototype.initialize.call(this,t,new e("pin",!0)),r=(this.crossHairRadius+this.dragPointRadius)/Math.sqrt(2),this.crossHairOffset=new OL.Pixel(-r,-r),this.svProjection=new OpenLayers.Projection("EPSG:4326"),this.map=i,this.render(),s=this.icon.$div,this.dragging=new n(this.map),this.dragging.down=function(e){return function(t){return s.addClass("dragging"),e.events.triggerEvent("dragStart",{xy:t.xy,marker:e})}}(this),this.dragging.force=function(e){return function(){return s.addClass("dragging"),e.events.triggerEvent("dragStart",{marker:e})}}(this),this.dragging.move=function(e){return function(t){var i;return e.lonlat=e.map.getLonLatFromViewPortPx(t.xy.offset(e.crossHairOffset)),i=e.lonlat.clone().transform(e.map.getProjectionObject(),e.svProjection),e.layer.drawMarker(e),e.events.triggerEvent("drag",{xy:t.xy,marker:e,svLonlat:i})}}(this),this.dragging.up=function(e){return function(){return s.removeClass("dragging"),e.events.triggerEvent("dragCancel",{})}}(this),this.dragging.done=function(e){return function(t){return e.icon.$div.removeClass("dragging"),e.events.triggerEvent("dragDone",{xy:t.xy,marker:e})}}(this),this.dragging.activate(this.dragHandle)},render:function(){return this.crossHair=$("<div />").addClass("crosshair").appendTo(this.icon.$div),this.dragHandle=$("<div />").addClass("drag-handle").appendTo(this.icon.$div),this.arrow=$("<div/>").append($("<i/>").addClass("icon-arrow-up arrow")).appendTo(this.crossHair)},setPanoAvailable:function(e){return this.icon.$div.toggleClass("pano-available",e)},setCrosshairAngle:function(e){return this.arrow.css({transform:"rotate("+e+"deg)"})},resetCrosshairAngle:function(){return this.setCrosshairAngle(0)},setCrosshairLonlat:function(e){return this.lonlat=e.transform(this.svProjection,this.map.getProjectionObject()),this.layer.drawMarker(this)},toggleVisibility:function(e){return this.icon.display(e)},getCrosshairRadius:function(){return this.crossHairRadius*this.map.getGeodesicPixelSize().h*1e3
}}),i.exports=o}).call(this)}}),this.require.define({"Waze/Presenter/UpdateRequest/CommentList":function(e,t,i){(function(){var e,n;n=t("Waze/Presenter"),e=OL.Class(n,{template:"update_request/comment_list",events:{"click [type=submit]":"onSubmitClicked","click .toggle-follow":"onToggleFollowClicked"},model:null,scrollPosition:null,initialize:function(){this.$el=$("<div/>").addClass("ur-comment-list"),n.prototype.initialize.apply(this,arguments),this.pm.map.events.register("resize",this,this.resize)},serialize:function(){return{model:this.model,view:this}},onSubmitClicked:function(e){var t,i;e.preventDefault(),i=this.$el.find(".new-comment-text"),t=i.val().trim(),t&&(this.toggleForm(!1),this.model.addComment(t).done(function(e){return function(t){return i.val(""),e.addCommentItem(t.comment),t.isAutoFollowed&&e.toggleFollowing(!0),e.fire("commentAdded")}}(this)).fail(function(){return window.alert("an error has occured")}).always(function(e){return function(){return e.toggleForm(!0)}}(this)))},addCommentItem:function(e){var t,i;return this.$el.find(".no-comments").remove(),i=this.$el.find("ul"),t=$(JST["templates/update_request/comment"]({comment:e})),t.addClass("fadeIn"),i.append(t),t.get(0).scrollIntoView(),t.removeClass("fadeIn")},toggleForm:function(e){return this.$el.find(".new-comment-form input,textarea,button").prop("disabled",!e)},onToggleFollowClicked:function(e){var t,i;return e.preventDefault(),t=this.$el.find(".toggle-follow"),i=this.model.isFollowing,this.model.isFollowing=!i,this.toggleFollowing(!i),this.toggleFollowButton(!1),this.model.toggleFollowConversation(!i).error(function(e){return function(){return e.model.isFollowing=i,e.toggleFollowing(i)}}(this)).always(function(e){return function(){return e.toggleFollowButton(!0)}}(this))},toggleFollowButton:function(e){return this.$el.find(".toggle-follow").prop("disabled",!e)},toggleFollowing:function(e){return this.$el.find(".toggle-follow").toggleClass("following",e)},resize:function(){return this.$el.height(this.pm.map.getHeight()-this.panelView.getHeight())},saveScrollPosition:function(){return this.scrollPosition=this.$el.find(".comment-list").get(0).scrollTop},restoreScrollPosition:function(){return this.scrollPosition?this.$el.find(".comment-list").get(0).scrollTop=this.scrollPosition:void 0},destroy:function(){return this.pm.map.events.unregister("resize",this,this.resize),n.prototype.destroy.apply(this,arguments)}}),i.exports=e}).call(this)}}),this.require.define({"Waze/Presenter/UserInfo":function(e,t,i){(function(){var e,n,s;n=t("Waze/Presenter"),e=t("Waze/Control/Archive"),s=OL.Class(n,{template:"login/user-info",rendered:!1,$el:$("#user-info"),render:function(){var t;return n.prototype.render.apply(this,arguments),t=W.loginManager.isLoggedIn(),t&&!this.rendered&&(this.archiveControl=new e,W.map.addControl(this.archiveControl),this.archiveControl.activate(),this.rendered=!0),null!=this.archiveControl?this.archiveControl.reset():void 0},serialize:function(){return{sandbox:this.model.get("sandbox"),user:this.model.get("user")}}}),i.exports=s}).call(this)}}),this.require.define({"Waze/Presenter/WelcomePopup":function(e,t,i){(function(){var e,n,s;n=t("Waze/Presenter/Popup"),e=t("Waze/Presenter/LoginForm"),s=OL.Class(n,{template:"login/welcome-popup",events:{"click .playmode":"_onPlaymodeClicked"},initialize:function(){return $.extend(this.events,n.prototype.events),n.prototype.initialize.apply(this,arguments)},render:function(){var t;return t=n.prototype.render.apply(this,arguments),this.loginPresenter=new e({$el:this.$el.find(".login-form")}),this.loginPresenter.render(),this.loginPresenter.reset(),t},_onPlaymodeClicked:function(e){return e.preventDefault(),W.app.activateSandboxMode()},destroy:function(){return null!=this.loginPresenter&&this.loginPresenter.destroy(),n.prototype.destroy.apply(this,arguments)}}),i.exports=s}).call(this)}}),this.require.define({"Waze/Region/Dialog":function(e,t,i){(function(){var e;e=Marionette.Region.extend({el:"#dialog-region",initialize:function(){return this.ensureEl(),this.$el.addClass("modal").attr("tabindex",-1),this.$el.on("hidden.bs.modal",function(e){return function(){return e.closeModal()}}(this)),this.$el.on("click",".cancel-button",function(e){return function(t){return t.preventDefault(),e.closeModal()}}(this))},closeModal:function(){return this.stopListening(this.currentView),this.$el.modal("hide"),this.$el.removeData(),this.close()},onShow:function(e){return e.$el.addClass("modal-dialog"),this.listenTo(e,"close",this.closeModal),this.$el.modal({keyboard:!0})}}),i.exports=e}).call(this)}}),this.require.define({"Waze/Region/Panel":function(e,t,i){(function(){var e;e=Marionette.Region.extend({el:"#panel-container",initialize:function(){return this.ensureEl(),this.$el.on("click",".close-panel",function(e){return function(){return e.close()}}(this))},onShow:function(e){return e.$el.addClass("panel")}}),i.exports=e}).call(this)}}),this.require.define({"Waze/Renderer/ExtendedSVG":function(e,t,i){var n,s=t("Waze/Util");n=OpenLayers.Class(OpenLayers.Renderer.SVG,{initialize:function(){OpenLayers.Renderer.SVG.prototype.initialize.apply(this,arguments),this.supportUse=!0},setAnimation:function(e,t){var i=document.createElementNS(this.xmlns,"animate");i.setAttributeNS(null,"attributeName",t.attributeName),i.setAttributeNS(null,"dur",t.dur),t.from&&i.setAttributeNS(null,"from",t.from),t.to&&i.setAttributeNS(null,"to",t.to),t.fill&&i.setAttributeNS(null,"fill",t.fill),t.begin&&i.setAttributeNS(null,"begin",t.begin),t.id&&i.setAttributeNS(null,"id",t.id),t.fill&&i.setAttributeNS(null,"fill",t.fill),e.appendChild(i)},setStyle:function(e,t){if(OpenLayers.Renderer.SVG.prototype.setStyle.apply(this,arguments),t.animation&&this.setAnimation(e,t.animation),t.mask&&e.setAttributeNS(null,"mask",t.mask),t.filter&&e.setAttributeNS(null,"filter",t.filter),s.defined(t.rx)&&e.setAttributeNS(null,"rx",t.rx),s.defined(t.ry)&&e.setAttributeNS(null,"ry",t.ry),s.defined(t.maskID)){var i,n=document.getElementById(t.maskID);n||(n=document.createElementNS(this.xmlns,"mask"),i=document.createElementNS(this.xmlns,"rect"),i.setAttributeNS(null,"x","0"),i.setAttributeNS(null,"y","0"),i.setAttributeNS(null,"width","100%"),i.setAttributeNS(null,"height","100%"),i.setAttributeNS(null,"fill","white"),n.setAttributeNS(null,"id",t.maskID),n.appendChild(i)),n.appendChild(e),n._style=t,e=n}return e},importSymbol:function(e){return this.symbolMetrics={},this.symbolMetrics[e]=[0,0,0],e},getNodeType:function(e,t){var i;return i=OpenLayers.Renderer.SVG.prototype.getNodeType.apply(this,arguments),"circle"===i&&s.defined(t.rx)&&s.defined(t.ry)&&(i="ellipse"),i},dashStyle:function(e,t){var i;if(e.strokeDashArray)return e.strokeDashArray;i=e.strokeWidth*t;var n=e.strokeDashstyle;switch(n){case"solid":return"none";case"dot":return[1,4*i].join();case"dash":return[4*i,4*i].join();case"dashdot":return[4*i,4*i,1,4*i].join();case"longdash":return[8*i,4*i].join();case"longdashdot":return[8*i,4*i,1,4*i].join();default:return OpenLayers.String.trim(n).replace(/\s+/g,",")}},CLASS_NAME:"Waze.Renderer.ExtendedSVG"}),i.exports=n}}),function(){this.Waze=this.Waze||this.W||{},this.W=this.Waze}.call(this),function(){Waze.Rule=OL.Class(OL.Rule,{getContext:function(e){return e},CLASS_NAME:"Waze.Rule"}),Waze.rule=function(e,t,i){return new Waze.Rule({filter:new OL.Filter({evaluate:function(i){var n;return null!=i.model&&(i=i.model),n=i[e],_.isFunction(n)&&(n=n.apply(i)),n===t}}),symbolizer:i})},Waze.defaultRule=function(e){return new Waze.Rule({filter:new OL.Filter({evaluate:function(){return!0}}),symbolizer:e})}}.call(this),this.require.define({"Waze/SelectionManager":function(e,t,i){(function(){var e,n,s,r={}.hasOwnProperty;e=t("Waze/Model/ObjectType"),s=t("Waze/Util"),n=OpenLayers.Class({selectedItems:null,events:null,layers:null,_objectTypeToLayer:null,selectControl:null,multiple:null,allowedSelections:null,currentSelectionMask:0,selectionCountByType:null,model:null,typeBitmap:null,initialize:function(e,t,i){var n,s,r,o;for(this.model=e,this.initAllowedSelections(),this.selectionCountByType={},this._getSelectableLayers(t),o=this.layers,s=0,r=o.length;r>s;s++)n=o[s],n.events.on({featureselected:this.itemsSelected,featureunselected:this.itemsUnselected,visibilitychanged:this.layerVisibilityChanged,beforefeatureselected:this.isSelectionValid,scope:this});OpenLayers.Util.extend(this,i),this.selectedItems=[],this.events=new OpenLayers.Events(this)},_getSelectableLayers:function(e){var t,i,n,s,r;for(this.layers=_(e).filter(function(e){return e.selectable}),this._objectTypeToLayer={},s=this.layers,r=[],i=0,n=s.length;n>i;i++)t=s[i],r.push(this._objectTypeToLayer[t.featureType]=t);return r},initAllowedSelections:function(){var t,i,n,s,o,a,l,h,u;o=Object.values(e).length,t=1,this.typeBitmap={},this.multiple={};for(a in e)r.call(e,a)&&(s=e[a],this.multiple[s]=s+"s",this.typeBitmap[s]=1<<t,this.typeBitmap[s+"s"]=1<<t+o,++t);for(this.allowedSelections={},s=e,n=[this.multiple[s.SEGMENT],s.SEGMENT,s.NODE,s.LANDMARK],u=[],l=0,h=n.length;h>l;l++)i=n[l],u.push(this.addAllowedSelection(i));return u},addAllowedSelection:function(e){return this.allowedSelections[this.typeBitmap[e]]=!0},layerVisibilityChanged:function(e){var t,i,n,s,r,o;if(i=e.object,!i.getVisibility()){for(r=this.selectedItems,o=[],n=0,s=r.length;s>n;n++)t=r[n],o.push(t.layer===i?this.selectControl.unselect(t):void 0);return o}},setSelectControl:function(e){return this.selectControl=e},destroy:function(){var e,t,i,n,s;for(n=this.layers,s=[],t=0,i=n.length;i>t;t++)e=n[t],null!=e&&s.push(e.events.un({featureselected:this.itemsSelected,featureunselected:this.itemsUnselected,visibilitychanged:this.layerVisibilityChanged,beforefeatureselected:this.isSelectionValid,scope:this}));return s},itemsSelected:function(e,t){var i,n,s,r;for(t=t||{},e=e.feature,_(e).isArray()||(e=[e]),n=!1,s=0,r=e.length;r>s;s++)i=e[s],this.selectedItems.contains(i)||(this.selectedItems.push(i),n=!0);return this.updateSelectionMask(),!t.silent&&n?this.events.triggerEvent("selectionchanged",{selected:this.selectedItems,reversedSegments:this.getReversedSegments()}):void 0},updateSelectionMask:function(){var e,t,i,n,o,a,l,h;for(this.selectionCountByType={},a=this.selectedItems,n=0,o=a.length;o>n;n++)t=a[n],s.defined(this.selectionCountByType[t.model.type])||(this.selectionCountByType[t.model.type]=0),this.selectionCountByType[t.model.type]++;this.currentSelectionMask=0,l=this.selectionCountByType,h=[];for(i in l)r.call(l,i)&&(e=l[i],h.push(1===e?this.currentSelectionMask+=this.typeBitmap[i]:this.currentSelectionMask+=this.typeBitmap[this.multiple[i]]));return h},itemsUnselected:function(e){var t,i,n,s;for(e=e.features,_(e).isArray()||(e=[e]),i=!1,n=0,s=e.length;s>n;n++)t=e[n],this.selectedItems.contains(t)&&(OpenLayers.Util.removeItem(this.selectedItems,t),i=!0);return this.updateSelectionMask(),i?this.events.triggerEvent("selectionchanged",{selected:this.selectedItems,reversedSegments:this.getReversedSegments()}):void 0},isSelectionValid:function(e){var t,i,n,r;return t=e.feature,r=t.model.type,this.selectionCountByType[r]?(n=this.currentSelectionMask|this.typeBitmap[this.multiple[r]],n&=~this.typeBitmap[r]):n=this.currentSelectionMask|this.typeBitmap[r],i=s.defined(this.allowedSelections[n]),i||(this.selectControl.unselectAll(),this.itemsSelected({feature:[t]})),!0},select:function(e){var t;return this.selectControl.unselectAll(this.selectedItems),t=e.map(function(e){return function(t){var i;return i=e._objectTypeToLayer[t.type],i.getVector(t)}}(this)),_.compact(t),this.selectControl.selectMultiple(t)},unselectAll:function(){return this.selectControl.unselectAll(this.selectedItems)},hasSelectedItems:function(){return!this.selectedItems.isEmpty()},bfs:function(e,t,i){var n,s,r,o,a,l,h,u,c,d,p,m,g;for(null==t&&(t=function(){return!0}),a=[e],u={},u[e.getID()]=e.getID();!a.isEmpty();)for(s=a.shift(),g=["from","to"],c=0,p=g.length;p>c;c++)for(o=g[c],r=s.attributes[""+o+"NodeID"],n=function(){var e,i,n,r;for(n=s.getConnectedSegments(o),r=[],e=0,i=n.length;i>e;e++)l=n[e],l.getID()!==s.getID()&&t(l)&&r.push(l);return r}(),d=0,m=n.length;m>d;d++)if(h=n[d],!u[h.getID()]){if(u[h.getID()]=s.getID(),i(h,r,o,n,s))return[h,u];a.push(h)}return[null,u]},getReversedSegments:function(){var e,t,i,n,s;return i=_(this.selectedItems).pluck("model"),e={multipleConnectedComponents:!1,numReversed:0},i.isEmpty()||!this.selectionCountByType.segment>=1?e:(e[i[0].getID()]=!1,s=this.bfs(i[0],function(e){return i.contains(e)},function(t,i,n,s,r){var o,a,l;return a="from"===n&&t.attributes.toNodeID!==i||"to"===n&&t.attributes.fromNodeID!==i,l=e[r.getID()],o=a?!l:l,e[t.getID()]=o,o&&e.numReversed++,!1}),t=s[0],n=s[1],Object.keys(n).length<this.selectedItems.length&&(e={multipleConnectedComponents:!0,numReversed:0}),e)},CLASS_NAME:"Waze.SelectionManager"}),i.exports=n}).call(this)}}),this.require.define({"Waze/Service/FlashService":function(e,t,i){var n=OpenLayers.Class({pendingFeatures:null,current:null,currentIntent:null,flashTimeMillis:100,flashIntent:"flash",initialize:function(e){OpenLayers.Util.extend(this,e),this.pendingFeatures=[],this.current=null},destroy:function(){this.pendingFeatures.splice(0,this.pendingFeatures.length)},addFeature:function(e){this.pendingFeatures.push(e),this.current||this.flash()},addFeatures:function(e){this.pendingFeatures=this.pendingFeatures.concat(e),this.current||this.flash()},flash:function(){if(this.current&&this.current.layer&&this.current.renderIntent===this.flashIntent&&this.current.layer.drawFeature(this.current,this.currentIntent),0===this.pendingFeatures.length)return void(this.current=null);if(this.current=this.pendingFeatures.shift(),this.current=W.map.segmentLayer.getVector(this.current),this.current){this.currentIntent=this.current.renderIntent,this.current.layer&&this.current.layer.drawFeature(this.current,this.flashIntent);var e=this;window.setTimeout(function(){e.flash()},this.flashTimeMillis)}},CLASS_NAME:"Waze.Service.FlashService"});i.exports=n}}),this.require.define({"Waze/Service/PseudoClipboard":function(e,t,i){(function(){var e;e=OL.Class({$el:null,copied:null,events:null,initialize:function(e){return this.$el=e,this.events=new OL.Events(this),this},setEl:function(e){return this.$el=e,e.on({mouseover:$.proxy(this._registerKeyHooks,this),mouseout:$.proxy(this._unregisterKeyHooks,this),scope:this})},_registerKeyHooks:function(){return $(document).on({keydown:$.proxy(this._onKeyDown,this),keyup:$.proxy(this._onKeyUp,this)})},_unregisterKeyHooks:function(){return $(document).off({keydown:$.proxy(this._onKeyDown,this),keyup:$.proxy(this._onKeyUp,this)})},_onKeyDown:function(e){return this.copied=!1,this.value&&(e.ctrlKey||e.metaKey)&&(67===e.keyCode&&(this.copied=!0),!$(e.target).is("input:visible,textarea:visible"))?_.defer(function(e){return function(){var t;return t=$("#clipboard-container"),t.empty().show(),$("<textarea id='clipboard'></textarea>").val(e.value).appendTo(t).focus().select()}}(this)):void 0},_onKeyUp:function(e){return $(e.target).is("#clipboard")&&(this.copied&&this.events.triggerEvent("copied",$("#clipboard-container #clipboard").val()),$("#clipboard-container").empty().hide()),this.copied=!1},set:function(e){this.value=e}}),i.exports=e}).call(this)}}),this.require.define({"Waze/Service/Services":function(e,t,i){var n,s=t("Waze/Service/FlashService"),r=t("Waze/Model/EventType");n=OpenLayers.Class({flashService:null,initialize:function(e,t){OpenLayers.Util.extend(this,t),this.model=e,this.flashService=new s},destroy:function(){this.flashService.destroy()},activate:function(){this.model.segments.events.register(r.CHANGED,this,this.onSegmentsChanged),this.model.segments.events.register(r.ADDED,this,this.onSegmentsAdded)},deactivate:function(){this.model.segments.events.unregister(r.CHANGED,this,this.onSegmentsChanged),this.model.segments.events.unregister(r.ADDED,this,this.onSegmentsAdded)},flash:function(e){e instanceof Array?this.flashService.addFeatures(e):this.flashService.addFeature(e)},onSegmentsChanged:function(e){for(var t=[],i=0,n=e.length;n>i;i++)e[i].state||t.push(e[i]);t.length>0&&this.flash(t)},onSegmentsAdded:function(e){for(var t=[],i=0;2>i;i++)for(var n=0,s=e.length;s>n;n++)e[n].state===OpenLayers.State.INSERT&&e[n].attributes.origIDs&&t.push(e[n]);t.length>0&&this.flash(t)},CLASS_NAME:"Waze.Service.Services"}),i.exports=n}}),function(){W.track=function(e,t){return W.Config.tracking.enable?mixpanel.track(e,t):void 0}}.call(this),this.require.define({"Waze/Util":function(e,t,i){var n={};n.isUndefined=function(e){return void 0===e},n.isDefined=function(e){return void 0!==e},n.defined=function(e){return"undefined"!=typeof e&&null!==e},n.localStorage={get:function(e){try{var t=localStorage.getItem(e);return t?JSON.parse(t):null}catch(i){return null}},set:function(e,t){try{return t=JSON.stringify(t),localStorage.setItem(e,t),!0}catch(i){return!1}}},n.copyAttributes=function(e,t,i){for(var s=0,r=i.length;r>s;s++)n.isDefined(t[i[s]])&&(e[i[s]]=t[i[s]])},n.protect=function(e,t,i){try{t.call(i)}catch(n){throw $.post(Waze.Config.paths.logger,{action:e,type:n.name,message:n.message,trace:n.stack}),n}},n.is=function(e,t){var i=Object.prototype.toString.call(t).slice(8,-1);return void 0!==t&&null!==t&&i===e},n.metricToImperial={km:"mi"},i.exports=n}}),this.require.define({"Waze/Utils/Activatable":function(e,t,i){var n=OpenLayers.Class({active:!1,autoActivate:!0,autoDestroy:!0,initialize:function(){},destroy:function(){this.deactivate()},activate:function(){return this.active?!1:(this.active=!0,!0)},deactivate:function(){return this.active?(this.active=!1,!0):!1},CLASS_NAME:"Waze.Activatable"});i.exports=n}}),Object.values=function(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(e[i]);return t},Object.keys||(Object.keys=function(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(i);return t}),Object.forEach=function(e,t,i){for(var n in e)e.hasOwnProperty(n)&&t.call(i,n,e[n])},Array.prototype.contains=function(e){return-1!==this.indexOf(e)},Array.prototype.isEmpty=function(){return 0===this.length},Object.printMap=function(e){var t="{";return Object.forEach(e,function(e,i){t+=e+": "+i+", "}),t+="}"},Array.prototype.unique=function(){for(var e=[],t=this.length,i=0;t>i;i++){for(var n=i+1;t>n;n++)this[i]===this[n]&&(n=++i);e.push(this[i])}return e},Array.prototype.uniqueBy=function(e){for(var t=[],i=this.length,n=0;i>n;n++){for(var s=n+1;i>s;s++)e(this[n],this[s])&&(s=++n);t.push(this[n])}return t},Array.prototype.union=function(e){var t=[];return t=this.concat(e),t.unique()},Array.prototype.remove=function(e){var t=this.indexOf(e),i=this.clone();return-1!==t&&i.splice(t,1),i},Array.prototype.min=function(){for(var e=this[0],t=this.length,i=1;t>i;i++)this[i]<e&&(e=this[i]);return e},Array.prototype.max=function(){for(var e=this[0],t=this.length,i=1;t>i;i++)this[i]>e&&(e=this[i]);return e},Array.prototype.intersect=function(){if(!arguments.length)return[];for(var e=this,t=null,i=null,n=0;n<arguments.length;){t=[],i=arguments[n];for(var s=e.length,r=i.length,o=0;s>o;o++)for(var a=0;r>a;a++)e[o]===i[a]&&t.push(e[o]);e=t,n++}return t.unique()},Array.prototype.equals=function(e){var t=this.length;if(t!==e.length)return!1;var i=this.clone().sort();return e=e.clone().sort(),i.every(function(t,i){return t===e[i]})},Array.prototype.clone=function(){return[].concat(this)},Array.prototype.last=function(){return this[this.length-1]},Array.prototype.first=function(){return this[0]},Number.prototype.toRad=function(){return this*Math.PI/180},Number.prototype.toDeg=function(){return this/Math.PI*180},Array.prototype.groupBy=function(e){for(var t={true:[],false:[]},i=0,n=this.length;n>i;i++)t[e.apply(this,[this[i]])].push(this[i]);return t},Array.prototype.toSet=function(){return this.reduce(function(e,t){return e[t]=!0,e},{})},$.fn.booleanVal=function(){var e=this.val();return"null"===e?null:"true"===e},this.require.define({"Waze/Utils/Geo":function(e,t,i){var n,s=t("Waze/Util");n={},n.EARTH_RADIUS_KM=6371,n.EARTH_CIRC_KM=40075,n.getHeading=function(e,t){var i=Math.atan2(t.y-e.y,t.x-e.x).toDeg();return i=(360+i)%360,Math.round(i/45)%8},n.destinationOnPlane=function(e,t,i){t=t.toRad();var s,r,o=1e3*n.EARTH_RADIUS_KM;return s=Math.cos(t)*i/(o*Math.cos(e.lat.toRad())),r=Math.sin(t)*i/o,new OL.LonLat(s.toDeg()+e.lon,r.toDeg()+e.lat)},n.distanceOnPlane=function(e,t){var i,s=((e.lat+t.lat)/2).toRad(),r=(e.lon-t.lon).toRad(),o=(e.lat-t.lat).toRad();return i=1e3*n.EARTH_RADIUS_KM*Math.sqrt(o*o+Math.pow(Math.cos(s)*r,2))},n.getPointAlongLine=function(e,t,i){var r,o,a,l,h=e,u=t,c=0;for(s.defined(i)?(r=i,c=n.getPointEdge(h,i)):r=h[c];c<h.length-1;){if(o=h[c+1],l=r.distanceTo(o),!(u-l>0)){a=u/l,r=new OpenLayers.Geometry.Point((1-a)*r.x+a*o.x,(1-a)*r.y+a*o.y);break}r=o,u-=l,c++}return r},n.getDistanceToPointOnLine=function(e,t){for(var i=e.distanceTo(t,{details:!0}).line,n=new OL.Geometry.Point(i.x1,i.y1),s=new OL.Geometry.Point(i.x2,i.y2),r=0,o=e.components,a=o.length,l=0;a-1>r;r++){if(o[r].equals(s)&&o[r+1].equals(n)||o[r].equals(n)&&o[r+1].equals(s))return l+=o[r].distanceTo(t);l+=o[r].distanceTo(o[r+1])}return l},n.getPointEdge=function(e,t,i){var n,r=0,o=e.length-1,a=!1,l=Number.POSITIVE_INFINITY,h=0;s.defined(i)||(i=0);do n=OpenLayers.Geometry.distanceToSegment(t,{x1:e[r].x,y1:e[r].y,x2:e[r+1].x,y2:e[r+1].y}).distance,l>n&&(l=n,h=r),i>=n&&(a=!0),r++;while(!a&&o>r);return a||(r=h),r-1},n.parse=function(e){var t=OL.Format.GeoJSON.prototype.parseGeometry(e);return n.project(t),t},n.project=function(e){e.transform(W.Config.map.projection.remote,W.Config.map.projection.local)},OL.Geometry.LineString.prototype.distanceTo=function(e,t){var i,n,s,r,o=!(t&&t.edge===!1),a=o&&t&&t.details,l={},h=Number.POSITIVE_INFINITY;if(e instanceof OpenLayers.Geometry.Point){var u,c=this.getSortedSegments(),d=e.x,p=e.y;for(s=0,r=c.length;r>s;++s)if(u=c[s],i=OpenLayers.Geometry.distanceToSegment(e,u),i.distance<h){if(h=i.distance,l=i,n=u,0===h)break}else if(u.x2>d&&(p>u.y1&&p<u.y2||p<u.y1&&p>u.y2))break;l=a?{distance:l.distance,x0:l.x,y0:l.y,x1:d,y1:p,line:n}:l.distance}else if(e instanceof OpenLayers.Geometry.LineString){var m,g,f,y,v,b=this.getSortedSegments(),L=e.getSortedSegments(),w=L.length,S={point:!0};e:for(s=0,r=b.length;r>s;++s){m=b[s],y=m.x1,v=m.y1;for(var C=0;w>C;++C){if(g=L[C],f=OpenLayers.Geometry.segmentsIntersect(m,g,S)){h=0,l={distance:0,x0:f.x,y0:f.y,x1:f.x,y1:f.y};break e}i=OpenLayers.Geometry.distanceToSegment({x:y,y:v},g),i.distance<h&&(h=i.distance,l={distance:h,x0:y,y0:v,x1:i.x,y1:i.y})}}if(a||(l=l.distance),0!==h&&m){i=e.distanceTo(new OpenLayers.Geometry.Point(m.x2,m.y2),t);var O=a?i.distance:i;h>O&&(l=a?{distance:h,x0:i.x1,y0:i.y1,x1:i.x0,y1:i.y0}:O)}}else l=e.distanceTo(this,t),a&&(l={distance:l.distance,x0:l.x1,y0:l.y1,x1:l.x0,y1:l.y0});return l},OL.Geometry.Collection.prototype.distanceTo=function(e,t){for(var i,n,s,r=!(t&&t.edge===!1),o=r&&t&&t.details,a=Number.POSITIVE_INFINITY,l=0,h=this.components.length;h>l&&(i=this.components[l].distanceTo(e,t),s=o?i.distance:i,!(a>s&&(a=s,n=i,n.model=this.components[l].model,0===a)));++l);return n},OL.Geometry.Point.prototype.toLonLat=function(){return new OL.LonLat(this.x,this.y)},OL.LonLat.prototype.toPoint=function(){return new OL.Geometry.Point(this.lon,this.lat)},OL.Geometry.LinearRing.prototype.getCentroid=function(){if(this.components){var e=this.components.length;if(e>0&&2>=e)return this.components[0].clone();if(e>2){var t,i,n,s=0,r=0,o=this.components[0].x,a=this.components[0].y,l=-1*this.getArea();if(0!==l){for(t=0;e-1>t;t++){var h=this.components[t],u=this.components[t+1];s+=(h.x+u.x-2*o)*((h.x-o)*(u.y-a)-(u.x-o)*(h.y-a)),r+=(h.y+u.y-2*a)*((h.x-o)*(u.y-a)-(u.x-o)*(h.y-a))}i=o+s/(6*l),n=a+r/(6*l)}else{for(t=0;e-1>t;t++)s+=this.components[t].x,r+=this.components[t].y;i=s/(e-1),n=r/(e-1)}return new OpenLayers.Geometry.Point(i,n)}return null}},i.exports=n}}),this.require.define({"Waze/Utils/Visitor":function(e,t,i){var n,s=t("Waze/Util");n=OpenLayers.Class({visit:function(e){var t=this[e.CLASS_NAME.split(".").last()];return s.defined(t)||(t=this._default),t.call(this,e)},_default:function(){},CLASS_NAME:"Waze.Util.Visitor"}),n.Order={PRE:0,POST:1,IN:2},i.exports=n}}),this.require.define({"Waze/VectorStyles/All":function(e,t,i){(function(){i.exports={virtualVertices:{strokeWidth:2,strokeColor:"#00d8ff",strokeOpacity:1,pointRadius:4,fillColor:"#ffffff",fillOpacity:.4},permalinkMarker:new OL.StyleMap({default:new OL.Style({externalGraphic:W.imagePath+"location_pin.png",graphicYOffset:-53,graphicWidth:37,graphicHeight:53})})}}).call(this)}}),this.require.define({"Waze/VectorStyles/Cameras":function(e,t,i){(function(){var e,t,n,s,r;s=W.rule("_cameraRotator",!0,{pointRadius:7,strokeOpacity:1,strokeColor:"#aaaaaa",fillColor:"#ff3300",fillOpacity:1,strokeWidth:2,externalGraphic:null}),e=W.rule("_cameraAnchor",!0,{pointRadius:25,strokeOpacity:1,strokeColor:"#aaaaaa",fillColor:"#ffffff",strokeWidth:0,externalGraphic:null,fillOpacity:0}),t=W.rule("type","camera",{}),r=[s,t,e],n=function(e){return new OpenLayers.Style(e,{rules:r,context:{getAzymuth:function(e){var t;return null!=(t=e.model)?t.attributes.azymuth:void 0},getType:function(e){var t;return null!=(t=e.model)?t.attributes.type:void 0},getValidated:function(e){var t;return null!=(t=e.model)?t.attributes.validated:void 0}}})},i.exports=new OpenLayers.StyleMap({default:n({externalGraphic:W.imagePath+"vectors/cameras/camera${getType}${getValidated}.png",pointRadius:18,rotation:"${getAzymuth}"}),highlight:n({pointRadius:22}),select:n({pointRadius:22}),highlightselected:n({pointRadius:22}),drag:n({pointRadius:22})})}).call(this)}}),this.require.define({"Waze/VectorStyles/ManagedAreas":function(e,t,i){(function(){i.exports=new OpenLayers.StyleMap({default:new OpenLayers.Style({fillOpacity:.3,strokeOpacity:.7,strokeWidth:2,strokeColor:"#333",label:"${getLabel}",fontColor:"#333",labelOutlineColor:"white",labelOutlineWidth:2,fontSize:14,fontWeight:"bold",fillColor:"${getFillColor}"},{context:{getLabel:function(e){return e.model.getUserName()},getFillColor:function(e){var t,i;return t=e.model.userID%16777216,i=t.toString(16),"#"+i}}}),highlight:new OpenLayers.Style({strokeOpacity:1,strokeWidth:5,fontSize:18})})}).call(this)}}),this.require.define({"Waze/VectorStyles/Nodes":function(e,t,i){(function(){var e,t,n,s;n="#03b9da",e="#ff8383",t="#eb7171",s=7,i.exports=new OpenLayers.StyleMap({default:new OpenLayers.Style(null,{rules:[W.defaultRule({pointRadius:s,strokeWidth:0,fillOpacity:0}),W.rule("isUnchanged",!1,{fillColor:e,fillOpacity:1})]}),highlight:new OpenLayers.Style(null,{rules:[W.defaultRule({pointRadius:s,strokeWidth:0,fillColor:n,fillOpacity:1}),W.rule("isUnchanged",!1,{fillOpacity:1,fillColor:t})]})})}).call(this)}}),this.require.define({"Waze/VectorStyles/Segments":function(e,t,i){(function(){var e,t,n,s,r,o,a,l,h,u;e="#ff8383",n="#03b9da",s="#eb7171",r="#00d8ff",t="#000010",o=6,l=new OpenLayers.Style({strokeOpacity:1,strokeDashstyle:"dash",strokeColor:e,strokeWidth:2}),a={strokeWidth:o,strokeOpacity:1},h=new OpenLayers.Rule({filter:new OpenLayers.Filter({evaluate:function(e){return e.model&&e.layer.colorEmptyStreetSegments&&e.model.hasEmptyStreet()}}),symbolizer:{strokeWidth:9,strokeOpacity:.55,strokeColor:"red",strokeLinecap:"butt"}}),u=function(e){var t;return t=W.defaultRule({Line:a}),new OL.Style(null,{rules:[t].concat(e)})},i.exports=new OpenLayers.StyleMap({default:u([W.rule("isUnchanged",!0,{strokeOpacity:0}),W.rule("isUnchanged",!1,{strokeColor:e})]),highlight:u([W.defaultRule({strokeColor:n}),W.rule("isUnchanged",!1,{strokeColor:s})]),select:u(W.defaultRule({strokeColor:r})),highlightselected:u(W.defaultRule({strokeColor:n})),delete:l,highlightdeleted:l,drag:u(W.defaultRule({strokeColor:r})),flash:u(W.defaultRule({strokeColor:t,strokeOpacity:.8}))})}).call(this)}}),this.require.define({"Waze/VectorStyles/Sketch":function(e,t,i){(function(){var e,t,n,s,r={}.hasOwnProperty;s={dragPoint:{strokeWidth:3,strokeColor:"#00d8ff",strokeOpacity:1,pointRadius:6,fillColor:"white",fillOpacity:1},fromNodeDragPoint:{fontSize:10,fontColor:"#222222",strokeWidth:3,strokeColor:"#00d8ff",strokeOpacity:1,pointRadius:10,label:"A",fillColor:"white",fillOpacity:1},toNodeDragPoint:{fontSize:10,fontColor:"#222222",strokeWidth:3,strokeColor:"#00d8ff",strokeOpacity:1,pointRadius:10,label:"B",fillColor:"white",fillOpacity:1},sketchNode:{pointRadius:9,strokeOpacity:1,strokeColor:"white",fillColor:"#03b9da",fillOpacity:1,strokeWidth:3},cameraRotator:{pointRadius:7,strokeOpacity:1,strokeColor:"#aaaaaa",fillColor:"#ff3300",fillOpacity:1,strokeWidth:2},highlightPlaceHolder:{strokeColor:"transparent",strokeOpacity:0,strokeWidth:30}},t=function(){var t;t=[];for(e in s)r.call(s,e)&&(n=s[e],t.push(W.rule("_"+e,!0,n)));return t}(),i.exports=new OpenLayers.StyleMap({default:new OpenLayers.Style(null,{rules:t}),highlight:new OpenLayers.Style(null,{rules:t})})}).call(this)}}),this.require.define({"Waze/VectorStyles/Venues":function(e,t,i){(function(){var e,t,n,s,r,o,a,l,h,u,c,d,p,m,g,f,y,v;s="#c290c6",e="#00ece3",r="#ca9ace",t="#ff8383",n="#ff9292",m={strokeColor:r,fillColor:s,strokeDashstyle:"solid",strokeOpacity:1,strokeWidth:2,fillOpacity:.3,graphicZIndex:"${getZIndex}"},p={pointRadius:6,strokeWidth:2,strokeColor:"white",fillColor:s,graphicZIndex:0,fillOpacity:1},o={CAR_SERVICES:"\ue001",TRANSPORTATION:"\ue007",PROFESSIONAL_AND_PUBLIC:"\ue000",SHOPPING_AND_SERVICES:"\ue008",FOOD_AND_DRINK:"\ue002",CULTURE_AND_ENTERTAINEMENT:"\ue003",OTHER:"\ue004",LODGING:"\ue005",OUTDOORS:"\ue006",NATURAL_FEATURES:"\ue009"},v=function(e){var t;return t=W.defaultRule({Point:p,Polygon:m}),new OL.Style(null,{rules:[t].concat(e),context:{getZIndex:function(e){var t;return t=e.geometry.getBounds(),-Math.floor(t.getHeight()*t.getWidth())},getCategoryIcon:function(e){var t,i;return t=null!=(i=e.model)?i.getMainCategory():void 0,o[t]||""}}})},g=W.defaultRule({Point:{fillColor:e,strokeColor:e,fontFamily:"FontAwesome",label:"\uf111",labelOutlineWidth:0,fontColor:"white",fontSize:11,labelYOffset:0,pointRadius:12,strokeOpacity:1,fillOpacity:.3},Polygon:{strokeColor:e,fillColor:e}}),h=W.defaultRule({Point:{fillColor:t,strokeDashstyle:"dot",fillOpacity:.3},Polygon:{strokeDashstyle:"dash",strokeColor:"white",fillColor:t}}),l=W.rule("isUnchanged",!1,{Point:{fillColor:t},Polygon:{fillColor:t,strokeColor:t}}),a=W.rule("isUnchanged",!1,{Point:{fillColor:n},Polygon:{fillColor:n,strokeColor:n}}),y=W.rule("isApproved",!1,{Point:{pointRadius:6,fillColor:s,strokeWidth:3,strokeColor:e},Polygon:{fillColor:r,strokeColor:e,strokeDashstyle:"dash"}}),f=W.rule("_sketch",!0,{externalGraphic:null,strokeWidth:3,strokeColor:"#00d8ff",strokeOpacity:1,pointRadius:6,fillColor:"white",fillOpacity:1,graphicZIndex:0}),d={stroke:!1,pointRadius:12,fillColor:"white",fillOpacity:.6,graphicZIndex:0,fontSize:16,fontColor:"#3d3d3d",labelOutlineWidth:0,fontFamily:"FontAwesome",label:"\uf047"},c=W.rule("dragPoint",!0,d),u=W.rule("dragPoint",!0,_.defaults({fillColor:"#25d7fd",fillOpacity:.3},d)),i.exports=new OL.StyleMap({default:v([f,c,l,y]),highlight:v([W.defaultRule({Point:{fontFamily:"WazeFont",label:"${getCategoryIcon}",labelOutlineWidth:0,fontColor:"white",fontSize:16,labelYOffset:-3,pointRadius:12,fillColor:r,fillOpacity:1,strokeOpacity:1},Polygon:{strokeColor:r,fillColor:r}}),f,u,a]),select:v([g]),highlightselected:v([g]),delete:v([h]),highlightdeleted:v([h])})}).call(this)}}),this.require.define({"Waze/View/Archive":function(e,t,i){var n=OpenLayers.Class({ResultsPerPage:5,$element:null,events:null,initialize:function(e){this.events=new OpenLayers.Events(this),this.$element=e,this.render()},render:function(){var e=this;this.$element.delegate(".result","click",function(){var t=this.dataset.id;$(this).hasClass("session-available")&&e.events.triggerEvent("sessionClicked",{id:t})}),$('a[href="#'+this.$element.attr("id")+'"]').on("show.bs.tab",function(){e.events.triggerEvent("shown")})},destroy:function(){this.events.destroy()},setLoading:function(e){e?(this.$element.find(".result-list-container").empty(),this.$element.find(".pagination").addClass("loading"),this.$element.find(".loading-animation").removeClass("hide")):(this.$element.find(".pagination").removeClass("loading"),this.$element.find(".loading-animation").addClass("hide"))},setSessions:function(e){this.$element.find(".result-list-container").empty(),this.$element.find(".pagination").toggle(e>this.ResultsPerPage),this.$element.find(".pagination").pagination(e,{callback:OpenLayers.Function.bind(this.onPaginationLinkClicked,this),items_per_page:this.ResultsPerPage,num_display_entries:this.ResultsPerPage-1,next_text:"",prev_text:"",num_edge_entries:1,ellipse_text:"..."})},setSessionsPage:function(e,t,i){var n=this;this.$element.find(".result-list-container").stacheComb("archive-sessions",{sessions:e,username:t,isStaff:i}).then(function(){n.$element.find(".sessions-search form").on("submit",function(e){e.preventDefault();
var t=$(e.target);n.events.triggerEvent("searchSubmitted",{username:t.find("input[name=username]").val()})})})},setSelectedSession:function(e){this.$element.find("#archive-sessions .result").removeClass("selected"),null!==e&&this.$element.find("#archive-sessions .result[data-id="+e+"]").addClass("selected")},onPaginationLinkClicked:function(e){this.events.triggerEvent("paginationLinkClicked",{index:e})},onAreaPaginationLinkClicked:function(e){this.events.triggerEvent("areasPaginationLinkClicked",{index:e})},showError:function(){this.$element.find(".error").removeClass("hide")},reset:function(){},show:function(){},hide:function(){},CLASS_NAME:"Waze.View.Archive"});i.exports=n}}),this.require.define({"Waze/View/ArchivePanel":function(e,t,i){var n,s=t("Waze/View/Panel");n=OpenLayers.Class(s,{initialize:function(e,t){var i=this;s.prototype.initialize.apply(this,[e,t]),this.$element.on("click",".create-road",function(){return i.events.triggerEvent("createRoadClicked"),!1})},setSession:function(e){this.$element.stacheComb("archive-panel",{session:e})},setExtendedSessionInfo:function(e,t){this.$element.stacheComb("archive-panel",{session:e,addresses:t.getEndPointAddresses(),averageSpeed:e.getAverageSpeed()})},update:function(){var e=this.$element.find(".create-road");this.pm.selectedDrivePart?e.removeAttr("disabled"):e.attr("disabled","disabled")},CLASS_NAME:"Waze.View.ArchivePanel"}),i.exports=n}}),this.require.define({"Waze/View/EditableAreas":function(e,t,i){var n=OpenLayers.Class({ResultsPerPage:5,$element:null,events:null,initialize:function(e){this.events=new OpenLayers.Events(this),this.$element=e,this.render()},render:function(){var e=this;this.$element.delegate(".result","click",function(){var t=this.dataset.id;e.events.triggerEvent("areaClicked",{id:t})})},destroy:function(){this.events.destroy()},setLoading:function(e){e?(this.$element.find(".result-list-container").empty(),this.$element.find(".pagination").addClass("loading")):this.$element.find(".pagination").removeClass("loading")},setEditableAreas:function(e){this.$element.find(".result-list-container").empty(),this.$element.find(".pagination").toggle(e>this.ResultsPerPage),this.$element.find(".pagination").pagination(e,{callback:OpenLayers.Function.bind(this.onAreaPaginationLinkClicked,this),items_per_page:this.ResultsPerPage,num_display_entries:this.ResultsPerPage-1,next_text:"",prev_text:"",num_edge_entries:1,ellipse_text:"..."})},setEditableAreasPage:function(e){this.$element.find(".result-list-container").stacheComb("editable-areas",{areas:e})},onAreaPaginationLinkClicked:function(e){this.events.triggerEvent("areasPaginationLinkClicked",{index:e})},reset:function(){},show:function(){},hide:function(){},CLASS_NAME:"Waze.View.EditableAreas"});i.exports=n}}),this.require.define({"Waze/View/KeyboardShortcutEditor":function(e,t,i){var n,s=t("Waze/Control/KeyboardShortcuts");n=OpenLayers.Class({events:null,$element:null,currentAction:null,active:!1,initialize:function(){var e=this;this.$element=$("#keyboard-dialog"),this.events=new OpenLayers.Events(this),W.accelerators.events.register("showShortcutsDialog",this,function(){this.show()}),$(window).bind("keydown.shortcut-editor",OpenLayers.Function.bind(this.onKeyDown,this)),$(window).bind("keyup.shortcut-editor",OpenLayers.Function.bind(this.onKeyUp,this)),this.$element.delegate(".shortcut-action","click",function(){e.onActionClicked(this.dataset.action)}),this.$element.on("hide.bs.modal",OpenLayers.Function.bind(this.onDialogClose,this)),this.$element.on("show.bs.modal",function(){e.activate()})},activate:function(){this.render(),this.active=!0},show:function(){this.activate(),this.$element.modal("show")},onDialogClose:function(){this.active=!1},render:function(){this.$element.stacheComb("keyboard_shortcuts/modal",{groups:Waze.accelerators.Groups})},renderList:function(){this.$element.find(".modal-body").stacheComb("keyboard_shortcuts/list",{groups:Waze.accelerators.Groups})},onActionClicked:function(e){this.currentAction&&this.currentAction.removeClass("selected"),this.currentAction=this.$element.find(".shortcut-action[data-action="+e+"]"),this.currentAction.addClass("selected")},onKeyDown:function(e){var t=String.fromCharCode(e.which),i=e.which;if(this.active&&this.currentAction)return e.stopImmediatePropagation(),(t.match(/^[a-zA-Z0-9]+/)||Object.keys(Waze.accelerators.SpecialKeys).contains(i.toString()))&&(Waze.accelerators.registerShortcut(new s.KeyStroke(e).toString(),this.currentAction.get(0).dataset.action,!0),this.currentAction.removeClass("selected"),Waze.accelerators.persist(),this.currentAction=null,this.renderList()),!1},onKeyUp:function(e){this.active&&this.currentAction&&e.stopImmediatePropagation()},getModifiersString:function(e){var t="";return e.shiftKey&&(t+="Shift+"),e.ctrlKey&&!e.metaKey&&(t+="Control+"),e.altKey&&(t+="Alt+"),e.metaKey&&(t+="Command+"),t},getShortcutCode:function(e,t){var i="";return e.shiftKey&&(i+="S"),(e.ctrlKey||e.metaKey)&&(i+="C"),e.altKey&&(i+="A"),i+"+"+t},destroy:function(){this.events.destroy()},CLASS_NAME:"Waze.View.KeyboardShortcutEditor"}),i.exports=n}}),this.require.define({"Waze/View/MapProblems":function(e,t,i){var n,s=t("Waze/View/Panel");n=OpenLayers.Class(s,{map:null,currentProblem:null,showingExtendedInfo:!1,initialize:function(e,t){s.prototype.initialize.apply(this,[e,t]);var i=this;this.$element=e,this.map=t,this.$element.delegate("input[name=state]","change.map-problems",function(){i.events.triggerEvent("problemchanged",{problem:i.currentProblem,changes:{state:this.value}})}),this.$element.delegate("input[name=sessionDisplay]","change.map-problems",OpenLayers.Function.bind(this.requestedSessionTypesChanged,this)),this.$element.on("click",".close-button",function(){i.hide()}),this.$element.on("click",".zoom-to-problem-button",function(){i.events.triggerEvent("zoomToProblem")}),this.$element.on("click",".collapse-panel-button",function(){i.$element.addClass("collapsed"),i.events.triggerEvent("render")}),this.$element.on("click",".expand-panel-button",function(){i.$element.removeClass("collapsed"),i.events.triggerEvent("render")})},setProblem:function(e,t){var i=this.currentProblem===e;this.currentProblem&&this.currentProblem.getID()===e.getID()&&this.currentProblem.id!==e.id&&(e.attributes.open=this.currentProblem.attributes.open,e.attributes.resolution=this.currentProblem.attributes.resolution,this.events.triggerEvent("problemchanged",{problem:this.currentProblem})),this.currentProblem=e,this.showingExtendedInfo=t,i||null===this.currentProblem||this.updateProblemDetails(e)},problemsChanged:function(e){this.currentProblem&&e.contains(this.currentProblem)&&this.updateProblemDetails(this.currentProblem)},updateProblemDetails:function(e){e===this.currentProblem&&(this.render(e),this.requestedSessionTypesChanged())},render:function(e){var t=this;this.$element.stacheComb("map-problem-panel",{problem:this.currentProblem,problemState:this.currentProblem.getState(),message:I18n.t("problems.types."+e.attributes.problemType),showExtendedInfo:this.showingExtendedInfo,isTurnProblem:"turnProblem"===e.type,pm:this.pm}).then(function(){t.$element.find(".problem-display-options label").tooltip()}),s.prototype.render.apply(this,arguments)},getRequestedSessionTypes:function(){var e={};return this.$element.find(".problem-display-options input").each(function(){e[this.value]=this.checked}),e},requestedSessionTypesChanged:function(){this.events.triggerEvent("requestedSessionTypesChanged",this.getRequestedSessionTypes())},CLASS_NAME:"Waze.View.MapProblems"}),i.exports=n}}),this.require.define({"Waze/View/MapProblemsExplanation":function(e,t,i){var n=OpenLayers.Class({$element:null,currentProblem:null,events:null,initialize:function(e){var t=this;this.events=new OpenLayers.Events(this),this.$element=e,this.$element.find("button").live("click",function(){t.events.triggerEvent("solveProblemsClicked",{problem:t.currentProblem})}),this.hide(),this.render()},problemsChanged:function(e){var t=e.getObjectArray(function(e){return e.attributes.open});this.currentProblem=t.first(),this.render()},destroy:function(){this.events.destroy()},show:function(){this.$element.show()},hide:function(){this.$element.hide()},render:function(){this.$element.stacheComb("map-problem-explanation",{problem:this.currentProblem})},CLASS_NAME:"Waze.View.MapProblemsExplanation"});i.exports=n}}),this.require.define({"Waze/View/Panel":function(e,t,i){var n=OpenLayers.Class({$element:null,map:null,events:null,initialize:function(e,t){var i=this;this.$element=e,this.map=t,e.on("click.map-panel",".close-button",function(){i.hide()}),this.events=new OpenLayers.Events(this)},destroy:function(){this.events.destroy()},show:function(){this.$element.removeClass("panel-hidden"),this.$element.addClass("panel-shown"),this.$element.show(),this.map.addPanel(this)},hide:function(){this.$element.addClass("panel-hidden"),this.$element.removeClass("panel-shown"),this.events.triggerEvent("panelClosed"),this.map.restoreTopControls(),OpenLayers.Element.removeClass(this.map.viewPortDiv,"PanelOpen")},render:function(){this.events.triggerEvent("render")},getHeight:function(){return this.$element.hasClass("collapsed")?this.$element.find(".panel-action").outerHeight():this.$element.height()},CLASS_NAME:"Waze.View.Panel"});i.exports=n}}),this.require.define({"Waze/View/RoadClosures":function(e,t,i){(function(){var e,n,s,r,o;s=t("Waze/View/Panel"),n=t("Waze/Presenter/FeatureEditor"),o=t("Waze/Action/UpdateObject"),e=t("Waze/Action/DeleteObject"),r=OpenLayers.Class(s,{map:null,datePicker:null,datePickerObj:null,timePicker:null,timePickerObj:null,changing:!1,initialize:function(e,t){s.prototype.initialize.apply(this,arguments),this.$element.on("change","input:not([data-type=date]), select",$.proxy(this.attributeChanged,this)),this.$element.on("click",".delete",$.proxy(this.onDeleteClicked,this)),this.$element=e,this.map=t},attributeChanged:function(e){var t,i,s,r;return t=$(e.target),i=t.attr("name"),r=n.prototype.serializeElement(t),s={},s[i]=r,this.updateModel(s)},endDateChanged:function(){return this.updateModel({endDate:+this.getEndTimeInMillis()})},endTimeChanged:function(){return this.updateModel({endDate:+this.getEndTimeInMillis()})},getEndTimeInMillis:function(){var e,t;return e=this.datePickerObj.getDate(),t=this.timePickerObj.hour,this.timePickerObj.meridian&&this.timePickerObj.hour<12&&(t+=12),e.set({hour:t,minute:this.timePickerObj.minute,second:0})},updateModel:function(e){return this.changing=!0,this.pm.model.actionManager.add(new o(this.pm.selectedClosure,e)),this.changing=!1},onDeleteClicked:function(){return this.pm.model.actionManager.add(new e(this.pm.selectedClosure))},render:function(){return this.changing?void 0:(this.datePicker&&this.datePicker.datepicker("remove"),this.timePicker&&this.timePicker.timepicker("remove"),this.$element.stacheComb("closures/panel",this.pm.selectedClosure),this.initDatePicker(),this.initTimePicker())},initTimePicker:function(){return this.timePicker=this.$element.find("input[name=endTime]"),this.timePicker.timepicker({showMeridian:!1}),this.timePicker.timepicker().on("changeTime.timepicker",$.proxy(this.endTimeChanged,this)),this.timePickerObj=this.timePicker.data("timepicker")},initDatePicker:function(){return this.datePicker=this.$element.find(".date-picker"),this.datePicker.datepicker(),this.datePicker.datepicker("setDate",new Date(this.pm.selectedClosure.endDate)),this.datePicker.on("changeDate",$.proxy(this.endDateChanged,this)),this.datePickerObj=this.datePicker.data("datepicker")},CLASS_NAME:"Waze.View.RoadClosures"}),i.exports=r}).call(this)}}),this.require.define({"Waze/View/SaveProblems":function(e,t,i){var n=OpenLayers.Class({defaultErrorCode:700,$element:null,$header:null,$description:null,events:null,initialize:function(e){var t=this;this.$element=e,this.$header=$("#save-problem-panel-error",e),this.$description=$("#save-problem-panel-error-description",e),this.$details=$("#save-problem-panel-error-details",e),$(".panel-navigation .close-button").bind("click.save-problems",function(){t.hide(),t.events.triggerEvent("panelClosed")}),this.events=new OpenLayers.Events(this)},destroy:function(){this.events.destroy()},setProblem:function(e,t){var i=I18n.t("save_error.types"),n=i[e.code];n||(n=i[this.defaultErrorCode]),this.$header.text(n.title),this.$description.text(n.solution),this.$details.text(e.details),this.$details.toggle(t)},show:function(){this.$element.removeClass("panel-hidden"),this.$element.addClass("panel-shown"),this.$element.show()},hide:function(){this.$element.addClass("panel-hidden"),this.$element.removeClass("panel-shown")},CLASS_NAME:"Waze.View.SaveProblems"});i.exports=n}}),this.require.define({"Waze/View/Tutorial":function(e,t,i){var n=OpenLayers.Class({videos:["intro","before_you_start","getting_started","basic_terms","basic_editing","map_problems","examples"],videoDetails:null,$element:null,player:null,currentVideo:null,YoutubePlayerStates:{End:0},initialize:function(e){var t=this;this.$element=e,this.videoDetails=I18n.t("tutorial.videos"),this.$element.delegate(".video-menu .video-link","click",function(){t.onVideoSectionClicked(this.dataset.videoKey)}),this.$element.delegate(".dialog-close-button","click",function(){t.$element.modal("hide"),t.onDialogClose()}),this.$element.on("show.bs.modal",function(){t.initPlayer()})},initPlayer:function(){var e=this,t=this.videos.first(),i=this.videoDetails[t].video_id;$.when(this.getYoutubePlayer()).done(function(n){e.$element.find(".video-menu").show(),e.setSelectedVideoLink(t),e.$element.data("bs.modal").isShown?n.loadVideoById(i):n.cueVideoById(i)})},onDialogClose:function(){this.player&&this.player.stopVideo()},render:function(){return this.$element.stacheComb("tutorial-lightbox",{videos:this.videos})},onVideoSectionClicked:function(e){this.setSelectedVideoLink(e),this.player.loadVideoById(this.videoDetails[e].video_id)},setSelectedVideoLink:function(e){this.currentVideo=e,this.$element.find(".video-link").removeClass("active"),this.$element.find(".video-link[data-video-key="+e+"]").addClass("active")},onPlayerStateChanged:function(e){var t=e.data;t===this.YoutubePlayerStates.End&&this.playNextVideo()},playNextVideo:function(){var e,t,i=this.videos.indexOf(this.currentVideo)+1;i>=this.videos.length&&(i=0),t=this.videos[i],e=this.videoDetails[t].video_id,this.setSelectedVideoLink(t),0===i?this.player.cueVideoById(e):this.player.loadVideoById(e)},getYoutubePlayer:function(){var e=this,t=$.Deferred();if(null!==this.player)return this.player;this.render().then(function(){$.getScript("https://www.youtube.com/player_api")}),window.onYouTubePlayerAPIReady=function(){delete window.onYouTubePlayerAPIReady,new window.YT.Player("tutorial-player",{height:"481",width:"800",playerVars:{wmode:"transparent",modestbranding:1,rel:0,showinfo:0,showsearch:0},events:{onReady:i,onStateChange:$.proxy(e.onPlayerStateChanged,e)}})};var i=function(i){e.player=i.target,t.resolve(e.player)};return t},CLASS_NAME:"Waze.View.Tutorial"});i.exports=n}}),this.require.define({"Waze/View/UpdateRequests":function(e,t,i){var n,s=t("Waze/View/Panel"),r=t("Waze/Presenter/UpdateRequest/CommentList");n=OpenLayers.Class(s,{pm:null,changing:!1,commentListView:null,confirmationShown:!1,initialize:function(e,t){s.prototype.initialize.apply(this,[e,t]);var i=this;this.$element.delegate("input[name=state]","change.update-requests",function(){var e=parseInt(this.value,10),t=e===i.pm.currentRequest.ResolutionType.NOT_A_PROBLEM||e===i.pm.currentRequest.ResolutionType.FIXED,n=!0;return t&&i.pm.isSessionAvailable()&&i.pm.requestSession.hasPendingComments()&&!i.confirmationShown&&(i.confirmationShown=!0,n=window.confirm(I18n.t("update_requests.panel.confirm"))),n?(i.changing=!0,i.events.triggerEvent("requestChanged",{changes:{state:e}}),void(i.changing=!1)):void i.render()}),this.$element.delegate("input[name=sessionDisplay]","change.update-requests",OpenLayers.Function.bind(this.requestedSessionTypesChanged,this)),this.$element.delegate(".zoom-to-ur-button","click",function(){i.events.triggerEvent("zoomToUR")}),this.$element.delegate(".collapse-panel-button","click",function(){i.$element.addClass("collapsed"),i.events.triggerEvent("render"),i.resizeCommentListView()}),this.$element.delegate(".expand-panel-button","click",function(){i.$element.removeClass("collapsed"),i.events.triggerEvent("render"),i.resizeCommentListView()}),this.$element.delegate(".toggle-comment-view","click",function(){i.events.triggerEvent("showCommentViewToggled",{show:!i.pm.showCommentView}),i.$element.find(".toggle-comment-view").toggleClass("comment-view-shown",i.pm.showCommentView),i.$element.find(".conversation-container").toggle(i.pm.showCommentView)})},update:function(e){this.changing||(e&&(this.confirmationShown=!1,this.destroyCommentListView()),this.pm.isSessionAvailable()&&null===this.commentListView&&(this.commentListView=new r({model:this.pm.requestSession,pm:this.pm,panelView:this}),this.commentListView.on("commentAdded",this.onCommentAdded,this),this.commentListView.render(),this.commentListView.resize()),this.pm.shouldShowPanel()?(this.show(),this.updateRequestDetails(),null!==this.commentListView&&this.commentListView.resize()):this.commentListView&&this.commentListView.destroy())},updateRequestDetails:function(){this.render()},render:function(){null!==this.commentListView&&(this.commentListView.saveScrollPosition(),this.commentListView.$el.detach()),this.$element.stacheComb("update_request/panel",this.pm),null!==this.commentListView&&(this.$element.find(".conversation-container").append(this.commentListView.$el),this.commentListView.restoreScrollPosition()),s.prototype.render.apply(this,arguments)},getRequestedSessionTypes:function(){var e={};return this.$element.find(".problem-display-options input").each(function(){e[this.value]=this.checked}),e},requestedSessionTypesChanged:function(){this.events.triggerEvent("requestedSessionTypesChanged",{types:this.getRequestedSessionTypes()})},resizeCommentListView:function(){this.commentListView&&this.commentListView.resize()},onCommentAdded:function(){this.$element.find(".num-comments").text(this.pm.requestSession.comments.length),this.events.triggerEvent("commentAdded",{})},destroyCommentListView:function(){this.commentListView&&(this.commentListView.destroy(),this.commentListView=null)},hide:function(){this.destroyCommentListView(),s.prototype.hide.apply(this,arguments)},CLASS_NAME:"Waze.View.UpdateRequests"}),i.exports=n}}),this.require.define({"Waze/ViewHelpers":function(e,t,i){var n=t("Waze/Model/Object/User"),s=t("Waze/HidableMessage"),r=t("Waze/Util"),o={};window.HAML.globals=function(){return{t:function(){return I18n.t.apply(I18n,arguments)},safe_t:o.safe_t,h:o}},o.safe_t=function(e,t){var i,n={};return Object.forEach(t,function(e){n[e]="%{"+e+"}"}),i=HAML.escape(I18n.t(e,n)),Object.forEach(t,function(e,t){t.htmlSafe||(t=HAML.escape(t)),i=i.replace(new RegExp("%\\{"+e+"\\}"),t)}),i},o.safeString=function(e){var t=new String(e);return t.htmlSafe=!0,t},o.contentTag=function(e,t){return t=HAML.escape(t),this.safeString("<"+e+">"+t+"</"+e+">")},o.link=function(e,t,i){e=HAML.escape(e);var n="";return i=i||{},i.href=t,Object.forEach(i,function(e,t){n+=" "+e+"="+t}),this.safeString("<a"+n+">"+e+"</a>")},o.radio=function(e,t,i,n,s){e=HAML.escape(e),t=HAML.escape(t);var r="<input type='radio' name='"+t+"' value='"+i+"' id='"+t+"-"+i+"'";return i===n&&(r+=" checked "),s===!1&&(r+=" disabled "),r+="/><label for='"+t+"-"+i+"'>"+e+"</label>"},o.option=function(e,t,i,n,s){var r="<option value='"+HAML.escape(t)+"'";return i instanceof Array||t!==i&&(n||parseInt(t,10)!==parseInt(i,10))||(r+=" selected"),s&&(r+=" disabled"),r+=">"+HAML.escape(e)+"</option>"},o.categoryOption=function(e,t){return o.option(I18n.t("venues.categories."+t),t,e[t]?t:null,!0)},o.roadTypeOption=function(e,t){return o.option(I18n.t("segment.road_types."+t),t,e.attributes.roadType)},o.directionOption=function(e,t){return o.option(I18n.t("segment.direction."+t),t,e.attributes.direction)},o.formatDate=function(e){return e?new Date(e).toDateString():""},o.durationString=function(e,t){var i=t-e,n=i/6e4,s=n/60,r="";return s=Math.floor(s),1===s?r="1 hour ":s>1&&(r=s+" hours "),n=Math.floor(n-60*s),r+=1===n?"1 min":n+" min"},o.dateOnlyString=function(e){function t(e,i){return e.toString().length<i?t("0"+e,i):e}if(!e)return"";var i=new Date,n=new Date(e),s=(i-n)/864e5,r="",o=!1,a=!1,l=!1,h=["January","February","March","April","May","June","July","August","September","October","November","December"];return i.getFullYear()===n.getFullYear()&&(o=!0,i.getMonth()===n.getMonth()&&(a=!0,i.getDate()===n.getDate()&&(l=!0))),r+=l?I18n.t("date.today"):2>s?I18n.t("date.yesterday"):h[n.getMonth()]+" "+t(n.getDate(),2),o||(r+=", "+n.getFullYear()),r},o.dateString=function(e){function t(e,i){return e.toString().length<i?t("0"+e,i):e}var i,n=(new Date,new Date(e));return e?(i=o.dateOnlyString.apply(this,arguments),i+=", "+t(n.getHours(),2)+":"+t(n.getMinutes(),2)):""},o.distanceString=function(e){var t=W.model.isImperial?r.metricToImperial.km:"km",i=e*OpenLayers.INCHES_PER_UNIT.m/OpenLayers.INCHES_PER_UNIT[t];return i.toFixed(2)+t},o.formatAddress=function(e){return e?e.replace(/,$/,""):""},o.areaString=function(e){var t=W.model.isImperial?r.metricToImperial.km:"km",i=e*Math.pow(OpenLayers.INCHES_PER_UNIT.m,2);return(i/Math.pow(OpenLayers.INCHES_PER_UNIT[t],2)).toFixed(2)+" "+t+"\xb2"},o.formatUserName=function(e){var t,i=W.model.users.get(e);return i?(t=i.temporary?I18n.t("user.temporary"):i.userName,t+"("+(i.isStaffUser()?"staff":i.normalizedLevel)+")"):e},o.formatRank=function(e){return e===n.prototype.StaffRank?I18n.t("edit.segment.lock_levels.staff"):n.normalizeLevel(e)},o.segmentRankOption=function(e,t,i){var n,s=!1;return null===t?(n=I18n.t("edit.segment.lock_levels.automatic",{rank:o.formatRank(e.attributes.rank)}),i||(s=!0)):n=o.formatRank(t),o.option(n,t,e.attributes.lockRank,!1,s)},o.getDisplayUnitValue=function(e,t,i,n){var s;return n.model.isImperial&&(t=r.metricToImperial[t]),s=n.attributes[e]*OpenLayers.INCHES_PER_UNIT[n.UNITS[e]]/OpenLayers.INCHES_PER_UNIT[t],i&&(s=Math.round(s)),s},o.getDisplayUnit=function(e,t){return t.model.isImperial?r.metricToImperial[e]:e},o.shortcutMaskToKeys=function(e){var t,i="";return["alt","ctrl","shift"].forEach(function(n){t=n+"Key",e[t]&&(i+="<kbd class='"+HAML.escape(t)+"'><span>"+HAML.escape(t)+"</span></kbd> + ")}),i},o.getShortcutKey=function(e){var t=Waze.accelerators.SpecialKeys[e.keyCode];return t||(t=String.fromCharCode(e.keyCode)),t},o.hidableMessage=function(e){var t=new s(e);return t.shouldShow()?t.render():""},o.formatDays=function(e){var t,i=o._groupDays(e);return t=i.map(function(e){return e.length>1?I18n.t("date.abbr_day_names")[e[0]]+"-"+I18n.t("date.abbr_day_names")[e.last()]:I18n.t("date.abbr_day_names")[e[0]]}),t.join(",")},o.formatOpeningHour=function(e){var t=o.formatDays(e.get("days"));return t+=e.isAllDay()?" "+I18n.t("time_span.all_day"):" "+e.get("fromHour")+"-"+e.get("toHour")},o._groupDays=function(e){var t,i=[],n=[],s=e.sort();return"monday"===I18n.t("date.first_day")&&0===s[0]&&(s.shift(),s.push(0)),t=s[0],s.forEach(function(e,r){Math.abs(e-t)%6<=1?n.push(e):(i.push(n),n=[e]),r===s.length-1&&i.push(n),t=e}),i},o.formatPlaceAddress=function(e){var t=e.getAddressDetails();if(null===t)return null;var i,n=t.houseNumber;return i=[t.streetName,t.cityName],i.push(t.hasState?t.stateName:t.countryName),i=i.join(", "),r.defined(n)&&(i=n+" "+i),i},o.formatVenueCategories=function(e){return e=e.map(function(e){return I18n.t("venues.categories."+e)}),e.join(", ")},o.formatVenueServices=function(e){return e=e.map(function(e){return I18n.t("venues.services."+e)}),e.join(", ")},o.formatVenueName=function(e){return e||"Unnamed"},i.exports=o}}),function(){var e,t,i,n,s,r,o,a,l,h,u,c,d,p,m,g,f,y,v,b;e=require("Waze/AppPresenter"),u=require("Waze/Presenter/LocationSwitcher"),s=require("Waze/EditingMediator"),n=require("Waze/Controller"),o=require("Waze/View/KeyboardShortcutEditor"),m=require("Waze/Control/SaveProblems"),c=require("Waze/Control/MapProblems"),f=require("Waze/Control/UpdateRequests"),r=require("Waze/Control/GeometryEditing"),g=require("Waze/View/Tutorial"),d=require("Waze/Model/Marx"),a=require("Waze/Model/LiveUsersMapAdapter"),l=require("Waze/Model/LiveUsers"),h=require("Waze/Presenter/LiveUsers"),t=require("Waze/Model/Chat"),i=require("Waze/Presenter/Chat"),p=require("Waze/Presenter/PlaceUpdate/Layer"),require("Waze/ViewHelpers"),$(document).ready(function(){var t;return t=require("Waze/App"),W.app=new t,W.appPresenter=new e({model:W.app}),W.app.on("change:loading",b),W.app.start()}),b=function(){var e;return(new u).render(),W.controller=new n,W.editingMediator=new s,W.editingMediator.activate(),W.map.setEditingMediator(W.editingMediator),y(),W.accelerators.registerDefaultShortcuts(W.map),W.accelerators.restore(),e=new o,W.accelerators.activate()},y=function(){var e,t;return e=new m,W.map.addControl(e),e.activate(),W.problemsControl=new c,W.updateRequestsControl=new f,W.map.addControls([W.problemsControl,W.updateRequestsControl]),W.problemsControl.activate(),W.updateRequestsControl.activate(),new p({$el:W.map.placeUpdatesLayer.$div}),v(),W.geometryEditing=new r(W.selectionManager),t=new g($("#tutorial-dialog")),$(".waze-header .version").length?$.get(W.Config.api_base+"/info/version").done(function(e){return $(".waze-header .version").append(", "+e.version)}):void 0},v=function(){var e,n,s,r,o,u;if(W.Config.chat.enable)return u=new d(W.model),s=new a(W.model,u,W.map),r=new l(W.model,u,s),o=new h({model:r,map:W.map}),e=new t.Chat(W.model,u),n=new i({model:e,marx:u,liveUsersPresenter:o,map:W.map}),W.model.chat=e,W.model.liveUsers=r}}.call(this);
